(function(){ try {var elementStyle = document.createElement('style'); elementStyle.appendChild(document.createTextNode(".d-slider.svelte-qzeq9z.svelte-qzeq9z{position:relative}.d-slider.svelte-qzeq9z .d-slider__runway.svelte-qzeq9z{width:100%;background-color:#333;position:relative;cursor:pointer;vertical-align:middle}.d-slider.svelte-qzeq9z .d-slider__runway .d-slider__cursor.svelte-qzeq9z,.d-slider.svelte-qzeq9z .d-slider__runway .d-slider__preload.svelte-qzeq9z,.d-slider.svelte-qzeq9z .d-slider__runway .d-slider__bar.svelte-qzeq9z{position:absolute;top:0;left:0;height:100%}.d-slider.svelte-qzeq9z .d-slider__runway .d-slider__cursor.svelte-qzeq9z{display:none;z-index:1;width:1px;background:#fff;pointer-events:none}.d-slider.svelte-qzeq9z .d-slider__runway .d-slider__cursor .d-slider__tips.svelte-qzeq9z{pointer-events:none;color:#fff;position:absolute;white-space:nowrap;z-index:2;bottom:14px;left:50%;padding:4px;box-sizing:border-box;display:block;font-size:12px;background:rgba(0,0,0,.6);border-radius:3px;transform:translate(-50%)}.d-slider.svelte-qzeq9z .d-slider__runway:hover .d-slider__cursor.svelte-qzeq9z{display:block}.d-slider.svelte-qzeq9z .d-slider__runway .d-slider__preload.svelte-qzeq9z{background-color:#717171}.d-slider.svelte-qzeq9z .d-slider__runway .d-slider__bar.svelte-qzeq9z{background:linear-gradient(to right,var(--primary-color) 0%,var(--primary-color-end) 80%,var(--primary-color-end) 100%)}.d-slider.svelte-qzeq9z .d-slider__runway .d-slider__bar.svelte-qzeq9z:before{display:block;content:\"\";position:absolute;right:-6px;top:50%;width:5px;height:5px;transition:.2s;transform:translateY(-50%) scale(1);border-radius:50%;background:#fff;border:5px solid var(--primary-color)}.d-slider.is-vertical.svelte-qzeq9z.svelte-qzeq9z{height:100px;display:inline-block}.d-slider.is-vertical.svelte-qzeq9z .d-slider__runway.svelte-qzeq9z{position:relative;height:100%;margin:0 6px}.d-slider.is-vertical.svelte-qzeq9z .d-slider__runway .d-slider__preload.svelte-qzeq9z,.d-slider.is-vertical.svelte-qzeq9z .d-slider__runway .d-slider__bar.svelte-qzeq9z,.d-slider.is-vertical.svelte-qzeq9z .d-slider__runway .d-slider__cursor.svelte-qzeq9z{bottom:0;top:auto;width:100%}.d-slider.is-vertical.svelte-qzeq9z .d-slider__runway .d-slider__cursor.svelte-qzeq9z{height:1px}.d-slider.is-vertical.svelte-qzeq9z .d-slider__runway .d-slider__bar.svelte-qzeq9z:before{top:-6px;left:50%;width:5px;height:5px;transform:translate(-50%) scale(1)}.d-progress-bar.svelte-qzeq9z.svelte-qzeq9z{position:absolute;left:0;right:0;bottom:0;width:100%;transition:height .1s;height:3px;z-index:1}.d-progress-bar.svelte-qzeq9z .d-slider__runway.svelte-qzeq9z{transition:height .1s;height:100%!important}.d-progress-bar.svelte-qzeq9z .d-slider__runway .d-slider__bar.svelte-qzeq9z:before{transform:translateY(-50%) scale(0)}.d-progress-bar.svelte-qzeq9z.svelte-qzeq9z:hover{height:100%}.d-progress-bar.svelte-qzeq9z:hover .d-slider__bar.svelte-qzeq9z:before{transform:translateY(-50%) scale(1)!important}.d-player-filter-panel-item.svelte-qzeq9z .d-slider__runway.svelte-qzeq9z{background-color:#999}.d-player-filter-panel-item.svelte-qzeq9z .d-slider__runway .d-slider__bar.svelte-qzeq9z:before{width:5px;height:5px}.filter-panel-slider.svelte-qzeq9z.svelte-qzeq9z{width:100%}.d-switch.svelte-31e6zs.svelte-31e6zs{position:relative;height:18px;transition:background .2s;background:#757575;border-radius:10px;display:inline-flex;align-items:center;vertical-align:middle}.d-switch.svelte-31e6zs .d-switch__input.svelte-31e6zs{position:relative;z-index:1;margin:0;width:100%;height:100%;opacity:0}.d-switch.svelte-31e6zs .d-switch_action.svelte-31e6zs{position:absolute;transition:.2s;left:2px;top:2px;z-index:0;height:5px;width:5px;background:#fff;border-radius:50%}.d-switch.is-checked.svelte-31e6zs.svelte-31e6zs{background-color:var(--primary-color)}.d-switch.is-checked.svelte-31e6zs .d-switch_action.svelte-31e6zs{left:100%;background:#fff;margin-left:-18px}.d-icon.svelte-6alrox{display:inline-block;cursor:pointer;overflow:hidden}.icon-play.svelte-6alrox{margin-left:5px}div.svelte-1sesy3u.svelte-1sesy3u,span.svelte-1sesy3u.svelte-1sesy3u,h5.svelte-1sesy3u.svelte-1sesy3u,i.svelte-1sesy3u.svelte-1sesy3u,ul.svelte-1sesy3u.svelte-1sesy3u,li.svelte-1sesy3u.svelte-1sesy3u{margin:0;padding:0;border:0;font-size:100%;font:inherit;vertical-align:baseline}ul.svelte-1sesy3u.svelte-1sesy3u{list-style:none}@keyframes svelte-1sesy3u-rotating{to{-webkit-transform:rotate(360deg)}}.d-player-contextmenu.svelte-1sesy3u.svelte-1sesy3u,.d-player-dialog.svelte-1sesy3u.svelte-1sesy3u{position:absolute;left:0;top:0;bottom:50px;width:100%;z-index:5}.d-player-contextmenu.svelte-1sesy3u .d-player-copyText.svelte-1sesy3u{opacity:0}.d-player-contextmenu.svelte-1sesy3u .d-player-contextmenu-body.svelte-1sesy3u{position:absolute;border-radius:5px;font-size:12px;background:rgba(0,0,0,.8);color:#efefef;text-align:left;min-width:130px;box-sizing:border-box;padding:5px 0}.d-player-contextmenu.svelte-1sesy3u .d-player-contextmenu-body li.svelte-1sesy3u{padding:8px 20px;margin:0;cursor:pointer;transition:.2s}.d-player-contextmenu.svelte-1sesy3u .d-player-contextmenu-body li.svelte-1sesy3u:hover{background-color:#ffffff1a}.d-player-dialog.svelte-1sesy3u.svelte-1sesy3u{display:flex;justify-content:center;align-items:center}.d-player-dialog.svelte-1sesy3u .d-player-dialog-body.svelte-1sesy3u{background-color:#212121e6;border-radius:5px;color:#fff;min-width:200px;padding:0 0 10px}.d-player-dialog.svelte-1sesy3u .d-player-dialog-body .d-player-dialog-title.svelte-1sesy3u{text-align:center;position:relative;font-size:14px;font-weight:400;margin:0 0 10px;padding:12px 0;border-bottom:1px solid rgba(255,255,255,.15)}.d-player-dialog.svelte-1sesy3u .d-player-dialog-body .d-player-dialog-title .icon-close.svelte-1sesy3u{position:absolute;right:0px;top:0px;width:40px;height:40px;line-height:40px;text-align:center;cursor:pointer}.d-player-dialog.svelte-1sesy3u .d-player-dialog-body .d-player-hotkey-panel.svelte-1sesy3u{font-size:12px;color:#eee;padding-right:40px}.d-player-dialog.svelte-1sesy3u .d-player-dialog-body .d-player-hotkey-panel .d-player-hotkey-panel-item.svelte-1sesy3u{line-height:26px}.d-player-dialog.svelte-1sesy3u .d-player-dialog-body .d-player-hotkey-panel .d-player-hotkey-panel-item span.svelte-1sesy3u{text-align:center;display:inline-block;width:120px}.d-player-dialog.svelte-1sesy3u .d-player-dialog-body .d-player-hotkey-panel .d-player-hotkey-panel-item span.svelte-1sesy3u:nth-child(2){color:#999;width:160px}.d-player-dialog.svelte-1sesy3u .d-player-dialog-body .d-player-filter-panel.svelte-1sesy3u{width:320px;padding:0 20px;text-align:center}.d-player-dialog.svelte-1sesy3u .d-player-dialog-body .d-player-filter-panel .d-player-filter-reset.svelte-1sesy3u{text-align:center;cursor:pointer;margin-top:10px;padding:3px 20px;display:inline-block;border-radius:2px;font-size:12px;background:rgba(133,133,133,.5)}.d-player-dialog.svelte-1sesy3u .d-player-dialog-body .d-player-filter-panel .d-player-filter-reset.svelte-1sesy3u:hover{background:rgba(255,255,255,.3)}.d-player-dialog.svelte-1sesy3u .d-player-dialog-body .d-player-filter-panel .d-player-filter-panel-item.svelte-1sesy3u{height:32px;display:flex;align-items:center}.d-player-dialog.svelte-1sesy3u .d-player-dialog-body .d-player-filter-panel .d-player-filter-panel-item span.svelte-1sesy3u{font-size:12px;display:block;width:80px;text-align:center}@font-face{font-family:iconfont;src:url(data:font/woff2;base64,d09GMgABAAAAAAf8AAsAAAAAD4AAAAesAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHFQGYACENAqQFI0gATYCJAMwCxoABCAFhGcHgRgbMA2jopRwhpH9xYEN7tEpwmIWXYlFbb0abbZI79LiOw8i759JE179cG04wTl4/lv73fdGdx1R7dBpePptO1IS0ROpEcucKY175977I5ZAEaYoB0Q+Sa9AyUuuH/ScmnFzExLIzqhN/27WA9pOSYBUSFMxoWIeqfuqJXeerBhQVrSma0bPHPxEe3/ryvP/O+8/vROmlEQSRRMb+GBOkyUgmdUv+7V8hmli/aG/EQqjplPxhHhyzZqoot6oROqNaqXSKgZrk2NVhFlY/ZvcBwGlU5v65uH5PUwdTjXMG8CGCvxoOVnCYeQmYnMKReR61X3j5QMHvfVHAO926uUnuiIo12AXut4HEbykIr8L6H/aqH1DN1cH6ytwwIDDgUnkzVf9Mi7j0GaVaYnWE2DczO1k+hWpS8cpyCzf5CG/v3tHvNa6IaYQ47zm7FpAEBVKVWcVleX4f16HsmrgftwVUiERBKQaQURqmOSxWwgowe5AqsY+hgAD9hkQCPIqAkW+QWCRBwQO+b0zfkj7zAJ2gT5gJrCcEZcy6q0k3pSWkWHj8nBmZvSUUTb8osN2s7NDvrdXy9Nj4OEpqIEIvRY3HgSKcZQwjtJS3DAytmYBP1FU9L3/95QyIMBkIg04lxMG42lHgjNnKzFOrpIelGoMuImUo5gYJWZmUln8gHHvebdwWjfAxMiUA08YhQPUsgelIOQoXHGTqgkpVLI6d55j9PHwK3FoAKBNZegLJupaYE4OgIPZDEU4VcoVnJw+yCoYJen8nooeZg8xh1dw1+lr7A1GPcBNDk+wU8z0R01PQJedZwEdOML6T/GY+RYOlQNVsVO4MJiynUNHad+DrMMYE6DECxPPp6YsmfmLfp2jszO+HSMX5vo5LbCgYXV9bicOrFDPI+TcNONAwuZOU5CInQB8k9z0KgEz9ZSDFCihUQLabhIWc9NrYIEIVIt5EDeskrA3qt9YDSPcdWDh2noLxHILj1c9ftyZVExBrBQf8ycPXZmJm19yxEd8SYWUnZDiw0f9KkHFyBEnQj4Jcxg16keoLs9e4FUXajyAkA/hOBh1+Jg/Tl5LwCHyShpOUqd85NsS6mQKJi6nUgR+0pNoYU0mxmzmjEZAGzSGurFL12bo2euXuavqeWbuxpUtKbNGQ2iq2mxKa2AdyOXblidgpmGYUnKTwMpEF0wUhCW+Sl/MlhKt0VCRaqbMpInEKxD6pEgh8IGMIZ3sKPbsO/4vhZPlndlsfQomL4051Z+cnFZpte02mX84Q8W1f5S7vYclBFYebq0HtaA4rCgkWDBKvPeaGbmxvnFjdCbI3Zqgv6QTvUUL7L0a5TmVoBTsSRkYStwLSjNLLKTOxQPr9mdUgALwUWxvm3tmT8FIqQ+I/vy5X6tMeE7iu1gRZnVOOLPKskb4PWbpek46J8lysdRZnctd0dXPIVtIdd8P3BB4TlLsQCz/PvQXdA4U+IFAO6tPRJy+kcbtFQmnbWZsp/HBt5RDf6N/299F71a8L1l2XHZ56PjwpMl5c/zm2L74vuE4iUzk6ypzk+373pWIJ+O74jvzg5EPfTfYIJQ3ZXfEednV2RMJQTydXZdZZ5sf/kT5rD/LR//8IYRA7yIxyJ3gO4hMcpcWSq+GXQu8FnYVaAqGXFcy2/8J325tba7MrARhjwNI/0h/srSLqLq+97+wSqPbAeMXczfUk+457lOffTaLYMcchIfgiDVCuOeqGCGCv/VzN25M3YXuk5nY3BWAekcGABlLarWx7FJG+g7amXCWcpWaZn8xiOP1ODp96TF4tnjHdo0tvL/UKaXIpjyuBFNgKXlIeV1KsfP+E7aa7cU7Tg+4X4w657FNCafER/j7IWTtLjju2vlB35b76OphdNX9lsqnaAdZwjBkmd14UtyqdBkVE0P1CLzF7HEvIPN3zSPyXP3S9y7nhMvCc5Zl9s1AdHTIS719PVb38Nacx0bnzXtO9YhVj54Yxd7iDEk3etkq57gf05ckk19/MyKOOSlZAnFV26xDvZQBytrbGblYPVZrz+eiIbVgcUszxV+IP038VPwFSOM9+nE1q2/0OVTdhzPtuA8A8O6xMQtEAACCXfwXYdxOlYz/1C6O4D8pXsl/IKQFVVxL5oIgA7hu3A+of8ma1Hq23rt8sxlJeWINH7gm/VW87WtqfLfUIqiHESmuJC3JjV0Ax6AOMHUdckh2cyWpsqb29qd0KCh5J9CJdON+u+BMKJP1P86EDypYACNaR1ncPjiVc/CiCygdODi4MkHrJymAbU8ERO8ZVOsPjN4ryuLewJn2B17vH0qPNXm8ynYNewY5YcREj2VS1bHgkr3UW0yakpsk+yMam8HKAtePeo+wRlPHDradhEQxi42q2OHlYliWimmjcpTkpkR61fPitB1cqSrYYyCOzIoRRuhVz0hKLe6Ywp/vFko0SpxRRD0qDHsi0qUzAZevgDpi1UoNDiTRakuEiCpiTDIMZVQu5/CjQCV3KYxOXyuHJOJKKzi0VR7tKFZlud1zqt09CyixV65LxYgVJ16CRCmklEpqafAX6pL3+nWmh0vFo6xOBiLnGNS8sThkpUGsxzooHM8xYpGowAF2vK3KpkInUp169CVtdEpQ1RACAAAAAA==) format(\"woff2\")}.iconfont{font-family:iconfont!important;font-size:16px;font-style:normal;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.icon-replay:before{content:\"\\e631\"}.icon-pip:before{content:\"\\e820\"}.icon-loading:before{content:\"\\e62e\"}.icon-play:before{content:\"\\e851\"}.icon-pause:before{content:\"\\e863\"}.icon-screen:before{content:\"\\e88f\"}.icon-web-screen:before{content:\"\\e609\"}.icon-settings:before{content:\"\\e60c\"}.icon-volume-down:before{content:\"\\e60d\"}.icon-volume-up:before{content:\"\\e60e\"}.icon-volume-mute:before{content:\"\\e60f\"}div.svelte-1dcs6nc.svelte-1dcs6nc,span.svelte-1dcs6nc.svelte-1dcs6nc,p.svelte-1dcs6nc.svelte-1dcs6nc,img.svelte-1dcs6nc.svelte-1dcs6nc,i.svelte-1dcs6nc.svelte-1dcs6nc{margin:0;padding:0;border:0;font-size:100%;font:inherit;vertical-align:baseline}.iconfont.svelte-1dcs6nc.svelte-1dcs6nc{display:inline-block}.d-flex-x.svelte-1dcs6nc.svelte-1dcs6nc{display:flex}.d-flex-x.svelte-1dcs6nc.svelte-1dcs6nc{align-items:center}.mr5.svelte-1dcs6nc.svelte-1dcs6nc{margin-right:5px}.d-pointer.svelte-1dcs6nc.svelte-1dcs6nc{cursor:pointer}.rotating.svelte-1dcs6nc.svelte-1dcs6nc{animation:svelte-1dcs6nc-rotating 2s linear infinite}@keyframes svelte-1dcs6nc-rotating{to{-webkit-transform:rotate(360deg)}}.f50.svelte-1dcs6nc.svelte-1dcs6nc{font-size:50px}.f24.svelte-1dcs6nc.svelte-1dcs6nc{font-size:24px}.d-loading.svelte-1dcs6nc.svelte-1dcs6nc{position:absolute;left:0;right:0;bottom:0px;top:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.3);z-index:2;color:#efefef;text-align:center;font-size:13px}.loading-img.svelte-1dcs6nc.svelte-1dcs6nc{width:50px}.d-logo-loading.svelte-1dcs6nc.svelte-1dcs6nc{position:relative;width:100px;height:23px;overflow:hidden}.d-logo-loading.svelte-1dcs6nc .d-logo.svelte-1dcs6nc{width:100%;height:100%;background:url(https://s.thsi.cn/cd/ths-frontend-hxmui-container/front/thsc-hxmui/1.11.0/img/logo_light.ed78645a.png) 50%;background-size:cover}.d-logo-loading.svelte-1dcs6nc .d-light.svelte-1dcs6nc{position:absolute;left:0;top:50%;-webkit-transform:translateY(-50%);transform:translateY(-50%);width:32px;height:23px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGIAAABaCAMAAAB0UnP8AAAAhFBMVEUAAAD///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////8g2+bRAAAALHRSTlMABAgVDx4uDCU9ODMZKUJcRiFWYGZKt06ojpeJUq95bmqzo6CTfYRydaybgZ4JNUQAAAd9SURBVGjejNWNVtpAEIbhpoECGii/ojUCapEU7v/++s27ux23kMTxHH/O0Tx+Mzubb7eqsPquGo0Gg0FZllVVDYeLxVg1/VT6cbEYqqqqVOl3RyP7M/7+W2sV9gEhYARQBoDH/6Du9aFCWaBgOIFRtBqhsgwhAcD9p0KxaG4I8RhFWwqAIglEIAGPv7OaUPomMo440dUrD5FlCAHS4x2JxiIRg55peApCIDAGixD+/dlsNg+l76QIoV0YnqNzGP+HUJdcANiEckRBPIcTrRk8RIlABrVICXj8drutrfTVFBAZlqOqaFXPNAoqaxMZSABQ10vKEKLIULOmjDyLgdA3CQQyAITn/0wVFBnkwPBWdaZwgjZNp2QgQgBWoWQsZcQctMqJzhTXIciw2ZBgtVqnQhGiZmVGd6e8TwhVGISOknUpAgfVfr/XZynB2MzsXEEEA6JNcMJPUxBqBHv8iTJFSWQwDyc6O5UJEC5oCAL2+6bZhWqaE0hmiKi8U719KodD3RsQZFCTlEDC0UqIjJTDY1R9nYLwYVsIFw4C9PzLh9XlIqY5HQ6r1XL5L8aCgXenyE+sEZOJ2uSCgGdKyG5nORRju82JQSuRnyefRBIUQc9/okCOyag3ED/GGaFqSeFEnARtsgwXhN8qIWbYPAKh3fgKgaAaiAiT+EGIIGjOHwC/rEx5/mAca02DTokYc0+1EoUTPuxAqE3M4RkhGiJsHGEadAqi6iAYRTbs+3vbiZoQEizDr/P5XXU+C7EYx2a/XkMw70RgdBJcTyEEx8lCkAHhDYQcl6M6BTHvJ/Ijm/oUFpsQCAZQGEyDTtXajK+myM4Tk6gV4tQcLwgCHqlgcKhaCGbRsRUKARGHbSGeIBAwiGHE/hCISR9RXB9ZNrteatiEiMIfymKETt0g2ra7yAhWmxBGxEm8v5vw8vIiQsZtovxEFD2rzXlKfUohBFB/6FRG3OUperdiHIma8xT7pDbp6a+vbUR/CifoE0e2ZilsJ1KIVxXEW06k7ZbQmyKN4u4uHVkR9EmTQPgyUXRsBcRkPqdPzc6GbSEQMGzeELvG7loukOymbdmKIp+2H9mPZ44TxMPDA0RIYXuhC6SFKNoWr6riVtCndTxPCoGQEWy3EZzZzhTFrT5N0pG92LDfIAQ4wXaf1hAcqKsUvRfUtpN4zwh/d0v4SgqOrIg4iicRCBlh1yDvC3uxQkiAuH3PBiEjwpGFYBSEyImLESsRs0SUbYSfJ67ZeEHVSxHqk4hzIijbC12DTyJO/4g0CvrU/a5gt7nI2QobBXvnBKvH/cEbScRcxNVVfkO42gpu2RNbEUI48fjItEXYbjPtSAw8RRcxdYLFy0cBwShE7J0YQ9y+PopEIFTxDoxb0VyPgmmfbdp+fYjovz4gfPEi8bdSc1ttI4qh6ENbqKF1ZojBLZi0BOqG/P8HRmeNthVFntFknvy2kHS2rn5xVRghhcLTB/0HiCq8akUtRw/DT0u0UyhCeGpxXNs/QKyrAgRlG4Sr4kmhwAi+LDxrNxFeowoQqYMSwnIgofh1H/FfCIWi1TZ+CuE9UrYpeIQiCPZkibYhHqQKQ3wp0S5WpGgbwsu21QoQJRSoAoTq9tdAtKoAQQcVwst++q2i6pl8BoHwunIEgop3qgjlwFcQRPt8PoJoy1F0Bo4YqjiRAzMiiqoq3nlvUc0j3lEItF0QWXgHot1akUc89csgqHiOiFpBmj0tCYpod+UoI0LbSh9C0EPRlUt4F6miIgKwibgGgk9PlhYKxDRt+4kvDxZeLFRUQZAFIUh3JCg9WRC5M8hJcC8CgiPGuJob5rmqolphBCGOCcGLUk9Op8kkuWQPjcNpT7S2NFCGKog6WPCeeLKlHLVWZATiRnrPMR4xgXlN9VZToaBW7LPi8BFxG/I0R0YHJVUI0VhREai7TqqWn/BTWn7UJ9vHgsp9pYsS4zmM4MkK0aoCwj3E1taALFtG+p0IdEGO0trAGPYNAARN9IZQM5ubNCAN4gjCMoibwX7FCeYmjNC4rVqxJbwci5i48dRTXUMZwYxQsMNP9clWRF5+0B683FumuRF6T/2TLT2zth+YoZUgO8FYCa5tHbsdc906stgcDG02sYHFZvipZo/yZcSsnaCWpxYOg/BdiYMIUrZ6j2pFfVKB4NlaNB7/Eo5/BrHPAEG4xEIQRKiiWc++WwFr28+mXKtyA9gAGQQlj1RTy5eWgqGMSbvywYiF/x9swE0RCSHWrcjb+M9eLZoVM58QBEOeujHGWWE5vQDABOvPRlcgTRREdwab/W5xmMRIJyQDXC523Smnl3hPzd0Chm5503TmDhZnMAOYk4aXILCTCMKaKgridqY66JoXxzy/5mFDNaKzQoxv9qi4GMKoN8kBwAapLkSxaYWkERF3OwYkDqs6esoG3EQxam7Q9QLtJ+7V8/BigySRZLfjtCoGh3og+cgdhJlA7D9yw8BVYpizgORbvf4P8B0vJSPaU312lYXcPhgBsR9O4M8TEp1iLSvaRwUDyDyv/m8i2RCxLoCqjRwPvKW/f+j7KYAIDeIN31OsfyvZzREAAAAASUVORK5CYII=) 50%;background-size:cover;opacity:.6;-webkit-animation:svelte-1dcs6nc-move .8s ease-in-out infinite;animation:svelte-1dcs6nc-move .8s ease-in-out infinite}@keyframes svelte-1dcs6nc-move{0%{left:0}to{left:100%}}.d-player-top.svelte-q8odyd{position:absolute;font-size:16px;left:0px;top:0;right:0px;color:#fff;display:flex;padding:0 20px;height:60px;background-image:linear-gradient(rgba(0,0,0,.6),transparent);justify-content:space-between;z-index:1}.d-flex-center.svelte-o0d56g{display:flex}.d-flex-center.svelte-o0d56g{justify-content:center;align-items:center}.d-status.svelte-o0d56g{text-align:center;font-size:14px;vertical-align:middle;background:rgba(0,0,0,.8);padding:0 8px;height:30px;border-radius:5px;display:flex;align-items:center;color:#fffffff2}.d-radio.svelte-9brao2{position:relative;display:inline-block;padding-left:20px;box-sizing:border-box;height:18px;line-height:18px;font-size:14px;margin-left:12px;margin-top:10px;cursor:pointer;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.d-radio.svelte-9brao2:before{content:\"\";position:absolute;display:inline-block;top:2px;left:0;width:5px;height:5px;border:1px solid #ccc;border-radius:50%}.d-radio.d-radio-checked.svelte-9brao2:before{content:\"\";border-color:#409eff;position:absolute;display:inline-block;top:2px;left:0;width:5px;height:5px;border:1px solid #409eff;border-radius:50%}.d-radio.d-radio-checked.svelte-9brao2:after{content:\"\";position:absolute;top:5px;left:3px;display:inline-block;width:8px;height:8px;background-color:#00a1d6;border-radius:50%}.d-toast.svelte-bbg92z{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background-color:#282828f5;padding:0 18px;border-radius:10px}.d-toast-content.svelte-bbg92z{font-size:16px;line-height:1;word-break:break-all;color:#fefefe}.d-feedback-container.svelte-bjqzkb.svelte-bjqzkb{position:absolute;left:0;top:0;right:0;bottom:0;display:flex;justify-content:center;align-items:center;z-index:3}.d-feedback-container.svelte-bjqzkb .dialog.svelte-bjqzkb{width:400px;height:240px;background-color:#212121e6;color:#fff}.d-feedback-container.svelte-bjqzkb .dialog .header.svelte-bjqzkb{width:100%;height:40px;display:flex;justify-content:center;align-items:center;font-size:16px;position:relative}.d-feedback-container.svelte-bjqzkb .dialog .header.svelte-bjqzkb:after{content:\" \";position:absolute;width:100%;height:1px;bottom:0;left:0;background-color:#fff6}.d-feedback-container.svelte-bjqzkb .dialog .header .icon-close.svelte-bjqzkb{position:absolute;right:0px;top:8px;width:40px;height:40px;line-height:40px;text-align:center;cursor:pointer;font:inherit}.d-feedback-container.svelte-bjqzkb .dialog .content.svelte-bjqzkb{position:relative;text-align:left}.d-feedback-container.svelte-bjqzkb .dialog .other.svelte-bjqzkb{font-size:14px;margin-left:12px}.d-feedback-container.svelte-bjqzkb .dialog #otherContent.svelte-bjqzkb{background-color:#191919;border:1px solid hsla(0,0%,100%,.4);resize:none;color:#ccc;margin-top:10px}.d-feedback-container.svelte-bjqzkb .dialog #otherContent.svelte-bjqzkb::-webkit-scrollbar{width:5px;background-color:#ffffff80}.d-feedback-container.svelte-bjqzkb .dialog #otherContent.svelte-bjqzkb::-webkit-scrollbar-thumb{width:5px;height:5px;background-color:#00000080;border-radius:10px}.d-feedback-container.svelte-bjqzkb .dialog .footer.svelte-bjqzkb{text-align:center}.d-feedback-container.svelte-bjqzkb .dialog .footer .d-player-filter-reset.svelte-bjqzkb{cursor:pointer;margin-top:10px;padding:3px 20px;display:inline-block;border-radius:2px;font-size:12px;background:rgba(133,133,133,.5)}.d-feedback-container.svelte-bjqzkb .dialog .footer .d-player-filter-reset.svelte-bjqzkb:hover{background:rgba(255,255,255,.3)}.d-icon-feedback.svelte-v622af{position:absolute;width:15px;height:15px;top:20px;right:35px;z-index:2;cursor:pointer}div.svelte-uvv227.svelte-uvv227,span.svelte-uvv227.svelte-uvv227,ul.svelte-uvv227.svelte-uvv227,li.svelte-uvv227.svelte-uvv227,video.svelte-uvv227.svelte-uvv227{margin:0;padding:0;border:0;font-size:100%;font:inherit;vertical-align:baseline}ul.svelte-uvv227.svelte-uvv227{list-style:none}.d-fade-in-enter-active.svelte-uvv227.svelte-uvv227,.d-fade-in-leave-active.svelte-uvv227.svelte-uvv227{transition:.5s}.d-fade-in-enter-from.svelte-uvv227.svelte-uvv227,.d-fade-in-leave-to.svelte-uvv227.svelte-uvv227{opacity:0}.d-scale-out-enter-active.svelte-uvv227.svelte-uvv227,.d-scale-out-leave-active.svelte-uvv227.svelte-uvv227{transition:.3s}.d-scale-out-leave-to.svelte-uvv227.svelte-uvv227{transform:scale(1.3);opacity:0}.rotateHover.svelte-uvv227.svelte-uvv227{transition:.2s}.rotateHover.svelte-uvv227.svelte-uvv227:hover{transform:rotate(90deg)}.rotating.svelte-uvv227.svelte-uvv227{animation:svelte-uvv227-rotating 2s linear infinite}@keyframes svelte-uvv227-rotating{to{-webkit-transform:rotate(360deg)}}.iconfont.svelte-uvv227.svelte-uvv227{display:inline-block}.d-flex-x.svelte-uvv227.svelte-uvv227,.d-flex-y.svelte-uvv227.svelte-uvv227,.d-flex-center.svelte-uvv227.svelte-uvv227{display:flex}.d-flex-x.svelte-uvv227.svelte-uvv227{align-items:center}.d-flex-y.svelte-uvv227.svelte-uvv227{justify-content:center}.d-flex-center.svelte-uvv227.svelte-uvv227{justify-content:center;align-items:center}.mr5.svelte-uvv227.svelte-uvv227{margin-right:5px}.mr10.svelte-uvv227.svelte-uvv227{margin-right:10px}.ml5.svelte-uvv227.svelte-uvv227{margin-left:5px}.ml10.svelte-uvv227.svelte-uvv227{margin-left:10px}.d-pointer.svelte-uvv227.svelte-uvv227{cursor:pointer}.d-player-wrap.svelte-uvv227.svelte-uvv227{position:relative;overflow:hidden;background-color:#000}.d-player-wrap.web-full-screen.svelte-uvv227.svelte-uvv227{z-index:9999999;position:fixed;left:0;top:0;width:100vw!important;height:100vh!important}.d-player-wrap.svelte-uvv227 .d-player-video.svelte-uvv227{position:relative;z-index:1;width:100%;height:100%}.d-player-wrap.svelte-uvv227 .d-player-video .d-player-video-poster.svelte-uvv227{position:absolute;height:100%;width:100%;top:0;left:0}.d-player-wrap.svelte-uvv227 .d-player-video .d-player-video-main.svelte-uvv227{width:100%;height:100%;transition:.2s}.d-player-wrap.svelte-uvv227 .d-player-video .d-player-video-main.video-mirror.svelte-uvv227{transform:rotateY(180deg)}.d-player-wrap.svelte-uvv227 .d-player-control.svelte-uvv227{transition:.1s;transform:translateY(45px);position:absolute;z-index:2;left:0;bottom:0;height:50px;width:100%;color:#fff}.d-player-wrap.svelte-uvv227 .d-player-control .d-control-progress.svelte-uvv227{width:100%;margin:0 auto;position:relative;height:5px;cursor:pointer}.d-player-wrap.svelte-uvv227 .d-player-control .d-control-progress .d-progress-bar.svelte-uvv227{position:absolute;left:0;right:0;bottom:0;width:100%;transition:height .1s;height:3px;z-index:1}.d-player-wrap.svelte-uvv227 .d-player-control .d-control-progress .d-progress-bar .d-slider__runway.svelte-uvv227{transition:height .1s;height:100%}.d-player-wrap.svelte-uvv227 .d-player-control .d-control-progress .d-progress-bar .d-slider__runway .d-slider__bar.svelte-uvv227:before{transform:translateY(-50%) scale(0)}.d-player-wrap.svelte-uvv227 .d-player-control .d-control-progress:hover .d-progress-bar.svelte-uvv227{height:100%}.d-player-wrap.svelte-uvv227 .d-player-control .d-control-progress:hover .d-progress-bar .d-slider__bar.svelte-uvv227:before{transform:translateY(-50%) scale(1)!important}.d-player-wrap.svelte-uvv227 .d-player-control .d-control-tool.svelte-uvv227{position:absolute;padding:0 10px;background-image:linear-gradient(180deg,transparent,rgba(0,0,0,.37),rgba(0,0,0,.75),rgba(0,0,0,.75));display:flex;justify-content:space-between;align-items:center;top:10px;left:0;bottom:0;width:100%;box-sizing:border-box}.d-player-wrap.svelte-uvv227 .d-player-control .d-control-tool .d-tool-bar.svelte-uvv227{display:flex;height:100%}.d-player-wrap.svelte-uvv227 .d-player-control .d-control-tool .d-tool-bar .d-tool-item.svelte-uvv227{position:relative;height:100%;cursor:pointer;text-align:center;padding:0 8px;display:flex;align-items:center;font-size:13px}.d-player-wrap.svelte-uvv227 .d-player-control .d-control-tool .d-tool-bar .d-tool-item .d-tool-item-main.svelte-uvv227{position:absolute;white-space:nowrap;z-index:2;bottom:98%;left:50%;padding:6px 16px;box-sizing:border-box;display:none;background:rgba(0,0,0,.95);border-radius:5px;transform:translate(-50%)}.d-player-wrap.svelte-uvv227 .d-player-control .d-control-tool .d-tool-bar .d-tool-item:hover .d-tool-item-main.svelte-uvv227{display:flex}.d-player-wrap.svelte-uvv227 .d-player-control .d-control-tool .d-tool-time.svelte-uvv227{font-size:12px;color:#fff;font-weight:300}.d-player-wrap.svelte-uvv227 .d-player-control .d-control-tool .d-tool-time .total-time.svelte-uvv227{color:#fffc}.d-player-wrap.svelte-uvv227 .d-player-control .d-control-tool .volume-box.svelte-uvv227{height:160px;width:50px;display:flex;align-items:center;justify-content:center}.d-player-wrap.svelte-uvv227 .d-player-control .d-control-tool .volume-box .volume-main.svelte-uvv227{height:90%;display:flex;width:60px;flex-direction:column;align-items:center}.d-player-wrap.svelte-uvv227 .d-player-control .d-control-tool .volume-box .volume-main .volume-text-size.svelte-uvv227{margin-bottom:10px;font-size:12px;font-weight:400}.d-player-wrap.svelte-uvv227 .d-player-control .d-control-tool .volume-box .volume-main.is-muted .d-slider__bar.svelte-uvv227{height:0!important}.d-player-wrap.svelte-uvv227 .d-player-control .d-control-tool .speed-main.svelte-uvv227{padding:0 10px}.d-player-wrap.svelte-uvv227 .d-player-control .d-control-tool .speed-main li.svelte-uvv227{cursor:pointer;line-height:34px;font-size:12px;color:#fff}.d-player-wrap.svelte-uvv227 .d-player-control .d-control-tool .speed-main li.svelte-uvv227:hover{opacity:.8}.d-player-wrap.svelte-uvv227 .d-player-control .d-control-tool .speed-main li.speed-active.svelte-uvv227{color:var(--primary-color);font-weight:700}.d-player-wrap.d-player-wrap-hover.svelte-uvv227 .d-player-control.svelte-uvv227{transform:translateY(0)}.d-player-wrap.d-player-wrap-hover.svelte-uvv227 .d-control-progress.svelte-uvv227{width:96%}.d-player-state.svelte-uvv227.svelte-uvv227,.d-player-input.svelte-uvv227.svelte-uvv227{position:absolute;left:0;top:0;right:0;bottom:40px;display:flex;justify-content:center;align-items:center;overflow:hidden;z-index:1}.d-player-input.svelte-uvv227.svelte-uvv227{width:100%;border:none;opacity:0;cursor:default}.d-play-btn.svelte-uvv227.svelte-uvv227{width:90px;height:90px;color:#fff;display:flex;align-items:center;justify-content:center;background-color:#000000b3;border-radius:50%}.d-player-lightoff.svelte-uvv227.svelte-uvv227{position:fixed;left:0;top:0;width:100vw;height:100vh;background-color:#000000e6}.is-lightoff.svelte-uvv227.svelte-uvv227{z-index:999998}.d-left-0.svelte-uvv227.svelte-uvv227{left:0!important}.d-player-state-top.svelte-uvv227.svelte-uvv227{position:absolute;left:0;top:0;right:0;bottom:40px px;display:flex;justify-content:center;align-items:flex-start;padding-top:5%;overflow:hidden;z-index:1}")); document.head.appendChild(elementStyle);} catch(e) {console.error('vite-plugin-css-injected-by-js', e);} })();(function(pt,_e){typeof exports=="object"&&typeof module<"u"?module.exports=_e():typeof define=="function"&&define.amd?define(_e):(pt=typeof globalThis<"u"?globalThis:pt||self,pt.videoPlayer=_e())})(this,function(){"use strict";var pt=document.createElement("style");pt.textContent=`.d-slider.svelte-qzeq9z.svelte-qzeq9z{position:relative}.d-slider.svelte-qzeq9z .d-slider__runway.svelte-qzeq9z{width:100%;background-color:#333;position:relative;cursor:pointer;vertical-align:middle}.d-slider.svelte-qzeq9z .d-slider__runway .d-slider__cursor.svelte-qzeq9z,.d-slider.svelte-qzeq9z .d-slider__runway .d-slider__preload.svelte-qzeq9z,.d-slider.svelte-qzeq9z .d-slider__runway .d-slider__bar.svelte-qzeq9z{position:absolute;top:0;left:0;height:100%}.d-slider.svelte-qzeq9z .d-slider__runway .d-slider__cursor.svelte-qzeq9z{display:none;z-index:1;width:1px;background:#fff;pointer-events:none}.d-slider.svelte-qzeq9z .d-slider__runway .d-slider__cursor .d-slider__tips.svelte-qzeq9z{pointer-events:none;color:#fff;position:absolute;white-space:nowrap;z-index:2;bottom:14px;left:50%;padding:4px;box-sizing:border-box;display:block;font-size:12px;background:rgba(0,0,0,.6);border-radius:3px;transform:translate(-50%)}.d-slider.svelte-qzeq9z .d-slider__runway:hover .d-slider__cursor.svelte-qzeq9z{display:block}.d-slider.svelte-qzeq9z .d-slider__runway .d-slider__preload.svelte-qzeq9z{background-color:#717171}.d-slider.svelte-qzeq9z .d-slider__runway .d-slider__bar.svelte-qzeq9z{background:linear-gradient(to right,var(--primary-color) 0%,var(--primary-color-end) 80%,var(--primary-color-end) 100%)}.d-slider.svelte-qzeq9z .d-slider__runway .d-slider__bar.svelte-qzeq9z:before{display:block;content:"";position:absolute;right:-6px;top:50%;width:5px;height:5px;transition:.2s;transform:translateY(-50%) scale(1);border-radius:50%;background:#fff;border:5px solid var(--primary-color)}.d-slider.is-vertical.svelte-qzeq9z.svelte-qzeq9z{height:100px;display:inline-block}.d-slider.is-vertical.svelte-qzeq9z .d-slider__runway.svelte-qzeq9z{position:relative;height:100%;margin:0 6px}.d-slider.is-vertical.svelte-qzeq9z .d-slider__runway .d-slider__preload.svelte-qzeq9z,.d-slider.is-vertical.svelte-qzeq9z .d-slider__runway .d-slider__bar.svelte-qzeq9z,.d-slider.is-vertical.svelte-qzeq9z .d-slider__runway .d-slider__cursor.svelte-qzeq9z{bottom:0;top:auto;width:100%}.d-slider.is-vertical.svelte-qzeq9z .d-slider__runway .d-slider__cursor.svelte-qzeq9z{height:1px}.d-slider.is-vertical.svelte-qzeq9z .d-slider__runway .d-slider__bar.svelte-qzeq9z:before{top:-6px;left:50%;width:5px;height:5px;transform:translate(-50%) scale(1)}.d-progress-bar.svelte-qzeq9z.svelte-qzeq9z{position:absolute;left:0;right:0;bottom:0;width:100%;transition:height .1s;height:3px;z-index:1}.d-progress-bar.svelte-qzeq9z .d-slider__runway.svelte-qzeq9z{transition:height .1s;height:100%!important}.d-progress-bar.svelte-qzeq9z .d-slider__runway .d-slider__bar.svelte-qzeq9z:before{transform:translateY(-50%) scale(0)}.d-progress-bar.svelte-qzeq9z.svelte-qzeq9z:hover{height:100%}.d-progress-bar.svelte-qzeq9z:hover .d-slider__bar.svelte-qzeq9z:before{transform:translateY(-50%) scale(1)!important}.d-player-filter-panel-item.svelte-qzeq9z .d-slider__runway.svelte-qzeq9z{background-color:#999}.d-player-filter-panel-item.svelte-qzeq9z .d-slider__runway .d-slider__bar.svelte-qzeq9z:before{width:5px;height:5px}.filter-panel-slider.svelte-qzeq9z.svelte-qzeq9z{width:100%}.d-switch.svelte-31e6zs.svelte-31e6zs{position:relative;height:18px;transition:background .2s;background:#757575;border-radius:10px;display:inline-flex;align-items:center;vertical-align:middle}.d-switch.svelte-31e6zs .d-switch__input.svelte-31e6zs{position:relative;z-index:1;margin:0;width:100%;height:100%;opacity:0}.d-switch.svelte-31e6zs .d-switch_action.svelte-31e6zs{position:absolute;transition:.2s;left:2px;top:2px;z-index:0;height:5px;width:5px;background:#fff;border-radius:50%}.d-switch.is-checked.svelte-31e6zs.svelte-31e6zs{background-color:var(--primary-color)}.d-switch.is-checked.svelte-31e6zs .d-switch_action.svelte-31e6zs{left:100%;background:#fff;margin-left:-18px}.d-icon.svelte-6alrox{display:inline-block;cursor:pointer;overflow:hidden}.icon-play.svelte-6alrox{margin-left:5px}div.svelte-1sesy3u.svelte-1sesy3u,span.svelte-1sesy3u.svelte-1sesy3u,h5.svelte-1sesy3u.svelte-1sesy3u,i.svelte-1sesy3u.svelte-1sesy3u,ul.svelte-1sesy3u.svelte-1sesy3u,li.svelte-1sesy3u.svelte-1sesy3u{margin:0;padding:0;border:0;font-size:100%;font:inherit;vertical-align:baseline}ul.svelte-1sesy3u.svelte-1sesy3u{list-style:none}@keyframes svelte-1sesy3u-rotating{to{-webkit-transform:rotate(360deg)}}.d-player-contextmenu.svelte-1sesy3u.svelte-1sesy3u,.d-player-dialog.svelte-1sesy3u.svelte-1sesy3u{position:absolute;left:0;top:0;bottom:50px;width:100%;z-index:5}.d-player-contextmenu.svelte-1sesy3u .d-player-copyText.svelte-1sesy3u{opacity:0}.d-player-contextmenu.svelte-1sesy3u .d-player-contextmenu-body.svelte-1sesy3u{position:absolute;border-radius:5px;font-size:12px;background:rgba(0,0,0,.8);color:#efefef;text-align:left;min-width:130px;box-sizing:border-box;padding:5px 0}.d-player-contextmenu.svelte-1sesy3u .d-player-contextmenu-body li.svelte-1sesy3u{padding:8px 20px;margin:0;cursor:pointer;transition:.2s}.d-player-contextmenu.svelte-1sesy3u .d-player-contextmenu-body li.svelte-1sesy3u:hover{background-color:#ffffff1a}.d-player-dialog.svelte-1sesy3u.svelte-1sesy3u{display:flex;justify-content:center;align-items:center}.d-player-dialog.svelte-1sesy3u .d-player-dialog-body.svelte-1sesy3u{background-color:#212121e6;border-radius:5px;color:#fff;min-width:200px;padding:0 0 10px}.d-player-dialog.svelte-1sesy3u .d-player-dialog-body .d-player-dialog-title.svelte-1sesy3u{text-align:center;position:relative;font-size:14px;font-weight:400;margin:0 0 10px;padding:12px 0;border-bottom:1px solid rgba(255,255,255,.15)}.d-player-dialog.svelte-1sesy3u .d-player-dialog-body .d-player-dialog-title .icon-close.svelte-1sesy3u{position:absolute;right:0px;top:0px;width:40px;height:40px;line-height:40px;text-align:center;cursor:pointer}.d-player-dialog.svelte-1sesy3u .d-player-dialog-body .d-player-hotkey-panel.svelte-1sesy3u{font-size:12px;color:#eee;padding-right:40px}.d-player-dialog.svelte-1sesy3u .d-player-dialog-body .d-player-hotkey-panel .d-player-hotkey-panel-item.svelte-1sesy3u{line-height:26px}.d-player-dialog.svelte-1sesy3u .d-player-dialog-body .d-player-hotkey-panel .d-player-hotkey-panel-item span.svelte-1sesy3u{text-align:center;display:inline-block;width:120px}.d-player-dialog.svelte-1sesy3u .d-player-dialog-body .d-player-hotkey-panel .d-player-hotkey-panel-item span.svelte-1sesy3u:nth-child(2){color:#999;width:160px}.d-player-dialog.svelte-1sesy3u .d-player-dialog-body .d-player-filter-panel.svelte-1sesy3u{width:320px;padding:0 20px;text-align:center}.d-player-dialog.svelte-1sesy3u .d-player-dialog-body .d-player-filter-panel .d-player-filter-reset.svelte-1sesy3u{text-align:center;cursor:pointer;margin-top:10px;padding:3px 20px;display:inline-block;border-radius:2px;font-size:12px;background:rgba(133,133,133,.5)}.d-player-dialog.svelte-1sesy3u .d-player-dialog-body .d-player-filter-panel .d-player-filter-reset.svelte-1sesy3u:hover{background:rgba(255,255,255,.3)}.d-player-dialog.svelte-1sesy3u .d-player-dialog-body .d-player-filter-panel .d-player-filter-panel-item.svelte-1sesy3u{height:32px;display:flex;align-items:center}.d-player-dialog.svelte-1sesy3u .d-player-dialog-body .d-player-filter-panel .d-player-filter-panel-item span.svelte-1sesy3u{font-size:12px;display:block;width:80px;text-align:center}@font-face{font-family:iconfont;src:url(data:font/woff2;base64,d09GMgABAAAAAAf8AAsAAAAAD4AAAAesAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHFQGYACENAqQFI0gATYCJAMwCxoABCAFhGcHgRgbMA2jopRwhpH9xYEN7tEpwmIWXYlFbb0abbZI79LiOw8i759JE179cG04wTl4/lv73fdGdx1R7dBpePptO1IS0ROpEcucKY175977I5ZAEaYoB0Q+Sa9AyUuuH/ScmnFzExLIzqhN/27WA9pOSYBUSFMxoWIeqfuqJXeerBhQVrSma0bPHPxEe3/ryvP/O+8/vROmlEQSRRMb+GBOkyUgmdUv+7V8hmli/aG/EQqjplPxhHhyzZqoot6oROqNaqXSKgZrk2NVhFlY/ZvcBwGlU5v65uH5PUwdTjXMG8CGCvxoOVnCYeQmYnMKReR61X3j5QMHvfVHAO926uUnuiIo12AXut4HEbykIr8L6H/aqH1DN1cH6ytwwIDDgUnkzVf9Mi7j0GaVaYnWE2DczO1k+hWpS8cpyCzf5CG/v3tHvNa6IaYQ47zm7FpAEBVKVWcVleX4f16HsmrgftwVUiERBKQaQURqmOSxWwgowe5AqsY+hgAD9hkQCPIqAkW+QWCRBwQO+b0zfkj7zAJ2gT5gJrCcEZcy6q0k3pSWkWHj8nBmZvSUUTb8osN2s7NDvrdXy9Nj4OEpqIEIvRY3HgSKcZQwjtJS3DAytmYBP1FU9L3/95QyIMBkIg04lxMG42lHgjNnKzFOrpIelGoMuImUo5gYJWZmUln8gHHvebdwWjfAxMiUA08YhQPUsgelIOQoXHGTqgkpVLI6d55j9PHwK3FoAKBNZegLJupaYE4OgIPZDEU4VcoVnJw+yCoYJen8nooeZg8xh1dw1+lr7A1GPcBNDk+wU8z0R01PQJedZwEdOML6T/GY+RYOlQNVsVO4MJiynUNHad+DrMMYE6DECxPPp6YsmfmLfp2jszO+HSMX5vo5LbCgYXV9bicOrFDPI+TcNONAwuZOU5CInQB8k9z0KgEz9ZSDFCihUQLabhIWc9NrYIEIVIt5EDeskrA3qt9YDSPcdWDh2noLxHILj1c9ftyZVExBrBQf8ycPXZmJm19yxEd8SYWUnZDiw0f9KkHFyBEnQj4Jcxg16keoLs9e4FUXajyAkA/hOBh1+Jg/Tl5LwCHyShpOUqd85NsS6mQKJi6nUgR+0pNoYU0mxmzmjEZAGzSGurFL12bo2euXuavqeWbuxpUtKbNGQ2iq2mxKa2AdyOXblidgpmGYUnKTwMpEF0wUhCW+Sl/MlhKt0VCRaqbMpInEKxD6pEgh8IGMIZ3sKPbsO/4vhZPlndlsfQomL4051Z+cnFZpte02mX84Q8W1f5S7vYclBFYebq0HtaA4rCgkWDBKvPeaGbmxvnFjdCbI3Zqgv6QTvUUL7L0a5TmVoBTsSRkYStwLSjNLLKTOxQPr9mdUgALwUWxvm3tmT8FIqQ+I/vy5X6tMeE7iu1gRZnVOOLPKskb4PWbpek46J8lysdRZnctd0dXPIVtIdd8P3BB4TlLsQCz/PvQXdA4U+IFAO6tPRJy+kcbtFQmnbWZsp/HBt5RDf6N/299F71a8L1l2XHZ56PjwpMl5c/zm2L74vuE4iUzk6ypzk+373pWIJ+O74jvzg5EPfTfYIJQ3ZXfEednV2RMJQTydXZdZZ5sf/kT5rD/LR//8IYRA7yIxyJ3gO4hMcpcWSq+GXQu8FnYVaAqGXFcy2/8J325tba7MrARhjwNI/0h/srSLqLq+97+wSqPbAeMXczfUk+457lOffTaLYMcchIfgiDVCuOeqGCGCv/VzN25M3YXuk5nY3BWAekcGABlLarWx7FJG+g7amXCWcpWaZn8xiOP1ODp96TF4tnjHdo0tvL/UKaXIpjyuBFNgKXlIeV1KsfP+E7aa7cU7Tg+4X4w657FNCafER/j7IWTtLjju2vlB35b76OphdNX9lsqnaAdZwjBkmd14UtyqdBkVE0P1CLzF7HEvIPN3zSPyXP3S9y7nhMvCc5Zl9s1AdHTIS719PVb38Nacx0bnzXtO9YhVj54Yxd7iDEk3etkq57gf05ckk19/MyKOOSlZAnFV26xDvZQBytrbGblYPVZrz+eiIbVgcUszxV+IP038VPwFSOM9+nE1q2/0OVTdhzPtuA8A8O6xMQtEAACCXfwXYdxOlYz/1C6O4D8pXsl/IKQFVVxL5oIgA7hu3A+of8ma1Hq23rt8sxlJeWINH7gm/VW87WtqfLfUIqiHESmuJC3JjV0Ax6AOMHUdckh2cyWpsqb29qd0KCh5J9CJdON+u+BMKJP1P86EDypYACNaR1ncPjiVc/CiCygdODi4MkHrJymAbU8ERO8ZVOsPjN4ryuLewJn2B17vH0qPNXm8ynYNewY5YcREj2VS1bHgkr3UW0yakpsk+yMam8HKAtePeo+wRlPHDradhEQxi42q2OHlYliWimmjcpTkpkR61fPitB1cqSrYYyCOzIoRRuhVz0hKLe6Ywp/vFko0SpxRRD0qDHsi0qUzAZevgDpi1UoNDiTRakuEiCpiTDIMZVQu5/CjQCV3KYxOXyuHJOJKKzi0VR7tKFZlud1zqt09CyixV65LxYgVJ16CRCmklEpqafAX6pL3+nWmh0vFo6xOBiLnGNS8sThkpUGsxzooHM8xYpGowAF2vK3KpkInUp169CVtdEpQ1RACAAAAAA==) format("woff2")}.iconfont{font-family:iconfont!important;font-size:16px;font-style:normal;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.icon-replay:before{content:"\\e631"}.icon-pip:before{content:"\\e820"}.icon-loading:before{content:"\\e62e"}.icon-play:before{content:"\\e851"}.icon-pause:before{content:"\\e863"}.icon-screen:before{content:"\\e88f"}.icon-web-screen:before{content:"\\e609"}.icon-settings:before{content:"\\e60c"}.icon-volume-down:before{content:"\\e60d"}.icon-volume-up:before{content:"\\e60e"}.icon-volume-mute:before{content:"\\e60f"}div.svelte-1dcs6nc.svelte-1dcs6nc,span.svelte-1dcs6nc.svelte-1dcs6nc,p.svelte-1dcs6nc.svelte-1dcs6nc,img.svelte-1dcs6nc.svelte-1dcs6nc,i.svelte-1dcs6nc.svelte-1dcs6nc{margin:0;padding:0;border:0;font-size:100%;font:inherit;vertical-align:baseline}.iconfont.svelte-1dcs6nc.svelte-1dcs6nc{display:inline-block}.d-flex-x.svelte-1dcs6nc.svelte-1dcs6nc{display:flex}.d-flex-x.svelte-1dcs6nc.svelte-1dcs6nc{align-items:center}.mr5.svelte-1dcs6nc.svelte-1dcs6nc{margin-right:5px}.d-pointer.svelte-1dcs6nc.svelte-1dcs6nc{cursor:pointer}.rotating.svelte-1dcs6nc.svelte-1dcs6nc{animation:svelte-1dcs6nc-rotating 2s linear infinite}@keyframes svelte-1dcs6nc-rotating{to{-webkit-transform:rotate(360deg)}}.f50.svelte-1dcs6nc.svelte-1dcs6nc{font-size:50px}.f24.svelte-1dcs6nc.svelte-1dcs6nc{font-size:24px}.d-loading.svelte-1dcs6nc.svelte-1dcs6nc{position:absolute;left:0;right:0;bottom:0px;top:0;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,.3);z-index:2;color:#efefef;text-align:center;font-size:13px}.loading-img.svelte-1dcs6nc.svelte-1dcs6nc{width:50px}.d-logo-loading.svelte-1dcs6nc.svelte-1dcs6nc{position:relative;width:100px;height:23px;overflow:hidden}.d-logo-loading.svelte-1dcs6nc .d-logo.svelte-1dcs6nc{width:100%;height:100%;background:url(https://s.thsi.cn/cd/ths-frontend-hxmui-container/front/thsc-hxmui/1.11.0/img/logo_light.ed78645a.png) 50%;background-size:cover}.d-logo-loading.svelte-1dcs6nc .d-light.svelte-1dcs6nc{position:absolute;left:0;top:50%;-webkit-transform:translateY(-50%);transform:translateY(-50%);width:32px;height:23px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGIAAABaCAMAAAB0UnP8AAAAhFBMVEUAAAD///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////8g2+bRAAAALHRSTlMABAgVDx4uDCU9ODMZKUJcRiFWYGZKt06ojpeJUq95bmqzo6CTfYRydaybgZ4JNUQAAAd9SURBVGjejNWNVtpAEIbhpoECGii/ojUCapEU7v/++s27ux23kMTxHH/O0Tx+Mzubb7eqsPquGo0Gg0FZllVVDYeLxVg1/VT6cbEYqqqqVOl3RyP7M/7+W2sV9gEhYARQBoDH/6Du9aFCWaBgOIFRtBqhsgwhAcD9p0KxaG4I8RhFWwqAIglEIAGPv7OaUPomMo440dUrD5FlCAHS4x2JxiIRg55peApCIDAGixD+/dlsNg+l76QIoV0YnqNzGP+HUJdcANiEckRBPIcTrRk8RIlABrVICXj8drutrfTVFBAZlqOqaFXPNAoqaxMZSABQ10vKEKLIULOmjDyLgdA3CQQyAITn/0wVFBnkwPBWdaZwgjZNp2QgQgBWoWQsZcQctMqJzhTXIciw2ZBgtVqnQhGiZmVGd6e8TwhVGISOknUpAgfVfr/XZynB2MzsXEEEA6JNcMJPUxBqBHv8iTJFSWQwDyc6O5UJEC5oCAL2+6bZhWqaE0hmiKi8U719KodD3RsQZFCTlEDC0UqIjJTDY1R9nYLwYVsIFw4C9PzLh9XlIqY5HQ6r1XL5L8aCgXenyE+sEZOJ2uSCgGdKyG5nORRju82JQSuRnyefRBIUQc9/okCOyag3ED/GGaFqSeFEnARtsgwXhN8qIWbYPAKh3fgKgaAaiAiT+EGIIGjOHwC/rEx5/mAca02DTokYc0+1EoUTPuxAqE3M4RkhGiJsHGEadAqi6iAYRTbs+3vbiZoQEizDr/P5XXU+C7EYx2a/XkMw70RgdBJcTyEEx8lCkAHhDYQcl6M6BTHvJ/Ijm/oUFpsQCAZQGEyDTtXajK+myM4Tk6gV4tQcLwgCHqlgcKhaCGbRsRUKARGHbSGeIBAwiGHE/hCISR9RXB9ZNrteatiEiMIfymKETt0g2ra7yAhWmxBGxEm8v5vw8vIiQsZtovxEFD2rzXlKfUohBFB/6FRG3OUperdiHIma8xT7pDbp6a+vbUR/CifoE0e2ZilsJ1KIVxXEW06k7ZbQmyKN4u4uHVkR9EmTQPgyUXRsBcRkPqdPzc6GbSEQMGzeELvG7loukOymbdmKIp+2H9mPZ44TxMPDA0RIYXuhC6SFKNoWr6riVtCndTxPCoGQEWy3EZzZzhTFrT5N0pG92LDfIAQ4wXaf1hAcqKsUvRfUtpN4zwh/d0v4SgqOrIg4iicRCBlh1yDvC3uxQkiAuH3PBiEjwpGFYBSEyImLESsRs0SUbYSfJ67ZeEHVSxHqk4hzIijbC12DTyJO/4g0CvrU/a5gt7nI2QobBXvnBKvH/cEbScRcxNVVfkO42gpu2RNbEUI48fjItEXYbjPtSAw8RRcxdYLFy0cBwShE7J0YQ9y+PopEIFTxDoxb0VyPgmmfbdp+fYjovz4gfPEi8bdSc1ttI4qh6ENbqKF1ZojBLZi0BOqG/P8HRmeNthVFntFknvy2kHS2rn5xVRghhcLTB/0HiCq8akUtRw/DT0u0UyhCeGpxXNs/QKyrAgRlG4Sr4kmhwAi+LDxrNxFeowoQqYMSwnIgofh1H/FfCIWi1TZ+CuE9UrYpeIQiCPZkibYhHqQKQ3wp0S5WpGgbwsu21QoQJRSoAoTq9tdAtKoAQQcVwst++q2i6pl8BoHwunIEgop3qgjlwFcQRPt8PoJoy1F0Bo4YqjiRAzMiiqoq3nlvUc0j3lEItF0QWXgHot1akUc89csgqHiOiFpBmj0tCYpod+UoI0LbSh9C0EPRlUt4F6miIgKwibgGgk9PlhYKxDRt+4kvDxZeLFRUQZAFIUh3JCg9WRC5M8hJcC8CgiPGuJob5rmqolphBCGOCcGLUk9Op8kkuWQPjcNpT7S2NFCGKog6WPCeeLKlHLVWZATiRnrPMR4xgXlN9VZToaBW7LPi8BFxG/I0R0YHJVUI0VhREai7TqqWn/BTWn7UJ9vHgsp9pYsS4zmM4MkK0aoCwj3E1taALFtG+p0IdEGO0trAGPYNAARN9IZQM5ubNCAN4gjCMoibwX7FCeYmjNC4rVqxJbwci5i48dRTXUMZwYxQsMNP9clWRF5+0B683FumuRF6T/2TLT2zth+YoZUgO8FYCa5tHbsdc906stgcDG02sYHFZvipZo/yZcSsnaCWpxYOg/BdiYMIUrZ6j2pFfVKB4NlaNB7/Eo5/BrHPAEG4xEIQRKiiWc++WwFr28+mXKtyA9gAGQQlj1RTy5eWgqGMSbvywYiF/x9swE0RCSHWrcjb+M9eLZoVM58QBEOeujHGWWE5vQDABOvPRlcgTRREdwab/W5xmMRIJyQDXC523Smnl3hPzd0Chm5503TmDhZnMAOYk4aXILCTCMKaKgridqY66JoXxzy/5mFDNaKzQoxv9qi4GMKoN8kBwAapLkSxaYWkERF3OwYkDqs6esoG3EQxam7Q9QLtJ+7V8/BigySRZLfjtCoGh3og+cgdhJlA7D9yw8BVYpizgORbvf4P8B0vJSPaU312lYXcPhgBsR9O4M8TEp1iLSvaRwUDyDyv/m8i2RCxLoCqjRwPvKW/f+j7KYAIDeIN31OsfyvZzREAAAAASUVORK5CYII=) 50%;background-size:cover;opacity:.6;-webkit-animation:svelte-1dcs6nc-move .8s ease-in-out infinite;animation:svelte-1dcs6nc-move .8s ease-in-out infinite}@keyframes svelte-1dcs6nc-move{0%{left:0}to{left:100%}}.d-player-top.svelte-q8odyd{position:absolute;font-size:16px;left:0px;top:0;right:0px;color:#fff;display:flex;padding:0 20px;height:60px;background-image:linear-gradient(rgba(0,0,0,.6),transparent);justify-content:space-between;z-index:1}.d-flex-center.svelte-o0d56g{display:flex}.d-flex-center.svelte-o0d56g{justify-content:center;align-items:center}.d-status.svelte-o0d56g{text-align:center;font-size:14px;vertical-align:middle;background:rgba(0,0,0,.8);padding:0 8px;height:30px;border-radius:5px;display:flex;align-items:center;color:#fffffff2}.d-radio.svelte-9brao2{position:relative;display:inline-block;padding-left:20px;box-sizing:border-box;height:18px;line-height:18px;font-size:14px;margin-left:12px;margin-top:10px;cursor:pointer;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.d-radio.svelte-9brao2:before{content:"";position:absolute;display:inline-block;top:2px;left:0;width:5px;height:5px;border:1px solid #ccc;border-radius:50%}.d-radio.d-radio-checked.svelte-9brao2:before{content:"";border-color:#409eff;position:absolute;display:inline-block;top:2px;left:0;width:5px;height:5px;border:1px solid #409eff;border-radius:50%}.d-radio.d-radio-checked.svelte-9brao2:after{content:"";position:absolute;top:5px;left:3px;display:inline-block;width:8px;height:8px;background-color:#00a1d6;border-radius:50%}.d-toast.svelte-bbg92z{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background-color:#282828f5;padding:0 18px;border-radius:10px}.d-toast-content.svelte-bbg92z{font-size:16px;line-height:1;word-break:break-all;color:#fefefe}.d-feedback-container.svelte-bjqzkb.svelte-bjqzkb{position:absolute;left:0;top:0;right:0;bottom:0;display:flex;justify-content:center;align-items:center;z-index:3}.d-feedback-container.svelte-bjqzkb .dialog.svelte-bjqzkb{width:400px;height:240px;background-color:#212121e6;color:#fff}.d-feedback-container.svelte-bjqzkb .dialog .header.svelte-bjqzkb{width:100%;height:40px;display:flex;justify-content:center;align-items:center;font-size:16px;position:relative}.d-feedback-container.svelte-bjqzkb .dialog .header.svelte-bjqzkb:after{content:" ";position:absolute;width:100%;height:1px;bottom:0;left:0;background-color:#fff6}.d-feedback-container.svelte-bjqzkb .dialog .header .icon-close.svelte-bjqzkb{position:absolute;right:0px;top:8px;width:40px;height:40px;line-height:40px;text-align:center;cursor:pointer;font:inherit}.d-feedback-container.svelte-bjqzkb .dialog .content.svelte-bjqzkb{position:relative;text-align:left}.d-feedback-container.svelte-bjqzkb .dialog .other.svelte-bjqzkb{font-size:14px;margin-left:12px}.d-feedback-container.svelte-bjqzkb .dialog #otherContent.svelte-bjqzkb{background-color:#191919;border:1px solid hsla(0,0%,100%,.4);resize:none;color:#ccc;margin-top:10px}.d-feedback-container.svelte-bjqzkb .dialog #otherContent.svelte-bjqzkb::-webkit-scrollbar{width:5px;background-color:#ffffff80}.d-feedback-container.svelte-bjqzkb .dialog #otherContent.svelte-bjqzkb::-webkit-scrollbar-thumb{width:5px;height:5px;background-color:#00000080;border-radius:10px}.d-feedback-container.svelte-bjqzkb .dialog .footer.svelte-bjqzkb{text-align:center}.d-feedback-container.svelte-bjqzkb .dialog .footer .d-player-filter-reset.svelte-bjqzkb{cursor:pointer;margin-top:10px;padding:3px 20px;display:inline-block;border-radius:2px;font-size:12px;background:rgba(133,133,133,.5)}.d-feedback-container.svelte-bjqzkb .dialog .footer .d-player-filter-reset.svelte-bjqzkb:hover{background:rgba(255,255,255,.3)}.d-icon-feedback.svelte-v622af{position:absolute;width:15px;height:15px;top:20px;right:35px;z-index:2;cursor:pointer}div.svelte-uvv227.svelte-uvv227,span.svelte-uvv227.svelte-uvv227,ul.svelte-uvv227.svelte-uvv227,li.svelte-uvv227.svelte-uvv227,video.svelte-uvv227.svelte-uvv227{margin:0;padding:0;border:0;font-size:100%;font:inherit;vertical-align:baseline}ul.svelte-uvv227.svelte-uvv227{list-style:none}.d-fade-in-enter-active.svelte-uvv227.svelte-uvv227,.d-fade-in-leave-active.svelte-uvv227.svelte-uvv227{transition:.5s}.d-fade-in-enter-from.svelte-uvv227.svelte-uvv227,.d-fade-in-leave-to.svelte-uvv227.svelte-uvv227{opacity:0}.d-scale-out-enter-active.svelte-uvv227.svelte-uvv227,.d-scale-out-leave-active.svelte-uvv227.svelte-uvv227{transition:.3s}.d-scale-out-leave-to.svelte-uvv227.svelte-uvv227{transform:scale(1.3);opacity:0}.rotateHover.svelte-uvv227.svelte-uvv227{transition:.2s}.rotateHover.svelte-uvv227.svelte-uvv227:hover{transform:rotate(90deg)}.rotating.svelte-uvv227.svelte-uvv227{animation:svelte-uvv227-rotating 2s linear infinite}@keyframes svelte-uvv227-rotating{to{-webkit-transform:rotate(360deg)}}.iconfont.svelte-uvv227.svelte-uvv227{display:inline-block}.d-flex-x.svelte-uvv227.svelte-uvv227,.d-flex-y.svelte-uvv227.svelte-uvv227,.d-flex-center.svelte-uvv227.svelte-uvv227{display:flex}.d-flex-x.svelte-uvv227.svelte-uvv227{align-items:center}.d-flex-y.svelte-uvv227.svelte-uvv227{justify-content:center}.d-flex-center.svelte-uvv227.svelte-uvv227{justify-content:center;align-items:center}.mr5.svelte-uvv227.svelte-uvv227{margin-right:5px}.mr10.svelte-uvv227.svelte-uvv227{margin-right:10px}.ml5.svelte-uvv227.svelte-uvv227{margin-left:5px}.ml10.svelte-uvv227.svelte-uvv227{margin-left:10px}.d-pointer.svelte-uvv227.svelte-uvv227{cursor:pointer}.d-player-wrap.svelte-uvv227.svelte-uvv227{position:relative;overflow:hidden;background-color:#000}.d-player-wrap.web-full-screen.svelte-uvv227.svelte-uvv227{z-index:9999999;position:fixed;left:0;top:0;width:100vw!important;height:100vh!important}.d-player-wrap.svelte-uvv227 .d-player-video.svelte-uvv227{position:relative;z-index:1;width:100%;height:100%}.d-player-wrap.svelte-uvv227 .d-player-video .d-player-video-poster.svelte-uvv227{position:absolute;height:100%;width:100%;top:0;left:0}.d-player-wrap.svelte-uvv227 .d-player-video .d-player-video-main.svelte-uvv227{width:100%;height:100%;transition:.2s}.d-player-wrap.svelte-uvv227 .d-player-video .d-player-video-main.video-mirror.svelte-uvv227{transform:rotateY(180deg)}.d-player-wrap.svelte-uvv227 .d-player-control.svelte-uvv227{transition:.1s;transform:translateY(45px);position:absolute;z-index:2;left:0;bottom:0;height:50px;width:100%;color:#fff}.d-player-wrap.svelte-uvv227 .d-player-control .d-control-progress.svelte-uvv227{width:100%;margin:0 auto;position:relative;height:5px;cursor:pointer}.d-player-wrap.svelte-uvv227 .d-player-control .d-control-progress .d-progress-bar.svelte-uvv227{position:absolute;left:0;right:0;bottom:0;width:100%;transition:height .1s;height:3px;z-index:1}.d-player-wrap.svelte-uvv227 .d-player-control .d-control-progress .d-progress-bar .d-slider__runway.svelte-uvv227{transition:height .1s;height:100%}.d-player-wrap.svelte-uvv227 .d-player-control .d-control-progress .d-progress-bar .d-slider__runway .d-slider__bar.svelte-uvv227:before{transform:translateY(-50%) scale(0)}.d-player-wrap.svelte-uvv227 .d-player-control .d-control-progress:hover .d-progress-bar.svelte-uvv227{height:100%}.d-player-wrap.svelte-uvv227 .d-player-control .d-control-progress:hover .d-progress-bar .d-slider__bar.svelte-uvv227:before{transform:translateY(-50%) scale(1)!important}.d-player-wrap.svelte-uvv227 .d-player-control .d-control-tool.svelte-uvv227{position:absolute;padding:0 10px;background-image:linear-gradient(180deg,transparent,rgba(0,0,0,.37),rgba(0,0,0,.75),rgba(0,0,0,.75));display:flex;justify-content:space-between;align-items:center;top:10px;left:0;bottom:0;width:100%;box-sizing:border-box}.d-player-wrap.svelte-uvv227 .d-player-control .d-control-tool .d-tool-bar.svelte-uvv227{display:flex;height:100%}.d-player-wrap.svelte-uvv227 .d-player-control .d-control-tool .d-tool-bar .d-tool-item.svelte-uvv227{position:relative;height:100%;cursor:pointer;text-align:center;padding:0 8px;display:flex;align-items:center;font-size:13px}.d-player-wrap.svelte-uvv227 .d-player-control .d-control-tool .d-tool-bar .d-tool-item .d-tool-item-main.svelte-uvv227{position:absolute;white-space:nowrap;z-index:2;bottom:98%;left:50%;padding:6px 16px;box-sizing:border-box;display:none;background:rgba(0,0,0,.95);border-radius:5px;transform:translate(-50%)}.d-player-wrap.svelte-uvv227 .d-player-control .d-control-tool .d-tool-bar .d-tool-item:hover .d-tool-item-main.svelte-uvv227{display:flex}.d-player-wrap.svelte-uvv227 .d-player-control .d-control-tool .d-tool-time.svelte-uvv227{font-size:12px;color:#fff;font-weight:300}.d-player-wrap.svelte-uvv227 .d-player-control .d-control-tool .d-tool-time .total-time.svelte-uvv227{color:#fffc}.d-player-wrap.svelte-uvv227 .d-player-control .d-control-tool .volume-box.svelte-uvv227{height:160px;width:50px;display:flex;align-items:center;justify-content:center}.d-player-wrap.svelte-uvv227 .d-player-control .d-control-tool .volume-box .volume-main.svelte-uvv227{height:90%;display:flex;width:60px;flex-direction:column;align-items:center}.d-player-wrap.svelte-uvv227 .d-player-control .d-control-tool .volume-box .volume-main .volume-text-size.svelte-uvv227{margin-bottom:10px;font-size:12px;font-weight:400}.d-player-wrap.svelte-uvv227 .d-player-control .d-control-tool .volume-box .volume-main.is-muted .d-slider__bar.svelte-uvv227{height:0!important}.d-player-wrap.svelte-uvv227 .d-player-control .d-control-tool .speed-main.svelte-uvv227{padding:0 10px}.d-player-wrap.svelte-uvv227 .d-player-control .d-control-tool .speed-main li.svelte-uvv227{cursor:pointer;line-height:34px;font-size:12px;color:#fff}.d-player-wrap.svelte-uvv227 .d-player-control .d-control-tool .speed-main li.svelte-uvv227:hover{opacity:.8}.d-player-wrap.svelte-uvv227 .d-player-control .d-control-tool .speed-main li.speed-active.svelte-uvv227{color:var(--primary-color);font-weight:700}.d-player-wrap.d-player-wrap-hover.svelte-uvv227 .d-player-control.svelte-uvv227{transform:translateY(0)}.d-player-wrap.d-player-wrap-hover.svelte-uvv227 .d-control-progress.svelte-uvv227{width:96%}.d-player-state.svelte-uvv227.svelte-uvv227,.d-player-input.svelte-uvv227.svelte-uvv227{position:absolute;left:0;top:0;right:0;bottom:40px;display:flex;justify-content:center;align-items:center;overflow:hidden;z-index:1}.d-player-input.svelte-uvv227.svelte-uvv227{width:100%;border:none;opacity:0;cursor:default}.d-play-btn.svelte-uvv227.svelte-uvv227{width:90px;height:90px;color:#fff;display:flex;align-items:center;justify-content:center;background-color:#000000b3;border-radius:50%}.d-player-lightoff.svelte-uvv227.svelte-uvv227{position:fixed;left:0;top:0;width:100vw;height:100vh;background-color:#000000e6}.is-lightoff.svelte-uvv227.svelte-uvv227{z-index:999998}.d-left-0.svelte-uvv227.svelte-uvv227{left:0!important}.d-player-state-top.svelte-uvv227.svelte-uvv227{position:absolute;left:0;top:0;right:0;bottom:40px px;display:flex;justify-content:center;align-items:flex-start;padding-top:5%;overflow:hidden;z-index:1}
`,document.head.appendChild(pt);function _e(){}const qt=D=>D;function Qt(D){return D()}function Zt(){return Object.create(null)}function st(D){D.forEach(Qt)}function ke(D){return typeof D=="function"}function Je(D,L){return D!=D?L==L:D!==L||D&&typeof D=="object"||typeof D=="function"}let It;function Rt(D,L){return It||(It=document.createElement("a")),It.href=L,D===It.href}function ti(D){return Object.keys(D).length===0}function we(D){return D==null?"":D}const Jt=typeof window<"u";let ri=Jt?()=>window.performance.now():()=>Date.now(),Ut=Jt?D=>requestAnimationFrame(D):_e;const yt=new Set;function $t(D){yt.forEach(L=>{L.c(D)||(yt.delete(L),L.f())}),yt.size!==0&&Ut($t)}function ii(D){let L;return yt.size===0&&Ut($t),{promise:new Promise(R=>{yt.add(L={c:D,f:R})}),abort(){yt.delete(L)}}}function Z(D,L){D.appendChild(L)}function $e(D,L,R){const G=Nt(D);if(!G.getElementById(L)){const K=re("style");K.id=L,K.textContent=R,er(G,K)}}function Nt(D){if(!D)return document;const L=D.getRootNode?D.getRootNode():D.ownerDocument;return L&&L.host?L:D.ownerDocument}function ni(D){const L=re("style");return er(Nt(D),L),L.sheet}function er(D,L){return Z(D.head||D,L),L.sheet}function fe(D,L,R){D.insertBefore(L,R||null)}function de(D){D.parentNode&&D.parentNode.removeChild(D)}function bt(D,L){for(let R=0;R<D.length;R+=1)D[R]&&D[R].d(L)}function re(D){return document.createElement(D)}function si(D){return document.createElementNS("http://www.w3.org/2000/svg",D)}function ve(D){return document.createTextNode(D)}function le(){return ve(" ")}function Et(){return ve("")}function he(D,L,R,G){return D.addEventListener(L,R,G),()=>D.removeEventListener(L,R,G)}function Ct(D){return function(L){return L.stopPropagation(),D.call(this,L)}}function q(D,L,R){R==null?D.removeAttribute(L):D.getAttribute(L)!==R&&D.setAttribute(L,R)}function ai(D){return Array.from(D.childNodes)}function xe(D,L){L=""+L,D.wholeText!==L&&(D.data=L)}function tr(D,L){D.value=L==null?"":L}function Ot(D,L,R,G){R===null?D.style.removeProperty(L):D.style.setProperty(L,R,G?"important":"")}function rr(D,L,R){D.classList[R?"add":"remove"](L)}function ir(D,L,{bubbles:R=!1,cancelable:G=!1}={}){const K=document.createEvent("CustomEvent");return K.initCustomEvent(D,R,G,L),K}class oi{constructor(L=!1){this.is_svg=!1,this.is_svg=L,this.e=this.n=null}c(L){this.h(L)}m(L,R,G=null){this.e||(this.is_svg?this.e=si(R.nodeName):this.e=re(R.nodeName),this.t=R,this.c(L)),this.i(G)}h(L){this.e.innerHTML=L,this.n=Array.from(this.e.childNodes)}i(L){for(let R=0;R<this.n.length;R+=1)fe(this.t,this.n[R],L)}p(L){this.d(),this.h(L),this.i(this.a)}d(){this.n.forEach(de)}}const Mt=new Map;let kt=0;function li(D){let L=5381,R=D.length;for(;R--;)L=(L<<5)-L^D.charCodeAt(R);return L>>>0}function ui(D,L){const R={stylesheet:ni(L),rules:{}};return Mt.set(D,R),R}function nr(D,L,R,G,K,H,W,O=0){const p=16.666/G;let P=`{
`;for(let b=0;b<=1;b+=p){const _=L+(R-L)*H(b);P+=b*100+`%{${W(_,1-_)}}
`}const T=P+`100% {${W(R,1-R)}}
}`,k=`__svelte_${li(T)}_${O}`,C=Nt(D),{stylesheet:B,rules:I}=Mt.get(C)||ui(C,D);I[k]||(I[k]=!0,B.insertRule(`@keyframes ${k} ${T}`,B.cssRules.length));const A=D.style.animation||"";return D.style.animation=`${A?`${A}, `:""}${k} ${G}ms linear ${K}ms 1 both`,kt+=1,k}function di(D,L){const R=(D.style.animation||"").split(", "),G=R.filter(L?H=>H.indexOf(L)<0:H=>H.indexOf("__svelte")===-1),K=R.length-G.length;K&&(D.style.animation=G.join(", "),kt-=K,kt||fi())}function fi(){Ut(()=>{kt||(Mt.forEach(D=>{const{ownerNode:L}=D.stylesheet;L&&de(L)}),Mt.clear())})}let At;function Dt(D){At=D}function Kt(){if(!At)throw new Error("Function called outside component initialization");return At}function sr(D){Kt().$$.on_mount.push(D)}function ci(D){Kt().$$.on_destroy.push(D)}function ht(){const D=Kt();return(L,R,{cancelable:G=!1}={})=>{const K=D.$$.callbacks[L];if(K){const H=ir(L,R,{cancelable:G});return K.slice().forEach(W=>{W.call(D,H)}),!H.defaultPrevented}return!0}}function hi(D,L){const R=D.$$.callbacks[L.type];R&&R.slice().forEach(G=>G.call(this,L))}const Tt=[],ut=[],wt=[],ar=[],or=Promise.resolve();let Wt=!1;function lr(){Wt||(Wt=!0,or.then(ur))}function Gt(){return lr(),or}function lt(D){wt.push(D)}const zt=new Set;let _t=0;function ur(){if(_t!==0)return;const D=At;do{try{for(;_t<Tt.length;){const L=Tt[_t];_t++,Dt(L),vi(L.$$)}}catch(L){throw Tt.length=0,_t=0,L}for(Dt(null),Tt.length=0,_t=0;ut.length;)ut.pop()();for(let L=0;L<wt.length;L+=1){const R=wt[L];zt.has(R)||(zt.add(R),R())}wt.length=0}while(Tt.length);for(;ar.length;)ar.pop()();Wt=!1,zt.clear(),Dt(D)}function vi(D){if(D.fragment!==null){D.update(),st(D.before_update);const L=D.dirty;D.dirty=[-1],D.fragment&&D.fragment.p(D.ctx,L),D.after_update.forEach(lt)}}let Lt;function gi(){return Lt||(Lt=Promise.resolve(),Lt.then(()=>{Lt=null})),Lt}function Ht(D,L,R){D.dispatchEvent(ir(`${L?"intro":"outro"}${R}`))}const Ft=new Set;let dt;function Ue(){dt={r:0,c:[],p:dt}}function Ne(){dt.r||st(dt.c),dt=dt.p}function se(D,L){D&&D.i&&(Ft.delete(D),D.i(L))}function ue(D,L,R,G){if(D&&D.o){if(Ft.has(D))return;Ft.add(D),dt.c.push(()=>{Ft.delete(D),G&&(R&&D.d(1),G())}),D.o(L)}else G&&G()}const mi={duration:0};function et(D,L,R,G){const K={direction:"both"};let H=L(D,R,K),W=G?0:1,O=null,p=null,P=null;function T(){P&&di(D,P)}function k(B,I){const A=B.b-W;return I*=Math.abs(A),{a:W,b:B.b,d:A,duration:I,start:B.start,end:B.start+I,group:B.group}}function C(B){const{delay:I=0,duration:A=300,easing:b=qt,tick:_=_e,css:S}=H||mi,g={start:ri()+I,b:B};B||(g.group=dt,dt.r+=1),O||p?p=g:(S&&(T(),P=nr(D,W,B,A,I,b,S)),B&&_(0,1),O=k(g,A),lt(()=>Ht(D,B,"start")),ii(x=>{if(p&&x>p.start&&(O=k(p,A),p=null,Ht(D,O.b,"start"),S&&(T(),P=nr(D,W,O.b,O.duration,0,b,H.css))),O){if(x>=O.end)_(W=O.b,1-W),Ht(D,O.b,"end"),p||(O.b?T():--O.group.r||st(O.group.c)),O=null;else if(x>=O.start){const y=x-O.start;W=O.a+O.d*b(y/O.duration),_(W,1-W)}}return!!(O||p)}))}return{run(B){ke(H)?gi().then(()=>{H=H(K),C(B)}):C(B)},end(){T(),O=p=null}}}function Pe(D){D&&D.c()}function De(D,L,R,G){const{fragment:K,after_update:H}=D.$$;K&&K.m(L,R),G||lt(()=>{const W=D.$$.on_mount.map(Qt).filter(ke);D.$$.on_destroy?D.$$.on_destroy.push(...W):st(W),D.$$.on_mount=[]}),H.forEach(lt)}function Le(D,L){const R=D.$$;R.fragment!==null&&(st(R.on_destroy),R.fragment&&R.fragment.d(L),R.on_destroy=R.fragment=null,R.ctx=[])}function pi(D,L){D.$$.dirty[0]===-1&&(Tt.push(D),lr(),D.$$.dirty.fill(0)),D.$$.dirty[L/31|0]|=1<<L%31}function tt(D,L,R,G,K,H,W,O=[-1]){const p=At;Dt(D);const P=D.$$={fragment:null,ctx:[],props:H,update:_e,not_equal:K,bound:Zt(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(L.context||(p?p.$$.context:[])),callbacks:Zt(),dirty:O,skip_bound:!1,root:L.target||p.$$.root};W&&W(P.root);let T=!1;if(P.ctx=R?R(D,L.props||{},(k,C,...B)=>{const I=B.length?B[0]:C;return P.ctx&&K(P.ctx[k],P.ctx[k]=I)&&(!P.skip_bound&&P.bound[k]&&P.bound[k](I),T&&pi(D,k)),C}):[],P.update(),T=!0,st(P.before_update),P.fragment=G?G(P.ctx):!1,L.target){if(L.hydrate){const k=ai(L.target);P.fragment&&P.fragment.l(k),k.forEach(de)}else P.fragment&&P.fragment.c();L.intro&&se(D.$$.fragment),De(D,L.target,L.anchor,L.customElement),ur()}Dt(p)}class rt{$destroy(){Le(this,1),this.$destroy=_e}$on(L,R){if(!ke(R))return _e;const G=this.$$.callbacks[L]||(this.$$.callbacks[L]=[]);return G.push(R),()=>{const K=G.indexOf(R);K!==-1&&G.splice(K,1)}}$set(L){this.$$set&&!ti(L)&&(this.$$.skip_bound=!0,this.$$set(L),this.$$.skip_bound=!1)}}function it(D,{delay:L=0,duration:R=400,easing:G=qt}={}){const K=+getComputedStyle(D).opacity;return{delay:L,duration:R,easing:G,css:H=>`opacity: ${H*K}`}}var yi=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ei(D){return D&&D.__esModule&&Object.prototype.hasOwnProperty.call(D,"default")?D.default:D}var dr={exports:{}};(function(D,L){typeof window<"u"&&function(G,K){D.exports=K()}(yi,()=>(()=>{var R={"./src/config.ts":(W,O,p)=>{p.r(O),p.d(O,{enableStreamingMode:()=>f,hlsDefaultConfig:()=>r,mergeConfig:()=>t});var P=p("./src/controller/abr-controller.ts"),T=p("./src/controller/audio-stream-controller.ts"),k=p("./src/controller/audio-track-controller.ts"),C=p("./src/controller/subtitle-stream-controller.ts"),B=p("./src/controller/subtitle-track-controller.ts"),I=p("./src/controller/buffer-controller.ts"),A=p("./src/controller/timeline-controller.ts"),b=p("./src/controller/cap-level-controller.ts"),_=p("./src/controller/fps-controller.ts"),S=p("./src/controller/eme-controller.ts"),g=p("./src/controller/cmcd-controller.ts"),x=p("./src/utils/xhr-loader.ts"),y=p("./src/utils/fetch-loader.ts"),l=p("./src/utils/cues.ts"),u=p("./src/utils/mediakeys-helper.ts"),a=p("./src/utils/logger.ts");function s(){return s=Object.assign?Object.assign.bind():function(e){for(var h=1;h<arguments.length;h++){var d=arguments[h];for(var c in d)Object.prototype.hasOwnProperty.call(d,c)&&(e[c]=d[c])}return e},s.apply(this,arguments)}function m(e,h){var d=Object.keys(e);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);h&&(c=c.filter(function(M){return Object.getOwnPropertyDescriptor(e,M).enumerable})),d.push.apply(d,c)}return d}function v(e){for(var h=1;h<arguments.length;h++){var d=arguments[h]!=null?arguments[h]:{};h%2?m(Object(d),!0).forEach(function(c){i(e,c,d[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(d)):m(Object(d)).forEach(function(c){Object.defineProperty(e,c,Object.getOwnPropertyDescriptor(d,c))})}return e}function i(e,h,d){return h=n(h),h in e?Object.defineProperty(e,h,{value:d,enumerable:!0,configurable:!0,writable:!0}):e[h]=d,e}function n(e){var h=E(e,"string");return typeof h=="symbol"?h:String(h)}function E(e,h){if(typeof e!="object"||e===null)return e;var d=e[Symbol.toPrimitive];if(d!==void 0){var c=d.call(e,h||"default");if(typeof c!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(h==="string"?String:Number)(e)}var r=v(v({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:x.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:P.default,bufferController:I.default,capLevelController:b.default,fpsController:_.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:u.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0},o()),{},{subtitleStreamController:C.SubtitleStreamController,subtitleTrackController:B.default,timelineController:A.TimelineController,audioStreamController:T.default,audioTrackController:k.default,emeController:S.default,cmcdController:g.default});function o(){return{cueHandler:l.default,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function t(e,h){if((h.liveSyncDurationCount||h.liveMaxLatencyDurationCount)&&(h.liveSyncDuration||h.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(h.liveMaxLatencyDurationCount!==void 0&&(h.liveSyncDurationCount===void 0||h.liveMaxLatencyDurationCount<=h.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(h.liveMaxLatencyDuration!==void 0&&(h.liveSyncDuration===void 0||h.liveMaxLatencyDuration<=h.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return s({},e,h)}function f(e){var h=e.loader;if(h!==y.default&&h!==x.default)a.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),e.progressive=!1;else{var d=(0,y.fetchSupported)();d&&(e.loader=y.default,e.progressive=!0,e.enableSoftwareAES=!0,a.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}}},"./src/controller/abr-controller.ts":(W,O,p)=>{p.r(O),p.d(O,{default:()=>x});var P=p("./src/polyfills/number.ts"),T=p("./src/utils/ewma-bandwidth-estimator.ts"),k=p("./src/events.ts"),C=p("./src/errors.ts"),B=p("./src/types/loader.ts"),I=p("./src/utils/logger.ts");function A(y,l){for(var u=0;u<l.length;u++){var a=l[u];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(y,_(a.key),a)}}function b(y,l,u){return l&&A(y.prototype,l),u&&A(y,u),Object.defineProperty(y,"prototype",{writable:!1}),y}function _(y){var l=S(y,"string");return typeof l=="symbol"?l:String(l)}function S(y,l){if(typeof y!="object"||y===null)return y;var u=y[Symbol.toPrimitive];if(u!==void 0){var a=u.call(y,l||"default");if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(l==="string"?String:Number)(y)}var g=function(){function y(u){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=u;var a=u.config;this.bwEstimator=new T.default(a.abrEwmaSlowVoD,a.abrEwmaFastVoD,a.abrEwmaDefaultEstimate),this.registerListeners()}var l=y.prototype;return l.registerListeners=function(){var a=this.hls;a.on(k.Events.FRAG_LOADING,this.onFragLoading,this),a.on(k.Events.FRAG_LOADED,this.onFragLoaded,this),a.on(k.Events.FRAG_BUFFERED,this.onFragBuffered,this),a.on(k.Events.LEVEL_LOADED,this.onLevelLoaded,this),a.on(k.Events.ERROR,this.onError,this)},l.unregisterListeners=function(){var a=this.hls;a.off(k.Events.FRAG_LOADING,this.onFragLoading,this),a.off(k.Events.FRAG_LOADED,this.onFragLoaded,this),a.off(k.Events.FRAG_BUFFERED,this.onFragBuffered,this),a.off(k.Events.LEVEL_LOADED,this.onLevelLoaded,this),a.off(k.Events.ERROR,this.onError,this)},l.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},l.onFragLoading=function(a,s){var m=s.frag;if(m.type===B.PlaylistLevelType.MAIN&&!this.timer){var v;this.fragCurrent=m,this.partCurrent=(v=s.part)!=null?v:null,this.timer=self.setInterval(this.onCheck,100)}},l.onLevelLoaded=function(a,s){var m=this.hls.config;s.details.live?this.bwEstimator.update(m.abrEwmaSlowLive,m.abrEwmaFastLive):this.bwEstimator.update(m.abrEwmaSlowVoD,m.abrEwmaFastVoD)},l._abandonRulesCheck=function(){var a=this.fragCurrent,s=this.partCurrent,m=this.hls,v=m.autoLevelEnabled,i=m.media;if(!(!a||!i)){var n=s?s.stats:a.stats,E=s?s.duration:a.duration;if(n.aborted||n.loaded&&n.loaded===n.total||a.level===0){this.clearTimer(),this._nextAutoLevel=-1;return}if(!(!v||i.paused||!i.playbackRate||!i.readyState)){var r=m.mainForwardBufferInfo;if(r!==null){var o=performance.now()-n.loading.start,t=Math.abs(i.playbackRate);if(!(o<=500*E/t)){var f=n.loaded&&n.loading.first,e=this.bwEstimator.getEstimate(),h=m.levels,d=m.minAutoLevel,c=h[a.level],M=n.total||Math.max(n.loaded,Math.round(E*c.maxBitrate/8)),F=f?n.loaded*1e3/o:0,w=F?(M-n.loaded)/F:M*8/e,U=r.len/t;if(!(w<=U)){var N=Number.POSITIVE_INFINITY,z;for(z=a.level-1;z>d;z--){var V=h[z].maxBitrate;if(N=F?E*V/(8*.8*F):E*V/e,N<U)break}N>=w||(I.logger.warn("Fragment "+a.sn+(s?" part "+s.index:"")+" of level "+a.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+z+`
      Current BW estimate: `+((0,P.isFiniteNumber)(e)?(e/1024).toFixed(3):"Unknown")+` Kb/s
      Estimated load time for current fragment: `+w.toFixed(3)+` s
      Estimated load time for the next fragment: `+N.toFixed(3)+` s
      Time to underbuffer: `+U.toFixed(3)+" s"),m.nextLoadLevel=z,f&&this.bwEstimator.sample(o,n.loaded),this.clearTimer(),(a.loader||a.keyLoader)&&(this.fragCurrent=this.partCurrent=null,a.abortRequests()),m.trigger(k.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:a,part:s,stats:n}))}}}}}},l.onFragLoaded=function(a,s){var m=s.frag,v=s.part;if(m.type===B.PlaylistLevelType.MAIN&&(0,P.isFiniteNumber)(m.sn)){var i=v?v.stats:m.stats,n=v?v.duration:m.duration;if(this.clearTimer(),this.lastLoadedFragLevel=m.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var E=this.hls.levels[m.level],r=(E.loaded?E.loaded.bytes:0)+i.loaded,o=(E.loaded?E.loaded.duration:0)+n;E.loaded={bytes:r,duration:o},E.realBitrate=Math.round(8*r/o)}if(m.bitrateTest){var t={stats:i,frag:m,part:v,id:m.type};this.onFragBuffered(k.Events.FRAG_BUFFERED,t)}}},l.onFragBuffered=function(a,s){var m=s.frag,v=s.part,i=v?v.stats:m.stats;if(!i.aborted&&!(m.type!==B.PlaylistLevelType.MAIN||m.sn==="initSegment")){var n=i.parsing.end-i.loading.start;this.bwEstimator.sample(n,i.loaded),i.bwEstimate=this.bwEstimator.getEstimate(),m.bitrateTest?this.bitrateTestDelay=n/1e3:this.bitrateTestDelay=0}},l.onError=function(a,s){var m;if(((m=s.frag)===null||m===void 0?void 0:m.type)===B.PlaylistLevelType.MAIN){if(s.type===C.ErrorTypes.KEY_SYSTEM_ERROR){this.clearTimer();return}switch(s.details){case C.ErrorDetails.FRAG_LOAD_ERROR:case C.ErrorDetails.FRAG_LOAD_TIMEOUT:case C.ErrorDetails.KEY_LOAD_ERROR:case C.ErrorDetails.KEY_LOAD_TIMEOUT:this.clearTimer();break}}},l.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},l.getNextABRAutoLevel=function(){var a=this.fragCurrent,s=this.partCurrent,m=this.hls,v=m.maxAutoLevel,i=m.config,n=m.minAutoLevel,E=m.media,r=s?s.duration:a?a.duration:0,o=E&&E.playbackRate!==0?Math.abs(E.playbackRate):1,t=this.bwEstimator?this.bwEstimator.getEstimate():i.abrEwmaDefaultEstimate,f=m.mainForwardBufferInfo,e=(f?f.len:0)/o,h=this.findBestLevel(t,n,v,e,i.abrBandWidthFactor,i.abrBandWidthUpFactor);if(h>=0)return h;I.logger.trace((e?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var d=r?Math.min(r,i.maxStarvationDelay):i.maxStarvationDelay,c=i.abrBandWidthFactor,M=i.abrBandWidthUpFactor;if(!e){var F=this.bitrateTestDelay;if(F){var w=r?Math.min(r,i.maxLoadingDelay):i.maxLoadingDelay;d=w-F,I.logger.trace("bitrate test took "+Math.round(1e3*F)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*d)+" ms"),c=M=1}}return h=this.findBestLevel(t,n,v,e+d,c,M),Math.max(h,0)},l.findBestLevel=function(a,s,m,v,i,n){for(var E,r=this.fragCurrent,o=this.partCurrent,t=this.lastLoadedFragLevel,f=this.hls.levels,e=f[t],h=!!(e!=null&&(E=e.details)!==null&&E!==void 0&&E.live),d=e==null?void 0:e.codecSet,c=o?o.duration:r?r.duration:0,M=m;M>=s;M--){var F=f[M];if(!(!F||d&&F.codecSet!==d)){var w=F.details,U=(o?w==null?void 0:w.partTarget:w==null?void 0:w.averagetargetduration)||c,N=void 0;M<=t?N=i*a:N=n*a;var z=f[M].maxBitrate,V=z*U/N;if(I.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+M+"/"+Math.round(N)+"/"+z+"/"+U+"/"+v+"/"+V),N>z&&(V===0||!(0,P.isFiniteNumber)(V)||h&&!this.bitrateTestDelay||V<v))return M}}return-1},b(y,[{key:"nextAutoLevel",get:function(){var a=this._nextAutoLevel,s=this.bwEstimator;if(a!==-1&&!s.canEstimate())return a;var m=this.getNextABRAutoLevel();return a!==-1&&this.hls.levels[m].loadError?a:(a!==-1&&(m=Math.min(a,m)),m)},set:function(a){this._nextAutoLevel=a}}]),y}();const x=g},"./src/controller/audio-stream-controller.ts":(W,O,p)=>{p.r(O),p.d(O,{default:()=>i});var P=p("./src/polyfills/number.ts"),T=p("./src/controller/base-stream-controller.ts"),k=p("./src/events.ts"),C=p("./src/utils/buffer-helper.ts"),B=p("./src/controller/fragment-tracker.ts"),I=p("./src/types/level.ts"),A=p("./src/types/loader.ts"),b=p("./src/loader/fragment.ts"),_=p("./src/demux/chunk-cache.ts"),S=p("./src/demux/transmuxer-interface.ts"),g=p("./src/types/transmuxer.ts"),x=p("./src/controller/fragment-finders.ts"),y=p("./src/utils/discontinuities.ts"),l=p("./src/errors.ts");function u(){return u=Object.assign?Object.assign.bind():function(n){for(var E=1;E<arguments.length;E++){var r=arguments[E];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(n[o]=r[o])}return n},u.apply(this,arguments)}function a(n,E){n.prototype=Object.create(E.prototype),n.prototype.constructor=n,s(n,E)}function s(n,E){return s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,t){return o.__proto__=t,o},s(n,E)}var m=100,v=function(n){a(E,n);function E(o,t,f){var e;return e=n.call(this,o,t,f,"[audio-stream-controller]")||this,e.videoBuffer=null,e.videoTrackCC=-1,e.waitingVideoCC=-1,e.audioSwitch=!1,e.trackId=-1,e.waitingData=null,e.mainDetails=null,e.bufferFlushed=!1,e.cachedTrackLoadedData=null,e._registerListeners(),e}var r=E.prototype;return r.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},r._registerListeners=function(){var t=this.hls;t.on(k.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(k.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(k.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(k.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.on(k.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.on(k.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(k.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(k.Events.ERROR,this.onError,this),t.on(k.Events.BUFFER_RESET,this.onBufferReset,this),t.on(k.Events.BUFFER_CREATED,this.onBufferCreated,this),t.on(k.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(k.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(k.Events.FRAG_BUFFERED,this.onFragBuffered,this)},r._unregisterListeners=function(){var t=this.hls;t.off(k.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(k.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(k.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(k.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.off(k.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.off(k.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(k.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.off(k.Events.ERROR,this.onError,this),t.off(k.Events.BUFFER_RESET,this.onBufferReset,this),t.off(k.Events.BUFFER_CREATED,this.onBufferCreated,this),t.off(k.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(k.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),t.off(k.Events.FRAG_BUFFERED,this.onFragBuffered,this)},r.onInitPtsFound=function(t,f){var e=f.frag,h=f.id,d=f.initPTS;if(h==="main"){var c=e.cc;this.initPTS[e.cc]=d,this.log("InitPTS for cc: "+c+" found from main: "+d),this.videoTrackCC=c,this.state===T.State.WAITING_INIT_PTS&&this.tick()}},r.startLoad=function(t){if(!this.levels){this.startPosition=t,this.state=T.State.STOPPED;return}var f=this.lastCurrentTime;this.stopLoad(),this.setInterval(m),this.fragLoadError=0,f>0&&t===-1?(this.log("Override startPosition with lastCurrentTime @"+f.toFixed(3)),t=f,this.state=T.State.IDLE):(this.loadedmetadata=!1,this.state=T.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()},r.doTick=function(){switch(this.state){case T.State.IDLE:this.doTickIdle();break;case T.State.WAITING_TRACK:{var t,f=this.levels,e=this.trackId,h=f==null||(t=f[e])===null||t===void 0?void 0:t.details;if(h){if(this.waitForCdnTuneIn(h))break;this.state=T.State.WAITING_INIT_PTS}break}case T.State.FRAG_LOADING_WAITING_RETRY:{var d,c=performance.now(),M=this.retryDate;(!M||c>=M||(d=this.media)!==null&&d!==void 0&&d.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.trackId),this.state=T.State.IDLE);break}case T.State.WAITING_INIT_PTS:{var F=this.waitingData;if(F){var w=F.frag,U=F.part,N=F.cache,z=F.complete;if(this.initPTS[w.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=T.State.FRAG_LOADING;var V=N.flush(),j={frag:w,part:U,payload:V,networkDetails:null};this._handleFragmentLoadProgress(j),z&&n.prototype._handleFragmentLoadComplete.call(this,j)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log("Waiting fragment cc ("+w.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var Y=this.getLoadPosition(),X=C.BufferHelper.bufferInfo(this.mediaBuffer,Y,this.config.maxBufferHole),Q=(0,x.fragmentWithinToleranceTest)(X.end,this.config.maxFragLookUpTolerance,w);Q<0&&(this.log("Waiting fragment cc ("+w.cc+") @ "+w.start+" cancelled because another fragment at "+X.end+" is needed"),this.clearWaitingFragment())}}else this.state=T.State.IDLE}}this.onTickEnd()},r.clearWaitingFragment=function(){var t=this.waitingData;t&&(this.fragmentTracker.removeFragment(t.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=T.State.IDLE)},r.resetLoadingState=function(){this.clearWaitingFragment(),n.prototype.resetLoadingState.call(this)},r.onTickEnd=function(){var t=this.media;!t||!t.readyState||(this.lastCurrentTime=t.currentTime)},r.doTickIdle=function(){var t=this.hls,f=this.levels,e=this.media,h=this.trackId,d=t.config;if(!(!f||!f[h])&&!(!e&&(this.startFragRequested||!d.startFragPrefetch))){var c=f[h],M=c.details;if(!M||M.live&&this.levelLastLoaded!==h||this.waitForCdnTuneIn(M)){this.state=T.State.WAITING_TRACK;return}var F=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&F&&(this.bufferFlushed=!1,this.afterBufferFlushed(F,b.ElementaryStreamTypes.AUDIO,A.PlaylistLevelType.AUDIO));var w=this.getFwdBufferInfo(F,A.PlaylistLevelType.AUDIO);if(w!==null){var U=this.audioSwitch;if(!U&&this._streamEnded(w,M)){t.trigger(k.Events.BUFFER_EOS,{type:"audio"}),this.state=T.State.ENDED;return}var N=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,A.PlaylistLevelType.MAIN),z=w.len,V=this.getMaxBufferLength(N==null?void 0:N.len);if(!(z>=V&&!U)){var j=M.fragments,Y=j[0].start,X=w.end;if(U&&e){var Q=this.getLoadPosition();X=Q,M.PTSKnown&&Q<Y&&(w.end>Y||w.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),e.currentTime=Y+.05)}if(!(N&&X>N.end+M.targetduration)&&!((!N||!N.len)&&w.len)){var te=this.getNextFragment(X,M);if(!te){this.bufferFlushed=!0;return}this.loadFragment(te,M,X)}}}}},r.getMaxBufferLength=function(t){var f=n.prototype.getMaxBufferLength.call(this);return t?Math.max(f,t):f},r.onMediaDetaching=function(){this.videoBuffer=null,n.prototype.onMediaDetaching.call(this)},r.onAudioTracksUpdated=function(t,f){var e=f.audioTracks;this.resetTransmuxer(),this.levels=e.map(function(h){return new I.Level(h)})},r.onAudioTrackSwitching=function(t,f){var e=!!f.url;this.trackId=f.id;var h=this.fragCurrent;h&&h.abortRequests(),this.fragCurrent=null,this.clearWaitingFragment(),e?this.setInterval(m):this.resetTransmuxer(),e?(this.audioSwitch=!0,this.state=T.State.IDLE):this.state=T.State.STOPPED,this.tick()},r.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},r.onLevelLoaded=function(t,f){this.mainDetails=f.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(k.Events.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)},r.onAudioTrackLoaded=function(t,f){var e;if(this.mainDetails==null){this.cachedTrackLoadedData=f;return}var h=this.levels,d=f.details,c=f.id;if(!h){this.warn("Audio tracks were reset while loading level "+c);return}this.log("Track "+c+" loaded ["+d.startSN+","+d.endSN+"],duration:"+d.totalduration);var M=h[c],F=0;if(d.live||(e=M.details)!==null&&e!==void 0&&e.live){var w=this.mainDetails;if(d.fragments[0]||(d.deltaUpdateFailed=!0),d.deltaUpdateFailed||!w)return;!M.details&&d.hasProgramDateTime&&w.hasProgramDateTime?((0,y.alignMediaPlaylistByPDT)(d,w),F=d.fragments[0].start):F=this.alignPlaylists(d,M.details)}M.details=d,this.levelLastLoaded=c,!this.startFragRequested&&(this.mainDetails||!d.live)&&this.setStartPosition(M.details,F),this.state===T.State.WAITING_TRACK&&!this.waitForCdnTuneIn(d)&&(this.state=T.State.IDLE),this.tick()},r._handleFragmentLoadProgress=function(t){var f,e=t.frag,h=t.part,d=t.payload,c=this.config,M=this.trackId,F=this.levels;if(!F){this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+e.sn+" of level "+e.level+" will not be buffered");return}var w=F[M];console.assert(w,"Audio track is defined on fragment load progress");var U=w.details;console.assert(U,"Audio track details are defined on fragment load progress");var N=c.defaultAudioCodec||w.audioCodec||"mp4a.40.2",z=this.transmuxer;z||(z=this.transmuxer=new S.default(this.hls,A.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var V=this.initPTS[e.cc],j=(f=e.initSegment)===null||f===void 0?void 0:f.data;if(V!==void 0){var Y=!1,X=h?h.index:-1,Q=X!==-1,te=new g.ChunkMetadata(e.level,e.sn,e.stats.chunkCount,d.byteLength,X,Q);z.push(d,j,N,"",e,h,U.totalduration,Y,te,V)}else{this.log("Unknown video PTS for cc "+e.cc+", waiting for video PTS before demuxing audio frag "+e.sn+" of ["+U.startSN+" ,"+U.endSN+"],track "+M);var $=this.waitingData=this.waitingData||{frag:e,part:h,cache:new _.default,complete:!1},ee=$.cache;ee.push(new Uint8Array(d)),this.waitingVideoCC=this.videoTrackCC,this.state=T.State.WAITING_INIT_PTS}},r._handleFragmentLoadComplete=function(t){if(this.waitingData){this.waitingData.complete=!0;return}n.prototype._handleFragmentLoadComplete.call(this,t)},r.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},r.onBufferCreated=function(t,f){var e=f.tracks.audio;e&&(this.mediaBuffer=e.buffer||null),f.tracks.video&&(this.videoBuffer=f.tracks.video.buffer||null)},r.onFragBuffered=function(t,f){var e=f.frag,h=f.part;if(e.type!==A.PlaylistLevelType.AUDIO){if(!this.loadedmetadata&&e.type===A.PlaylistLevelType.MAIN){var d;(d=this.videoBuffer||this.media)!==null&&d!==void 0&&d.buffered.length&&(this.loadedmetadata=!0)}return}if(this.fragContextChanged(e)){this.warn("Fragment "+e.sn+(h?" p: "+h.index:"")+" of level "+e.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch);return}e.sn!=="initSegment"&&(this.fragPrevious=e,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(k.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(e,h)},r.onError=function(t,f){if(f.type===l.ErrorTypes.KEY_SYSTEM_ERROR){this.onFragmentOrKeyLoadError(A.PlaylistLevelType.AUDIO,f);return}switch(f.details){case l.ErrorDetails.FRAG_LOAD_ERROR:case l.ErrorDetails.FRAG_LOAD_TIMEOUT:case l.ErrorDetails.FRAG_PARSING_ERROR:case l.ErrorDetails.KEY_LOAD_ERROR:case l.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(A.PlaylistLevelType.AUDIO,f);break;case l.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case l.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==T.State.ERROR&&this.state!==T.State.STOPPED&&(this.state=f.fatal?T.State.ERROR:T.State.IDLE,this.warn(f.details+" while loading frag, switching to "+this.state+" state"));break;case l.ErrorDetails.BUFFER_FULL_ERROR:if(f.parent==="audio"&&(this.state===T.State.PARSING||this.state===T.State.PARSED)){var e=!0,h=this.getFwdBufferInfo(this.mediaBuffer,A.PlaylistLevelType.AUDIO);h&&h.len>.5&&(e=!this.reduceMaxBufferLength(h.len)),e&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,n.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}break}},r.onBufferFlushed=function(t,f){var e=f.type;e===b.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0,this.state===T.State.ENDED&&(this.state=T.State.IDLE))},r._handleTransmuxComplete=function(t){var f,e="audio",h=this.hls,d=t.remuxResult,c=t.chunkMeta,M=this.getCurrentContext(c);if(!M){this.warn("The loading context changed while buffering fragment "+c.sn+" of level "+c.level+". This chunk will not be buffered."),this.resetStartWhenNotLoaded(c.level);return}var F=M.frag,w=M.part,U=M.level.details,N=d.audio,z=d.text,V=d.id3,j=d.initSegment;if(!(this.fragContextChanged(F)||!U)){if(this.state=T.State.PARSING,this.audioSwitch&&N&&this.completeAudioSwitch(),j!=null&&j.tracks&&(this._bufferInitSegment(j.tracks,F,c),h.trigger(k.Events.FRAG_PARSING_INIT_SEGMENT,{frag:F,id:e,tracks:j.tracks})),N){var Y=N.startPTS,X=N.endPTS,Q=N.startDTS,te=N.endDTS;w&&(w.elementaryStreams[b.ElementaryStreamTypes.AUDIO]={startPTS:Y,endPTS:X,startDTS:Q,endDTS:te}),F.setElementaryStreamInfo(b.ElementaryStreamTypes.AUDIO,Y,X,Q,te),this.bufferFragmentData(N,F,w,c)}if(V!=null&&(f=V.samples)!==null&&f!==void 0&&f.length){var $=u({id:e,frag:F,details:U},V);h.trigger(k.Events.FRAG_PARSING_METADATA,$)}if(z){var ee=u({id:e,frag:F,details:U},z);h.trigger(k.Events.FRAG_PARSING_USERDATA,ee)}}},r._bufferInitSegment=function(t,f,e){if(this.state===T.State.PARSING){t.video&&delete t.video;var h=t.audio;if(!!h){h.levelCodec=h.codec,h.id="audio",this.log("Init audio buffer, container:"+h.container+", codecs[parsed]=["+h.codec+"]"),this.hls.trigger(k.Events.BUFFER_CODECS,t);var d=h.initSegment;if(d!=null&&d.byteLength){var c={type:"audio",frag:f,part:null,chunkMeta:e,parent:f.type,data:d};this.hls.trigger(k.Events.BUFFER_APPENDING,c)}this.tick()}}},r.loadFragment=function(t,f,e){var h=this.fragmentTracker.getState(t);this.fragCurrent=t,(this.audioSwitch||h===B.FragmentState.NOT_LOADED||h===B.FragmentState.PARTIAL)&&(t.sn==="initSegment"?this._loadInitSegment(t,f):f.live&&!(0,P.isFiniteNumber)(this.initPTS[t.cc])?(this.log("Waiting for video PTS in continuity counter "+t.cc+" of live stream before loading audio fragment "+t.sn+" of level "+this.trackId),this.state=T.State.WAITING_INIT_PTS):(this.startFragRequested=!0,n.prototype.loadFragment.call(this,t,f,e)))},r.completeAudioSwitch=function(){var t=this.hls,f=this.media,e=this.trackId;f&&(this.log("Switching audio track : flushing all audio"),n.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,t.trigger(k.Events.AUDIO_TRACK_SWITCHED,{id:e})},E}(T.default);const i=v},"./src/controller/audio-track-controller.ts":(W,O,p)=>{p.r(O),p.d(O,{default:()=>x});var P=p("./src/events.ts"),T=p("./src/errors.ts"),k=p("./src/controller/base-playlist-controller.ts"),C=p("./src/types/loader.ts");function B(y,l){for(var u=0;u<l.length;u++){var a=l[u];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(y,A(a.key),a)}}function I(y,l,u){return l&&B(y.prototype,l),u&&B(y,u),Object.defineProperty(y,"prototype",{writable:!1}),y}function A(y){var l=b(y,"string");return typeof l=="symbol"?l:String(l)}function b(y,l){if(typeof y!="object"||y===null)return y;var u=y[Symbol.toPrimitive];if(u!==void 0){var a=u.call(y,l||"default");if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(l==="string"?String:Number)(y)}function _(y,l){y.prototype=Object.create(l.prototype),y.prototype.constructor=y,S(y,l)}function S(y,l){return S=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,s){return a.__proto__=s,a},S(y,l)}var g=function(y){_(l,y);function l(a){var s;return s=y.call(this,a,"[audio-track-controller]")||this,s.tracks=[],s.groupId=null,s.tracksInGroup=[],s.trackId=-1,s.trackName="",s.selectDefaultTrack=!0,s.registerListeners(),s}var u=l.prototype;return u.registerListeners=function(){var s=this.hls;s.on(P.Events.MANIFEST_LOADING,this.onManifestLoading,this),s.on(P.Events.MANIFEST_PARSED,this.onManifestParsed,this),s.on(P.Events.LEVEL_LOADING,this.onLevelLoading,this),s.on(P.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),s.on(P.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),s.on(P.Events.ERROR,this.onError,this)},u.unregisterListeners=function(){var s=this.hls;s.off(P.Events.MANIFEST_LOADING,this.onManifestLoading,this),s.off(P.Events.MANIFEST_PARSED,this.onManifestParsed,this),s.off(P.Events.LEVEL_LOADING,this.onLevelLoading,this),s.off(P.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),s.off(P.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),s.off(P.Events.ERROR,this.onError,this)},u.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,y.prototype.destroy.call(this)},u.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},u.onManifestParsed=function(s,m){this.tracks=m.audioTracks||[]},u.onAudioTrackLoaded=function(s,m){var v=m.id,i=m.details,n=this.tracksInGroup[v];if(!n){this.warn("Invalid audio track id "+v);return}var E=n.details;n.details=m.details,this.log("audioTrack "+v+" loaded ["+i.startSN+"-"+i.endSN+"]"),v===this.trackId&&(this.retryCount=0,this.playlistLoaded(v,m,E))},u.onLevelLoading=function(s,m){this.switchLevel(m.level)},u.onLevelSwitching=function(s,m){this.switchLevel(m.level)},u.switchLevel=function(s){var m=this.hls.levels[s];if(!!(m!=null&&m.audioGroupIds)){var v=m.audioGroupIds[m.urlId];if(this.groupId!==v){this.groupId=v;var i=this.tracks.filter(function(E){return!v||E.groupId===v});this.selectDefaultTrack&&!i.some(function(E){return E.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=i;var n={audioTracks:i};this.log("Updating audio tracks, "+i.length+' track(s) found in "'+v+'" group-id'),this.hls.trigger(P.Events.AUDIO_TRACKS_UPDATED,n),this.selectInitialTrack()}}},u.onError=function(s,m){y.prototype.onError.call(this,s,m),!(m.fatal||!m.context)&&m.context.type===C.PlaylistContextType.AUDIO_TRACK&&m.context.id===this.trackId&&m.context.groupId===this.groupId&&this.retryLoadingOrFail(m)},u.setAudioTrack=function(s){var m=this.tracksInGroup;if(s<0||s>=m.length){this.warn("Invalid id passed to audio-track controller");return}this.clearTimer();var v=m[this.trackId];this.log("Now switching to audio-track index "+s);var i=m[s],n=i.id,E=i.groupId,r=E===void 0?"":E,o=i.name,t=i.type,f=i.url;if(this.trackId=s,this.trackName=o,this.selectDefaultTrack=!1,this.hls.trigger(P.Events.AUDIO_TRACK_SWITCHING,{id:n,groupId:r,name:o,type:t,url:f}),!(i.details&&!i.details.live)){var e=this.switchParams(i.url,v==null?void 0:v.details);this.loadPlaylist(e)}},u.selectInitialTrack=function(){var s=this.tracksInGroup;console.assert(s.length,"Initial audio track should be selected when tracks are known");var m=this.trackName,v=this.findTrackId(m)||this.findTrackId();v!==-1?this.setAudioTrack(v):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(P.Events.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},u.findTrackId=function(s){for(var m=this.tracksInGroup,v=0;v<m.length;v++){var i=m[v];if((!this.selectDefaultTrack||i.default)&&(!s||s===i.name))return i.id}return-1},u.loadPlaylist=function(s){y.prototype.loadPlaylist.call(this);var m=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(m)){var v=m.id,i=m.groupId,n=m.url;if(s)try{n=s.addDirectives(n)}catch(E){this.warn("Could not construct new URL with HLS Delivery Directives: "+E)}this.log("loading audio-track playlist for id: "+v),this.clearTimer(),this.hls.trigger(P.Events.AUDIO_TRACK_LOADING,{url:n,id:v,groupId:i,deliveryDirectives:s||null})}},I(l,[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(s){this.selectDefaultTrack=!1,this.setAudioTrack(s)}}]),l}(k.default);const x=g},"./src/controller/base-playlist-controller.ts":(W,O,p)=>{p.r(O),p.d(O,{default:()=>B});var P=p("./src/types/level.ts"),T=p("./src/controller/level-helper.ts"),k=p("./src/utils/logger.ts"),C=p("./src/errors.ts"),B=function(){function I(b,_){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=k.logger.log.bind(k.logger,_+":"),this.warn=k.logger.warn.bind(k.logger,_+":"),this.hls=b}var A=I.prototype;return A.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},A.onError=function(_,S){S.fatal&&(S.type===C.ErrorTypes.NETWORK_ERROR||S.type===C.ErrorTypes.KEY_SYSTEM_ERROR)&&this.stopLoad()},A.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},A.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.requestScheduled=-1,this.loadPlaylist()},A.stopLoad=function(){this.canLoad=!1,this.clearTimer()},A.switchParams=function(_,S){var g=S==null?void 0:S.renditionReports;if(g)for(var x=0;x<g.length;x++){var y=g[x],l=void 0;try{l=new self.URL(y.URI,S.url).href}catch(m){k.logger.warn("Could not construct new URL for Rendition Report: "+m),l=y.URI||""}if(l===_.slice(-l.length)){var u=parseInt(y["LAST-MSN"])||(S==null?void 0:S.lastPartSn),a=parseInt(y["LAST-PART"])||(S==null?void 0:S.lastPartIndex);if(this.hls.config.lowLatencyMode){var s=Math.min(S.age-S.partTarget,S.targetduration);a>=0&&s>S.partTarget&&(a+=1)}return new P.HlsUrlParameters(u,a>=0?a:void 0,P.HlsSkip.No)}}},A.loadPlaylist=function(_){this.requestScheduled===-1&&(this.requestScheduled=self.performance.now())},A.shouldLoadTrack=function(_){return this.canLoad&&_&&!!_.url&&(!_.details||_.details.live)},A.playlistLoaded=function(_,S,g){var x=this,y=S.details,l=S.stats,u=self.performance.now(),a=l.loading.first?Math.max(0,u-l.loading.first):0;if(y.advancedDateTime=Date.now()-a,y.live||g!=null&&g.live){if(y.reloaded(g),g&&this.log("live playlist "+_+" "+(y.advanced?"REFRESHED "+y.lastPartSn+"-"+y.lastPartIndex:"MISSED")),g&&y.fragments.length>0&&(0,T.mergeDetails)(g,y),!this.canLoad||!y.live)return;var s,m=void 0,v=void 0;if(y.canBlockReload&&y.endSN&&y.advanced){var i=this.hls.config.lowLatencyMode,n=y.lastPartSn,E=y.endSN,r=y.lastPartIndex,o=r!==-1,t=n===E,f=i?0:r;o?(m=t?E+1:n,v=t?f:r+1):m=E+1;var e=y.age,h=e+y.ageHeader,d=Math.min(h-y.partTarget,y.targetduration*1.5);if(d>0){if(g&&d>g.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+g.tuneInGoal+" to: "+d+" with playlist age: "+y.age),d=0;else{var c=Math.floor(d/y.targetduration);if(m+=c,v!==void 0){var M=Math.round(d%y.targetduration/y.partTarget);v+=M}this.log("CDN Tune-in age: "+y.ageHeader+"s last advanced "+e.toFixed(2)+"s goal: "+d+" skip sn "+c+" to part "+v)}y.tuneInGoal=d}if(s=this.getDeliveryDirectives(y,S.deliveryDirectives,m,v),i||!t){this.loadPlaylist(s);return}}else s=this.getDeliveryDirectives(y,S.deliveryDirectives,m,v);var F=this.hls.mainForwardBufferInfo,w=F?F.end-F.len:0,U=(y.edge-w)*1e3,N=(0,T.computeReloadInterval)(y,U);y.updated?u>this.requestScheduled+N&&(this.requestScheduled=l.loading.start):this.requestScheduled=-1,m!==void 0&&y.canBlockReload?this.requestScheduled=l.loading.first+N-(y.partTarget*1e3||1e3):this.requestScheduled=(this.requestScheduled===-1?u:this.requestScheduled)+N;var z=this.requestScheduled-u;z=Math.max(0,z),this.log("reload live playlist "+_+" in "+Math.round(z)+" ms"),this.timer=self.setTimeout(function(){return x.loadPlaylist(s)},z)}else this.clearTimer()},A.getDeliveryDirectives=function(_,S,g,x){var y=(0,P.getSkipValue)(_,g);return S!=null&&S.skip&&_.deltaUpdateFailed&&(g=S.msn,x=S.part,y=P.HlsSkip.No),new P.HlsUrlParameters(g,x,y)},A.retryLoadingOrFail=function(_){var S=this,g=this.hls.config,x=this.retryCount<g.levelLoadingMaxRetry;if(x){var y;if(this.requestScheduled=-1,this.retryCount++,_.details.indexOf("LoadTimeOut")>-1&&(y=_.context)!==null&&y!==void 0&&y.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+_.details+'"'),this.loadPlaylist();else{var l=Math.min(Math.pow(2,this.retryCount)*g.levelLoadingRetryDelay,g.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return S.loadPlaylist()},l),this.warn("retry playlist loading #"+this.retryCount+" in "+l+' ms after "'+_.details+'"')}}else this.warn('cannot recover from error "'+_.details+'"'),this.clearTimer(),_.fatal=!0;return x},I}()},"./src/controller/base-stream-controller.ts":(W,O,p)=>{p.r(O),p.d(O,{State:()=>o,default:()=>t});var P=p("./src/polyfills/number.ts"),T=p("./src/task-loop.ts"),k=p("./src/controller/fragment-tracker.ts"),C=p("./src/utils/buffer-helper.ts"),B=p("./src/utils/logger.ts"),I=p("./src/events.ts"),A=p("./src/errors.ts"),b=p("./src/types/transmuxer.ts"),_=p("./src/utils/mp4-tools.ts"),S=p("./src/utils/discontinuities.ts"),g=p("./src/controller/fragment-finders.ts"),x=p("./src/controller/level-helper.ts"),y=p("./src/loader/fragment-loader.ts"),l=p("./src/crypt/decrypter.ts"),u=p("./src/utils/time-ranges.ts"),a=p("./src/types/loader.ts");function s(f,e){for(var h=0;h<e.length;h++){var d=e[h];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(f,v(d.key),d)}}function m(f,e,h){return e&&s(f.prototype,e),h&&s(f,h),Object.defineProperty(f,"prototype",{writable:!1}),f}function v(f){var e=i(f,"string");return typeof e=="symbol"?e:String(e)}function i(f,e){if(typeof f!="object"||f===null)return f;var h=f[Symbol.toPrimitive];if(h!==void 0){var d=h.call(f,e||"default");if(typeof d!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(f)}function n(f){if(f===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return f}function E(f,e){f.prototype=Object.create(e.prototype),f.prototype.constructor=f,r(f,e)}function r(f,e){return r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(d,c){return d.__proto__=c,d},r(f,e)}var o={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},t=function(f){E(e,f);function e(d,c,M,F){var w;return w=f.call(this)||this,w.hls=void 0,w.fragPrevious=null,w.fragCurrent=null,w.fragmentTracker=void 0,w.transmuxer=null,w._state=o.STOPPED,w.media=null,w.mediaBuffer=null,w.config=void 0,w.bitrateTest=!1,w.lastCurrentTime=0,w.nextLoadPosition=0,w.startPosition=0,w.loadedmetadata=!1,w.fragLoadError=0,w.retryDate=0,w.levels=null,w.fragmentLoader=void 0,w.keyLoader=void 0,w.levelLastLoaded=null,w.startFragRequested=!1,w.decrypter=void 0,w.initPTS=[],w.onvseeking=null,w.onvended=null,w.logPrefix="",w.log=void 0,w.warn=void 0,w.logPrefix=F,w.log=B.logger.log.bind(B.logger,F+":"),w.warn=B.logger.warn.bind(B.logger,F+":"),w.hls=d,w.fragmentLoader=new y.default(d.config),w.keyLoader=M,w.fragmentTracker=c,w.config=d.config,w.decrypter=new l.default(d.config),d.on(I.Events.LEVEL_SWITCHING,w.onLevelSwitching,n(w)),w}var h=e.prototype;return h.doTick=function(){this.onTickEnd()},h.onTickEnd=function(){},h.startLoad=function(c){},h.stopLoad=function(){this.fragmentLoader.abort(),this.keyLoader.abort();var c=this.fragCurrent;c&&(c.abortRequests(),this.fragmentTracker.removeFragment(c)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=o.STOPPED},h._streamEnded=function(c,M){if(M.live||c.nextStart||!c.end||!this.media)return!1;var F=M.partList;if(F!=null&&F.length){var w=F[F.length-1],U=C.BufferHelper.isBuffered(this.media,w.start+w.duration/2);return U}var N=M.fragments[M.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(N)},h.getLevelDetails=function(){if(this.levels&&this.levelLastLoaded!==null){var c;return(c=this.levels[this.levelLastLoaded])===null||c===void 0?void 0:c.details}},h.onMediaAttached=function(c,M){var F=this.media=this.mediaBuffer=M.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),F.addEventListener("seeking",this.onvseeking),F.addEventListener("ended",this.onvended);var w=this.config;this.levels&&w.autoStartLoad&&this.state===o.STOPPED&&this.startLoad(w.startPosition)},h.onMediaDetaching=function(){var c=this.media;c!=null&&c.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),c&&this.onvseeking&&this.onvended&&(c.removeEventListener("seeking",this.onvseeking),c.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},h.onMediaSeeking=function(){var c=this.config,M=this.fragCurrent,F=this.media,w=this.mediaBuffer,U=this.state,N=F?F.currentTime:0,z=C.BufferHelper.bufferInfo(w||F,N,c.maxBufferHole);if(this.log("media seeking to "+((0,P.isFiniteNumber)(N)?N.toFixed(3):N)+", state: "+U),this.state===o.ENDED)this.resetLoadingState();else if(M){var V=c.maxFragLookUpTolerance,j=M.start-V,Y=M.start+M.duration+V;if(!z.len||Y<z.start||j>z.end){var X=N>Y;(N<j||X)&&(X&&M.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),M.abortRequests()),this.resetLoadingState())}}F&&(this.lastCurrentTime=N),!this.loadedmetadata&&!z.len&&(this.nextLoadPosition=this.startPosition=N),this.tickImmediate()},h.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},h.onLevelSwitching=function(c,M){this.fragLoadError=0},h.onHandlerDestroying=function(){this.stopLoad(),f.prototype.onHandlerDestroying.call(this)},h.onHandlerDestroyed=function(){this.state=o.STOPPED,this.hls.off(I.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,f.prototype.onHandlerDestroyed.call(this)},h.loadFragment=function(c,M,F){this._loadFragForPlayback(c,M,F)},h._loadFragForPlayback=function(c,M,F){var w=this,U=function(z){if(w.fragContextChanged(c)){w.warn("Fragment "+c.sn+(z.part?" p: "+z.part.index:"")+" of level "+c.level+" was dropped during download."),w.fragmentTracker.removeFragment(c);return}c.stats.chunkCount++,w._handleFragmentLoadProgress(z)};this._doFragLoad(c,M,F,U).then(function(N){if(!!N){w.fragLoadError=0;var z=w.state;if(w.fragContextChanged(c)){(z===o.FRAG_LOADING||!w.fragCurrent&&z===o.PARSING)&&(w.fragmentTracker.removeFragment(c),w.state=o.IDLE);return}"payload"in N&&(w.log("Loaded fragment "+c.sn+" of level "+c.level),w.hls.trigger(I.Events.FRAG_LOADED,N)),w._handleFragmentLoadComplete(N)}}).catch(function(N){w.state===o.STOPPED||w.state===o.ERROR||(w.warn(N),w.resetFragmentLoading(c))})},h.flushMainBuffer=function(c,M,F){if(F===void 0&&(F=null),!!(c-M)){var w={startOffset:c,endOffset:M,type:F};this.fragLoadError=0,this.hls.trigger(I.Events.BUFFER_FLUSHING,w)}},h._loadInitSegment=function(c,M){var F=this;this._doFragLoad(c,M).then(function(w){if(!w||F.fragContextChanged(c)||!F.levels)throw new Error("init load aborted");return w}).then(function(w){var U=F.hls,N=w.payload,z=c.decryptdata;if(N&&N.byteLength>0&&z&&z.key&&z.iv&&z.method==="AES-128"){var V=self.performance.now();return F.decrypter.decrypt(new Uint8Array(N),z.key.buffer,z.iv.buffer).then(function(j){var Y=self.performance.now();return U.trigger(I.Events.FRAG_DECRYPTED,{frag:c,payload:j,stats:{tstart:V,tdecrypt:Y}}),w.payload=j,w})}return w}).then(function(w){var U=F.fragCurrent,N=F.hls,z=F.levels;if(!z)throw new Error("init load aborted, missing levels");var V=z[c.level].details;console.assert(V,"Level details are defined when init segment is loaded");var j=c.stats;F.state=o.IDLE,F.fragLoadError=0,c.data=new Uint8Array(w.payload),j.parsing.start=j.buffering.start=self.performance.now(),j.parsing.end=j.buffering.end=self.performance.now(),w.frag===U&&N.trigger(I.Events.FRAG_BUFFERED,{stats:j,frag:U,part:null,id:c.type}),F.tick()}).catch(function(w){F.state===o.STOPPED||F.state===o.ERROR||(F.warn(w),F.resetFragmentLoading(c))})},h.fragContextChanged=function(c){var M=this.fragCurrent;return!c||!M||c.level!==M.level||c.sn!==M.sn||c.urlId!==M.urlId},h.fragBufferedComplete=function(c,M){var F,w,U=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+c.type+" sn: "+c.sn+(M?" part: "+M.index:"")+" of "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+c.level+" (frag:["+(c.startPTS||NaN).toFixed(3)+"-"+(c.endPTS||NaN).toFixed(3)+"] > buffer:"+(U?u.default.toString(C.BufferHelper.getBuffered(U)):"(detached)")+")"),this.state=o.IDLE,U&&(!this.loadedmetadata&&c.type==a.PlaylistLevelType.MAIN&&U.buffered.length&&((F=this.fragCurrent)===null||F===void 0?void 0:F.sn)===((w=this.fragPrevious)===null||w===void 0?void 0:w.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())},h.seekToStartPos=function(){},h._handleFragmentLoadComplete=function(c){var M=this.transmuxer;if(!!M){var F=c.frag,w=c.part,U=c.partsLoaded,N=!U||U.length===0||U.some(function(V){return!V}),z=new b.ChunkMetadata(F.level,F.sn,F.stats.chunkCount+1,0,w?w.index:-1,!N);M.flush(z)}},h._handleFragmentLoadProgress=function(c){},h._doFragLoad=function(c,M,F,w){var U,N=this;if(F===void 0&&(F=null),!this.levels)throw new Error("frag load aborted, missing levels");var z=null;if(c.encrypted&&!((U=c.decryptdata)!==null&&U!==void 0&&U.key)?(this.log("Loading key for "+c.sn+" of ["+M.startSN+"-"+M.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+c.level),this.state=o.KEY_LOADING,this.fragCurrent=c,z=this.keyLoader.load(c).then(function(Q){if(!N.fragContextChanged(Q.frag))return N.hls.trigger(I.Events.KEY_LOADED,Q),N.state===o.KEY_LOADING&&(N.state=o.IDLE),Q}),this.hls.trigger(I.Events.KEY_LOADING,{frag:c}),this.throwIfFragContextChanged("KEY_LOADING")):!c.encrypted&&M.encryptedFragments.length&&this.keyLoader.loadClear(c,M.encryptedFragments),F=Math.max(c.start,F||0),this.config.lowLatencyMode&&M){var V=M.partList;if(V&&w){F>c.end&&M.fragmentHint&&(c=M.fragmentHint);var j=this.getNextPart(V,c,F);if(j>-1){var Y=V[j];return this.log("Loading part sn: "+c.sn+" p: "+Y.index+" cc: "+c.cc+" of playlist ["+M.startSN+"-"+M.endSN+"] parts [0-"+j+"-"+(V.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+c.level+", target: "+parseFloat(F.toFixed(3))),this.nextLoadPosition=Y.start+Y.duration,this.state=o.FRAG_LOADING,this.hls.trigger(I.Events.FRAG_LOADING,{frag:c,part:V[j],targetBufferTime:F}),this.throwIfFragContextChanged("FRAG_LOADING parts"),z?z.then(function(Q){return!Q||N.fragContextChanged(Q.frag)?null:N.doFragPartsLoad(c,V,j,w)}).catch(function(Q){return N.handleFragLoadError(Q)}):this.doFragPartsLoad(c,V,j,w).catch(function(Q){return N.handleFragLoadError(Q)})}else if(!c.url||this.loadedEndOfParts(V,F))return Promise.resolve(null)}}this.log("Loading fragment "+c.sn+" cc: "+c.cc+" "+(M?"of ["+M.startSN+"-"+M.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+c.level+", target: "+parseFloat(F.toFixed(3))),(0,P.isFiniteNumber)(c.sn)&&!this.bitrateTest&&(this.nextLoadPosition=c.start+c.duration),this.state=o.FRAG_LOADING,this.hls.trigger(I.Events.FRAG_LOADING,{frag:c,targetBufferTime:F}),this.throwIfFragContextChanged("FRAG_LOADING");var X=this.config.progressive;return X&&z?z.then(function(Q){return!Q||N.fragContextChanged(Q==null?void 0:Q.frag)?null:N.fragmentLoader.load(c,w)}).catch(function(Q){return N.handleFragLoadError(Q)}):Promise.all([this.fragmentLoader.load(c,X?w:void 0),z]).then(function(Q){var te=Q[0];return!X&&te&&w&&w(te),te}).catch(function(Q){return N.handleFragLoadError(Q)})},h.throwIfFragContextChanged=function(c){if(this.fragCurrent===null)throw new Error("frag load aborted, context changed in "+c)},h.doFragPartsLoad=function(c,M,F,w){var U=this;return new Promise(function(N,z){var V=[],j=function Y(X){var Q=M[X];U.fragmentLoader.loadPart(c,Q,w).then(function(te){V[Q.index]=te;var $=te.part;U.hls.trigger(I.Events.FRAG_LOADED,te);var ee=M[X+1];if(ee&&ee.fragment===c)Y(X+1);else return N({frag:c,part:$,partsLoaded:V})}).catch(z)};j(F)})},h.handleFragLoadError=function(c){if("data"in c){var M=c.data;c.data&&M.details===A.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(M.frag,M.part):this.hls.trigger(I.Events.ERROR,M)}else this.hls.trigger(I.Events.ERROR,{type:A.ErrorTypes.OTHER_ERROR,details:A.ErrorDetails.INTERNAL_EXCEPTION,err:c,fatal:!0});return null},h._handleTransmuxerFlush=function(c){var M=this.getCurrentContext(c);if(!M||this.state!==o.PARSING){!this.fragCurrent&&this.state!==o.STOPPED&&this.state!==o.ERROR&&(this.state=o.IDLE);return}var F=M.frag,w=M.part,U=M.level,N=self.performance.now();F.stats.parsing.end=N,w&&(w.stats.parsing.end=N),this.updateLevelTiming(F,w,U,c.partial)},h.getCurrentContext=function(c){var M=this.levels,F=c.level,w=c.sn,U=c.part;if(!M||!M[F])return this.warn("Levels object was unset while buffering fragment "+w+" of level "+F+". The current chunk will not be buffered."),null;var N=M[F],z=U>-1?(0,x.getPartWith)(N,w,U):null,V=z?z.fragment:(0,x.getFragmentWithSN)(N,w,this.fragCurrent);return V?{frag:V,part:z,level:N}:null},h.bufferFragmentData=function(c,M,F,w){if(!(!c||this.state!==o.PARSING)){var U=c.data1,N=c.data2,z=U;if(U&&N&&(z=(0,_.appendUint8Array)(U,N)),!(!z||!z.length)){var V={type:c.type,frag:M,part:F,chunkMeta:w,parent:M.type,data:z};this.hls.trigger(I.Events.BUFFER_APPENDING,V),c.dropped&&c.independent&&!F&&this.flushBufferGap(M)}}},h.flushBufferGap=function(c){var M=this.media;if(!!M){if(!C.BufferHelper.isBuffered(M,M.currentTime)){this.flushMainBuffer(0,c.start);return}var F=M.currentTime,w=C.BufferHelper.bufferInfo(M,F,0),U=c.duration,N=Math.min(this.config.maxFragLookUpTolerance*2,U*.25),z=Math.max(Math.min(c.start-N,w.end-N),F+N);c.start-z>N&&this.flushMainBuffer(z,c.start)}},h.getFwdBufferInfo=function(c,M){var F=this.config,w=this.getLoadPosition();if(!(0,P.isFiniteNumber)(w))return null;var U=C.BufferHelper.bufferInfo(c,w,F.maxBufferHole);if(U.len===0&&U.nextStart!==void 0){var N=this.fragmentTracker.getBufferedFrag(w,M);if(N&&U.nextStart<N.end)return C.BufferHelper.bufferInfo(c,w,Math.max(U.nextStart,F.maxBufferHole))}return U},h.getMaxBufferLength=function(c){var M=this.config,F;return c?F=Math.max(8*M.maxBufferSize/c,M.maxBufferLength):F=M.maxBufferLength,Math.min(F,M.maxMaxBufferLength)},h.reduceMaxBufferLength=function(c){var M=this.config,F=c||M.maxBufferLength;return M.maxMaxBufferLength>=F?(M.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+M.maxMaxBufferLength+"s"),!0):!1},h.getNextFragment=function(c,M){var F=M.fragments,w=F.length;if(!w)return null;var U=this.config,N=F[0].start,z;if(M.live){var V=U.initialLiveManifestSize;if(w<V)return this.warn("Not enough fragments to start playback (have: "+w+", need: "+V+")"),null;!M.PTSKnown&&!this.startFragRequested&&this.startPosition===-1&&(z=this.getInitialLiveFragment(M,F),this.startPosition=z?this.hls.liveSyncPosition||z.start:c)}else c<=N&&(z=F[0]);if(!z){var j=U.lowLatencyMode?M.partEnd:M.fragmentEnd;z=this.getFragmentAtPosition(c,j,M)}return this.mapToInitFragWhenRequired(z)},h.mapToInitFragWhenRequired=function(c){return c!=null&&c.initSegment&&!(c!=null&&c.initSegment.data)&&!this.bitrateTest?c.initSegment:c},h.getNextPart=function(c,M,F){for(var w=-1,U=!1,N=!0,z=0,V=c.length;z<V;z++){var j=c[z];if(N=N&&!j.independent,w>-1&&F<j.start)break;var Y=j.loaded;Y?w=-1:(U||j.independent||N)&&j.fragment===M&&(w=z),U=Y}return w},h.loadedEndOfParts=function(c,M){var F=c[c.length-1];return F&&M>F.start&&F.loaded},h.getInitialLiveFragment=function(c,M){var F=this.fragPrevious,w=null;if(F){if(c.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+F.programDateTime),w=(0,g.findFragmentByPDT)(M,F.endProgramDateTime,this.config.maxFragLookUpTolerance)),!w){var U=F.sn+1;if(U>=c.startSN&&U<=c.endSN){var N=M[U-c.startSN];F.cc===N.cc&&(w=N,this.log("Live playlist, switching playlist, load frag with next SN: "+w.sn))}w||(w=(0,g.findFragWithCC)(M,F.cc),w&&this.log("Live playlist, switching playlist, load frag with same CC: "+w.sn))}}else{var z=this.hls.liveSyncPosition;z!==null&&(w=this.getFragmentAtPosition(z,this.bitrateTest?c.fragmentEnd:c.edge,c))}return w},h.getFragmentAtPosition=function(c,M,F){var w=this.config,U=this.fragPrevious,N=F.fragments,z=F.endSN,V=F.fragmentHint,j=w.maxFragLookUpTolerance,Y=!!(w.lowLatencyMode&&F.partList&&V);Y&&V&&!this.bitrateTest&&(N=N.concat(V),z=V.sn);var X;if(c<M){var Q=c>M-j?0:j;X=(0,g.findFragmentByPTS)(U,N,c,Q)}else X=N[N.length-1];if(X){var te=X.sn-F.startSN;if(this.fragmentTracker.getState(X)===k.FragmentState.OK&&(U=X),U&&X.sn===U.sn&&!Y){var $=U&&X.level===U.level;if($){var ee=N[te+1];X.sn<z&&this.fragmentTracker.getState(ee)!==k.FragmentState.OK?(this.log("SN "+X.sn+" just loaded, load next one: "+ee.sn),X=ee):X=null}}}return X},h.synchronizeToLiveEdge=function(c){var M=this.config,F=this.media;if(!!F){var w=this.hls.liveSyncPosition,U=F.currentTime,N=c.fragments[0].start,z=c.edge,V=U>=N-M.maxFragLookUpTolerance&&U<=z;if(w!==null&&F.duration>w&&(U<w||!V)){var j=M.liveMaxLatencyDuration!==void 0?M.liveMaxLatencyDuration:M.liveMaxLatencyDurationCount*c.targetduration;(!V&&F.readyState<4||U<z-j)&&(this.loadedmetadata||(this.nextLoadPosition=w),F.readyState&&(this.warn("Playback: "+U.toFixed(3)+" is located too far from the end of live sliding playlist: "+z+", reset currentTime to : "+w.toFixed(3)),F.currentTime=w))}}},h.alignPlaylists=function(c,M){var F=this.levels,w=this.levelLastLoaded,U=this.fragPrevious,N=w!==null?F[w]:null,z=c.fragments.length;if(!z)return this.warn("No fragments in live playlist"),0;var V=c.fragments[0].start,j=!M,Y=c.alignedSliding&&(0,P.isFiniteNumber)(V);if(j||!Y&&!V){(0,S.alignStream)(U,N,c);var X=c.fragments[0].start;return this.log("Live playlist sliding: "+X.toFixed(2)+" start-sn: "+(M?M.startSN:"na")+"->"+c.startSN+" prev-sn: "+(U?U.sn:"na")+" fragments: "+z),X}return V},h.waitForCdnTuneIn=function(c){var M=3;return c.live&&c.canBlockReload&&c.partTarget&&c.tuneInGoal>Math.max(c.partHoldBack,c.partTarget*M)},h.setStartPosition=function(c,M){var F=this.startPosition;if(F<M&&(F=-1),F===-1||this.lastCurrentTime===-1){var w=c.startTimeOffset;(0,P.isFiniteNumber)(w)?(F=M+w,w<0&&(F+=c.totalduration),F=Math.min(Math.max(M,F),M+c.totalduration),this.log("Start time offset "+w+" found in playlist, adjust startPosition to "+F),this.startPosition=F):c.live?F=this.hls.liveSyncPosition||M:this.startPosition=F=0,this.lastCurrentTime=F}this.nextLoadPosition=F},h.getLoadPosition=function(){var c=this.media,M=0;return this.loadedmetadata&&c?M=c.currentTime:this.nextLoadPosition&&(M=this.nextLoadPosition),M},h.handleFragLoadAborted=function(c,M){this.transmuxer&&c.sn!=="initSegment"&&c.stats.aborted&&(this.warn("Fragment "+c.sn+(M?" part"+M.index:"")+" of level "+c.level+" was aborted"),this.resetFragmentLoading(c))},h.resetFragmentLoading=function(c){(!this.fragCurrent||!this.fragContextChanged(c)&&this.state!==o.FRAG_LOADING_WAITING_RETRY)&&(this.state=o.IDLE)},h.onFragmentOrKeyLoadError=function(c,M){if(M.fatal){this.stopLoad(),this.state=o.ERROR;return}var F=this.config;if(M.chunkMeta){var w=this.getCurrentContext(M.chunkMeta);w&&(M.frag=w.frag,M.levelRetry=!0,this.fragLoadError=F.fragLoadingMaxRetry)}var U=M.frag;if(!(!U||U.type!==c)){var N=this.fragCurrent;if(console.assert(N&&U.sn===N.sn&&U.level===N.level&&U.urlId===N.urlId,"Frag load error must match current frag to retry"),this.fragLoadError+1<=F.fragLoadingMaxRetry){this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition);var z=Math.min(Math.pow(2,this.fragLoadError)*F.fragLoadingRetryDelay,F.fragLoadingMaxRetryTimeout);this.warn("Fragment "+U.sn+" of "+c+" "+U.level+" failed to load, retrying in "+z+"ms"),this.retryDate=self.performance.now()+z,this.fragLoadError++,this.state=o.FRAG_LOADING_WAITING_RETRY}else M.levelRetry?(c===a.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=o.IDLE):(B.logger.error(M.details+" reaches max retry, redispatch as fatal ..."),M.fatal=!0,this.hls.stopLoad(),this.state=o.ERROR)}},h.afterBufferFlushed=function(c,M,F){if(!!c){var w=C.BufferHelper.getBuffered(c);this.fragmentTracker.detectEvictedFragments(M,w,F),this.state===o.ENDED&&this.resetLoadingState()}},h.resetLoadingState=function(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=o.IDLE},h.resetStartWhenNotLoaded=function(c){if(!this.loadedmetadata){this.startFragRequested=!1;var M=this.levels?this.levels[c].details:null;M!=null&&M.live?(this.startPosition=-1,this.setStartPosition(M,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}},h.updateLevelTiming=function(c,M,F,w){var U=this,N=F.details;console.assert(!!N,"level.details must be defined");var z=Object.keys(c.elementaryStreams).reduce(function(V,j){var Y=c.elementaryStreams[j];if(Y){var X=Y.endPTS-Y.startPTS;if(X<=0)return U.warn("Could not parse fragment "+c.sn+" "+j+" duration reliably ("+X+")"),V||!1;var Q=w?0:(0,x.updateFragPTSDTS)(N,c,Y.startPTS,Y.endPTS,Y.startDTS,Y.endDTS);return U.hls.trigger(I.Events.LEVEL_PTS_UPDATED,{details:N,level:F,drift:Q,type:j,frag:c,start:Y.startPTS,end:Y.endPTS}),!0}return V},!1);z||(this.warn("Found no media in fragment "+c.sn+" of level "+F.id+" resetting transmuxer to fallback to playlist timing"),this.resetTransmuxer()),this.state=o.PARSED,this.hls.trigger(I.Events.FRAG_PARSED,{frag:c,part:M})},h.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},m(e,[{key:"state",get:function(){return this._state},set:function(c){var M=this._state;M!==c&&(this._state=c,this.log(M+"->"+c))}}]),e}(T.default)},"./src/controller/buffer-controller.ts":(W,O,p)=>{p.r(O),p.d(O,{default:()=>g});var P=p("./src/polyfills/number.ts"),T=p("./src/events.ts"),k=p("./src/utils/logger.ts"),C=p("./src/errors.ts"),B=p("./src/utils/buffer-helper.ts"),I=p("./src/utils/mediasource-helper.ts"),A=p("./src/loader/fragment.ts"),b=p("./src/controller/buffer-operation-queue.ts"),_=(0,I.getMediaSource)(),S=/([ha]vc.)(?:\.[^.,]+)+/,g=function(){function x(l){var u=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var a=u.media,s=u.mediaSource;k.logger.log("[buffer-controller]: Media source opened"),a&&(a.removeEventListener("emptied",u._onMediaEmptied),u.updateMediaElementDuration(),u.hls.trigger(T.Events.MEDIA_ATTACHED,{media:a})),s&&s.removeEventListener("sourceopen",u._onMediaSourceOpen),u.checkPendingTracks()},this._onMediaSourceClose=function(){k.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){k.logger.log("[buffer-controller]: Media source ended")},this._onMediaEmptied=function(){var a=u.media,s=u._objectUrl;a&&a.src!==s&&k.logger.error("Media element src was set while attaching MediaSource ("+s+" > "+a.src+")")},this.hls=l,this._initSourceBuffer(),this.registerListeners()}var y=x.prototype;return y.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},y.destroy=function(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null},y.registerListeners=function(){var u=this.hls;u.on(T.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),u.on(T.Events.MEDIA_DETACHING,this.onMediaDetaching,this),u.on(T.Events.MANIFEST_PARSED,this.onManifestParsed,this),u.on(T.Events.BUFFER_RESET,this.onBufferReset,this),u.on(T.Events.BUFFER_APPENDING,this.onBufferAppending,this),u.on(T.Events.BUFFER_CODECS,this.onBufferCodecs,this),u.on(T.Events.BUFFER_EOS,this.onBufferEos,this),u.on(T.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),u.on(T.Events.LEVEL_UPDATED,this.onLevelUpdated,this),u.on(T.Events.FRAG_PARSED,this.onFragParsed,this),u.on(T.Events.FRAG_CHANGED,this.onFragChanged,this)},y.unregisterListeners=function(){var u=this.hls;u.off(T.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),u.off(T.Events.MEDIA_DETACHING,this.onMediaDetaching,this),u.off(T.Events.MANIFEST_PARSED,this.onManifestParsed,this),u.off(T.Events.BUFFER_RESET,this.onBufferReset,this),u.off(T.Events.BUFFER_APPENDING,this.onBufferAppending,this),u.off(T.Events.BUFFER_CODECS,this.onBufferCodecs,this),u.off(T.Events.BUFFER_EOS,this.onBufferEos,this),u.off(T.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),u.off(T.Events.LEVEL_UPDATED,this.onLevelUpdated,this),u.off(T.Events.FRAG_PARSED,this.onFragParsed,this),u.off(T.Events.FRAG_CHANGED,this.onFragChanged,this)},y._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new b.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.lastMpegAudioChunk=null},y.onManifestParsed=function(u,a){var s=2;(a.audio&&!a.video||!a.altAudio)&&(s=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=s,this.details=null,k.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},y.onMediaAttaching=function(u,a){var s=this.media=a.media;if(s&&_){var m=this.mediaSource=new _;m.addEventListener("sourceopen",this._onMediaSourceOpen),m.addEventListener("sourceended",this._onMediaSourceEnded),m.addEventListener("sourceclose",this._onMediaSourceClose),s.src=self.URL.createObjectURL(m),this._objectUrl=s.src,s.addEventListener("emptied",this._onMediaEmptied)}},y.onMediaDetaching=function(){var u=this.media,a=this.mediaSource,s=this._objectUrl;if(a){if(k.logger.log("[buffer-controller]: media source detaching"),a.readyState==="open")try{a.endOfStream()}catch(m){k.logger.warn("[buffer-controller]: onMediaDetaching: "+m.message+" while calling endOfStream")}this.onBufferReset(),a.removeEventListener("sourceopen",this._onMediaSourceOpen),a.removeEventListener("sourceended",this._onMediaSourceEnded),a.removeEventListener("sourceclose",this._onMediaSourceClose),u&&(u.removeEventListener("emptied",this._onMediaEmptied),s&&self.URL.revokeObjectURL(s),u.src===s?(u.removeAttribute("src"),u.load()):k.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(T.Events.MEDIA_DETACHED,void 0)},y.onBufferReset=function(){var u=this;this.getSourceBufferTypes().forEach(function(a){var s=u.sourceBuffer[a];try{s&&(u.removeBufferListeners(a),u.mediaSource&&u.mediaSource.removeSourceBuffer(s),u.sourceBuffer[a]=void 0)}catch(m){k.logger.warn("[buffer-controller]: Failed to reset the "+a+" buffer",m)}}),this._initSourceBuffer()},y.onBufferCodecs=function(u,a){var s=this,m=this.getSourceBufferTypes().length;Object.keys(a).forEach(function(v){if(m){var i=s.tracks[v];if(i&&typeof i.buffer.changeType=="function"){var n=a[v],E=n.id,r=n.codec,o=n.levelCodec,t=n.container,f=n.metadata,e=(i.levelCodec||i.codec).replace(S,"$1"),h=(o||r).replace(S,"$1");if(e!==h){var d=t+";codecs="+(o||r);s.appendChangeType(v,d),k.logger.log("[buffer-controller]: switching codec "+e+" to "+h),s.tracks[v]={buffer:i.buffer,codec:r,container:t,levelCodec:o,metadata:f,id:E}}}}else s.pendingTracks[v]=a[v]}),!m&&(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},y.appendChangeType=function(u,a){var s=this,m=this.operationQueue,v={execute:function(){var n=s.sourceBuffer[u];n&&(k.logger.log("[buffer-controller]: changing "+u+" sourceBuffer type to "+a),n.changeType(a)),m.shiftAndExecuteNext(u)},onStart:function(){},onComplete:function(){},onError:function(n){k.logger.warn("[buffer-controller]: Failed to change "+u+" SourceBuffer type",n)}};m.append(v,u)},y.onBufferAppending=function(u,a){var s=this,m=this.hls,v=this.operationQueue,i=this.tracks,n=a.data,E=a.type,r=a.frag,o=a.part,t=a.chunkMeta,f=t.buffering[E],e=self.performance.now();f.start=e;var h=r.stats.buffering,d=o?o.stats.buffering:null;h.start===0&&(h.start=e),d&&d.start===0&&(d.start=e);var c=i.audio,M=!1;E==="audio"&&(c==null?void 0:c.container)==="audio/mpeg"&&(M=!this.lastMpegAudioChunk||t.id===1||this.lastMpegAudioChunk.sn!==t.sn,this.lastMpegAudioChunk=t);var F=r.start,w={execute:function(){if(f.executeStart=self.performance.now(),M){var N=s.sourceBuffer[E];if(N){var z=F-N.timestampOffset;Math.abs(z)>=.1&&(k.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+F+" (delta: "+z+") sn: "+r.sn+")"),N.timestampOffset=F)}}s.appendExecutor(n,E)},onStart:function(){},onComplete:function(){var N=self.performance.now();f.executeEnd=f.end=N,h.first===0&&(h.first=N),d&&d.first===0&&(d.first=N);var z=s.sourceBuffer,V={};for(var j in z)V[j]=B.BufferHelper.getBuffered(z[j]);s.appendError=0,s.hls.trigger(T.Events.BUFFER_APPENDED,{type:E,frag:r,part:o,chunkMeta:t,parent:r.type,timeRanges:V})},onError:function(N){k.logger.error("[buffer-controller]: Error encountered while trying to append to the "+E+" SourceBuffer",N);var z={type:C.ErrorTypes.MEDIA_ERROR,parent:r.type,details:C.ErrorDetails.BUFFER_APPEND_ERROR,err:N,fatal:!1};N.code===DOMException.QUOTA_EXCEEDED_ERR?z.details=C.ErrorDetails.BUFFER_FULL_ERROR:(s.appendError++,z.details=C.ErrorDetails.BUFFER_APPEND_ERROR,s.appendError>m.config.appendErrorMaxRetry&&(k.logger.error("[buffer-controller]: Failed "+m.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),z.fatal=!0,m.stopLoad())),m.trigger(T.Events.ERROR,z)}};v.append(w,E)},y.onBufferFlushing=function(u,a){var s=this,m=this.operationQueue,v=function(n){return{execute:s.removeExecutor.bind(s,n,a.startOffset,a.endOffset),onStart:function(){},onComplete:function(){s.hls.trigger(T.Events.BUFFER_FLUSHED,{type:n})},onError:function(r){k.logger.warn("[buffer-controller]: Failed to remove from "+n+" SourceBuffer",r)}}};a.type?m.append(v(a.type),a.type):this.getSourceBufferTypes().forEach(function(i){m.append(v(i),i)})},y.onFragParsed=function(u,a){var s=this,m=a.frag,v=a.part,i=[],n=v?v.elementaryStreams:m.elementaryStreams;n[A.ElementaryStreamTypes.AUDIOVIDEO]?i.push("audiovideo"):(n[A.ElementaryStreamTypes.AUDIO]&&i.push("audio"),n[A.ElementaryStreamTypes.VIDEO]&&i.push("video"));var E=function(){var o=self.performance.now();m.stats.buffering.end=o,v&&(v.stats.buffering.end=o);var t=v?v.stats:m.stats;s.hls.trigger(T.Events.FRAG_BUFFERED,{frag:m,part:v,stats:t,id:m.type})};i.length===0&&k.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+m.type+" level: "+m.level+" sn: "+m.sn),this.blockBuffers(E,i)},y.onFragChanged=function(u,a){this.flushBackBuffer()},y.onBufferEos=function(u,a){var s=this,m=this.getSourceBufferTypes().reduce(function(v,i){var n=s.sourceBuffer[i];return n&&(!a.type||a.type===i)&&(n.ending=!0,n.ended||(n.ended=!0,k.logger.log("[buffer-controller]: "+i+" sourceBuffer now EOS"))),v&&!!(!n||n.ended)},!0);m&&(k.logger.log("[buffer-controller]: Queueing mediaSource.endOfStream()"),this.blockBuffers(function(){s.getSourceBufferTypes().forEach(function(i){var n=s.sourceBuffer[i];n&&(n.ending=!1)});var v=s.mediaSource;if(!v||v.readyState!=="open"){v&&k.logger.info("[buffer-controller]: Could not call mediaSource.endOfStream(). mediaSource.readyState: "+v.readyState);return}k.logger.log("[buffer-controller]: Calling mediaSource.endOfStream()"),v.endOfStream()}))},y.onLevelUpdated=function(u,a){var s=a.details;!s.fragments.length||(this.details=s,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},y.flushBackBuffer=function(){var u=this.hls,a=this.details,s=this.media,m=this.sourceBuffer;if(!(!s||a===null)){var v=this.getSourceBufferTypes();if(!!v.length){var i=a.live&&u.config.liveBackBufferLength!==null?u.config.liveBackBufferLength:u.config.backBufferLength;if(!(!(0,P.isFiniteNumber)(i)||i<0)){var n=s.currentTime,E=a.levelTargetDuration,r=Math.max(i,E),o=Math.floor(n/E)*E-r;v.forEach(function(t){var f=m[t];if(f){var e=B.BufferHelper.getBuffered(f);if(e.length>0&&o>e.start(0)){if(u.trigger(T.Events.BACK_BUFFER_REACHED,{bufferEnd:o}),a.live)u.trigger(T.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:o});else if(f.ended&&e.end(e.length-1)-n<E*2){k.logger.info("[buffer-controller]: Cannot flush "+t+" back buffer while SourceBuffer is in ended state");return}u.trigger(T.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:o,type:t})}}})}}}},y.updateMediaElementDuration=function(){if(!(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")){var u=this.details,a=this.hls,s=this.media,m=this.mediaSource,v=u.fragments[0].start+u.totalduration,i=s.duration,n=(0,P.isFiniteNumber)(m.duration)?m.duration:0;u.live&&a.config.liveDurationInfinity?(k.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),m.duration=1/0,this.updateSeekableRange(u)):(v>n&&v>i||!(0,P.isFiniteNumber)(i))&&(k.logger.log("[buffer-controller]: Updating Media Source duration to "+v.toFixed(3)),m.duration=v)}},y.updateSeekableRange=function(u){var a=this.mediaSource,s=u.fragments,m=s.length;if(m&&u.live&&a!==null&&a!==void 0&&a.setLiveSeekableRange){var v=Math.max(0,s[0].start),i=Math.max(v,v+u.totalduration);a.setLiveSeekableRange(v,i)}},y.checkPendingTracks=function(){var u=this.bufferCodecEventsExpected,a=this.operationQueue,s=this.pendingTracks,m=Object.keys(s).length;if(m&&!u||m===2){this.createSourceBuffers(s),this.pendingTracks={};var v=this.getSourceBufferTypes();if(v.length===0){this.hls.trigger(T.Events.ERROR,{type:C.ErrorTypes.MEDIA_ERROR,details:C.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});return}v.forEach(function(i){a.executeNext(i)})}},y.createSourceBuffers=function(u){var a=this.sourceBuffer,s=this.mediaSource;if(!s)throw Error("createSourceBuffers called when mediaSource was null");var m=0;for(var v in u)if(!a[v]){var i=u[v];if(!i)throw Error("source buffer exists for track "+v+", however track does not");var n=i.levelCodec||i.codec,E=i.container+";codecs="+n;k.logger.log("[buffer-controller]: creating sourceBuffer("+E+")");try{var r=a[v]=s.addSourceBuffer(E),o=v;this.addBufferListener(o,"updatestart",this._onSBUpdateStart),this.addBufferListener(o,"updateend",this._onSBUpdateEnd),this.addBufferListener(o,"error",this._onSBUpdateError),this.tracks[v]={buffer:r,codec:n,container:i.container,levelCodec:i.levelCodec,metadata:i.metadata,id:i.id},m++}catch(t){k.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+t.message),this.hls.trigger(T.Events.ERROR,{type:C.ErrorTypes.MEDIA_ERROR,details:C.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:t,mimeType:E})}}m&&this.hls.trigger(T.Events.BUFFER_CREATED,{tracks:this.tracks})},y._onSBUpdateStart=function(u){var a=this.operationQueue,s=a.current(u);s.onStart()},y._onSBUpdateEnd=function(u){var a=this.operationQueue,s=a.current(u);s.onComplete(),a.shiftAndExecuteNext(u)},y._onSBUpdateError=function(u,a){k.logger.error("[buffer-controller]: "+u+" SourceBuffer error",a),this.hls.trigger(T.Events.ERROR,{type:C.ErrorTypes.MEDIA_ERROR,details:C.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var s=this.operationQueue.current(u);s&&s.onError(a)},y.removeExecutor=function(u,a,s){var m=this.media,v=this.mediaSource,i=this.operationQueue,n=this.sourceBuffer,E=n[u];if(!m||!v||!E){k.logger.warn("[buffer-controller]: Attempting to remove from the "+u+" SourceBuffer, but it does not exist"),i.shiftAndExecuteNext(u);return}var r=(0,P.isFiniteNumber)(m.duration)?m.duration:1/0,o=(0,P.isFiniteNumber)(v.duration)?v.duration:1/0,t=Math.max(0,a),f=Math.min(s,r,o);f>t&&!E.ending?(E.ended=!1,k.logger.log("[buffer-controller]: Removing ["+t+","+f+"] from the "+u+" SourceBuffer"),console.assert(!E.updating,u+" sourceBuffer must not be updating"),E.remove(t,f)):i.shiftAndExecuteNext(u)},y.appendExecutor=function(u,a){var s=this.operationQueue,m=this.sourceBuffer,v=m[a];if(!v){k.logger.warn("[buffer-controller]: Attempting to append to the "+a+" SourceBuffer, but it does not exist"),s.shiftAndExecuteNext(a);return}v.ended=!1,console.assert(!v.updating,a+" sourceBuffer must not be updating"),v.appendBuffer(u)},y.blockBuffers=function(u,a){var s=this;if(a===void 0&&(a=this.getSourceBufferTypes()),!a.length){k.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(u);return}var m=this.operationQueue,v=a.map(function(i){return m.appendBlocker(i)});Promise.all(v).then(function(){u(),a.forEach(function(i){var n=s.sourceBuffer[i];(!n||!n.updating)&&m.shiftAndExecuteNext(i)})})},y.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},y.addBufferListener=function(u,a,s){var m=this.sourceBuffer[u];if(!!m){var v=s.bind(this,u);this.listeners[u].push({event:a,listener:v}),m.addEventListener(a,v)}},y.removeBufferListeners=function(u){var a=this.sourceBuffer[u];!a||this.listeners[u].forEach(function(s){a.removeEventListener(s.event,s.listener)})},x}()},"./src/controller/buffer-operation-queue.ts":(W,O,p)=>{p.r(O),p.d(O,{default:()=>T});var P=p("./src/utils/logger.ts"),T=function(){function k(B){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=B}var C=k.prototype;return C.append=function(I,A){var b=this.queues[A];b.push(I),b.length===1&&this.buffers[A]&&this.executeNext(A)},C.insertAbort=function(I,A){var b=this.queues[A];b.unshift(I),this.executeNext(A)},C.appendBlocker=function(I){var A,b=new Promise(function(S){A=S}),_={execute:A,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(_,I),b},C.executeNext=function(I){var A=this.buffers,b=this.queues,_=A[I],S=b[I];if(S.length){var g=S[0];try{g.execute()}catch(x){P.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),g.onError(x),(!_||!_.updating)&&(S.shift(),this.executeNext(I))}}},C.shiftAndExecuteNext=function(I){this.queues[I].shift(),this.executeNext(I)},C.current=function(I){return this.queues[I][0]},k}()},"./src/controller/cap-level-controller.ts":(W,O,p)=>{p.r(O),p.d(O,{default:()=>A});var P=p("./src/events.ts");function T(b,_){for(var S=0;S<_.length;S++){var g=_[S];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(b,C(g.key),g)}}function k(b,_,S){return _&&T(b.prototype,_),S&&T(b,S),Object.defineProperty(b,"prototype",{writable:!1}),b}function C(b){var _=B(b,"string");return typeof _=="symbol"?_:String(_)}function B(b,_){if(typeof b!="object"||b===null)return b;var S=b[Symbol.toPrimitive];if(S!==void 0){var g=S.call(b,_||"default");if(typeof g!="object")return g;throw new TypeError("@@toPrimitive must return a primitive value.")}return(_==="string"?String:Number)(b)}var I=function(){function b(S){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=S,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var _=b.prototype;return _.setStreamController=function(g){this.streamController=g},_.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},_.registerListeners=function(){var g=this.hls;g.on(P.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),g.on(P.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),g.on(P.Events.MANIFEST_PARSED,this.onManifestParsed,this),g.on(P.Events.BUFFER_CODECS,this.onBufferCodecs,this),g.on(P.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},_.unregisterListener=function(){var g=this.hls;g.off(P.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),g.off(P.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),g.off(P.Events.MANIFEST_PARSED,this.onManifestParsed,this),g.off(P.Events.BUFFER_CODECS,this.onBufferCodecs,this),g.off(P.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},_.onFpsDropLevelCapping=function(g,x){b.isLevelAllowed(x.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(x.droppedLevel)},_.onMediaAttaching=function(g,x){this.media=x.media instanceof HTMLVideoElement?x.media:null,this.clientRect=null},_.onManifestParsed=function(g,x){var y=this.hls;this.restrictedLevels=[],this.firstLevel=x.firstLevel,y.config.capLevelToPlayerSize&&x.video&&this.startCapping()},_.onBufferCodecs=function(g,x){var y=this.hls;y.config.capLevelToPlayerSize&&x.video&&this.startCapping()},_.onMediaDetaching=function(){this.stopCapping()},_.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var g=this.hls.levels;if(g.length){var x=this.hls;x.autoLevelCapping=this.getMaxLevel(g.length-1),x.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=x.autoLevelCapping}}},_.getMaxLevel=function(g){var x=this,y=this.hls.levels;if(!y.length)return-1;var l=y.filter(function(u,a){return b.isLevelAllowed(a,x.restrictedLevels)&&a<=g});return this.clientRect=null,b.getMaxLevelByMediaSize(l,this.mediaWidth,this.mediaHeight)},_.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},_.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},_.getDimensions=function(){if(this.clientRect)return this.clientRect;var g=this.media,x={width:0,height:0};if(g){var y=g.getBoundingClientRect();x.width=y.width,x.height=y.height,!x.width&&!x.height&&(x.width=y.right-y.left||g.width||0,x.height=y.bottom-y.top||g.height||0)}return this.clientRect=x,x},b.isLevelAllowed=function(g,x){return x===void 0&&(x=[]),x.indexOf(g)===-1},b.getMaxLevelByMediaSize=function(g,x,y){if(!g||!g.length)return-1;for(var l=function(v,i){return i?v.width!==i.width||v.height!==i.height:!0},u=g.length-1,a=0;a<g.length;a+=1){var s=g[a];if((s.width>=x||s.height>=y)&&l(s,g[a+1])){u=a;break}}return u},k(b,[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var g=1;if(!this.hls.config.ignoreDevicePixelRatio)try{g=self.devicePixelRatio}catch{}return g}}]),b}();const A=I},"./src/controller/cmcd-controller.ts":(W,O,p)=>{p.r(O),p.d(O,{default:()=>y});var P=p("./src/events.ts"),T=p("./src/types/cmcd.ts"),k=p("./src/utils/buffer-helper.ts"),C=p("./src/utils/logger.ts");function B(l,u){for(var a=0;a<u.length;a++){var s=u[a];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(l,A(s.key),s)}}function I(l,u,a){return u&&B(l.prototype,u),a&&B(l,a),Object.defineProperty(l,"prototype",{writable:!1}),l}function A(l){var u=b(l,"string");return typeof u=="symbol"?u:String(u)}function b(l,u){if(typeof l!="object"||l===null)return l;var a=l[Symbol.toPrimitive];if(a!==void 0){var s=a.call(l,u||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(u==="string"?String:Number)(l)}function _(l,u){var a=typeof Symbol<"u"&&l[Symbol.iterator]||l["@@iterator"];if(a)return(a=a.call(l)).next.bind(a);if(Array.isArray(l)||(a=S(l))||u&&l&&typeof l.length=="number"){a&&(l=a);var s=0;return function(){return s>=l.length?{done:!0}:{done:!1,value:l[s++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function S(l,u){if(!!l){if(typeof l=="string")return g(l,u);var a=Object.prototype.toString.call(l).slice(8,-1);if(a==="Object"&&l.constructor&&(a=l.constructor.name),a==="Map"||a==="Set")return Array.from(l);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return g(l,u)}}function g(l,u){(u==null||u>l.length)&&(u=l.length);for(var a=0,s=new Array(u);a<u;a++)s[a]=l[a];return s}function x(){return x=Object.assign?Object.assign.bind():function(l){for(var u=1;u<arguments.length;u++){var a=arguments[u];for(var s in a)Object.prototype.hasOwnProperty.call(a,s)&&(l[s]=a[s])}return l},x.apply(this,arguments)}var y=function(){function l(a){var s=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){s.initialized&&(s.starved=!0),s.buffering=!0},this.onPlaying=function(){s.initialized||(s.initialized=!0),s.buffering=!1},this.applyPlaylistData=function(i){try{s.apply(i,{ot:T.CMCDObjectType.MANIFEST,su:!s.initialized})}catch(n){C.logger.warn("Could not generate manifest CMCD data.",n)}},this.applyFragmentData=function(i){try{var n=i.frag,E=s.hls.levels[n.level],r=s.getObjectType(n),o={d:n.duration*1e3,ot:r};(r===T.CMCDObjectType.VIDEO||r===T.CMCDObjectType.AUDIO||r==T.CMCDObjectType.MUXED)&&(o.br=E.bitrate/1e3,o.tb=s.getTopBandwidth(r)/1e3,o.bl=s.getBufferLength(r)),s.apply(i,o)}catch(t){C.logger.warn("Could not generate segment CMCD data.",t)}},this.hls=a;var m=this.config=a.config,v=m.cmcd;v!=null&&(m.pLoader=this.createPlaylistLoader(),m.fLoader=this.createFragmentLoader(),this.sid=v.sessionId||l.uuid(),this.cid=v.contentId,this.useHeaders=v.useHeaders===!0,this.registerListeners())}var u=l.prototype;return u.registerListeners=function(){var s=this.hls;s.on(P.Events.MEDIA_ATTACHED,this.onMediaAttached,this),s.on(P.Events.MEDIA_DETACHED,this.onMediaDetached,this),s.on(P.Events.BUFFER_CREATED,this.onBufferCreated,this)},u.unregisterListeners=function(){var s=this.hls;s.off(P.Events.MEDIA_ATTACHED,this.onMediaAttached,this),s.off(P.Events.MEDIA_DETACHED,this.onMediaDetached,this),s.off(P.Events.BUFFER_CREATED,this.onBufferCreated,this),this.onMediaDetached()},u.destroy=function(){this.unregisterListeners(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},u.onMediaAttached=function(s,m){this.media=m.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},u.onMediaDetached=function(){!this.media||(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},u.onBufferCreated=function(s,m){var v,i;this.audioBuffer=(v=m.tracks.audio)===null||v===void 0?void 0:v.buffer,this.videoBuffer=(i=m.tracks.video)===null||i===void 0?void 0:i.buffer},u.createData=function(){var s;return{v:T.CMCDVersion,sf:T.CMCDStreamingFormat.HLS,sid:this.sid,cid:this.cid,pr:(s=this.media)===null||s===void 0?void 0:s.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},u.apply=function(s,m){m===void 0&&(m={}),x(m,this.createData());var v=m.ot===T.CMCDObjectType.INIT||m.ot===T.CMCDObjectType.VIDEO||m.ot===T.CMCDObjectType.MUXED;if(this.starved&&v&&(m.bs=!0,m.su=!0,this.starved=!1),m.su==null&&(m.su=this.buffering),this.useHeaders){var i=l.toHeaders(m);if(!Object.keys(i).length)return;s.headers||(s.headers={}),x(s.headers,i)}else{var n=l.toQuery(m);if(!n)return;s.url=l.appendQueryToUri(s.url,n)}},u.getObjectType=function(s){var m=s.type;if(m==="subtitle")return T.CMCDObjectType.TIMED_TEXT;if(s.sn==="initSegment")return T.CMCDObjectType.INIT;if(m==="audio")return T.CMCDObjectType.AUDIO;if(m==="main")return this.hls.audioTracks.length?T.CMCDObjectType.VIDEO:T.CMCDObjectType.MUXED},u.getTopBandwidth=function(s){var m=0,v,i=this.hls;if(s===T.CMCDObjectType.AUDIO)v=i.audioTracks;else{var n=i.maxAutoLevel,E=n>-1?n+1:i.levels.length;v=i.levels.slice(0,E)}for(var r=_(v),o;!(o=r()).done;){var t=o.value;t.bitrate>m&&(m=t.bitrate)}return m>0?m:NaN},u.getBufferLength=function(s){var m=this.hls.media,v=s===T.CMCDObjectType.AUDIO?this.audioBuffer:this.videoBuffer;if(!v||!m)return NaN;var i=k.BufferHelper.bufferInfo(v,m.currentTime,this.config.maxBufferHole);return i.len*1e3},u.createPlaylistLoader=function(){var s=this.config.pLoader,m=this.applyPlaylistData,v=s||this.config.loader;return function(){function i(E){this.loader=void 0,this.loader=new v(E)}var n=i.prototype;return n.destroy=function(){this.loader.destroy()},n.abort=function(){this.loader.abort()},n.load=function(r,o,t){m(r),this.loader.load(r,o,t)},I(i,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),i}()},u.createFragmentLoader=function(){var s=this.config.fLoader,m=this.applyFragmentData,v=s||this.config.loader;return function(){function i(E){this.loader=void 0,this.loader=new v(E)}var n=i.prototype;return n.destroy=function(){this.loader.destroy()},n.abort=function(){this.loader.abort()},n.load=function(r,o,t){m(r),this.loader.load(r,o,t)},I(i,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),i}()},l.uuid=function(){var s=URL.createObjectURL(new Blob),m=s.toString();return URL.revokeObjectURL(s),m.slice(m.lastIndexOf("/")+1)},l.serialize=function(s){for(var m=[],v=function(w){return!Number.isNaN(w)&&w!=null&&w!==""&&w!==!1},i=function(w){return Math.round(w)},n=function(w){return i(w/100)*100},E=function(w){return encodeURIComponent(w)},r={br:i,d:i,bl:n,dl:n,mtp:n,nor:E,rtp:n,tb:i},o=Object.keys(s||{}).sort(),t=_(o),f;!(f=t()).done;){var e=f.value,h=s[e];if(!!v(h)&&!(e==="v"&&h===1)&&!(e=="pr"&&h===1)){var d=r[e];d&&(h=d(h));var c=typeof h,M=void 0;e==="ot"||e==="sf"||e==="st"?M=e+"="+h:c==="boolean"?M=e:c==="number"?M=e+"="+h:M=e+"="+JSON.stringify(h),m.push(M)}}return m.join(",")},l.toHeaders=function(s){for(var m=Object.keys(s),v={},i=["Object","Request","Session","Status"],n=[{},{},{},{}],E={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},r=0,o=m;r<o.length;r++){var t=o[r],f=E[t]!=null?E[t]:1;n[f][t]=s[t]}for(var e=0;e<n.length;e++){var h=l.serialize(n[e]);h&&(v["CMCD-"+i[e]]=h)}return v},l.toQuery=function(s){return"CMCD="+encodeURIComponent(l.serialize(s))},l.appendQueryToUri=function(s,m){if(!m)return s;var v=s.includes("?")?"&":"?";return""+s+v+m},l}()},"./src/controller/eme-controller.ts":(W,O,p)=>{p.r(O),p.d(O,{default:()=>r});var P=p("./src/events.ts"),T=p("./src/errors.ts"),k=p("./src/utils/logger.ts"),C=p("./src/utils/mediakeys-helper.ts"),B=p("./src/utils/keysystem-util.ts"),I=p("./src/utils/numeric-encoding-utils.ts"),A=p("./src/loader/level-key.ts"),b=p("./src/utils/hex.ts"),_=p("./src/utils/mp4-tools.ts"),S=p("./node_modules/eventemitter3/index.js"),g=p.n(S);function x(o,t){o.prototype=Object.create(t.prototype),o.prototype.constructor=o,s(o,t)}function y(o){var t=typeof Map=="function"?new Map:void 0;return y=function(e){if(e===null||!a(e))return e;if(typeof e!="function")throw new TypeError("Super expression must either be null or a function");if(typeof t<"u"){if(t.has(e))return t.get(e);t.set(e,h)}function h(){return l(e,arguments,m(this).constructor)}return h.prototype=Object.create(e.prototype,{constructor:{value:h,enumerable:!1,writable:!0,configurable:!0}}),s(h,e)},y(o)}function l(o,t,f){return u()?l=Reflect.construct.bind():l=function(h,d,c){var M=[null];M.push.apply(M,d);var F=Function.bind.apply(h,M),w=new F;return c&&s(w,c.prototype),w},l.apply(null,arguments)}function u(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function a(o){return Function.toString.call(o).indexOf("[native code]")!==-1}function s(o,t){return s=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,h){return e.__proto__=h,e},s(o,t)}function m(o){return m=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(f){return f.__proto__||Object.getPrototypeOf(f)},m(o)}var v=3,i="[eme]",n=function(){function o(f){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=o.CDMCleanupPromise?[o.CDMCleanupPromise]:[],this.onMediaEncrypted=this._onMediaEncrypted.bind(this),this.onWaitingForKey=this._onWaitingForKey.bind(this),this.debug=k.logger.debug.bind(k.logger,i),this.log=k.logger.log.bind(k.logger,i),this.warn=k.logger.warn.bind(k.logger,i),this.error=k.logger.error.bind(k.logger,i),this.hls=f,this.config=f.config,this.registerListeners()}var t=o.prototype;return t.destroy=function(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.onMediaEncrypted=this.onWaitingForKey=this.keyIdToKeySessionPromise=null},t.registerListeners=function(){this.hls.on(P.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(P.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(P.Events.MANIFEST_LOADED,this.onManifestLoaded,this)},t.unregisterListeners=function(){this.hls.off(P.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(P.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(P.Events.MANIFEST_LOADED,this.onManifestLoaded,this)},t.getLicenseServerUrl=function(e){var h=this.config,d=h.drmSystems,c=h.widevineLicenseUrl,M=d[e];if(M)return M.licenseUrl;if(e===C.KeySystems.WIDEVINE&&c)return c;throw new Error('no license server URL configured for key-system "'+e+'"')},t.getServerCertificateUrl=function(e){var h=this.config.drmSystems,d=h[e];if(d)return d.serverCertificateUrl;this.log('No Server Certificate in config.drmSystems["'+e+'"]')},t.attemptKeySystemAccess=function(e){var h=this,d=this.hls.levels,c=function(U,N,z){return!!U&&z.indexOf(U)===N},M=d.map(function(w){return w.audioCodec}).filter(c),F=d.map(function(w){return w.videoCodec}).filter(c);return M.length+F.length===0&&F.push("avc1.42e01e"),new Promise(function(w,U){var N=function z(V){var j=V.shift();h.getMediaKeysPromise(j,M,F).then(function(Y){return w({keySystem:j,mediaKeys:Y})}).catch(function(Y){V.length?z(V):Y instanceof E?U(Y):U(new E({type:T.ErrorTypes.KEY_SYSTEM_ERROR,details:T.ErrorDetails.KEY_SYSTEM_NO_ACCESS,error:Y,fatal:!0},Y.message))})};N(e)})},t.requestMediaKeySystemAccess=function(e,h){var d=this.config.requestMediaKeySystemAccessFunc;if(typeof d!="function"){var c="Configured requestMediaKeySystemAccess is not a function "+d;return C.requestMediaKeySystemAccess===null&&self.location.protocol==="http:"&&(c="navigator.requestMediaKeySystemAccess is not available over insecure protocol "+location.protocol),Promise.reject(new Error(c))}return d(e,h)},t.getMediaKeysPromise=function(e,h,d){var c=this,M=(0,C.getSupportedMediaKeySystemConfigurations)(e,h,d,this.config.drmSystemOptions),F=this.keySystemAccessPromises[e],w=F==null?void 0:F.keySystemAccess;if(!w){this.log('Requesting encrypted media "'+e+'" key-system access with config: '+JSON.stringify(M)),w=this.requestMediaKeySystemAccess(e,M);var U=this.keySystemAccessPromises[e]={keySystemAccess:w};return w.catch(function(N){c.log('Failed to obtain access to key-system "'+e+'": '+N)}),w.then(function(N){c.log('Access for key-system "'+N.keySystem+'" obtained');var z=c.fetchServerCertificate(e);return c.log('Create media-keys for "'+e+'"'),U.mediaKeys=N.createMediaKeys().then(function(V){return c.log('Media-keys created for "'+e+'"'),z.then(function(j){return j?c.setMediaKeysServerCertificate(V,e,j):V})}),U.mediaKeys.catch(function(V){c.error('Failed to create media-keys for "'+e+'"}: '+V)}),U.mediaKeys})}return w.then(function(){return F.mediaKeys})},t.createMediaKeySessionContext=function(e){var h=e.decryptdata,d=e.keySystem,c=e.mediaKeys;console.assert(!!c,"mediaKeys is defined"),this.log('Creating key-system session "'+d+'" keyId: '+b.default.hexDump(h.keyId||[]));var M=c.createSession(),F={decryptdata:h,keySystem:d,mediaKeys:c,mediaKeysSession:M,keyStatus:"status-pending"};return this.mediaKeySessions.push(F),F},t.renewKeySession=function(e){var h=e.decryptdata;if(h.pssh){var d=this.createMediaKeySessionContext(e),c=this.getKeyIdString(h),M="cenc";this.keyIdToKeySessionPromise[c]=this.generateRequestWithPreferredKeySession(d,M,h.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)},t.getKeyIdString=function(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(e.keyId===null)throw new Error("keyId is null");return b.default.hexDump(e.keyId)},t.updateKeySession=function(e,h){var d,c=e.mediaKeysSession;return this.log('Updating key-session "'+c.sessionId+'" for keyID '+b.default.hexDump(((d=e.decryptdata)===null||d===void 0?void 0:d.keyId)||[])+`
      } (data length: `+(h&&h.byteLength)+")"),c.update(h)},t.selectKeySystemFormat=function(e){var h=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log("Selecting key-system from fragment (sn: "+e.sn+" "+e.type+": "+e.level+") key formats "+h.join(", ")),this.keyFormatPromise=this.getKeyFormatPromise(h)),this.keyFormatPromise},t.getKeyFormatPromise=function(e){var h=this;return new Promise(function(d,c){var M=(0,C.getKeySystemsForConfig)(h.config),F=e.map(C.keySystemFormatToKeySystemDomain).filter(function(w){return!!w&&M.indexOf(w)!==-1});return h.getKeySystemSelectionPromise(F).then(function(w){var U=w.keySystem,N=(0,C.keySystemDomainToKeySystemFormat)(U);N?d(N):c(new Error('Unable to find format for key-system "'+U+'"'))}).catch(c)})},t.loadKey=function(e){var h=this,d=e.keyInfo.decryptdata,c=this.getKeyIdString(d),M="(keyId: "+c+' format: "'+d.keyFormat+'" method: '+d.method+" uri: "+d.uri+")";this.log("Starting session for key "+M);var F=this.keyIdToKeySessionPromise[c];return F||(F=this.keyIdToKeySessionPromise[c]=this.getKeySystemForKeyPromise(d).then(function(w){var U=w.keySystem,N=w.mediaKeys;return h.throwIfDestroyed(),h.log("Handle encrypted media sn: "+e.frag.sn+" "+e.frag.type+": "+e.frag.level+" using key "+M),h.attemptSetMediaKeys(U,N).then(function(){h.throwIfDestroyed();var z=h.createMediaKeySessionContext({keySystem:U,mediaKeys:N,decryptdata:d}),V="cenc";return h.generateRequestWithPreferredKeySession(z,V,d.pssh,"playlist-key")})}),F.catch(function(w){return h.handleError(w)})),F},t.throwIfDestroyed=function(e){if(!this.hls)throw new Error("invalid state")},t.handleError=function(e){!this.hls||(this.error(e.message),e instanceof E?this.hls.trigger(P.Events.ERROR,e.data):this.hls.trigger(P.Events.ERROR,{type:T.ErrorTypes.KEY_SYSTEM_ERROR,details:T.ErrorDetails.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0}))},t.getKeySystemForKeyPromise=function(e){var h=this.getKeyIdString(e),d=this.keyIdToKeySessionPromise[h];if(!d){var c=(0,C.keySystemFormatToKeySystemDomain)(e.keyFormat),M=c?[c]:(0,C.getKeySystemsForConfig)(this.config);return this.attemptKeySystemAccess(M)}return d},t.getKeySystemSelectionPromise=function(e){if(e.length||(e=(0,C.getKeySystemsForConfig)(this.config)),e.length===0)throw new E({type:T.ErrorTypes.KEY_SYSTEM_ERROR,details:T.ErrorDetails.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},"Missing key-system license configuration options "+JSON.stringify({drmSystems:this.config.drmSystems}));return this.attemptKeySystemAccess(e)},t._onMediaEncrypted=function(e){var h=this,d=e.initDataType,c=e.initData;if(this.debug('"'+e.type+'" event: init data type: "'+d+'"'),c!==null){var M,F;if(d==="sinf"&&this.config.drmSystems[C.KeySystems.FAIRPLAY]){var w=(0,_.bin2str)(new Uint8Array(c));try{var U=(0,I.base64Decode)(JSON.parse(w).sinf),N=(0,_.parseSinf)(new Uint8Array(U));if(!N)return;M=N.subarray(8,24),F=C.KeySystems.FAIRPLAY}catch{this.warn('Failed to parse sinf "encrypted" event message initData');return}}else{var z=(0,_.parsePssh)(c);if(z===null)return;z.version===0&&z.systemId===C.KeySystemIds.WIDEVINE&&z.data&&(M=z.data.subarray(8,24)),F=(0,C.keySystemIdToKeySystemDomain)(z.systemId)}if(!(!F||!M)){for(var V=b.default.hexDump(M),j=this.keyIdToKeySessionPromise,Y=this.mediaKeySessions,X=j[V],Q=function(ne){var oe=Y[ne],ae=oe.decryptdata;if(ae.pssh||!ae.keyId)return"continue";var ie=b.default.hexDump(ae.keyId);if(V===ie||ae.uri.replace(/-/g,"").indexOf(V)!==-1)return X=j[ie],delete j[ie],ae.pssh=new Uint8Array(c),ae.keyId=M,X=j[V]=X.then(function(){return h.generateRequestWithPreferredKeySession(oe,d,c,"encrypted-event-key-match")}),"break"},te=0;te<Y.length;te++){var $=Q(te);if($!=="continue"&&$==="break")break}X||(X=j[V]=this.getKeySystemSelectionPromise([F]).then(function(ee){var ne,oe=ee.keySystem,ae=ee.mediaKeys;h.throwIfDestroyed();var ie=new A.LevelKey("ISO-23001-7",V,(ne=(0,C.keySystemDomainToKeySystemFormat)(oe))!=null?ne:"");return ie.pssh=new Uint8Array(c),ie.keyId=M,h.attemptSetMediaKeys(oe,ae).then(function(){h.throwIfDestroyed();var ce=h.createMediaKeySessionContext({decryptdata:ie,keySystem:oe,mediaKeys:ae});return h.generateRequestWithPreferredKeySession(ce,d,c,"encrypted-event-no-match")})})),X.catch(function(ee){return h.handleError(ee)})}}},t._onWaitingForKey=function(e){this.log('"'+e.type+'" event')},t.attemptSetMediaKeys=function(e,h){var d=this,c=this.setMediaKeysQueue.slice();this.log('Setting media-keys for "'+e+'"');var M=Promise.all(c).then(function(){if(!d.media)throw new Error("Attempted to set mediaKeys without media element attached");return d.media.setMediaKeys(h)});return this.setMediaKeysQueue.push(M),M.then(function(){d.log('Media-keys set for "'+e+'"'),c.push(M),d.setMediaKeysQueue=d.setMediaKeysQueue.filter(function(F){return c.indexOf(F)===-1})})},t.generateRequestWithPreferredKeySession=function(e,h,d,c){var M,F,w=this,U=(M=this.config.drmSystems)===null||M===void 0||(F=M[e.keySystem])===null||F===void 0?void 0:F.generateRequest;if(U)try{var N=U.call(this.hls,h,d,e);if(!N)throw new Error("Invalid response from configured generateRequest filter");h=N.initDataType,d=e.decryptdata.pssh=N.initData?new Uint8Array(N.initData):null}catch(X){var z;if(this.warn(X.message),(z=this.hls)!==null&&z!==void 0&&z.config.debug)throw X}if(d===null)return this.log('Skipping key-session request for "'+c+'" (no initData)'),Promise.resolve(e);var V=this.getKeyIdString(e.decryptdata);this.log('Generating key-session request for "'+c+'": '+V+" (init data type: "+h+" length: "+(d?d.byteLength:null)+")");var j=new(g());e.mediaKeysSession.onmessage=function(X){var Q=e.mediaKeysSession;if(!Q){j.emit("error",new Error("invalid state"));return}var te=X.messageType,$=X.message;w.log('"'+te+'" message event for session "'+Q.sessionId+'" message size: '+$.byteLength),te==="license-request"||te==="license-renewal"?w.renewLicense(e,$).catch(function(ee){w.handleError(ee),j.emit("error",ee)}):te==="license-release"?e.keySystem===C.KeySystems.FAIRPLAY&&(w.updateKeySession(e,(0,B.strToUtf8array)("acknowledged")),w.removeSession(e)):w.warn('unhandled media key message type "'+te+'"')},e.mediaKeysSession.onkeystatuseschange=function(X){var Q=e.mediaKeysSession;if(!Q){j.emit("error",new Error("invalid state"));return}w.onKeyStatusChange(e);var te=e.keyStatus;j.emit("keyStatus",te),te==="expired"&&(w.warn(e.keySystem+" expired for key "+V),w.renewKeySession(e))};var Y=new Promise(function(X,Q){j.on("error",Q),j.on("keyStatus",function(te){te.startsWith("usable")?X():te==="output-restricted"?Q(new E({type:T.ErrorTypes.KEY_SYSTEM_ERROR,details:T.ErrorDetails.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):te==="internal-error"?Q(new E({type:T.ErrorTypes.KEY_SYSTEM_ERROR,details:T.ErrorDetails.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},'key status changed to "'+te+'"')):te==="expired"?Q(new Error("key expired while generating request")):w.warn('unhandled key status change "'+te+'"')})});return e.mediaKeysSession.generateRequest(h,d).then(function(){var X;w.log('Request generated for key-session "'+((X=e.mediaKeysSession)===null||X===void 0?void 0:X.sessionId)+'" keyId: '+V)}).catch(function(X){throw new E({type:T.ErrorTypes.KEY_SYSTEM_ERROR,details:T.ErrorDetails.KEY_SYSTEM_NO_SESSION,error:X,fatal:!1},"Error generating key-session request: "+X)}).then(function(){return Y}).catch(function(X){throw j.removeAllListeners(),w.removeSession(e),X}).then(function(){return j.removeAllListeners(),e})},t.onKeyStatusChange=function(e){var h=this;e.mediaKeysSession.keyStatuses.forEach(function(d,c){h.log('key status change "'+d+'" for keyStatuses keyId: '+b.default.hexDump("buffer"in c?new Uint8Array(c.buffer,c.byteOffset,c.byteLength):new Uint8Array(c))+" session keyId: "+b.default.hexDump(new Uint8Array(e.decryptdata.keyId||[]))+" uri: "+e.decryptdata.uri),e.keyStatus=d})},t.fetchServerCertificate=function(e){var h=this;return new Promise(function(d,c){var M=h.getServerCertificateUrl(e);if(!M)return d();h.log('Fetching serverCertificate for "'+e+'"');var F=new XMLHttpRequest;F.open("GET",M,!0),F.responseType="arraybuffer",F.onreadystatechange=function(){F.readyState===XMLHttpRequest.DONE&&(F.status===200?d(F.response):c(new E({type:T.ErrorTypes.KEY_SYSTEM_ERROR,details:T.ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:F},'"'+e+'" certificate request XHR failed ('+M+"). Status: "+F.status+" ("+F.statusText+")")))},F.send()})},t.setMediaKeysServerCertificate=function(e,h,d){var c=this;return new Promise(function(M,F){e.setServerCertificate(d).then(function(w){c.log("setServerCertificate "+(w?"success":"not supported by CDM")+" ("+(d==null?void 0:d.byteLength)+') on "'+h+'"'),M(e)}).catch(function(w){F(new E({type:T.ErrorTypes.KEY_SYSTEM_ERROR,details:T.ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:w,fatal:!0},w.message))})})},t.renewLicense=function(e,h){var d=this;return this.requestLicense(e,new Uint8Array(h)).then(function(c){return d.updateKeySession(e,new Uint8Array(c)).catch(function(M){throw new E({type:T.ErrorTypes.KEY_SYSTEM_ERROR,details:T.ErrorDetails.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:M,fatal:!0},M.message)})})},t.setupLicenseXHR=function(e,h,d,c){var M=this,F=this.config.licenseXhrSetup;return F?Promise.resolve().then(function(){if(!d.decryptdata)throw new Error("Key removed");return F.call(M.hls,e,h,d,c)}).catch(function(w){if(!d.decryptdata)throw w;return e.open("POST",h,!0),F.call(M.hls,e,h,d,c)}).then(function(w){e.readyState||e.open("POST",h,!0);var U=w||c;return{xhr:e,licenseChallenge:U}}):(e.open("POST",h,!0),Promise.resolve({xhr:e,licenseChallenge:c}))},t.requestLicense=function(e,h){var d=this;return new Promise(function(c,M){var F=d.getLicenseServerUrl(e.keySystem);d.log("Sending license request to URL: "+F);var w=new XMLHttpRequest;w.responseType="arraybuffer",w.onreadystatechange=function(){if(!d.hls||!e.mediaKeysSession)return M(new Error("invalid state"));if(w.readyState===4)if(w.status===200){d._requestLicenseFailureCount=0;var U=w.response;d.log("License received "+(U instanceof ArrayBuffer?U.byteLength:U));var N=d.config.licenseResponseCallback;if(N)try{U=N.call(d.hls,w,F,e)}catch(V){d.error(V)}c(U)}else if(d._requestLicenseFailureCount++,d._requestLicenseFailureCount>v||w.status>=400&&w.status<500)M(new E({type:T.ErrorTypes.KEY_SYSTEM_ERROR,details:T.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:w},"License Request XHR failed ("+F+"). Status: "+w.status+" ("+w.statusText+")"));else{var z=v-d._requestLicenseFailureCount+1;d.warn("Retrying license request, "+z+" attempts left"),d.requestLicense(e,h).then(c,M)}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=w,d.setupLicenseXHR(w,F,e,h).then(function(U){var N=U.xhr,z=U.licenseChallenge;N.send(z)})})},t.onMediaAttached=function(e,h){if(!!this.config.emeEnabled){var d=h.media;this.media=d,d.addEventListener("encrypted",this.onMediaEncrypted),d.addEventListener("waitingforkey",this.onWaitingForKey)}},t.onMediaDetached=function(){var e=this,h=this.media,d=this.mediaKeySessions;h&&(h.removeEventListener("encrypted",this.onMediaEncrypted),h.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},A.LevelKey.clearKeyUriToKeyIdMap();var c=d.length;o.CDMCleanupPromise=Promise.all(d.map(function(M){return e.removeSession(M)}).concat(h==null?void 0:h.setMediaKeys(null).catch(function(M){e.log("Could not clear media keys: "+M+". media.src: "+(h==null?void 0:h.src))}))).then(function(){c&&(e.log("finished closing key sessions and clearing media keys"),d.length=0)}).catch(function(M){e.log("Could not close sessions and clear media keys: "+M+". media.src: "+(h==null?void 0:h.src))})},t.onManifestLoaded=function(e,h){var d=h.sessionKeys;if(!(!d||!this.config.emeEnabled)&&!this.keyFormatPromise){var c=d.reduce(function(M,F){return M.indexOf(F.keyFormat)===-1&&M.push(F.keyFormat),M},[]);this.log("Selecting key-system from session-keys "+c.join(", ")),this.keyFormatPromise=this.getKeyFormatPromise(c)}},t.removeSession=function(e){var h=this,d=e.mediaKeysSession,c=e.licenseXhr;if(d){this.log("Remove licenses and keys and close session "+d.sessionId),d.onmessage=null,d.onkeystatuseschange=null,c&&c.readyState!==XMLHttpRequest.DONE&&c.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;var M=this.mediaKeySessions.indexOf(e);return M>-1&&this.mediaKeySessions.splice(M,1),d.remove().catch(function(F){h.log("Could not remove session: "+F)}).then(function(){return d.close()}).catch(function(F){h.log("Could not close session: "+F)})}},o}();n.CDMCleanupPromise=void 0;var E=function(o){x(t,o);function t(f,e){var h;return h=o.call(this,e)||this,h.data=void 0,h.data=f,f.err=f.error,h}return t}(y(Error));const r=n},"./src/controller/fps-controller.ts":(W,O,p)=>{p.r(O),p.d(O,{default:()=>C});var P=p("./src/events.ts"),T=p("./src/utils/logger.ts"),k=function(){function B(A){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=A,this.registerListeners()}var I=B.prototype;return I.setStreamController=function(b){this.streamController=b},I.registerListeners=function(){this.hls.on(P.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},I.unregisterListeners=function(){this.hls.off(P.Events.MEDIA_ATTACHING,this.onMediaAttaching)},I.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},I.onMediaAttaching=function(b,_){var S=this.hls.config;if(S.capLevelOnFPSDrop){var g=_.media instanceof self.HTMLVideoElement?_.media:null;this.media=g,g&&typeof g.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),S.fpsDroppedMonitoringPeriod)}},I.checkFPS=function(b,_,S){var g=performance.now();if(_){if(this.lastTime){var x=g-this.lastTime,y=S-this.lastDroppedFrames,l=_-this.lastDecodedFrames,u=1e3*y/x,a=this.hls;if(a.trigger(P.Events.FPS_DROP,{currentDropped:y,currentDecoded:l,totalDroppedFrames:S}),u>0&&y>a.config.fpsDroppedMonitoringThreshold*l){var s=a.currentLevel;T.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+s),s>0&&(a.autoLevelCapping===-1||a.autoLevelCapping>=s)&&(s=s-1,a.trigger(P.Events.FPS_DROP_LEVEL_CAPPING,{level:s,droppedLevel:a.currentLevel}),a.autoLevelCapping=s,this.streamController.nextLevelSwitch())}}this.lastTime=g,this.lastDroppedFrames=S,this.lastDecodedFrames=_}},I.checkFPSInterval=function(){var b=this.media;if(b)if(this.isVideoPlaybackQualityAvailable){var _=b.getVideoPlaybackQuality();this.checkFPS(b,_.totalVideoFrames,_.droppedVideoFrames)}else this.checkFPS(b,b.webkitDecodedFrameCount,b.webkitDroppedFrameCount)},B}();const C=k},"./src/controller/fragment-finders.ts":(W,O,p)=>{p.r(O),p.d(O,{findFragWithCC:()=>A,findFragmentByPDT:()=>k,findFragmentByPTS:()=>C,fragmentWithinToleranceTest:()=>B,pdtWithinToleranceTest:()=>I});var P=p("./src/polyfills/number.ts"),T=p("./src/utils/binary-search.ts");function k(b,_,S){if(_===null||!Array.isArray(b)||!b.length||!(0,P.isFiniteNumber)(_))return null;var g=b[0].programDateTime;if(_<(g||0))return null;var x=b[b.length-1].endProgramDateTime;if(_>=(x||0))return null;S=S||0;for(var y=0;y<b.length;++y){var l=b[y];if(I(_,S,l))return l}return null}function C(b,_,S,g){S===void 0&&(S=0),g===void 0&&(g=0);var x=null;if(b?x=_[b.sn-_[0].sn+1]||null:S===0&&_[0].start===0&&(x=_[0]),x&&B(S,g,x)===0)return x;var y=T.default.search(_,B.bind(null,S,g));return y&&(y!==b||!x)?y:x}function B(b,_,S){if(b===void 0&&(b=0),_===void 0&&(_=0),S.start<=b&&S.start+S.duration>b)return 0;var g=Math.min(_,S.duration+(S.deltaPTS?S.deltaPTS:0));return S.start+S.duration-g<=b?1:S.start-g>b&&S.start?-1:0}function I(b,_,S){var g=Math.min(_,S.duration+(S.deltaPTS?S.deltaPTS:0))*1e3,x=S.endProgramDateTime||0;return x-g>b}function A(b,_){return T.default.search(b,function(S){return S.cc<_?1:S.cc>_?-1:0})}},"./src/controller/fragment-tracker.ts":(W,O,p)=>{p.r(O),p.d(O,{FragmentState:()=>k,FragmentTracker:()=>C});var P=p("./src/events.ts"),T=p("./src/types/loader.ts"),k;(function(A){A.NOT_LOADED="NOT_LOADED",A.APPENDING="APPENDING",A.PARTIAL="PARTIAL",A.OK="OK"})(k||(k={}));var C=function(){function A(_){this.activeFragment=null,this.activeParts=null,this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=_,this._registerListeners()}var b=A.prototype;return b._registerListeners=function(){var S=this.hls;S.on(P.Events.BUFFER_APPENDED,this.onBufferAppended,this),S.on(P.Events.FRAG_BUFFERED,this.onFragBuffered,this),S.on(P.Events.FRAG_LOADED,this.onFragLoaded,this)},b._unregisterListeners=function(){var S=this.hls;S.off(P.Events.BUFFER_APPENDED,this.onBufferAppended,this),S.off(P.Events.FRAG_BUFFERED,this.onFragBuffered,this),S.off(P.Events.FRAG_LOADED,this.onFragLoaded,this)},b.destroy=function(){this._unregisterListeners(),this.fragments=this.endListFragments=this.timeRanges=this.activeFragment=this.activeParts=null},b.getAppendedFrag=function(S,g){if(g===T.PlaylistLevelType.MAIN){var x=this.activeFragment,y=this.activeParts;if(!x)return null;if(y)for(var l=y.length;l--;){var u=y[l],a=u?u.end:x.appendedPTS;if(u.start<=S&&a!==void 0&&S<=a)return l>9&&(this.activeParts=y.slice(l-9)),u}else if(x.start<=S&&x.appendedPTS!==void 0&&S<=x.appendedPTS)return x}return this.getBufferedFrag(S,g)},b.getBufferedFrag=function(S,g){for(var x=this.fragments,y=Object.keys(x),l=y.length;l--;){var u=x[y[l]];if((u==null?void 0:u.body.type)===g&&u.buffered){var a=u.body;if(a.start<=S&&S<=a.end)return a}}return null},b.detectEvictedFragments=function(S,g,x){var y=this;this.timeRanges&&(this.timeRanges[S]=g),Object.keys(this.fragments).forEach(function(l){var u=y.fragments[l];if(!!u){if(!u.buffered&&!u.loaded){u.body.type===x&&y.removeFragment(u.body);return}var a=u.range[S];!a||a.time.some(function(s){var m=!y.isTimeBuffered(s.startPTS,s.endPTS,g);return m&&y.removeFragment(u.body),m})}})},b.detectPartialFragments=function(S){var g=this,x=this.timeRanges,y=S.frag,l=S.part;if(!(!x||y.sn==="initSegment")){var u=I(y),a=this.fragments[u];!a||(Object.keys(x).forEach(function(s){var m=y.elementaryStreams[s];if(!!m){var v=x[s],i=l!==null||m.partial===!0;a.range[s]=g.getBufferedTimes(y,l,i,v)}}),a.loaded=null,Object.keys(a.range).length?(a.buffered=!0,a.body.endList&&(this.endListFragments[a.body.type]=a)):this.removeFragment(a.body))}},b.fragBuffered=function(S){var g=I(S),x=this.fragments[g];x&&(x.loaded=null,x.buffered=!0)},b.getBufferedTimes=function(S,g,x,y){for(var l={time:[],partial:x},u=g?g.start:S.start,a=g?g.end:S.end,s=S.minEndPTS||a,m=S.maxStartPTS||u,v=0;v<y.length;v++){var i=y.start(v)-this.bufferPadding,n=y.end(v)+this.bufferPadding;if(m>=i&&s<=n){l.time.push({startPTS:Math.max(u,y.start(v)),endPTS:Math.min(a,y.end(v))});break}else if(u<n&&a>i)l.partial=!0,l.time.push({startPTS:Math.max(u,y.start(v)),endPTS:Math.min(a,y.end(v))});else if(a<=i)break}return l},b.getPartialFragment=function(S){var g=null,x,y,l,u=0,a=this.bufferPadding,s=this.fragments;return Object.keys(s).forEach(function(m){var v=s[m];!v||B(v)&&(y=v.body.start-a,l=v.body.end+a,S>=y&&S<=l&&(x=Math.min(S-y,l-S),u<=x&&(g=v.body,u=x)))}),g},b.isEndListAppended=function(S){var g=this.endListFragments[S];return g!==void 0&&(g.buffered||B(g))},b.getState=function(S){var g=I(S),x=this.fragments[g];return x?x.buffered?B(x)?k.PARTIAL:k.OK:k.APPENDING:k.NOT_LOADED},b.isTimeBuffered=function(S,g,x){for(var y,l,u=0;u<x.length;u++){if(y=x.start(u)-this.bufferPadding,l=x.end(u)+this.bufferPadding,S>=y&&g<=l)return!0;if(g<=y)return!1}return!1},b.onFragLoaded=function(S,g){var x=g.frag,y=g.part;if(!(x.sn==="initSegment"||x.bitrateTest||y)){var l=I(x);this.fragments[l]={body:x,loaded:g,buffered:!1,range:Object.create(null)}}},b.onBufferAppended=function(S,g){var x=this,y=g.frag,l=g.part,u=g.timeRanges;if(y.type===T.PlaylistLevelType.MAIN)if(this.activeFragment!==y&&(this.activeFragment=y,y.appendedPTS=void 0),l){var a=this.activeParts;a||(this.activeParts=a=[]),a.push(l)}else this.activeParts=null;this.timeRanges=u,Object.keys(u).forEach(function(s){var m=u[s];if(x.detectEvictedFragments(s,m),!l&&y.type===T.PlaylistLevelType.MAIN){var v=y.elementaryStreams[s];if(!v)return;for(var i=0;i<m.length;i++){var n=m.end(i);n<=v.endPTS&&n>v.startPTS?y.appendedPTS=Math.max(n,y.appendedPTS||0):y.appendedPTS=v.endPTS}}})},b.onFragBuffered=function(S,g){this.detectPartialFragments(g)},b.hasFragment=function(S){var g=I(S);return!!this.fragments[g]},b.removeFragmentsInRange=function(S,g,x){var y=this;Object.keys(this.fragments).forEach(function(l){var u=y.fragments[l];if(!!u&&u.buffered){var a=u.body;a.type===x&&a.start<g&&a.end>S&&y.removeFragment(a)}})},b.removeFragment=function(S){var g=I(S);S.stats.loaded=0,S.clearElementaryStreamInfo(),S.appendedPTS=void 0,delete this.fragments[g],S.endList&&delete this.endListFragments[S.type]},b.removeAllFragments=function(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activeFragment=null,this.activeParts=null},A}();function B(A){var b,_;return A.buffered&&(((b=A.range.video)===null||b===void 0?void 0:b.partial)||((_=A.range.audio)===null||_===void 0?void 0:_.partial))}function I(A){return A.type+"_"+A.level+"_"+A.urlId+"_"+A.sn}},"./src/controller/gap-controller.ts":(W,O,p)=>{p.r(O),p.d(O,{MAX_START_GAP_JUMP:()=>I,SKIP_BUFFER_HOLE_STEP_SECONDS:()=>A,SKIP_BUFFER_RANGE_START:()=>b,STALL_MINIMUM_DURATION_MS:()=>B,default:()=>_});var P=p("./src/utils/buffer-helper.ts"),T=p("./src/errors.ts"),k=p("./src/events.ts"),C=p("./src/utils/logger.ts"),B=250,I=2,A=.1,b=.05,_=function(){function S(x,y,l,u){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=x,this.media=y,this.fragmentTracker=l,this.hls=u}var g=S.prototype;return g.destroy=function(){this.media=null,this.hls=this.fragmentTracker=null},g.poll=function(y,l){var u=this.config,a=this.media,s=this.stalled;if(a!==null){var m=a.currentTime,v=a.seeking,i=this.seeking&&!v,n=!this.seeking&&v;if(this.seeking=v,m!==y){if(this.moved=!0,s!==null){if(this.stallReported){var E=self.performance.now()-s;C.logger.warn("playback not stuck anymore @"+m+", after "+Math.round(E)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}return}if((n||i)&&(this.stalled=null),!(a.paused&&!v||a.ended||a.playbackRate===0||!P.BufferHelper.getBuffered(a).length)){var r=P.BufferHelper.bufferInfo(a,m,0),o=r.len>0,t=r.nextStart||0;if(!(!o&&!t)){if(v){var f=r.len>I,e=!t||l&&l.start<=m||t-m>I&&!this.fragmentTracker.getPartialFragment(m);if(f||e)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var h,d=Math.max(t,r.start||0)-m,c=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,M=c==null||(h=c.details)===null||h===void 0?void 0:h.live,F=M?c.details.targetduration*2:I;if(d>0&&d<=F){this._trySkipBufferHole(null);return}}var w=self.performance.now();if(s===null){this.stalled=w;return}var U=w-s;if(!(!v&&U>=B&&(this._reportStall(r),!this.media))){var N=P.BufferHelper.bufferInfo(a,m,u.maxBufferHole);this._tryFixBufferStall(N,U)}}}}},g._tryFixBufferStall=function(y,l){var u=this.config,a=this.fragmentTracker,s=this.media;if(s!==null){var m=s.currentTime,v=a.getPartialFragment(m);if(v){var i=this._trySkipBufferHole(v);if(i||!this.media)return}y.len>u.maxBufferHole&&l>u.highBufferWatchdogPeriod*1e3&&(C.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}},g._reportStall=function(y){var l=this.hls,u=this.media,a=this.stallReported;!a&&u&&(this.stallReported=!0,C.logger.warn("Playback stalling at @"+u.currentTime+" due to low buffer ("+JSON.stringify(y)+")"),l.trigger(k.Events.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:y.len}))},g._trySkipBufferHole=function(y){var l=this.config,u=this.hls,a=this.media;if(a===null)return 0;for(var s=a.currentTime,m=0,v=P.BufferHelper.getBuffered(a),i=0;i<v.length;i++){var n=v.start(i);if(s+l.maxBufferHole>=m&&s<n){var E=Math.max(n+b,a.currentTime+A);return C.logger.warn("skipping hole, adjusting currentTime from "+s+" to "+E),this.moved=!0,this.stalled=null,a.currentTime=E,y&&u.trigger(k.Events.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+s+" to "+E,frag:y}),E}m=v.end(i)}return 0},g._tryNudgeBuffer=function(){var y=this.config,l=this.hls,u=this.media,a=this.nudgeRetry;if(u!==null){var s=u.currentTime;if(this.nudgeRetry++,a<y.nudgeMaxRetry){var m=s+(a+1)*y.nudgeOffset;C.logger.warn("Nudging 'currentTime' from "+s+" to "+m),u.currentTime=m,l.trigger(k.Events.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else C.logger.error("Playhead still not moving while enough data buffered @"+s+" after "+y.nudgeMaxRetry+" nudges"),l.trigger(k.Events.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})}},S}()},"./src/controller/id3-track-controller.ts":(W,O,p)=>{p.r(O),p.d(O,{default:()=>y});var P=p("./src/polyfills/number.ts"),T=p("./src/events.ts"),k=p("./src/utils/texttrack-utils.ts"),C=p("./src/demux/id3.ts"),B=p("./src/loader/date-range.ts"),I=p("./src/types/demuxer.ts"),A=.25;function b(){return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}var _=function(){var l=b();try{new l(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY}();function S(l,u){return l.getTime()/1e3-u}function g(l){return Uint8Array.from(l.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}var x=function(){function l(a){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=a,this._registerListeners()}var u=l.prototype;return u.destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null},u._registerListeners=function(){var s=this.hls;s.on(T.Events.MEDIA_ATTACHED,this.onMediaAttached,this),s.on(T.Events.MEDIA_DETACHING,this.onMediaDetaching,this),s.on(T.Events.MANIFEST_LOADING,this.onManifestLoading,this),s.on(T.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),s.on(T.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),s.on(T.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},u._unregisterListeners=function(){var s=this.hls;s.off(T.Events.MEDIA_ATTACHED,this.onMediaAttached,this),s.off(T.Events.MEDIA_DETACHING,this.onMediaDetaching,this),s.off(T.Events.MANIFEST_LOADING,this.onManifestLoading,this),s.off(T.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),s.off(T.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),s.off(T.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},u.onMediaAttached=function(s,m){this.media=m.media},u.onMediaDetaching=function(){!this.id3Track||((0,k.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})},u.onManifestLoading=function(){this.dateRangeCuesAppended={}},u.createTrack=function(s){var m=this.getID3Track(s.textTracks);return m.mode="hidden",m},u.getID3Track=function(s){if(!!this.media){for(var m=0;m<s.length;m++){var v=s[m];if(v.kind==="metadata"&&v.label==="id3")return(0,k.sendAddTrackEvent)(v,this.media),v}return this.media.addTextTrack("metadata","id3")}},u.onFragParsingMetadata=function(s,m){if(!!this.media){var v=this.hls.config,i=v.enableEmsgMetadataCues,n=v.enableID3MetadataCues;if(!(!i&&!n)){var E=m.samples;this.id3Track||(this.id3Track=this.createTrack(this.media));for(var r=b(),o=0;o<E.length;o++){var t=E[o].type;if(!(t===I.MetadataSchema.emsg&&!i||!n)){var f=C.getID3Frames(E[o].data);if(f){var e=E[o].pts,h=e+E[o].duration;h>_&&(h=_);var d=h-e;d<=0&&(h=e+A);for(var c=0;c<f.length;c++){var M=f[c];if(!C.isTimeStampFrame(M)){this.updateId3CueEnds(e);var F=new r(e,h,"");F.value=M,t&&(F.type=t),this.id3Track.addCue(F)}}}}}}}},u.updateId3CueEnds=function(s){var m,v=(m=this.id3Track)===null||m===void 0?void 0:m.cues;if(v)for(var i=v.length;i--;){var n=v[i];n.startTime<s&&n.endTime===_&&(n.endTime=s)}},u.onBufferFlushing=function(s,m){var v=m.startOffset,i=m.endOffset,n=m.type,E=this.id3Track,r=this.hls;if(!!r){var o=r.config,t=o.enableEmsgMetadataCues,f=o.enableID3MetadataCues;if(E&&(t||f)){var e;n==="audio"?e=function(d){return d.type===I.MetadataSchema.audioId3&&f}:n==="video"?e=function(d){return d.type===I.MetadataSchema.emsg&&t}:e=function(d){return d.type===I.MetadataSchema.audioId3&&f||d.type===I.MetadataSchema.emsg&&t},(0,k.removeCuesInRange)(E,v,i,e)}}},u.onLevelUpdated=function(s,m){var v=this,i=m.details;if(!(!this.media||!i.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)){var n=this.dateRangeCuesAppended,E=this.id3Track,r=i.dateRanges,o=Object.keys(r);if(E)for(var t=Object.keys(n).filter(function(w){return!o.includes(w)}),f=function(U){var N=t[U];Object.keys(n[N].cues).forEach(function(z){E.removeCue(n[N].cues[z])}),delete n[N]},e=t.length;e--;)f(e);var h=i.fragments[i.fragments.length-1];if(!(o.length===0||!(0,P.isFiniteNumber)(h==null?void 0:h.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var d=h.programDateTime/1e3-h.start,c=b(),M=function(U){var N=o[U],z=r[N],V=n[N],j=(V==null?void 0:V.cues)||{},Y=(V==null?void 0:V.durationKnown)||!1,X=S(z.startDate,d),Q=_,te=z.endDate;if(te)Q=S(te,d),Y=!0;else if(z.endOnNext&&!Y){var $=o.reduce(function(ce,me){var pe=r[me];return pe.class===z.class&&pe.id!==me&&pe.startDate>z.startDate&&ce.push(pe),ce},[]).sort(function(ce,me){return ce.startDate.getTime()-me.startDate.getTime()})[0];$&&(Q=S($.startDate,d),Y=!0)}for(var ee=Object.keys(z.attr),ne=0;ne<ee.length;ne++){var oe=ee[ne];if(!(oe===B.DateRangeAttribute.ID||oe===B.DateRangeAttribute.CLASS||oe===B.DateRangeAttribute.START_DATE||oe===B.DateRangeAttribute.DURATION||oe===B.DateRangeAttribute.END_DATE||oe===B.DateRangeAttribute.END_ON_NEXT)){var ae=j[oe];if(ae)Y&&!V.durationKnown&&(ae.endTime=Q);else{var ie=z.attr[oe];ae=new c(X,Q,""),(oe===B.DateRangeAttribute.SCTE35_OUT||oe===B.DateRangeAttribute.SCTE35_IN)&&(ie=g(ie)),ae.value={key:oe,data:ie},ae.type=I.MetadataSchema.dateRange,v.id3Track.addCue(ae),j[oe]=ae}}}n[N]={cues:j,dateRange:z,durationKnown:Y}},F=0;F<o.length;F++)M(F)}}},l}();const y=x},"./src/controller/latency-controller.ts":(W,O,p)=>{p.r(O),p.d(O,{default:()=>b});var P=p("./src/errors.ts"),T=p("./src/events.ts"),k=p("./src/utils/logger.ts");function C(_,S){for(var g=0;g<S.length;g++){var x=S[g];x.enumerable=x.enumerable||!1,x.configurable=!0,"value"in x&&(x.writable=!0),Object.defineProperty(_,I(x.key),x)}}function B(_,S,g){return S&&C(_.prototype,S),g&&C(_,g),Object.defineProperty(_,"prototype",{writable:!1}),_}function I(_){var S=A(_,"string");return typeof S=="symbol"?S:String(S)}function A(_,S){if(typeof _!="object"||_===null)return _;var g=_[Symbol.toPrimitive];if(g!==void 0){var x=g.call(_,S||"default");if(typeof x!="object")return x;throw new TypeError("@@toPrimitive must return a primitive value.")}return(S==="string"?String:Number)(_)}var b=function(){function _(g){var x=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return x.timeupdate()},this.hls=g,this.config=g.config,this.registerListeners()}var S=_.prototype;return S.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},S.registerListeners=function(){this.hls.on(T.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(T.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(T.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(T.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(T.Events.ERROR,this.onError,this)},S.unregisterListeners=function(){this.hls.off(T.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(T.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(T.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(T.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(T.Events.ERROR,this.onError)},S.onMediaAttached=function(x,y){this.media=y.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},S.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},S.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},S.onLevelUpdated=function(x,y){var l=y.details;this.levelDetails=l,l.advanced&&this.timeupdate(),!l.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},S.onError=function(x,y){y.details===P.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,k.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},S.timeupdate=function(){var x=this.media,y=this.levelDetails;if(!(!x||!y)){this.currentTime=x.currentTime;var l=this.computeLatency();if(l!==null){this._latency=l;var u=this.config,a=u.lowLatencyMode,s=u.maxLiveSyncPlaybackRate;if(!(!a||s===1)){var m=this.targetLatency;if(m!==null){var v=l-m,i=Math.min(this.maxLatency,m+y.targetduration),n=v<i;if(y.live&&n&&v>.05&&this.forwardBufferLength>1){var E=Math.min(2,Math.max(1,s)),r=Math.round(2/(1+Math.exp(-.75*v-this.edgeStalled))*20)/20;x.playbackRate=Math.min(E,Math.max(1,r))}else x.playbackRate!==1&&x.playbackRate!==0&&(x.playbackRate=1)}}}}},S.estimateLiveEdge=function(){var x=this.levelDetails;return x===null?null:x.edge+x.age},S.computeLatency=function(){var x=this.estimateLiveEdge();return x===null?null:x-this.currentTime},B(_,[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var x=this.config,y=this.levelDetails;return x.liveMaxLatencyDuration!==void 0?x.liveMaxLatencyDuration:y?x.liveMaxLatencyDurationCount*y.targetduration:0}},{key:"targetLatency",get:function(){var x=this.levelDetails;if(x===null)return null;var y=x.holdBack,l=x.partHoldBack,u=x.targetduration,a=this.config,s=a.liveSyncDuration,m=a.liveSyncDurationCount,v=a.lowLatencyMode,i=this.hls.userConfig,n=v&&l||y;(i.liveSyncDuration||i.liveSyncDurationCount||n===0)&&(n=s!==void 0?s:m*u);var E=u,r=1;return n+Math.min(this.stallCount*r,E)}},{key:"liveSyncPosition",get:function(){var x=this.estimateLiveEdge(),y=this.targetLatency,l=this.levelDetails;if(x===null||y===null||l===null)return null;var u=l.edge,a=x-y-this.edgeStalled,s=u-l.totalduration,m=u-(this.config.lowLatencyMode&&l.partTarget||l.targetduration);return Math.min(Math.max(s,a),m)}},{key:"drift",get:function(){var x=this.levelDetails;return x===null?1:x.drift}},{key:"edgeStalled",get:function(){var x=this.levelDetails;if(x===null)return 0;var y=(this.config.lowLatencyMode&&x.partTarget||x.targetduration)*3;return Math.max(x.age-y,0)}},{key:"forwardBufferLength",get:function(){var x=this.media,y=this.levelDetails;if(!x||!y)return 0;var l=x.buffered.length;return(l?x.buffered.end(l-1):y.edge)-this.currentTime}}]),_}()},"./src/controller/level-controller.ts":(W,O,p)=>{p.r(O),p.d(O,{default:()=>a});var P=p("./src/types/level.ts"),T=p("./src/events.ts"),k=p("./src/errors.ts"),C=p("./src/utils/codecs.ts"),B=p("./src/controller/level-helper.ts"),I=p("./src/controller/base-playlist-controller.ts"),A=p("./src/types/loader.ts");function b(){return b=Object.assign?Object.assign.bind():function(s){for(var m=1;m<arguments.length;m++){var v=arguments[m];for(var i in v)Object.prototype.hasOwnProperty.call(v,i)&&(s[i]=v[i])}return s},b.apply(this,arguments)}function _(s,m){for(var v=0;v<m.length;v++){var i=m[v];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(s,g(i.key),i)}}function S(s,m,v){return m&&_(s.prototype,m),v&&_(s,v),Object.defineProperty(s,"prototype",{writable:!1}),s}function g(s){var m=x(s,"string");return typeof m=="symbol"?m:String(m)}function x(s,m){if(typeof s!="object"||s===null)return s;var v=s[Symbol.toPrimitive];if(v!==void 0){var i=v.call(s,m||"default");if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(m==="string"?String:Number)(s)}function y(s,m){s.prototype=Object.create(m.prototype),s.prototype.constructor=s,l(s,m)}function l(s,m){return l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,n){return i.__proto__=n,i},l(s,m)}var u=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),a=function(s){y(m,s);function m(i){var n;return n=s.call(this,i,"[level-controller]")||this,n._levels=[],n._firstLevel=-1,n._startLevel=void 0,n.currentLevelIndex=-1,n.manualLevelIndex=-1,n.onParsedComplete=void 0,n._registerListeners(),n}var v=m.prototype;return v._registerListeners=function(){var n=this.hls;n.on(T.Events.MANIFEST_LOADED,this.onManifestLoaded,this),n.on(T.Events.LEVEL_LOADED,this.onLevelLoaded,this),n.on(T.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),n.on(T.Events.FRAG_LOADED,this.onFragLoaded,this),n.on(T.Events.ERROR,this.onError,this)},v._unregisterListeners=function(){var n=this.hls;n.off(T.Events.MANIFEST_LOADED,this.onManifestLoaded,this),n.off(T.Events.LEVEL_LOADED,this.onLevelLoaded,this),n.off(T.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),n.off(T.Events.FRAG_LOADED,this.onFragLoaded,this),n.off(T.Events.ERROR,this.onError,this)},v.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,s.prototype.destroy.call(this)},v.startLoad=function(){var n=this._levels;n.forEach(function(E){E.loadError=0}),s.prototype.startLoad.call(this)},v.onManifestLoaded=function(n,E){var r=[],o=[],t=[],f,e={},h,d=!1,c=!1,M=!1;if(E.levels.forEach(function(N){var z=N.attrs;d=d||!!(N.width&&N.height),c=c||!!N.videoCodec,M=M||!!N.audioCodec,u&&N.audioCodec&&N.audioCodec.indexOf("mp4a.40.34")!==-1&&(N.audioCodec=void 0);var V=N.bitrate+"-"+N.attrs.RESOLUTION+"-"+N.attrs.CODECS;h=e[V],h?h.url.push(N.url):(h=new P.Level(N),e[V]=h,r.push(h)),z&&(z.AUDIO&&(0,B.addGroupId)(h,"audio",z.AUDIO),z.SUBTITLES&&(0,B.addGroupId)(h,"text",z.SUBTITLES))}),(d||c)&&M&&(r=r.filter(function(N){var z=N.videoCodec,V=N.width,j=N.height;return!!z||!!(V&&j)})),r=r.filter(function(N){var z=N.audioCodec,V=N.videoCodec;return(!z||(0,C.isCodecSupportedInMp4)(z,"audio"))&&(!V||(0,C.isCodecSupportedInMp4)(V,"video"))}),E.audioTracks&&(o=E.audioTracks.filter(function(N){return!N.audioCodec||(0,C.isCodecSupportedInMp4)(N.audioCodec,"audio")}),(0,B.assignTrackIdsByGroup)(o)),E.subtitles&&(t=E.subtitles,(0,B.assignTrackIdsByGroup)(t)),r.length>0){f=r[0].bitrate,r.sort(function(N,z){return N.attrs["HDCP-LEVEL"]!==z.attrs["HDCP-LEVEL"]?(N.attrs["HDCP-LEVEL"]||"")>(z.attrs["HDCP-LEVEL"]||"")?1:-1:N.bitrate!==z.bitrate?N.bitrate-z.bitrate:N.attrs.SCORE!==z.attrs.SCORE?N.attrs.decimalFloatingPoint("SCORE")-z.attrs.decimalFloatingPoint("SCORE"):d&&N.height!==z.height?N.height-z.height:0}),this._levels=r;for(var F=0;F<r.length;F++)if(r[F].bitrate===f){this._firstLevel=F,this.log("manifest loaded, "+r.length+" level(s) found, first bitrate: "+f);break}var w=M&&!c,U={levels:r,audioTracks:o,subtitleTracks:t,sessionData:E.sessionData,sessionKeys:E.sessionKeys,firstLevel:this._firstLevel,stats:E.stats,audio:M,video:c,altAudio:!w&&o.some(function(N){return!!N.url})};this.hls.trigger(T.Events.MANIFEST_PARSED,U),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(T.Events.ERROR,{type:k.ErrorTypes.MEDIA_ERROR,details:k.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:E.url,reason:"no level with compatible codecs found in manifest"})},v.onError=function(n,E){var r,o;if(s.prototype.onError.call(this,n,E),!E.fatal){var t=E.context,f=this._levels[this.currentLevelIndex];if(t&&(t.type===A.PlaylistContextType.AUDIO_TRACK&&f.audioGroupIds&&t.groupId===f.audioGroupIds[f.urlId]||t.type===A.PlaylistContextType.SUBTITLE_TRACK&&f.textGroupIds&&t.groupId===f.textGroupIds[f.urlId])){this.redundantFailover(this.currentLevelIndex);return}var e=!1,h=!0,d;switch(E.details){case k.ErrorDetails.FRAG_LOAD_ERROR:case k.ErrorDetails.FRAG_LOAD_TIMEOUT:case k.ErrorDetails.KEY_LOAD_ERROR:case k.ErrorDetails.KEY_LOAD_TIMEOUT:if(E.frag){var c=E.frag.type===A.PlaylistLevelType.MAIN?E.frag.level:this.currentLevelIndex,M=this._levels[c];M?(M.fragmentError++,M.fragmentError>this.hls.config.fragLoadingMaxRetry&&(d=c)):d=c}break;case k.ErrorDetails.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{var F=f.attrs["HDCP-LEVEL"];F&&(this.hls.maxHdcpLevel=P.HdcpLevels[P.HdcpLevels.indexOf(F)-1],this.warn('Restricting playback to HDCP-LEVEL of "'+this.hls.maxHdcpLevel+'" or lower'))}case k.ErrorDetails.FRAG_PARSING_ERROR:case k.ErrorDetails.KEY_SYSTEM_NO_SESSION:d=((r=E.frag)===null||r===void 0?void 0:r.type)===A.PlaylistLevelType.MAIN?E.frag.level:this.currentLevelIndex,E.levelRetry=!1;break;case k.ErrorDetails.LEVEL_LOAD_ERROR:case k.ErrorDetails.LEVEL_LOAD_TIMEOUT:t&&(t.deliveryDirectives&&(h=!1),d=t.level),e=!0;break;case k.ErrorDetails.REMUX_ALLOC_ERROR:d=(o=E.level)!=null?o:this.currentLevelIndex,e=!0;break}d!==void 0&&this.recoverLevel(E,d,e,h)}},v.recoverLevel=function(n,E,r,o){var t=n.details,f=this._levels[E];if(f.loadError++,r){var e=this.retryLoadingOrFail(n);if(e)n.levelRetry=!0;else{this.currentLevelIndex=-1;return}}if(o){var h=f.url.length;if(h>1&&f.loadError<h)n.levelRetry=!0,this.redundantFailover(E);else if(this.manualLevelIndex===-1){for(var d=-1,c=this._levels,M=c.length;M--;){var F=(M+this.currentLevelIndex)%c.length;if(F!==this.currentLevelIndex&&c[F].loadError===0){d=F;break}}d>-1&&this.currentLevelIndex!==d?(this.warn(t+": switch to "+d),n.levelRetry=!0,this.hls.nextAutoLevel=d):n.levelRetry===!1&&(n.fatal=!0)}}},v.redundantFailover=function(n){var E=this._levels[n],r=E.url.length;if(r>1){var o=(E.urlId+1)%r;this.warn("Switching to redundant URL-id "+o),this._levels.forEach(function(t){t.urlId=o}),this.level=n}},v.onFragLoaded=function(n,E){var r=E.frag;if(r!==void 0&&r.type===A.PlaylistLevelType.MAIN){var o=this._levels[r.level];o!==void 0&&(o.fragmentError=0,o.loadError=0)}},v.onLevelLoaded=function(n,E){var r,o=E.level,t=E.details,f=this._levels[o];if(!f){var e;this.warn("Invalid level index "+o),(e=E.deliveryDirectives)!==null&&e!==void 0&&e.skip&&(t.deltaUpdateFailed=!0);return}o===this.currentLevelIndex?(f.fragmentError===0&&(f.loadError=0,this.retryCount=0),this.playlistLoaded(o,E,f.details)):(r=E.deliveryDirectives)!==null&&r!==void 0&&r.skip&&(t.deltaUpdateFailed=!0)},v.onAudioTrackSwitched=function(n,E){var r=this.hls.levels[this.currentLevelIndex];if(!!r&&r.audioGroupIds){for(var o=-1,t=this.hls.audioTracks[E.id].groupId,f=0;f<r.audioGroupIds.length;f++)if(r.audioGroupIds[f]===t){o=f;break}o!==r.urlId&&(r.urlId=o,this.startLoad())}},v.loadPlaylist=function(n){s.prototype.loadPlaylist.call(this);var E=this.currentLevelIndex,r=this._levels[E];if(this.canLoad&&r&&r.url.length>0){var o=r.urlId,t=r.url[o];if(n)try{t=n.addDirectives(t)}catch(f){this.warn("Could not construct new URL with HLS Delivery Directives: "+f)}this.log("Attempt loading level index "+E+((n==null?void 0:n.msn)!==void 0?" at sn "+n.msn+" part "+n.part:"")+" with URL-id "+o+" "+t),this.clearTimer(),this.hls.trigger(T.Events.LEVEL_LOADING,{url:t,level:E,id:o,deliveryDirectives:n||null})}},v.removeLevel=function(n,E){var r=function(f,e){return e!==E},o=this._levels.filter(function(t,f){return f!==n?!0:t.url.length>1&&E!==void 0?(t.url=t.url.filter(r),t.audioGroupIds&&(t.audioGroupIds=t.audioGroupIds.filter(r)),t.textGroupIds&&(t.textGroupIds=t.textGroupIds.filter(r)),t.urlId=0,!0):!1}).map(function(t,f){var e=t.details;return e!=null&&e.fragments&&e.fragments.forEach(function(h){h.level=f}),t});this._levels=o,this.hls.trigger(T.Events.LEVELS_UPDATED,{levels:o})},S(m,[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(n){var E,r=this._levels;if(r.length!==0&&!(this.currentLevelIndex===n&&(E=r[n])!==null&&E!==void 0&&E.details)){if(n<0||n>=r.length){var o=n<0;if(this.hls.trigger(T.Events.ERROR,{type:k.ErrorTypes.OTHER_ERROR,details:k.ErrorDetails.LEVEL_SWITCH_ERROR,level:n,fatal:o,reason:"invalid level idx"}),o)return;n=Math.min(n,r.length-1)}this.clearTimer();var t=this.currentLevelIndex,f=r[t],e=r[n];this.log("switching to level "+n+" from "+t),this.currentLevelIndex=n;var h=b({},e,{level:n,maxBitrate:e.maxBitrate,uri:e.uri,urlId:e.urlId});delete h._urlId,this.hls.trigger(T.Events.LEVEL_SWITCHING,h);var d=e.details;if(!d||d.live){var c=this.switchParams(e.uri,f==null?void 0:f.details);this.loadPlaylist(c)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(n){this.manualLevelIndex=n,this._startLevel===void 0&&(this._startLevel=n),n!==-1&&(this.level=n)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(n){this._firstLevel=n}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var n=this.hls.config.startLevel;return n!==void 0?n:this._firstLevel}else return this._startLevel},set:function(n){this._startLevel=n}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(n){this.level=n,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=n)}}]),m}(I.default)},"./src/controller/level-helper.ts":(W,O,p)=>{p.r(O),p.d(O,{addGroupId:()=>B,addSliding:()=>u,adjustSliding:()=>l,assignTrackIdsByGroup:()=>I,computeReloadInterval:()=>a,getFragmentWithSN:()=>s,getPartWith:()=>m,mapFragmentIntersection:()=>y,mapPartIntersection:()=>x,mergeDetails:()=>S,updateFragPTSDTS:()=>_,updatePTS:()=>A});var P=p("./src/polyfills/number.ts"),T=p("./src/utils/logger.ts"),k=p("./src/loader/date-range.ts");function C(){return C=Object.assign?Object.assign.bind():function(v){for(var i=1;i<arguments.length;i++){var n=arguments[i];for(var E in n)Object.prototype.hasOwnProperty.call(n,E)&&(v[E]=n[E])}return v},C.apply(this,arguments)}function B(v,i,n){switch(i){case"audio":v.audioGroupIds||(v.audioGroupIds=[]),v.audioGroupIds.push(n);break;case"text":v.textGroupIds||(v.textGroupIds=[]),v.textGroupIds.push(n);break}}function I(v){var i={};v.forEach(function(n){var E=n.groupId||"";n.id=i[E]=i[E]||0,i[E]++})}function A(v,i,n){var E=v[i],r=v[n];b(E,r)}function b(v,i){var n=i.startPTS;if((0,P.isFiniteNumber)(n)){var E=0,r;i.sn>v.sn?(E=n-v.start,r=v):(E=v.start-n,r=i),r.duration!==E&&(r.duration=E)}else if(i.sn>v.sn){var o=v.cc===i.cc;o&&v.minEndPTS?i.start=v.start+(v.minEndPTS-v.start):i.start=v.start+v.duration}else i.start=Math.max(v.start-i.duration,0)}function _(v,i,n,E,r,o){var t=E-n;t<=0&&(T.logger.warn("Fragment should have a positive duration",i),E=n+i.duration,o=r+i.duration);var f=n,e=E,h=i.startPTS,d=i.endPTS;if((0,P.isFiniteNumber)(h)){var c=Math.abs(h-n);(0,P.isFiniteNumber)(i.deltaPTS)?i.deltaPTS=Math.max(c,i.deltaPTS):i.deltaPTS=c,f=Math.max(n,h),n=Math.min(n,h),r=Math.min(r,i.startDTS),e=Math.min(E,d),E=Math.max(E,d),o=Math.max(o,i.endDTS)}i.duration=E-n;var M=n-i.start;i.start=i.startPTS=n,i.maxStartPTS=f,i.startDTS=r,i.endPTS=E,i.minEndPTS=e,i.endDTS=o;var F=i.sn;if(!v||F<v.startSN||F>v.endSN)return 0;var w,U=F-v.startSN,N=v.fragments;for(N[U]=i,w=U;w>0;w--)b(N[w],N[w-1]);for(w=U;w<N.length-1;w++)b(N[w],N[w+1]);return v.fragmentHint&&b(N[N.length-1],v.fragmentHint),v.PTSKnown=v.alignedSliding=!0,M}function S(v,i){for(var n=null,E=v.fragments,r=E.length-1;r>=0;r--){var o=E[r].initSegment;if(o){n=o;break}}v.fragmentHint&&delete v.fragmentHint.endPTS;var t=0,f;if(y(v,i,function(w,U){w.relurl&&(t=w.cc-U.cc),(0,P.isFiniteNumber)(w.startPTS)&&(0,P.isFiniteNumber)(w.endPTS)&&(U.start=U.startPTS=w.startPTS,U.startDTS=w.startDTS,U.appendedPTS=w.appendedPTS,U.maxStartPTS=w.maxStartPTS,U.endPTS=w.endPTS,U.endDTS=w.endDTS,U.minEndPTS=w.minEndPTS,U.duration=w.endPTS-w.startPTS,U.duration&&(f=U),i.PTSKnown=i.alignedSliding=!0),U.elementaryStreams=w.elementaryStreams,U.loader=w.loader,U.stats=w.stats,U.urlId=w.urlId,w.initSegment&&(U.initSegment=w.initSegment,n=w.initSegment)}),n){var e=i.fragmentHint?i.fragments.concat(i.fragmentHint):i.fragments;e.forEach(function(w){var U;(!w.initSegment||w.initSegment.relurl===((U=n)===null||U===void 0?void 0:U.relurl))&&(w.initSegment=n)})}if(i.skippedSegments)if(i.deltaUpdateFailed=i.fragments.some(function(w){return!w}),i.deltaUpdateFailed){T.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var h=i.skippedSegments;h--;)i.fragments.shift();i.startSN=i.fragments[0].sn,i.startCC=i.fragments[0].cc}else i.canSkipDateRanges&&(i.dateRanges=g(v.dateRanges,i.dateRanges,i.recentlyRemovedDateranges));var d=i.fragments;if(t){T.logger.warn("discontinuity sliding from playlist, take drift into account");for(var c=0;c<d.length;c++)d[c].cc+=t}i.skippedSegments&&(i.startCC=i.fragments[0].cc),x(v.partList,i.partList,function(w,U){U.elementaryStreams=w.elementaryStreams,U.stats=w.stats}),f?_(i,f,f.startPTS,f.endPTS,f.startDTS,f.endDTS):l(v,i),d.length&&(i.totalduration=i.edge-d[0].start),i.driftStartTime=v.driftStartTime,i.driftStart=v.driftStart;var M=i.advancedDateTime;if(i.advanced&&M){var F=i.edge;i.driftStart||(i.driftStartTime=M,i.driftStart=F),i.driftEndTime=M,i.driftEnd=F}else i.driftEndTime=v.driftEndTime,i.driftEnd=v.driftEnd,i.advancedDateTime=v.advancedDateTime}function g(v,i,n){var E=C({},v);return n&&n.forEach(function(r){delete E[r]}),Object.keys(i).forEach(function(r){var o=new k.DateRange(i[r].attr,E[r]);o.isValid?E[r]=o:T.logger.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+JSON.stringify(i[r].attr)+'"')}),E}function x(v,i,n){if(v&&i)for(var E=0,r=0,o=v.length;r<=o;r++){var t=v[r],f=i[r+E];t&&f&&t.index===f.index&&t.fragment.sn===f.fragment.sn?n(t,f):E--}}function y(v,i,n){for(var E=i.skippedSegments,r=Math.max(v.startSN,i.startSN)-i.startSN,o=(v.fragmentHint?1:0)+(E?i.endSN:Math.min(v.endSN,i.endSN))-i.startSN,t=i.startSN-v.startSN,f=i.fragmentHint?i.fragments.concat(i.fragmentHint):i.fragments,e=v.fragmentHint?v.fragments.concat(v.fragmentHint):v.fragments,h=r;h<=o;h++){var d=e[t+h],c=f[h];E&&!c&&h<E&&(c=i.fragments[h]=d),d&&c&&n(d,c)}}function l(v,i){var n=i.startSN+i.skippedSegments-v.startSN,E=v.fragments;n<0||n>=E.length||u(i,E[n].start)}function u(v,i){if(i){for(var n=v.fragments,E=v.skippedSegments;E<n.length;E++)n[E].start+=i;v.fragmentHint&&(v.fragmentHint.start+=i)}}function a(v,i){i===void 0&&(i=1/0);var n=1e3*v.targetduration;if(v.updated){var E=v.fragments,r=4;if(E.length&&n*r>i){var o=E[E.length-1].duration*1e3;o<n&&(n=o)}}else n/=2;return Math.round(n)}function s(v,i,n){if(!v||!v.details)return null;var E=v.details,r=E.fragments[i-E.startSN];return r||(r=E.fragmentHint,r&&r.sn===i)?r:i<E.startSN&&n&&n.sn===i?n:null}function m(v,i,n){if(!v||!v.details)return null;var E=v.details.partList;if(E)for(var r=E.length;r--;){var o=E[r];if(o.index===n&&o.fragment.sn===i)return o}return null}},"./src/controller/stream-controller.ts":(W,O,p)=>{p.r(O),p.d(O,{default:()=>i});var P=p("./src/polyfills/number.ts"),T=p("./src/controller/base-stream-controller.ts"),k=p("./src/is-supported.ts"),C=p("./src/events.ts"),B=p("./src/utils/buffer-helper.ts"),I=p("./src/controller/fragment-tracker.ts"),A=p("./src/types/loader.ts"),b=p("./src/loader/fragment.ts"),_=p("./src/demux/transmuxer-interface.ts"),S=p("./src/types/transmuxer.ts"),g=p("./src/controller/gap-controller.ts"),x=p("./src/errors.ts");function y(n,E){for(var r=0;r<E.length;r++){var o=E[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(n,u(o.key),o)}}function l(n,E,r){return E&&y(n.prototype,E),r&&y(n,r),Object.defineProperty(n,"prototype",{writable:!1}),n}function u(n){var E=a(n,"string");return typeof E=="symbol"?E:String(E)}function a(n,E){if(typeof n!="object"||n===null)return n;var r=n[Symbol.toPrimitive];if(r!==void 0){var o=r.call(n,E||"default");if(typeof o!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(E==="string"?String:Number)(n)}function s(n,E){n.prototype=Object.create(E.prototype),n.prototype.constructor=n,m(n,E)}function m(n,E){return m=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,t){return o.__proto__=t,o},m(n,E)}var v=100,i=function(n){s(E,n);function E(o,t,f){var e;return e=n.call(this,o,t,f,"[stream-controller]")||this,e.audioCodecSwap=!1,e.gapController=null,e.level=-1,e._forceStartLoad=!1,e.altAudio=!1,e.audioOnly=!1,e.fragPlaying=null,e.onvplaying=null,e.onvseeked=null,e.fragLastKbps=0,e.couldBacktrack=!1,e.backtrackFragment=null,e.audioCodecSwitch=!1,e.videoBuffer=null,e._registerListeners(),e}var r=E.prototype;return r._registerListeners=function(){var t=this.hls;t.on(C.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(C.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(C.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(C.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(C.Events.LEVEL_LOADING,this.onLevelLoading,this),t.on(C.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.on(C.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.on(C.Events.ERROR,this.onError,this),t.on(C.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(C.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.on(C.Events.BUFFER_CREATED,this.onBufferCreated,this),t.on(C.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(C.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(C.Events.FRAG_BUFFERED,this.onFragBuffered,this)},r._unregisterListeners=function(){var t=this.hls;t.off(C.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(C.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(C.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(C.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.off(C.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.off(C.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.off(C.Events.ERROR,this.onError,this),t.off(C.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(C.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.off(C.Events.BUFFER_CREATED,this.onBufferCreated,this),t.off(C.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(C.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(C.Events.FRAG_BUFFERED,this.onFragBuffered,this)},r.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},r.startLoad=function(t){if(this.levels){var f=this.lastCurrentTime,e=this.hls;if(this.stopLoad(),this.setInterval(v),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var h=e.startLevel;h===-1&&(e.config.testBandwidth&&this.levels.length>1?(h=0,this.bitrateTest=!0):h=e.nextAutoLevel),this.level=e.nextLoadLevel=h,this.loadedmetadata=!1}f>0&&t===-1&&(this.log("Override startPosition with lastCurrentTime @"+f.toFixed(3)),t=f),this.state=T.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()}else this._forceStartLoad=!0,this.state=T.State.STOPPED},r.stopLoad=function(){this._forceStartLoad=!1,n.prototype.stopLoad.call(this)},r.doTick=function(){switch(this.state){case T.State.IDLE:this.doTickIdle();break;case T.State.WAITING_LEVEL:{var t,f=this.levels,e=this.level,h=f==null||(t=f[e])===null||t===void 0?void 0:t.details;if(h&&(!h.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(h))break;this.state=T.State.IDLE;break}break}case T.State.FRAG_LOADING_WAITING_RETRY:{var d,c=self.performance.now(),M=this.retryDate;(!M||c>=M||(d=this.media)!==null&&d!==void 0&&d.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.level),this.state=T.State.IDLE)}break}this.onTickEnd()},r.onTickEnd=function(){n.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},r.doTickIdle=function(){var t=this.hls,f=this.levelLastLoaded,e=this.levels,h=this.media,d=t.config,c=t.nextLoadLevel;if(!(f===null||!h&&(this.startFragRequested||!d.startFragPrefetch))&&!(this.altAudio&&this.audioOnly)&&!(!e||!e[c])){var M=e[c],F=this.getMainFwdBufferInfo();if(F!==null){var w=this.getLevelDetails();if(w&&this._streamEnded(F,w)){var U={};this.altAudio&&(U.type="video"),this.hls.trigger(C.Events.BUFFER_EOS,U),this.state=T.State.ENDED;return}this.level=t.nextLoadLevel=c;var N=M.details;if(!N||this.state===T.State.WAITING_LEVEL||N.live&&this.levelLastLoaded!==c){this.level=c,this.state=T.State.WAITING_LEVEL;return}var z=F.len,V=this.getMaxBufferLength(M.maxBitrate);if(!(z>=V)){this.backtrackFragment&&this.backtrackFragment.start>F.end&&(this.backtrackFragment=null);var j=this.backtrackFragment?this.backtrackFragment.start:F.end,Y=this.getNextFragment(j,N);if(this.couldBacktrack&&!this.fragPrevious&&Y&&Y.sn!=="initSegment"&&this.fragmentTracker.getState(Y)!==I.FragmentState.OK){var X,Q=((X=this.backtrackFragment)!=null?X:Y).sn,te=Q-N.startSN,$=N.fragments[te-1];$&&Y.cc===$.cc&&(Y=$,this.fragmentTracker.removeFragment($))}else this.backtrackFragment&&F.len&&(this.backtrackFragment=null);if(Y&&this.fragmentTracker.getState(Y)===I.FragmentState.OK&&this.nextLoadPosition>j){var ee=this.audioOnly&&!this.altAudio?b.ElementaryStreamTypes.AUDIO:b.ElementaryStreamTypes.VIDEO,ne=(ee===b.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;ne&&this.afterBufferFlushed(ne,ee,A.PlaylistLevelType.MAIN),Y=this.getNextFragment(this.nextLoadPosition,N)}!Y||(Y.initSegment&&!Y.initSegment.data&&!this.bitrateTest&&(Y=Y.initSegment),this.loadFragment(Y,N,j))}}}},r.loadFragment=function(t,f,e){var h,d=this.fragmentTracker.getState(t);this.fragCurrent=t,d===I.FragmentState.NOT_LOADED?t.sn==="initSegment"?this._loadInitSegment(t,f):this.bitrateTest?(this.log("Fragment "+t.sn+" of level "+t.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(t,f)):(this.startFragRequested=!0,n.prototype.loadFragment.call(this,t,f,e)):d===I.FragmentState.APPENDING?this.reduceMaxBufferLength(t.duration)&&this.fragmentTracker.removeFragment(t):((h=this.media)===null||h===void 0?void 0:h.buffered.length)===0&&this.fragmentTracker.removeAllFragments()},r.getAppendedFrag=function(t){var f=this.fragmentTracker.getAppendedFrag(t,A.PlaylistLevelType.MAIN);return f&&"fragment"in f?f.fragment:f},r.getBufferedFrag=function(t){return this.fragmentTracker.getBufferedFrag(t,A.PlaylistLevelType.MAIN)},r.followingBufferedFrag=function(t){return t?this.getBufferedFrag(t.end+.5):null},r.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},r.nextLevelSwitch=function(){var t=this.levels,f=this.media;if(f!=null&&f.readyState){var e,h=this.getAppendedFrag(f.currentTime);if(h&&h.start>1&&this.flushMainBuffer(0,h.start-1),!f.paused&&t){var d=this.hls.nextLoadLevel,c=t[d],M=this.fragLastKbps;M&&this.fragCurrent?e=this.fragCurrent.duration*c.maxBitrate/(1e3*M)+1:e=0}else e=0;var F=this.getBufferedFrag(f.currentTime+e);if(F){var w=this.followingBufferedFrag(F);if(w){this.abortCurrentFrag();var U=w.maxStartPTS?w.maxStartPTS:w.start,N=w.duration,z=Math.max(F.end,U+Math.min(Math.max(N-this.config.maxFragLookUpTolerance,N*.5),N*.75));this.flushMainBuffer(z,Number.POSITIVE_INFINITY)}}}},r.abortCurrentFrag=function(){var t=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,t&&t.abortRequests(),this.state){case T.State.KEY_LOADING:case T.State.FRAG_LOADING:case T.State.FRAG_LOADING_WAITING_RETRY:case T.State.PARSING:case T.State.PARSED:this.state=T.State.IDLE;break}this.nextLoadPosition=this.getLoadPosition()},r.flushMainBuffer=function(t,f){n.prototype.flushMainBuffer.call(this,t,f,this.altAudio?"video":null)},r.onMediaAttached=function(t,f){n.prototype.onMediaAttached.call(this,t,f);var e=f.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),e.addEventListener("playing",this.onvplaying),e.addEventListener("seeked",this.onvseeked),this.gapController=new g.default(this.config,e,this.fragmentTracker,this.hls)},r.onMediaDetaching=function(){var t=this.media;t&&this.onvplaying&&this.onvseeked&&(t.removeEventListener("playing",this.onvplaying),t.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),n.prototype.onMediaDetaching.call(this)},r.onMediaPlaying=function(){this.tick()},r.onMediaSeeked=function(){var t=this.media,f=t?t.currentTime:null;(0,P.isFiniteNumber)(f)&&this.log("Media seeked to "+f.toFixed(3)),this.tick()},r.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(C.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null,this.backtrackFragment=null},r.onManifestParsed=function(t,f){var e=!1,h=!1,d;f.levels.forEach(function(c){d=c.audioCodec,d&&(d.indexOf("mp4a.40.2")!==-1&&(e=!0),d.indexOf("mp4a.40.5")!==-1&&(h=!0))}),this.audioCodecSwitch=e&&h&&!(0,k.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=f.levels,this.startFragRequested=!1},r.onLevelLoading=function(t,f){var e=this.levels;if(!(!e||this.state!==T.State.IDLE)){var h=e[f.level];(!h.details||h.details.live&&this.levelLastLoaded!==f.level||this.waitForCdnTuneIn(h.details))&&(this.state=T.State.WAITING_LEVEL)}},r.onLevelLoaded=function(t,f){var e,h=this.levels,d=f.level,c=f.details,M=c.totalduration;if(!h){this.warn("Levels were reset while loading level "+d);return}this.log("Level "+d+" loaded ["+c.startSN+","+c.endSN+"], cc ["+c.startCC+", "+c.endCC+"] duration:"+M);var F=this.fragCurrent;F&&(this.state===T.State.FRAG_LOADING||this.state===T.State.FRAG_LOADING_WAITING_RETRY)&&F.level!==f.level&&F.loader&&(this.state=T.State.IDLE,this.backtrackFragment=null,F.abortRequests());var w=h[d],U=0;if(c.live||(e=w.details)!==null&&e!==void 0&&e.live){if(c.fragments[0]||(c.deltaUpdateFailed=!0),c.deltaUpdateFailed)return;U=this.alignPlaylists(c,w.details)}if(w.details=c,this.levelLastLoaded=d,this.hls.trigger(C.Events.LEVEL_UPDATED,{details:c,level:d}),this.state===T.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(c))return;this.state=T.State.IDLE}this.startFragRequested?c.live&&this.synchronizeToLiveEdge(c):this.setStartPosition(c,U),this.tick()},r._handleFragmentLoadProgress=function(t){var f,e=t.frag,h=t.part,d=t.payload,c=this.levels;if(!c){this.warn("Levels were reset while fragment load was in progress. Fragment "+e.sn+" of level "+e.level+" will not be buffered");return}var M=c[e.level],F=M.details;if(!F){this.warn("Dropping fragment "+e.sn+" of level "+e.level+" after level details were reset");return}var w=M.videoCodec,U=F.PTSKnown||!F.live,N=(f=e.initSegment)===null||f===void 0?void 0:f.data,z=this._getAudioCodec(M),V=this.transmuxer=this.transmuxer||new _.default(this.hls,A.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),j=h?h.index:-1,Y=j!==-1,X=new S.ChunkMetadata(e.level,e.sn,e.stats.chunkCount,d.byteLength,j,Y),Q=this.initPTS[e.cc];V.push(d,N,z,w,e,h,F.totalduration,U,X,Q)},r.onAudioTrackSwitching=function(t,f){var e=this.altAudio,h=!!f.url,d=f.id;if(!h){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var c=this.fragCurrent;c&&(this.log("Switching to main audio track, cancel main fragment load"),c.abortRequests()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var M=this.hls;e&&M.trigger(C.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),M.trigger(C.Events.AUDIO_TRACK_SWITCHED,{id:d})}},r.onAudioTrackSwitched=function(t,f){var e=f.id,h=!!this.hls.audioTracks[e].url;if(h){var d=this.videoBuffer;d&&this.mediaBuffer!==d&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=d)}this.altAudio=h,this.tick()},r.onBufferCreated=function(t,f){var e=f.tracks,h,d,c=!1;for(var M in e){var F=e[M];if(F.id==="main"){if(d=M,h=F,M==="video"){var w=e[M];w&&(this.videoBuffer=w.buffer)}}else c=!0}c&&h?(this.log("Alternate track found, use "+d+".buffered to schedule main fragment loading"),this.mediaBuffer=h.buffer):this.mediaBuffer=this.media},r.onFragBuffered=function(t,f){var e=f.frag,h=f.part;if(!(e&&e.type!==A.PlaylistLevelType.MAIN)){if(this.fragContextChanged(e)){this.warn("Fragment "+e.sn+(h?" p: "+h.index:"")+" of level "+e.level+" finished buffering, but was aborted. state: "+this.state),this.state===T.State.PARSED&&(this.state=T.State.IDLE);return}var d=h?h.stats:e.stats;this.fragLastKbps=Math.round(8*d.total/(d.buffering.end-d.loading.first)),e.sn!=="initSegment"&&(this.fragPrevious=e),this.fragBufferedComplete(e,h)}},r.onError=function(t,f){if(f.type===x.ErrorTypes.KEY_SYSTEM_ERROR){this.onFragmentOrKeyLoadError(A.PlaylistLevelType.MAIN,f);return}switch(f.details){case x.ErrorDetails.FRAG_LOAD_ERROR:case x.ErrorDetails.FRAG_LOAD_TIMEOUT:case x.ErrorDetails.FRAG_PARSING_ERROR:case x.ErrorDetails.KEY_LOAD_ERROR:case x.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(A.PlaylistLevelType.MAIN,f);break;case x.ErrorDetails.LEVEL_LOAD_ERROR:case x.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==T.State.ERROR&&(f.fatal?(this.warn(""+f.details),this.state=T.State.ERROR):!f.levelRetry&&this.state===T.State.WAITING_LEVEL&&(this.state=T.State.IDLE));break;case x.ErrorDetails.BUFFER_FULL_ERROR:if(f.parent==="main"&&(this.state===T.State.PARSING||this.state===T.State.PARSED)){var e=!0,h=this.getFwdBufferInfo(this.media,A.PlaylistLevelType.MAIN);h&&h.len>.5&&(e=!this.reduceMaxBufferLength(h.len)),e&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}break}},r.checkBuffer=function(){var t=this.media,f=this.gapController;if(!(!t||!f||!t.readyState)){if(this.loadedmetadata||!B.BufferHelper.getBuffered(t).length){var e=this.state!==T.State.IDLE?this.fragCurrent:null;f.poll(this.lastCurrentTime,e)}this.lastCurrentTime=t.currentTime}},r.onFragLoadEmergencyAborted=function(){this.state=T.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},r.onBufferFlushed=function(t,f){var e=f.type;if(e!==b.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var h=(e===b.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(h,e,A.PlaylistLevelType.MAIN)}},r.onLevelsUpdated=function(t,f){this.levels=f.levels},r.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},r.seekToStartPos=function(){var t=this.media;if(!!t){var f=t.currentTime,e=this.startPosition;if(e>=0&&f<e){if(t.seeking){this.log("could not seek to "+e+", already seeking at "+f);return}var h=B.BufferHelper.getBuffered(t),d=h.length?h.start(0):0,c=d-e;c>0&&(c<this.config.maxBufferHole||c<this.config.maxFragLookUpTolerance)&&(this.log("adjusting start position by "+c+" to match buffer start"),e+=c,this.startPosition=e),this.log("seek to target start position "+e+" from current time "+f),t.currentTime=e}}},r._getAudioCodec=function(t){var f=this.config.defaultAudioCodec||t.audioCodec;return this.audioCodecSwap&&f&&(this.log("Swapping audio codec"),f.indexOf("mp4a.40.5")!==-1?f="mp4a.40.2":f="mp4a.40.5"),f},r._loadBitrateTestFrag=function(t,f){var e=this;t.bitrateTest=!0,this._doFragLoad(t,f).then(function(h){var d=e.hls;if(!(!h||e.fragContextChanged(t))){e.fragLoadError=0,e.state=T.State.IDLE,e.startFragRequested=!1,e.bitrateTest=!1;var c=t.stats;c.parsing.start=c.parsing.end=c.buffering.start=c.buffering.end=self.performance.now(),d.trigger(C.Events.FRAG_LOADED,h),t.bitrateTest=!1}})},r._handleTransmuxComplete=function(t){var f,e="main",h=this.hls,d=t.remuxResult,c=t.chunkMeta,M=this.getCurrentContext(c);if(!M){this.warn("The loading context changed while buffering fragment "+c.sn+" of level "+c.level+". This chunk will not be buffered."),this.resetStartWhenNotLoaded(c.level);return}var F=M.frag,w=M.part,U=M.level,N=d.video,z=d.text,V=d.id3,j=d.initSegment,Y=U.details,X=this.altAudio?void 0:d.audio;if(!this.fragContextChanged(F)){if(this.state=T.State.PARSING,j){j.tracks&&(this._bufferInitSegment(U,j.tracks,F,c),h.trigger(C.Events.FRAG_PARSING_INIT_SEGMENT,{frag:F,id:e,tracks:j.tracks}));var Q=j.initPTS,te=j.timescale;(0,P.isFiniteNumber)(Q)&&(this.initPTS[F.cc]=Q,h.trigger(C.Events.INIT_PTS_FOUND,{frag:F,id:e,initPTS:Q,timescale:te}))}if(N&&d.independent!==!1){if(Y){var $=N.startPTS,ee=N.endPTS,ne=N.startDTS,oe=N.endDTS;if(w)w.elementaryStreams[N.type]={startPTS:$,endPTS:ee,startDTS:ne,endDTS:oe};else if(N.firstKeyFrame&&N.independent&&c.id===1&&(this.couldBacktrack=!0),N.dropped&&N.independent){var ae=this.getMainFwdBufferInfo(),ie=(ae?ae.end:this.getLoadPosition())+this.config.maxBufferHole,ce=N.firstKeyFramePTS?N.firstKeyFramePTS:$;if(ie<ce-this.config.maxBufferHole){this.backtrack(F);return}F.setElementaryStreamInfo(N.type,F.start,ee,F.start,oe,!0)}F.setElementaryStreamInfo(N.type,$,ee,ne,oe),this.backtrackFragment&&(this.backtrackFragment=F),this.bufferFragmentData(N,F,w,c)}}else if(d.independent===!1){this.backtrack(F);return}if(X){var me=X.startPTS,pe=X.endPTS,Ie=X.startDTS,Ee=X.endDTS;w&&(w.elementaryStreams[b.ElementaryStreamTypes.AUDIO]={startPTS:me,endPTS:pe,startDTS:Ie,endDTS:Ee}),F.setElementaryStreamInfo(b.ElementaryStreamTypes.AUDIO,me,pe,Ie,Ee),this.bufferFragmentData(X,F,w,c)}if(Y&&V!==null&&V!==void 0&&(f=V.samples)!==null&&f!==void 0&&f.length){var Se={id:e,frag:F,details:Y,samples:V.samples};h.trigger(C.Events.FRAG_PARSING_METADATA,Se)}if(Y&&z){var Te={id:e,frag:F,details:Y,samples:z.samples};h.trigger(C.Events.FRAG_PARSING_USERDATA,Te)}}},r._bufferInitSegment=function(t,f,e,h){var d=this;if(this.state===T.State.PARSING){this.audioOnly=!!f.audio&&!f.video,this.altAudio&&!this.audioOnly&&delete f.audio;var c=f.audio,M=f.video,F=f.audiovideo;if(c){var w=t.audioCodec,U=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(w&&(w.indexOf("mp4a.40.5")!==-1?w="mp4a.40.2":w="mp4a.40.5"),c.metadata.channelCount!==1&&U.indexOf("firefox")===-1&&(w="mp4a.40.5")),U.indexOf("android")!==-1&&c.container!=="audio/mpeg"&&(w="mp4a.40.2",this.log("Android: force audio codec to "+w)),t.audioCodec&&t.audioCodec!==w&&this.log('Swapping manifest audio codec "'+t.audioCodec+'" for "'+w+'"'),c.levelCodec=w,c.id="main",this.log("Init audio buffer, container:"+c.container+", codecs[selected/level/parsed]=["+(w||"")+"/"+(t.audioCodec||"")+"/"+c.codec+"]")}M&&(M.levelCodec=t.videoCodec,M.id="main",this.log("Init video buffer, container:"+M.container+", codecs[level/parsed]=["+(t.videoCodec||"")+"/"+M.codec+"]")),F&&this.log("Init audiovideo buffer, container:"+F.container+", codecs[level/parsed]=["+(t.attrs.CODECS||"")+"/"+F.codec+"]"),this.hls.trigger(C.Events.BUFFER_CODECS,f),Object.keys(f).forEach(function(N){var z=f[N],V=z.initSegment;V!=null&&V.byteLength&&d.hls.trigger(C.Events.BUFFER_APPENDING,{type:N,data:V,frag:e,part:null,chunkMeta:h,parent:e.type})}),this.tick()}},r.getMainFwdBufferInfo=function(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,A.PlaylistLevelType.MAIN)},r.backtrack=function(t){this.couldBacktrack=!0,this.backtrackFragment=t,this.resetTransmuxer(),this.flushBufferGap(t),this.fragmentTracker.removeFragment(t),this.fragPrevious=null,this.nextLoadPosition=t.start,this.state=T.State.IDLE},r.checkFragmentChanged=function(){var t=this.media,f=null;if(t&&t.readyState>1&&t.seeking===!1){var e=t.currentTime;if(B.BufferHelper.isBuffered(t,e)?f=this.getAppendedFrag(e):B.BufferHelper.isBuffered(t,e+.1)&&(f=this.getAppendedFrag(e+.1)),f){this.backtrackFragment=null;var h=this.fragPlaying,d=f.level;(!h||f.sn!==h.sn||h.level!==d||f.urlId!==h.urlId)&&(this.fragPlaying=f,this.hls.trigger(C.Events.FRAG_CHANGED,{frag:f}),(!h||h.level!==d)&&this.hls.trigger(C.Events.LEVEL_SWITCHED,{level:d}))}}},l(E,[{key:"nextLevel",get:function(){var t=this.nextBufferedFrag;return t?t.level:-1}},{key:"currentFrag",get:function(){var t=this.media;return t?this.fragPlaying||this.getAppendedFrag(t.currentTime):null}},{key:"currentProgramDateTime",get:function(){var t=this.media;if(t){var f=t.currentTime,e=this.currentFrag;if(e&&(0,P.isFiniteNumber)(f)&&(0,P.isFiniteNumber)(e.programDateTime)){var h=e.programDateTime+(f-e.start)*1e3;return new Date(h)}}return null}},{key:"currentLevel",get:function(){var t=this.currentFrag;return t?t.level:-1}},{key:"nextBufferedFrag",get:function(){var t=this.currentFrag;return t?this.followingBufferedFrag(t):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}]),E}(T.default)},"./src/controller/subtitle-stream-controller.ts":(W,O,p)=>{p.r(O),p.d(O,{SubtitleStreamController:()=>s});var P=p("./src/events.ts"),T=p("./src/utils/buffer-helper.ts"),k=p("./src/controller/fragment-finders.ts"),C=p("./src/utils/discontinuities.ts"),B=p("./src/controller/level-helper.ts"),I=p("./src/controller/fragment-tracker.ts"),A=p("./src/controller/base-stream-controller.ts"),b=p("./src/types/loader.ts"),_=p("./src/types/level.ts");function S(v,i){for(var n=0;n<i.length;n++){var E=i[n];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(v,x(E.key),E)}}function g(v,i,n){return i&&S(v.prototype,i),n&&S(v,n),Object.defineProperty(v,"prototype",{writable:!1}),v}function x(v){var i=y(v,"string");return typeof i=="symbol"?i:String(i)}function y(v,i){if(typeof v!="object"||v===null)return v;var n=v[Symbol.toPrimitive];if(n!==void 0){var E=n.call(v,i||"default");if(typeof E!="object")return E;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(v)}function l(v,i){v.prototype=Object.create(i.prototype),v.prototype.constructor=v,u(v,i)}function u(v,i){return u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(E,r){return E.__proto__=r,E},u(v,i)}var a=500,s=function(v){l(i,v);function i(E,r,o){var t;return t=v.call(this,E,r,o,"[subtitle-stream-controller]")||this,t.levels=[],t.currentTrackId=-1,t.tracksBuffered=[],t.mainDetails=null,t._registerListeners(),t}var n=i.prototype;return n.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},n._registerListeners=function(){var r=this.hls;r.on(P.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.on(P.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(P.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(P.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.on(P.Events.ERROR,this.onError,this),r.on(P.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),r.on(P.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),r.on(P.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),r.on(P.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),r.on(P.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),r.on(P.Events.FRAG_BUFFERED,this.onFragBuffered,this)},n._unregisterListeners=function(){var r=this.hls;r.off(P.Events.MEDIA_ATTACHED,this.onMediaAttached,this),r.off(P.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.off(P.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.off(P.Events.LEVEL_LOADED,this.onLevelLoaded,this),r.off(P.Events.ERROR,this.onError,this),r.off(P.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),r.off(P.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),r.off(P.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),r.off(P.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),r.off(P.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),r.off(P.Events.FRAG_BUFFERED,this.onFragBuffered,this)},n.startLoad=function(r){this.stopLoad(),this.state=A.State.IDLE,this.setInterval(a),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=r,this.tick()},n.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},n.onLevelLoaded=function(r,o){this.mainDetails=o.details},n.onSubtitleFragProcessed=function(r,o){var t=o.frag,f=o.success;if(this.fragPrevious=t,this.state=A.State.IDLE,!!f){var e=this.tracksBuffered[this.currentTrackId];if(!!e){for(var h,d=t.start,c=0;c<e.length;c++)if(d>=e[c].start&&d<=e[c].end){h=e[c];break}var M=t.start+t.duration;h?h.end=M:(h={start:d,end:M},e.push(h)),this.fragmentTracker.fragBuffered(t)}}},n.onBufferFlushing=function(r,o){var t=o.startOffset,f=o.endOffset;if(t===0&&f!==Number.POSITIVE_INFINITY){var e=this.currentTrackId,h=this.levels;if(!h.length||!h[e]||!h[e].details)return;var d=h[e].details,c=d.targetduration,M=f-c;if(M<=0)return;o.endOffsetSubtitles=Math.max(0,M),this.tracksBuffered.forEach(function(F){for(var w=0;w<F.length;){if(F[w].end<=M){F.shift();continue}else if(F[w].start<M)F[w].start=M;else break;w++}}),this.fragmentTracker.removeFragmentsInRange(t,M,b.PlaylistLevelType.SUBTITLE)}},n.onFragBuffered=function(r,o){if(!this.loadedmetadata&&o.frag.type===b.PlaylistLevelType.MAIN){var t;(t=this.media)!==null&&t!==void 0&&t.buffered.length&&(this.loadedmetadata=!0)}},n.onError=function(r,o){var t=o.frag;!t||t.type!==b.PlaylistLevelType.SUBTITLE||(this.fragCurrent&&this.fragCurrent.abortRequests(),this.state=A.State.IDLE)},n.onSubtitleTracksUpdated=function(r,o){var t=this,f=o.subtitleTracks;this.tracksBuffered=[],this.levels=f.map(function(e){return new _.Level(e)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(e){t.tracksBuffered[e.id]=[]}),this.mediaBuffer=null},n.onSubtitleTrackSwitch=function(r,o){if(this.currentTrackId=o.id,!this.levels.length||this.currentTrackId===-1){this.clearInterval();return}var t=this.levels[this.currentTrackId];t!=null&&t.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,t&&this.setInterval(a)},n.onSubtitleTrackLoaded=function(r,o){var t,f=o.details,e=o.id,h=this.currentTrackId,d=this.levels;if(!!d.length){var c=d[h];if(!(e>=d.length||e!==h||!c)){this.mediaBuffer=this.mediaBufferTimeRanges;var M=0;if(f.live||(t=c.details)!==null&&t!==void 0&&t.live){var F=this.mainDetails;if(f.deltaUpdateFailed||!F)return;var w=F.fragments[0];c.details?(M=this.alignPlaylists(f,c.details),M===0&&w&&(M=w.start,(0,B.addSliding)(f,M))):f.hasProgramDateTime&&F.hasProgramDateTime?((0,C.alignMediaPlaylistByPDT)(f,F),M=f.fragments[0].start):w&&(M=w.start,(0,B.addSliding)(f,M))}if(c.details=f,this.levelLastLoaded=e,!this.startFragRequested&&(this.mainDetails||!f.live)&&this.setStartPosition(c.details,M),this.tick(),f.live&&!this.fragCurrent&&this.media&&this.state===A.State.IDLE){var U=(0,k.findFragmentByPTS)(null,f.fragments,this.media.currentTime,0);U||(this.warn("Subtitle playlist not aligned with playback"),c.details=void 0)}}}},n._handleFragmentLoadComplete=function(r){var o=this,t=r.frag,f=r.payload,e=t.decryptdata,h=this.hls;if(!this.fragContextChanged(t)&&f&&f.byteLength>0&&e&&e.key&&e.iv&&e.method==="AES-128"){var d=performance.now();this.decrypter.decrypt(new Uint8Array(f),e.key.buffer,e.iv.buffer).then(function(c){var M=performance.now();h.trigger(P.Events.FRAG_DECRYPTED,{frag:t,payload:c,stats:{tstart:d,tdecrypt:M}})}).catch(function(c){o.warn(c.name+": "+c.message),o.state=A.State.IDLE})}},n.doTick=function(){if(!this.media){this.state=A.State.IDLE;return}if(this.state===A.State.IDLE){var r=this.currentTrackId,o=this.levels;if(!o.length||!o[r]||!o[r].details)return;var t=o[r].details,f=t.targetduration,e=this.config,h=this.getLoadPosition(),d=T.BufferHelper.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],h-f,e.maxBufferHole),c=d.end,M=d.len,F=this.getFwdBufferInfo(this.media,b.PlaylistLevelType.MAIN),w=this.getMaxBufferLength(F==null?void 0:F.len)+f;if(M>w)return;console.assert(t,"Subtitle track details are defined on idle subtitle stream controller tick");var U=t.fragments,N=U.length,z=t.edge,V=null,j=this.fragPrevious;if(c<z){var Y=e.maxFragLookUpTolerance;V=(0,k.findFragmentByPTS)(j,U,Math.max(U[0].start,c),Y),!V&&j&&j.start<U[0].start&&(V=U[0])}else V=U[N-1];if(!V)return;V=this.mapToInitFragWhenRequired(V),this.fragmentTracker.getState(V)===I.FragmentState.NOT_LOADED&&this.loadFragment(V,t,c)}},n.getMaxBufferLength=function(r){var o=v.prototype.getMaxBufferLength.call(this);return r?Math.max(o,r):o},n.loadFragment=function(r,o,t){this.fragCurrent=r,r.sn==="initSegment"?this._loadInitSegment(r,o):(this.startFragRequested=!0,v.prototype.loadFragment.call(this,r,o,t))},g(i,[{key:"mediaBufferTimeRanges",get:function(){return new m(this.tracksBuffered[this.currentTrackId]||[])}}]),i}(A.default),m=function(i){this.buffered=void 0;var n=function(r,o,t){if(o=o>>>0,o>t-1)throw new DOMException("Failed to execute '"+r+"' on 'TimeRanges': The index provided ("+o+") is greater than the maximum bound ("+t+")");return i[o][r]};this.buffered={get length(){return i.length},end:function(r){return n("end",r,i.length)},start:function(r){return n("start",r,i.length)}}}},"./src/controller/subtitle-track-controller.ts":(W,O,p)=>{p.r(O),p.d(O,{default:()=>y});var P=p("./src/events.ts"),T=p("./src/utils/texttrack-utils.ts"),k=p("./src/controller/base-playlist-controller.ts"),C=p("./src/types/loader.ts");function B(l,u){for(var a=0;a<u.length;a++){var s=u[a];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(l,A(s.key),s)}}function I(l,u,a){return u&&B(l.prototype,u),a&&B(l,a),Object.defineProperty(l,"prototype",{writable:!1}),l}function A(l){var u=b(l,"string");return typeof u=="symbol"?u:String(u)}function b(l,u){if(typeof l!="object"||l===null)return l;var a=l[Symbol.toPrimitive];if(a!==void 0){var s=a.call(l,u||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(u==="string"?String:Number)(l)}function _(l,u){l.prototype=Object.create(u.prototype),l.prototype.constructor=l,S(l,u)}function S(l,u){return S=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,m){return s.__proto__=m,s},S(l,u)}var g=function(l){_(u,l);function u(s){var m;return m=l.call(this,s,"[subtitle-track-controller]")||this,m.media=null,m.tracks=[],m.groupId=null,m.tracksInGroup=[],m.trackId=-1,m.selectDefaultTrack=!0,m.queuedDefaultTrack=-1,m.trackChangeListener=function(){return m.onTextTracksChanged()},m.asyncPollTrackChange=function(){return m.pollTrackChange(0)},m.useTextTrackPolling=!1,m.subtitlePollingInterval=-1,m._subtitleDisplay=!0,m.registerListeners(),m}var a=u.prototype;return a.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,l.prototype.destroy.call(this)},a.registerListeners=function(){var m=this.hls;m.on(P.Events.MEDIA_ATTACHED,this.onMediaAttached,this),m.on(P.Events.MEDIA_DETACHING,this.onMediaDetaching,this),m.on(P.Events.MANIFEST_LOADING,this.onManifestLoading,this),m.on(P.Events.MANIFEST_PARSED,this.onManifestParsed,this),m.on(P.Events.LEVEL_LOADING,this.onLevelLoading,this),m.on(P.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),m.on(P.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),m.on(P.Events.ERROR,this.onError,this)},a.unregisterListeners=function(){var m=this.hls;m.off(P.Events.MEDIA_ATTACHED,this.onMediaAttached,this),m.off(P.Events.MEDIA_DETACHING,this.onMediaDetaching,this),m.off(P.Events.MANIFEST_LOADING,this.onManifestLoading,this),m.off(P.Events.MANIFEST_PARSED,this.onManifestParsed,this),m.off(P.Events.LEVEL_LOADING,this.onLevelLoading,this),m.off(P.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),m.off(P.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),m.off(P.Events.ERROR,this.onError,this)},a.onMediaAttached=function(m,v){this.media=v.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},a.pollTrackChange=function(m){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,m)},a.onMediaDetaching=function(){if(!!this.media){self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId);var m=x(this.media.textTracks);m.forEach(function(v){(0,T.clearCurrentCues)(v)}),this.subtitleTrack=-1,this.media=null}},a.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},a.onManifestParsed=function(m,v){this.tracks=v.subtitleTracks},a.onSubtitleTrackLoaded=function(m,v){var i=v.id,n=v.details,E=this.trackId,r=this.tracksInGroup[E];if(!r){this.warn("Invalid subtitle track id "+i);return}var o=r.details;r.details=v.details,this.log("subtitle track "+i+" loaded ["+n.startSN+"-"+n.endSN+"]"),i===this.trackId&&(this.retryCount=0,this.playlistLoaded(i,v,o))},a.onLevelLoading=function(m,v){this.switchLevel(v.level)},a.onLevelSwitching=function(m,v){this.switchLevel(v.level)},a.switchLevel=function(m){var v=this.hls.levels[m];if(!!(v!=null&&v.textGroupIds)){var i=v.textGroupIds[v.urlId];if(this.groupId!==i){var n=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,E=this.tracks.filter(function(t){return!i||t.groupId===i});this.tracksInGroup=E;var r=this.findTrackId(n==null?void 0:n.name)||this.findTrackId();this.groupId=i;var o={subtitleTracks:E};this.log("Updating subtitle tracks, "+E.length+' track(s) found in "'+i+'" group-id'),this.hls.trigger(P.Events.SUBTITLE_TRACKS_UPDATED,o),r!==-1&&this.setSubtitleTrack(r,n)}}},a.findTrackId=function(m){for(var v=this.tracksInGroup,i=0;i<v.length;i++){var n=v[i];if((!this.selectDefaultTrack||n.default)&&(!m||m===n.name))return n.id}return-1},a.onError=function(m,v){l.prototype.onError.call(this,m,v),!(v.fatal||!v.context)&&v.context.type===C.PlaylistContextType.SUBTITLE_TRACK&&v.context.id===this.trackId&&v.context.groupId===this.groupId&&this.retryLoadingOrFail(v)},a.loadPlaylist=function(m){l.prototype.loadPlaylist.call(this);var v=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(v)){var i=v.id,n=v.groupId,E=v.url;if(m)try{E=m.addDirectives(E)}catch(r){this.warn("Could not construct new URL with HLS Delivery Directives: "+r)}this.log("Loading subtitle playlist for id "+i),this.hls.trigger(P.Events.SUBTITLE_TRACK_LOADING,{url:E,id:i,groupId:n,deliveryDirectives:m||null})}},a.toggleTrackModes=function(m){var v=this,i=this.media,n=this.trackId;if(!!i){var E=x(i.textTracks),r=E.filter(function(f){return f.groupId===v.groupId});if(m===-1)[].slice.call(E).forEach(function(f){f.mode="disabled"});else{var o=r[n];o&&(o.mode="disabled")}var t=r[m];t&&(t.mode=this.subtitleDisplay?"showing":"hidden")}},a.setSubtitleTrack=function(m,v){var i,n=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=m;return}if(this.trackId!==m&&this.toggleTrackModes(m),!(this.trackId===m&&(m===-1||(i=n[m])!==null&&i!==void 0&&i.details)||m<-1||m>=n.length)){this.clearTimer();var E=n[m];if(this.log("Switching to subtitle track "+m),this.trackId=m,E){var r=E.id,o=E.groupId,t=o===void 0?"":o,f=E.name,e=E.type,h=E.url;this.hls.trigger(P.Events.SUBTITLE_TRACK_SWITCH,{id:r,groupId:t,name:f,type:e,url:h});var d=this.switchParams(E.url,v==null?void 0:v.details);this.loadPlaylist(d)}else this.hls.trigger(P.Events.SUBTITLE_TRACK_SWITCH,{id:m})}},a.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!(!this.media||!this.hls.config.renderTextTracksNatively)){for(var m=-1,v=x(this.media.textTracks),i=0;i<v.length;i++)if(v[i].mode==="hidden")m=i;else if(v[i].mode==="showing"){m=i;break}this.subtitleTrack!==m&&(this.subtitleTrack=m)}},I(u,[{key:"subtitleDisplay",get:function(){return this._subtitleDisplay},set:function(m){this._subtitleDisplay=m,this.trackId>-1&&this.toggleTrackModes(this.trackId)}},{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(m){this.selectDefaultTrack=!1;var v=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(m,v)}}]),u}(k.default);function x(l){for(var u=[],a=0;a<l.length;a++){var s=l[a];s.kind==="subtitles"&&s.label&&u.push(l[a])}return u}const y=g},"./src/controller/timeline-controller.ts":(W,O,p)=>{p.r(O),p.d(O,{TimelineController:()=>g});var P=p("./src/polyfills/number.ts"),T=p("./src/events.ts"),k=p("./src/utils/cea-608-parser.ts"),C=p("./src/utils/output-filter.ts"),B=p("./src/utils/webvtt-parser.ts"),I=p("./src/utils/texttrack-utils.ts"),A=p("./src/utils/imsc1-ttml-parser.ts"),b=p("./src/utils/mp4-tools.ts"),_=p("./src/types/loader.ts"),S=p("./src/utils/logger.ts"),g=function(){function u(s){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=l(),this.captionsProperties=void 0,this.hls=s,this.config=s.config,this.Cues=s.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var m=new C.default(this,"textTrack1"),v=new C.default(this,"textTrack2"),i=new C.default(this,"textTrack3"),n=new C.default(this,"textTrack4");this.cea608Parser1=new k.default(1,m,v),this.cea608Parser2=new k.default(3,i,n)}s.on(T.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),s.on(T.Events.MEDIA_DETACHING,this.onMediaDetaching,this),s.on(T.Events.MANIFEST_LOADING,this.onManifestLoading,this),s.on(T.Events.MANIFEST_LOADED,this.onManifestLoaded,this),s.on(T.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),s.on(T.Events.FRAG_LOADING,this.onFragLoading,this),s.on(T.Events.FRAG_LOADED,this.onFragLoaded,this),s.on(T.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),s.on(T.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),s.on(T.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),s.on(T.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),s.on(T.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var a=u.prototype;return a.destroy=function(){var m=this.hls;m.off(T.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),m.off(T.Events.MEDIA_DETACHING,this.onMediaDetaching,this),m.off(T.Events.MANIFEST_LOADING,this.onManifestLoading,this),m.off(T.Events.MANIFEST_LOADED,this.onManifestLoaded,this),m.off(T.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),m.off(T.Events.FRAG_LOADING,this.onFragLoading,this),m.off(T.Events.FRAG_LOADED,this.onFragLoaded,this),m.off(T.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),m.off(T.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),m.off(T.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),m.off(T.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),m.off(T.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},a.addCues=function(m,v,i,n,E){for(var r=!1,o=E.length;o--;){var t=E[o],f=y(t[0],t[1],v,i);if(f>=0&&(t[0]=Math.min(t[0],v),t[1]=Math.max(t[1],i),r=!0,f/(i-v)>.5))return}if(r||E.push([v,i]),this.config.renderTextTracksNatively){var e=this.captionsTracks[m];this.Cues.newCue(e,v,i,n)}else{var h=this.Cues.newCue(null,v,i,n);this.hls.trigger(T.Events.CUES_PARSED,{type:"captions",cues:h,track:m})}},a.onInitPtsFound=function(m,v){var i=this,n=v.frag,E=v.id,r=v.initPTS,o=v.timescale,t=this.unparsedVttFrags;E==="main"&&(this.initPTS[n.cc]=r,this.timescale[n.cc]=o),t.length&&(this.unparsedVttFrags=[],t.forEach(function(f){i.onFragLoaded(T.Events.FRAG_LOADED,f)}))},a.getExistingTrack=function(m){var v=this.media;if(v)for(var i=0;i<v.textTracks.length;i++){var n=v.textTracks[i];if(n[m])return n}return null},a.createCaptionsTrack=function(m){this.config.renderTextTracksNatively?this.createNativeTrack(m):this.createNonNativeTrack(m)},a.createNativeTrack=function(m){if(!this.captionsTracks[m]){var v=this.captionsProperties,i=this.captionsTracks,n=this.media,E=v[m],r=E.label,o=E.languageCode,t=this.getExistingTrack(m);if(t)i[m]=t,(0,I.clearCurrentCues)(i[m]),(0,I.sendAddTrackEvent)(i[m],n);else{var f=this.createTextTrack("captions",r,o);f&&(f[m]=!0,i[m]=f)}}},a.createNonNativeTrack=function(m){if(!this.nonNativeCaptionsTracks[m]){var v=this.captionsProperties[m];if(!!v){var i=v.label,n={_id:m,label:i,kind:"captions",default:v.media?!!v.media.default:!1,closedCaptions:v.media};this.nonNativeCaptionsTracks[m]=n,this.hls.trigger(T.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[n]})}}},a.createTextTrack=function(m,v,i){var n=this.media;if(!!n)return n.addTextTrack(m,v,i)},a.onMediaAttaching=function(m,v){this.media=v.media,this._cleanTracks()},a.onMediaDetaching=function(){var m=this.captionsTracks;Object.keys(m).forEach(function(v){(0,I.clearCurrentCues)(m[v]),delete m[v]}),this.nonNativeCaptionsTracks={}},a.onManifestLoading=function(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=l(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},a._cleanTracks=function(){var m=this.media;if(!!m){var v=m.textTracks;if(v)for(var i=0;i<v.length;i++)(0,I.clearCurrentCues)(v[i])}},a.onSubtitleTracksUpdated=function(m,v){var i=this;this.textTracks=[];var n=v.subtitleTracks||[],E=n.some(function(f){return f.textCodec===A.IMSC1_CODEC});if(this.config.enableWebVTT||E&&this.config.enableIMSC1){var r=this.tracks&&n&&this.tracks.length===n.length;if(this.tracks=n||[],this.config.renderTextTracksNatively){var o=this.media?this.media.textTracks:[];this.tracks.forEach(function(f,e){var h;if(e<o.length){for(var d=null,c=0;c<o.length;c++)if(x(o[c],f)){d=o[c];break}d&&(h=d)}if(h)(0,I.clearCurrentCues)(h);else{var M=i._captionsOrSubtitlesFromCharacteristics(f);h=i.createTextTrack(M,f.name,f.lang),h&&(h.mode="disabled")}h&&(h.groupId=f.groupId,i.textTracks.push(h))})}else if(!r&&this.tracks&&this.tracks.length){var t=this.tracks.map(function(f){return{label:f.name,kind:f.type.toLowerCase(),default:f.default,subtitleTrack:f}});this.hls.trigger(T.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:t})}}},a._captionsOrSubtitlesFromCharacteristics=function(m){var v;if((v=m.attrs)!==null&&v!==void 0&&v.CHARACTERISTICS){var i=/transcribes-spoken-dialog/gi.test(m.attrs.CHARACTERISTICS),n=/describes-music-and-sound/gi.test(m.attrs.CHARACTERISTICS);if(i&&n)return"captions"}return"subtitles"},a.onManifestLoaded=function(m,v){var i=this;this.config.enableCEA708Captions&&v.captions&&v.captions.forEach(function(n){var E=/(?:CC|SERVICE)([1-4])/.exec(n.instreamId);if(!!E){var r="textTrack"+E[1],o=i.captionsProperties[r];!o||(o.label=n.name,n.lang&&(o.languageCode=n.lang),o.media=n)}})},a.closedCaptionsForLevel=function(m){var v=this.hls.levels[m.level];return v==null?void 0:v.attrs["CLOSED-CAPTIONS"]},a.onFragLoading=function(m,v){var i=this.cea608Parser1,n=this.cea608Parser2,E=this.lastSn,r=this.lastPartIndex;if(!(!this.enabled||!(i&&n))&&v.frag.type===_.PlaylistLevelType.MAIN){var o,t,f=v.frag.sn,e=(o=v==null||(t=v.part)===null||t===void 0?void 0:t.index)!=null?o:-1;f===E+1||f===E&&e===r+1||(i.reset(),n.reset()),this.lastSn=f,this.lastPartIndex=e}},a.onFragLoaded=function(m,v){var i=v.frag,n=v.payload,E=this.initPTS,r=this.unparsedVttFrags;if(i.type===_.PlaylistLevelType.SUBTITLE)if(n.byteLength){if(!(0,P.isFiniteNumber)(E[i.cc])){r.push(v),E.length&&this.hls.trigger(T.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:new Error("Missing initial subtitle PTS")});return}var o=i.decryptdata,t="stats"in v;if(o==null||!o.encrypted||t){var f=this.tracks[i.level],e=this.vttCCs;e[i.cc]||(e[i.cc]={start:i.start,prevCC:this.prevCC,new:!0},this.prevCC=i.cc),f&&f.textCodec===A.IMSC1_CODEC?this._parseIMSC1(i,n):this._parseVTTs(i,n,e)}}else this.hls.trigger(T.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:new Error("Empty subtitle payload")})},a._parseIMSC1=function(m,v){var i=this,n=this.hls;(0,A.parseIMSC1)(v,this.initPTS[m.cc],this.timescale[m.cc],function(E){i._appendCues(E,m.level),n.trigger(T.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:m})},function(E){S.logger.log("Failed to parse IMSC1: "+E),n.trigger(T.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:m,error:E})})},a._parseVTTs=function(m,v,i){var n,E=this,r=this.hls,o=(n=m.initSegment)!==null&&n!==void 0&&n.data?(0,b.appendUint8Array)(m.initSegment.data,new Uint8Array(v)):v;(0,B.parseWebVTT)(o,this.initPTS[m.cc],this.timescale[m.cc],i,m.cc,m.start,function(t){E._appendCues(t,m.level),r.trigger(T.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:m})},function(t){E._fallbackToIMSC1(m,v),S.logger.log("Failed to parse VTT cue: "+t),r.trigger(T.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:m,error:t})})},a._fallbackToIMSC1=function(m,v){var i=this,n=this.tracks[m.level];n.textCodec||(0,A.parseIMSC1)(v,this.initPTS[m.cc],this.timescale[m.cc],function(){n.textCodec=A.IMSC1_CODEC,i._parseIMSC1(m,v)},function(){n.textCodec="wvtt"})},a._appendCues=function(m,v){var i=this.hls;if(this.config.renderTextTracksNatively){var n=this.textTracks[v];if(!n||n.mode==="disabled")return;m.forEach(function(o){return(0,I.addCueToTrack)(n,o)})}else{var E=this.tracks[v];if(!E)return;var r=E.default?"default":"subtitles"+v;i.trigger(T.Events.CUES_PARSED,{type:"subtitles",cues:m,track:r})}},a.onFragDecrypted=function(m,v){var i=v.frag;if(i.type===_.PlaylistLevelType.SUBTITLE){if(!(0,P.isFiniteNumber)(this.initPTS[i.cc])){this.unparsedVttFrags.push(v);return}this.onFragLoaded(T.Events.FRAG_LOADED,v)}},a.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},a.onFragParsingUserdata=function(m,v){var i=this.cea608Parser1,n=this.cea608Parser2;if(!(!this.enabled||!(i&&n))){var E=v.frag,r=v.samples;if(!(E.type===_.PlaylistLevelType.MAIN&&this.closedCaptionsForLevel(E)==="NONE"))for(var o=0;o<r.length;o++){var t=r[o].bytes;if(t){var f=this.extractCea608Data(t);i.addData(r[o].pts,f[0]),n.addData(r[o].pts,f[1])}}}},a.onBufferFlushing=function(m,v){var i=v.startOffset,n=v.endOffset,E=v.endOffsetSubtitles,r=v.type,o=this.media;if(!(!o||o.currentTime<n)){if(!r||r==="video"){var t=this.captionsTracks;Object.keys(t).forEach(function(e){return(0,I.removeCuesInRange)(t[e],i,n)})}if(this.config.renderTextTracksNatively&&i===0&&E!==void 0){var f=this.textTracks;Object.keys(f).forEach(function(e){return(0,I.removeCuesInRange)(f[e],i,E)})}}},a.extractCea608Data=function(m){for(var v=[[],[]],i=m[0]&31,n=2,E=0;E<i;E++){var r=m[n++],o=127&m[n++],t=127&m[n++];if(!(o===0&&t===0)){var f=(4&r)!==0;if(f){var e=3&r;(e===0||e===1)&&(v[e].push(o),v[e].push(t))}}}return v},u}();function x(u,a){return u&&u.label===a.name&&!(u.textTrack1||u.textTrack2)}function y(u,a,s,m){return Math.min(a,m)-Math.max(u,s)}function l(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}},"./src/crypt/aes-crypto.ts":(W,O,p)=>{p.r(O),p.d(O,{default:()=>P});var P=function(){function T(C,B){this.subtle=void 0,this.aesIV=void 0,this.subtle=C,this.aesIV=B}var k=T.prototype;return k.decrypt=function(B,I){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},I,B)},T}()},"./src/crypt/aes-decryptor.ts":(W,O,p)=>{p.r(O),p.d(O,{default:()=>k,removePadding:()=>T});var P=p("./src/utils/typed-array.ts");function T(C){var B=C.byteLength,I=B&&new DataView(C.buffer).getUint8(B-1);return I?(0,P.sliceUint8)(C,0,B-I):C}var k=function(){function C(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var B=C.prototype;return B.uint8ArrayToUint32Array_=function(A){for(var b=new DataView(A),_=new Uint32Array(4),S=0;S<4;S++)_[S]=b.getUint32(S*4);return _},B.initTable=function(){var A=this.sBox,b=this.invSBox,_=this.subMix,S=_[0],g=_[1],x=_[2],y=_[3],l=this.invSubMix,u=l[0],a=l[1],s=l[2],m=l[3],v=new Uint32Array(256),i=0,n=0,E=0;for(E=0;E<256;E++)E<128?v[E]=E<<1:v[E]=E<<1^283;for(E=0;E<256;E++){var r=n^n<<1^n<<2^n<<3^n<<4;r=r>>>8^r&255^99,A[i]=r,b[r]=i;var o=v[i],t=v[o],f=v[t],e=v[r]*257^r*16843008;S[i]=e<<24|e>>>8,g[i]=e<<16|e>>>16,x[i]=e<<8|e>>>24,y[i]=e,e=f*16843009^t*65537^o*257^i*16843008,u[r]=e<<24|e>>>8,a[r]=e<<16|e>>>16,s[r]=e<<8|e>>>24,m[r]=e,i?(i=o^v[v[v[f^o]]],n^=v[v[n]]):i=n=1}},B.expandKey=function(A){for(var b=this.uint8ArrayToUint32Array_(A),_=!0,S=0;S<b.length&&_;)_=b[S]===this.key[S],S++;if(!_){this.key=b;var g=this.keySize=b.length;if(g!==4&&g!==6&&g!==8)throw new Error("Invalid aes key size="+g);var x=this.ksRows=(g+6+1)*4,y,l,u=this.keySchedule=new Uint32Array(x),a=this.invKeySchedule=new Uint32Array(x),s=this.sBox,m=this.rcon,v=this.invSubMix,i=v[0],n=v[1],E=v[2],r=v[3],o,t;for(y=0;y<x;y++){if(y<g){o=u[y]=b[y];continue}t=o,y%g===0?(t=t<<8|t>>>24,t=s[t>>>24]<<24|s[t>>>16&255]<<16|s[t>>>8&255]<<8|s[t&255],t^=m[y/g|0]<<24):g>6&&y%g===4&&(t=s[t>>>24]<<24|s[t>>>16&255]<<16|s[t>>>8&255]<<8|s[t&255]),u[y]=o=(u[y-g]^t)>>>0}for(l=0;l<x;l++)y=x-l,l&3?t=u[y]:t=u[y-4],l<4||y<=4?a[l]=t:a[l]=i[s[t>>>24]]^n[s[t>>>16&255]]^E[s[t>>>8&255]]^r[s[t&255]],a[l]=a[l]>>>0}},B.networkToHostOrderSwap=function(A){return A<<24|(A&65280)<<8|(A&16711680)>>8|A>>>24},B.decrypt=function(A,b,_){for(var S=this.keySize+6,g=this.invKeySchedule,x=this.invSBox,y=this.invSubMix,l=y[0],u=y[1],a=y[2],s=y[3],m=this.uint8ArrayToUint32Array_(_),v=m[0],i=m[1],n=m[2],E=m[3],r=new Int32Array(A),o=new Int32Array(r.length),t,f,e,h,d,c,M,F,w,U,N,z,V,j,Y=this.networkToHostOrderSwap;b<r.length;){for(w=Y(r[b]),U=Y(r[b+1]),N=Y(r[b+2]),z=Y(r[b+3]),d=w^g[0],c=z^g[1],M=N^g[2],F=U^g[3],V=4,j=1;j<S;j++)t=l[d>>>24]^u[c>>16&255]^a[M>>8&255]^s[F&255]^g[V],f=l[c>>>24]^u[M>>16&255]^a[F>>8&255]^s[d&255]^g[V+1],e=l[M>>>24]^u[F>>16&255]^a[d>>8&255]^s[c&255]^g[V+2],h=l[F>>>24]^u[d>>16&255]^a[c>>8&255]^s[M&255]^g[V+3],d=t,c=f,M=e,F=h,V=V+4;t=x[d>>>24]<<24^x[c>>16&255]<<16^x[M>>8&255]<<8^x[F&255]^g[V],f=x[c>>>24]<<24^x[M>>16&255]<<16^x[F>>8&255]<<8^x[d&255]^g[V+1],e=x[M>>>24]<<24^x[F>>16&255]<<16^x[d>>8&255]<<8^x[c&255]^g[V+2],h=x[F>>>24]<<24^x[d>>16&255]<<16^x[c>>8&255]<<8^x[M&255]^g[V+3],o[b]=Y(t^v),o[b+1]=Y(h^i),o[b+2]=Y(e^n),o[b+3]=Y(f^E),v=w,i=U,n=N,E=z,b=b+4}return o.buffer},C}()},"./src/crypt/decrypter.ts":(W,O,p)=>{p.r(O),p.d(O,{default:()=>b});var P=p("./src/crypt/aes-crypto.ts"),T=p("./src/crypt/fast-aes-key.ts"),k=p("./src/crypt/aes-decryptor.ts"),C=p("./src/utils/logger.ts"),B=p("./src/utils/mp4-tools.ts"),I=p("./src/utils/typed-array.ts"),A=16,b=function(){function _(g,x){var y=x===void 0?{}:x,l=y.removePKCS7Padding,u=l===void 0?!0:l;if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=g.enableSoftwareAES,this.removePKCS7Padding=u,u)try{var a=self.crypto;a&&(this.subtle=a.subtle||a.webkitSubtle)}catch{}this.subtle===null&&(this.useSoftware=!0)}var S=_.prototype;return S.destroy=function(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null},S.isSync=function(){return this.useSoftware},S.flush=function(){var x=this.currentResult,y=this.remainderData;if(!x||y)return this.reset(),null;var l=new Uint8Array(x);return this.reset(),this.removePKCS7Padding?(0,k.removePadding)(l):l},S.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},S.decrypt=function(x,y,l){var u=this;return this.useSoftware?new Promise(function(a,s){u.softwareDecrypt(new Uint8Array(x),y,l);var m=u.flush();m?a(m.buffer):s(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(x),y,l)},S.softwareDecrypt=function(x,y,l){var u=this.currentIV,a=this.currentResult,s=this.remainderData;this.logOnce("JS AES decrypt"),s&&(x=(0,B.appendUint8Array)(s,x),this.remainderData=null);var m=this.getValidChunk(x);if(!m.length)return null;u&&(l=u);var v=this.softwareDecrypter;v||(v=this.softwareDecrypter=new k.default),v.expandKey(y);var i=a;return this.currentResult=v.decrypt(m.buffer,0,l),this.currentIV=(0,I.sliceUint8)(m,-16).buffer,i||null},S.webCryptoDecrypt=function(x,y,l){var u=this,a=this.subtle;return(this.key!==y||!this.fastAesKey)&&(this.key=y,this.fastAesKey=new T.default(a,y)),this.fastAesKey.expandKey().then(function(s){if(!a)return Promise.reject(new Error("web crypto not initialized"));u.logOnce("WebCrypto AES decrypt");var m=new P.default(a,new Uint8Array(l));return m.decrypt(x.buffer,s)}).catch(function(s){return C.logger.warn("[decrypter]: WebCrypto Error, disable WebCrypto API, "+s.name+": "+s.message),u.onWebCryptoError(x,y,l)})},S.onWebCryptoError=function(x,y,l){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(x,y,l);var u=this.flush();if(u)return u.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")},S.getValidChunk=function(x){var y=x,l=x.length-x.length%A;return l!==x.length&&(y=(0,I.sliceUint8)(x,0,l),this.remainderData=(0,I.sliceUint8)(x,l)),y},S.logOnce=function(x){!this.logEnabled||(C.logger.log("[decrypter]: "+x),this.logEnabled=!1)},_}()},"./src/crypt/fast-aes-key.ts":(W,O,p)=>{p.r(O),p.d(O,{default:()=>P});var P=function(){function T(C,B){this.subtle=void 0,this.key=void 0,this.subtle=C,this.key=B}var k=T.prototype;return k.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},T}()},"./src/demux/aacdemuxer.ts":(W,O,p)=>{p.r(O),p.d(O,{default:()=>b});var P=p("./src/demux/base-audio-demuxer.ts"),T=p("./src/demux/adts.ts"),k=p("./src/utils/logger.ts"),C=p("./src/demux/id3.ts");function B(_,S){_.prototype=Object.create(S.prototype),_.prototype.constructor=_,I(_,S)}function I(_,S){return I=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(x,y){return x.__proto__=y,x},I(_,S)}var A=function(_){B(S,_);function S(x,y){var l;return l=_.call(this)||this,l.observer=void 0,l.config=void 0,l.observer=x,l.config=y,l}var g=S.prototype;return g.resetInitSegment=function(y,l,u,a){_.prototype.resetInitSegment.call(this,y,l,u,a),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:l,duration:a,inputTimeScale:9e4,dropped:0}},S.probe=function(y){if(!y)return!1;for(var l=C.getID3Data(y,0)||[],u=l.length,a=y.length;u<a;u++)if(T.probe(y,u))return k.logger.log("ADTS sync word found !"),!0;return!1},g.canParse=function(y,l){return T.canParse(y,l)},g.appendFrame=function(y,l,u){T.initTrackConfig(y,this.observer,l,u,y.manifestCodec);var a=T.appendFrame(y,l,u,this.basePTS,this.frameIndex);if(a&&a.missing===0)return a},S}(P.default);const b=A},"./src/demux/adts.ts":(W,O,p)=>{p.r(O),p.d(O,{appendFrame:()=>u,canGetFrameLength:()=>b,canParse:()=>S,getAudioConfig:()=>C,getFrameDuration:()=>y,getFullFrameLength:()=>A,getHeaderLength:()=>I,initTrackConfig:()=>x,isHeader:()=>_,isHeaderPattern:()=>B,parseFrameHeader:()=>l,probe:()=>g});var P=p("./src/utils/logger.ts"),T=p("./src/errors.ts"),k=p("./src/events.ts");function C(a,s,m,v){var i,n,E,r,o=navigator.userAgent.toLowerCase(),t=v,f=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];i=((s[m+2]&192)>>>6)+1;var e=(s[m+2]&60)>>>2;if(e>f.length-1){a.trigger(k.Events.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+e});return}return E=(s[m+2]&1)<<2,E|=(s[m+3]&192)>>>6,P.logger.log("manifest codec:"+v+", ADTS type:"+i+", samplingIndex:"+e),/firefox/i.test(o)?e>=6?(i=5,r=new Array(4),n=e-3):(i=2,r=new Array(2),n=e):o.indexOf("android")!==-1?(i=2,r=new Array(2),n=e):(i=5,r=new Array(4),v&&(v.indexOf("mp4a.40.29")!==-1||v.indexOf("mp4a.40.5")!==-1)||!v&&e>=6?n=e-3:((v&&v.indexOf("mp4a.40.2")!==-1&&(e>=6&&E===1||/vivaldi/i.test(o))||!v&&E===1)&&(i=2,r=new Array(2)),n=e)),r[0]=i<<3,r[0]|=(e&14)>>1,r[1]|=(e&1)<<7,r[1]|=E<<3,i===5&&(r[1]|=(n&14)>>1,r[2]=(n&1)<<7,r[2]|=8,r[3]=0),{config:r,samplerate:f[e],channelCount:E,codec:"mp4a.40."+i,manifestCodec:t}}function B(a,s){return a[s]===255&&(a[s+1]&246)===240}function I(a,s){return a[s+1]&1?7:9}function A(a,s){return(a[s+3]&3)<<11|a[s+4]<<3|(a[s+5]&224)>>>5}function b(a,s){return s+5<a.length}function _(a,s){return s+1<a.length&&B(a,s)}function S(a,s){return b(a,s)&&B(a,s)&&A(a,s)<=a.length-s}function g(a,s){if(_(a,s)){var m=I(a,s);if(s+m>=a.length)return!1;var v=A(a,s);if(v<=m)return!1;var i=s+v;return i===a.length||_(a,i)}return!1}function x(a,s,m,v,i){if(!a.samplerate){var n=C(s,m,v,i);if(!n)return;a.config=n.config,a.samplerate=n.samplerate,a.channelCount=n.channelCount,a.codec=n.codec,a.manifestCodec=n.manifestCodec,P.logger.log("parsed codec:"+a.codec+", rate:"+n.samplerate+", channels:"+n.channelCount)}}function y(a){return 9216e4/a}function l(a,s){var m=I(a,s);if(s+m<=a.length){var v=A(a,s)-m;if(v>0)return{headerLength:m,frameLength:v}}}function u(a,s,m,v,i){var n=y(a.samplerate),E=v+i*n,r=l(s,m),o;if(r){var t=r.frameLength,f=r.headerLength,e=f+t,h=Math.max(0,m+e-s.length);h?(o=new Uint8Array(e-f),o.set(s.subarray(m+f,s.length),0)):o=s.subarray(m+f,m+e);var d={unit:o,pts:E};return h||a.samples.push(d),{sample:d,length:e,missing:h}}var c=s.length-m;o=new Uint8Array(c),o.set(s.subarray(m,s.length),0);var M={unit:o,pts:E};return{sample:M,length:c,missing:-1}}},"./src/demux/base-audio-demuxer.ts":(W,O,p)=>{p.r(O),p.d(O,{default:()=>_,initPTSFn:()=>b});var P=p("./src/polyfills/number.ts"),T=p("./src/demux/id3.ts"),k=p("./src/types/demuxer.ts"),C=p("./src/demux/dummy-demuxed-track.ts"),B=p("./src/utils/mp4-tools.ts"),I=p("./src/utils/typed-array.ts"),A=function(){function S(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}var g=S.prototype;return g.resetInitSegment=function(y,l,u,a){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},g.resetTimeStamp=function(y){this.initPTS=y,this.resetContiguity()},g.resetContiguity=function(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0},g.canParse=function(y,l){return!1},g.appendFrame=function(y,l,u){},g.demux=function(y,l){this.cachedData&&(y=(0,B.appendUint8Array)(this.cachedData,y),this.cachedData=null);var u=T.getID3Data(y,0),a=u?u.length:0,s,m=this._audioTrack,v=this._id3Track,i=u?T.getTimeStamp(u):void 0,n=y.length;for((this.basePTS===null||this.frameIndex===0&&(0,P.isFiniteNumber)(i))&&(this.basePTS=b(i,l,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),u&&u.length>0&&v.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:u,type:k.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});a<n;){if(this.canParse(y,a)){var E=this.appendFrame(m,y,a);E?(this.frameIndex++,this.lastPTS=E.sample.pts,a+=E.length,s=a):a=n}else T.canParse(y,a)?(u=T.getID3Data(y,a),v.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:u,type:k.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY}),a+=u.length,s=a):a++;if(a===n&&s!==n){var r=(0,I.sliceUint8)(y,s);this.cachedData?this.cachedData=(0,B.appendUint8Array)(this.cachedData,r):this.cachedData=r}}return{audioTrack:m,videoTrack:(0,C.dummyTrack)(),id3Track:v,textTrack:(0,C.dummyTrack)()}},g.demuxSampleAes=function(y,l,u){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},g.flush=function(y){var l=this.cachedData;return l&&(this.cachedData=null,this.demux(l,0)),{audioTrack:this._audioTrack,videoTrack:(0,C.dummyTrack)(),id3Track:this._id3Track,textTrack:(0,C.dummyTrack)()}},g.destroy=function(){},S}(),b=function(g,x,y){return(0,P.isFiniteNumber)(g)?g*90:x*9e4+(y||0)};const _=A},"./src/demux/chunk-cache.ts":(W,O,p)=>{p.r(O),p.d(O,{default:()=>P});var P=function(){function k(){this.chunks=[],this.dataLength=0}var C=k.prototype;return C.push=function(I){this.chunks.push(I),this.dataLength+=I.length},C.flush=function(){var I=this.chunks,A=this.dataLength,b;if(I.length)I.length===1?b=I[0]:b=T(I,A);else return new Uint8Array(0);return this.reset(),b},C.reset=function(){this.chunks.length=0,this.dataLength=0},k}();function T(k,C){for(var B=new Uint8Array(C),I=0,A=0;A<k.length;A++){var b=k[A];B.set(b,I),I+=b.length}return B}},"./src/demux/dummy-demuxed-track.ts":(W,O,p)=>{p.r(O),p.d(O,{dummyTrack:()=>P});function P(T,k){return T===void 0&&(T=""),k===void 0&&(k=9e4),{type:T,id:-1,pid:-1,inputTimeScale:k,sequenceNumber:-1,samples:[],dropped:0}}},"./src/demux/exp-golomb.ts":(W,O,p)=>{p.r(O),p.d(O,{default:()=>k});var P=p("./src/utils/logger.ts"),T=function(){function C(I){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=I,this.bytesAvailable=I.byteLength,this.word=0,this.bitsAvailable=0}var B=C.prototype;return B.loadWord=function(){var A=this.data,b=this.bytesAvailable,_=A.byteLength-b,S=new Uint8Array(4),g=Math.min(4,b);if(g===0)throw new Error("no bytes available");S.set(A.subarray(_,_+g)),this.word=new DataView(S.buffer).getUint32(0),this.bitsAvailable=g*8,this.bytesAvailable-=g},B.skipBits=function(A){var b;A=Math.min(A,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>A?(this.word<<=A,this.bitsAvailable-=A):(A-=this.bitsAvailable,b=A>>3,A-=b<<3,this.bytesAvailable-=b,this.loadWord(),this.word<<=A,this.bitsAvailable-=A)},B.readBits=function(A){var b=Math.min(this.bitsAvailable,A),_=this.word>>>32-b;if(A>32&&P.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=b,this.bitsAvailable>0)this.word<<=b;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return b=A-b,b>0&&this.bitsAvailable?_<<b|this.readBits(b):_},B.skipLZ=function(){var A;for(A=0;A<this.bitsAvailable;++A)if((this.word&2147483648>>>A)!==0)return this.word<<=A,this.bitsAvailable-=A,A;return this.loadWord(),A+this.skipLZ()},B.skipUEG=function(){this.skipBits(1+this.skipLZ())},B.skipEG=function(){this.skipBits(1+this.skipLZ())},B.readUEG=function(){var A=this.skipLZ();return this.readBits(A+1)-1},B.readEG=function(){var A=this.readUEG();return 1&A?1+A>>>1:-1*(A>>>1)},B.readBoolean=function(){return this.readBits(1)===1},B.readUByte=function(){return this.readBits(8)},B.readUShort=function(){return this.readBits(16)},B.readUInt=function(){return this.readBits(32)},B.skipScalingList=function(A){for(var b=8,_=8,S,g=0;g<A;g++)_!==0&&(S=this.readEG(),_=(b+S+256)%256),b=_===0?b:_},B.readSPS=function(){var A=0,b=0,_=0,S=0,g,x,y,l=this.readUByte.bind(this),u=this.readBits.bind(this),a=this.readUEG.bind(this),s=this.readBoolean.bind(this),m=this.skipBits.bind(this),v=this.skipEG.bind(this),i=this.skipUEG.bind(this),n=this.skipScalingList.bind(this);l();var E=l();if(u(5),m(3),l(),i(),E===100||E===110||E===122||E===244||E===44||E===83||E===86||E===118||E===128){var r=a();if(r===3&&m(1),i(),i(),m(1),s())for(x=r!==3?8:12,y=0;y<x;y++)s()&&(y<6?n(16):n(64))}i();var o=a();if(o===0)a();else if(o===1)for(m(1),v(),v(),g=a(),y=0;y<g;y++)v();i(),m(1);var t=a(),f=a(),e=u(1);e===0&&m(1),m(1),s()&&(A=a(),b=a(),_=a(),S=a());var h=[1,1];if(s()&&s()){var d=l();switch(d){case 1:h=[1,1];break;case 2:h=[12,11];break;case 3:h=[10,11];break;case 4:h=[16,11];break;case 5:h=[40,33];break;case 6:h=[24,11];break;case 7:h=[20,11];break;case 8:h=[32,11];break;case 9:h=[80,33];break;case 10:h=[18,11];break;case 11:h=[15,11];break;case 12:h=[64,33];break;case 13:h=[160,99];break;case 14:h=[4,3];break;case 15:h=[3,2];break;case 16:h=[2,1];break;case 255:{h=[l()<<8|l(),l()<<8|l()];break}}}return{width:Math.ceil((t+1)*16-A*2-b*2),height:(2-e)*(f+1)*16-(e?2:4)*(_+S),pixelRatio:h}},B.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},C}();const k=T},"./src/demux/id3.ts":(W,O,p)=>{p.r(O),p.d(O,{canParse:()=>B,decodeFrame:()=>S,getID3Data:()=>k,getID3Frames:()=>_,getTimeStamp:()=>I,isFooter:()=>T,isHeader:()=>P,isTimeStampFrame:()=>A,testables:()=>a,utf8ArrayToStr:()=>u});var P=function(i,n){return n+10<=i.length&&i[n]===73&&i[n+1]===68&&i[n+2]===51&&i[n+3]<255&&i[n+4]<255&&i[n+6]<128&&i[n+7]<128&&i[n+8]<128&&i[n+9]<128},T=function(i,n){return n+10<=i.length&&i[n]===51&&i[n+1]===68&&i[n+2]===73&&i[n+3]<255&&i[n+4]<255&&i[n+6]<128&&i[n+7]<128&&i[n+8]<128&&i[n+9]<128},k=function(i,n){for(var E=n,r=0;P(i,n);){r+=10;var o=C(i,n+6);r+=o,T(i,n+10)&&(r+=10),n+=r}if(r>0)return i.subarray(E,E+r)},C=function(i,n){var E=0;return E=(i[n]&127)<<21,E|=(i[n+1]&127)<<14,E|=(i[n+2]&127)<<7,E|=i[n+3]&127,E},B=function(i,n){return P(i,n)&&C(i,n+6)+10<=i.length-n},I=function(i){for(var n=_(i),E=0;E<n.length;E++){var r=n[E];if(A(r))return l(r)}},A=function(i){return i&&i.key==="PRIV"&&i.info==="com.apple.streaming.transportStreamTimestamp"},b=function(i){var n=String.fromCharCode(i[0],i[1],i[2],i[3]),E=C(i,4),r=10;return{type:n,size:E,data:i.subarray(r,r+E)}},_=function(i){for(var n=0,E=[];P(i,n);){var r=C(i,n+6);n+=10;for(var o=n+r;n+8<o;){var t=b(i.subarray(n)),f=S(t);f&&E.push(f),n+=t.size+10}T(i,n)&&(n+=10)}return E},S=function(i){return i.type==="PRIV"?g(i):i.type[0]==="W"?y(i):x(i)},g=function(i){if(!(i.size<2)){var n=u(i.data,!0),E=new Uint8Array(i.data.subarray(n.length+1));return{key:i.type,info:n,data:E.buffer}}},x=function(i){if(!(i.size<2)){if(i.type==="TXXX"){var n=1,E=u(i.data.subarray(n),!0);n+=E.length+1;var r=u(i.data.subarray(n));return{key:i.type,info:E,data:r}}var o=u(i.data.subarray(1));return{key:i.type,data:o}}},y=function(i){if(i.type==="WXXX"){if(i.size<2)return;var n=1,E=u(i.data.subarray(n),!0);n+=E.length+1;var r=u(i.data.subarray(n));return{key:i.type,info:E,data:r}}var o=u(i.data);return{key:i.type,data:o}},l=function(i){if(i.data.byteLength===8){var n=new Uint8Array(i.data),E=n[3]&1,r=(n[4]<<23)+(n[5]<<15)+(n[6]<<7)+n[7];return r/=45,E&&(r+=4772185884e-2),Math.round(r)}},u=function(i,n){n===void 0&&(n=!1);var E=m();if(E){var r=E.decode(i);if(n){var o=r.indexOf("\0");return o!==-1?r.substring(0,o):r}return r.replace(/\0/g,"")}for(var t=i.length,f,e,h,d="",c=0;c<t;){if(f=i[c++],f===0&&n)return d;if(f===0||f===3)continue;switch(f>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:d+=String.fromCharCode(f);break;case 12:case 13:e=i[c++],d+=String.fromCharCode((f&31)<<6|e&63);break;case 14:e=i[c++],h=i[c++],d+=String.fromCharCode((f&15)<<12|(e&63)<<6|(h&63)<<0);break}}return d},a={decodeTextFrame:x},s;function m(){return!s&&typeof self.TextDecoder<"u"&&(s=new self.TextDecoder("utf-8")),s}},"./src/demux/mp3demuxer.ts":(W,O,p)=>{p.r(O),p.d(O,{default:()=>b});var P=p("./src/demux/base-audio-demuxer.ts"),T=p("./src/demux/id3.ts"),k=p("./src/utils/logger.ts"),C=p("./src/demux/mpegaudio.ts");function B(_,S){_.prototype=Object.create(S.prototype),_.prototype.constructor=_,I(_,S)}function I(_,S){return I=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(x,y){return x.__proto__=y,x},I(_,S)}var A=function(_){B(S,_);function S(){return _.apply(this,arguments)||this}var g=S.prototype;return g.resetInitSegment=function(y,l,u,a){_.prototype.resetInitSegment.call(this,y,l,u,a),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:l,duration:a,inputTimeScale:9e4,dropped:0}},S.probe=function(y){if(!y)return!1;for(var l=T.getID3Data(y,0)||[],u=l.length,a=y.length;u<a;u++)if(C.probe(y,u))return k.logger.log("MPEG Audio sync word found !"),!0;return!1},g.canParse=function(y,l){return C.canParse(y,l)},g.appendFrame=function(y,l,u){if(this.basePTS!==null)return C.appendFrame(y,l,u,this.basePTS,this.frameIndex)},S}(P.default);const b=A},"./src/demux/mp4demuxer.ts":(W,O,p)=>{p.r(O),p.d(O,{default:()=>A});var P=p("./src/polyfills/number.ts"),T=p("./src/types/demuxer.ts"),k=p("./src/utils/mp4-tools.ts"),C=p("./src/demux/dummy-demuxed-track.ts"),B=/\/emsg[-/]ID3/i,I=function(){function b(S,g){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=g}var _=b.prototype;return _.resetTimeStamp=function(){},_.resetInitSegment=function(g,x,y,l){var u=this.videoTrack=(0,C.dummyTrack)("video",1),a=this.audioTrack=(0,C.dummyTrack)("audio",1),s=this.txtTrack=(0,C.dummyTrack)("text",1);if(this.id3Track=(0,C.dummyTrack)("id3",1),this.timeOffset=0,!(!g||!g.byteLength)){var m=(0,k.parseInitSegment)(g);if(m.video){var v=m.video,i=v.id,n=v.timescale,E=v.codec;u.id=i,u.timescale=s.timescale=n,u.codec=E}if(m.audio){var r=m.audio,o=r.id,t=r.timescale,f=r.codec;a.id=o,a.timescale=t,a.codec=f}s.id=k.RemuxerTrackIdConfig.text,u.sampleDuration=0,u.duration=a.duration=l}},_.resetContiguity=function(){},b.probe=function(g){return g=g.length>16384?g.subarray(0,16384):g,(0,k.findBox)(g,["moof"]).length>0},_.demux=function(g,x){this.timeOffset=x;var y=g,l=this.videoTrack,u=this.txtTrack;if(this.config.progressive){this.remainderData&&(y=(0,k.appendUint8Array)(this.remainderData,g));var a=(0,k.segmentValidRange)(y);this.remainderData=a.remainder,l.samples=a.valid||new Uint8Array}else l.samples=y;var s=this.extractID3Track(l,x);return u.samples=(0,k.parseSamples)(x,l),{videoTrack:l,audioTrack:this.audioTrack,id3Track:s,textTrack:this.txtTrack}},_.flush=function(){var g=this.timeOffset,x=this.videoTrack,y=this.txtTrack;x.samples=this.remainderData||new Uint8Array,this.remainderData=null;var l=this.extractID3Track(x,this.timeOffset);return y.samples=(0,k.parseSamples)(g,x),{videoTrack:x,audioTrack:(0,C.dummyTrack)(),id3Track:l,textTrack:(0,C.dummyTrack)()}},_.extractID3Track=function(g,x){var y=this.id3Track;if(g.samples.length){var l=(0,k.findBox)(g.samples,["emsg"]);l&&l.forEach(function(u){var a=(0,k.parseEmsg)(u);if(B.test(a.schemeIdUri)){var s=(0,P.isFiniteNumber)(a.presentationTime)?a.presentationTime/a.timeScale:x+a.presentationTimeDelta/a.timeScale,m=a.eventDuration===4294967295?Number.POSITIVE_INFINITY:a.eventDuration/a.timeScale;m<=.001&&(m=Number.POSITIVE_INFINITY);var v=a.payload;y.samples.push({data:v,len:v.byteLength,dts:s,pts:s,type:T.MetadataSchema.emsg,duration:m})}})}return y},_.demuxSampleAes=function(g,x,y){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},_.destroy=function(){},b}();const A=I},"./src/demux/mpegaudio.ts":(W,O,p)=>{p.r(O),p.d(O,{appendFrame:()=>I,canParse:()=>S,isHeader:()=>_,isHeaderPattern:()=>b,parseHeader:()=>A,probe:()=>g});var P=null,T=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],k=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],C=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],B=[0,1,1,4];function I(x,y,l,u,a){if(!(l+24>y.length)){var s=A(y,l);if(s&&l+s.frameLength<=y.length){var m=s.samplesPerFrame*9e4/s.sampleRate,v=u+a*m,i={unit:y.subarray(l,l+s.frameLength),pts:v,dts:v};return x.config=[],x.channelCount=s.channelCount,x.samplerate=s.sampleRate,x.samples.push(i),{sample:i,length:s.frameLength,missing:0}}}}function A(x,y){var l=x[y+1]>>3&3,u=x[y+1]>>1&3,a=x[y+2]>>4&15,s=x[y+2]>>2&3;if(l!==1&&a!==0&&a!==15&&s!==3){var m=x[y+2]>>1&1,v=x[y+3]>>6,i=l===3?3-u:u===3?3:4,n=T[i*14+a-1]*1e3,E=l===3?0:l===2?1:2,r=k[E*3+s],o=v===3?1:2,t=C[l][u],f=B[u],e=t*8*f,h=Math.floor(t*n/r+m)*f;if(P===null){var d=navigator.userAgent||"",c=d.match(/Chrome\/(\d+)/i);P=c?parseInt(c[1]):0}var M=!!P&&P<=87;return M&&u===2&&n>=224e3&&v===0&&(x[y+3]=x[y+3]|128),{sampleRate:r,channelCount:o,frameLength:h,samplesPerFrame:e}}}function b(x,y){return x[y]===255&&(x[y+1]&224)===224&&(x[y+1]&6)!==0}function _(x,y){return y+1<x.length&&b(x,y)}function S(x,y){var l=4;return b(x,y)&&l<=x.length-y}function g(x,y){if(y+1<x.length&&b(x,y)){var l=4,u=A(x,y),a=l;u!=null&&u.frameLength&&(a=u.frameLength);var s=y+a;return s===x.length||_(x,s)}return!1}},"./src/demux/sample-aes.ts":(W,O,p)=>{p.r(O),p.d(O,{default:()=>C});var P=p("./src/crypt/decrypter.ts"),T=p("./src/utils/mp4-tools.ts"),k=function(){function B(A,b,_){this.keyData=void 0,this.decrypter=void 0,this.keyData=_,this.decrypter=new P.default(b,{removePKCS7Padding:!1})}var I=B.prototype;return I.decryptBuffer=function(b){return this.decrypter.decrypt(b,this.keyData.key.buffer,this.keyData.iv.buffer)},I.decryptAacSample=function(b,_,S){var g=this,x=b[_].unit;if(!(x.length<=16)){var y=x.subarray(16,x.length-x.length%16),l=y.buffer.slice(y.byteOffset,y.byteOffset+y.length);this.decryptBuffer(l).then(function(u){var a=new Uint8Array(u);x.set(a,16),g.decrypter.isSync()||g.decryptAacSamples(b,_+1,S)})}},I.decryptAacSamples=function(b,_,S){for(;;_++){if(_>=b.length){S();return}if(!(b[_].unit.length<32)&&(this.decryptAacSample(b,_,S),!this.decrypter.isSync()))return}},I.getAvcEncryptedData=function(b){for(var _=Math.floor((b.length-48)/160)*16+16,S=new Int8Array(_),g=0,x=32;x<b.length-16;x+=160,g+=16)S.set(b.subarray(x,x+16),g);return S},I.getAvcDecryptedUnit=function(b,_){for(var S=new Uint8Array(_),g=0,x=32;x<b.length-16;x+=160,g+=16)b.set(S.subarray(g,g+16),x);return b},I.decryptAvcSample=function(b,_,S,g,x){var y=this,l=(0,T.discardEPB)(x.data),u=this.getAvcEncryptedData(l);this.decryptBuffer(u.buffer).then(function(a){x.data=y.getAvcDecryptedUnit(l,a),y.decrypter.isSync()||y.decryptAvcSamples(b,_,S+1,g)})},I.decryptAvcSamples=function(b,_,S,g){if(b instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;_++,S=0){if(_>=b.length){g();return}for(var x=b[_].units;!(S>=x.length);S++){var y=x[S];if(!(y.data.length<=48||y.type!==1&&y.type!==5)&&(this.decryptAvcSample(b,_,S,g,y),!this.decrypter.isSync()))return}}},B}();const C=k},"./src/demux/transmuxer-interface.ts":(W,O,p)=>{p.r(O),p.d(O,{default:()=>_});var P=p("./src/demux/webworkify-webpack.js"),T=p("./src/events.ts"),k=p("./src/demux/transmuxer.ts"),C=p("./src/utils/logger.ts"),B=p("./src/errors.ts"),I=p("./src/utils/mediasource-helper.ts"),A=p("./node_modules/eventemitter3/index.js"),b=(0,I.getMediaSource)()||{isTypeSupported:function(){return!1}},_=function(){function S(x,y,l,u){var a=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;var s=x.config;this.hls=x,this.id=y,this.useWorker=!!s.enableWorker,this.onTransmuxComplete=l,this.onFlush=u;var m=function(r,o){o=o||{},o.frag=a.frag,o.id=a.id,a.hls.trigger(r,o)};this.observer=new A.EventEmitter,this.observer.on(T.Events.FRAG_DECRYPTED,m),this.observer.on(T.Events.ERROR,m);var v={mp4:b.isTypeSupported("video/mp4"),mpeg:b.isTypeSupported("audio/mpeg"),mp3:b.isTypeSupported('audio/mp4; codecs="mp3"')},i=navigator.vendor;if(this.useWorker&&typeof Worker<"u"){C.logger.log("demuxing in webworker");var n;try{n=this.worker=(0,P.default)("./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),n.addEventListener("message",this.onwmsg),n.onerror=function(E){a.useWorker=!1,C.logger.warn("Exception in webworker, fallback to inline"),a.hls.trigger(T.Events.ERROR,{type:B.ErrorTypes.OTHER_ERROR,details:B.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:new Error(E.message+"  ("+E.filename+":"+E.lineno+")")})},n.postMessage({cmd:"init",typeSupported:v,vendor:i,id:y,config:JSON.stringify(s)})}catch(E){C.logger.warn("Error in worker:",E),C.logger.error("Error while initializing DemuxerWorker, fallback to inline"),n&&self.URL.revokeObjectURL(n.objectURL),this.transmuxer=new k.default(this.observer,v,s,i,y),this.worker=null}}else this.transmuxer=new k.default(this.observer,v,s,i,y)}var g=S.prototype;return g.destroy=function(){var y=this.worker;if(y)y.removeEventListener("message",this.onwmsg),y.terminate(),this.worker=null,this.onwmsg=void 0;else{var l=this.transmuxer;l&&(l.destroy(),this.transmuxer=null)}var u=this.observer;u&&u.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null},g.push=function(y,l,u,a,s,m,v,i,n,E){var r,o,t=this;n.transmuxing.start=self.performance.now();var f=this.transmuxer,e=this.worker,h=m?m.start:s.start,d=s.decryptdata,c=this.frag,M=!(c&&s.cc===c.cc),F=!(c&&n.level===c.level),w=c?n.sn-c.sn:-1,U=this.part?n.part-this.part.index:-1,N=w===0&&n.id>1&&n.id===(c==null?void 0:c.stats.chunkCount),z=!F&&(w===1||w===0&&(U===1||N&&U<=0)),V=self.performance.now();(F||w||s.stats.parsing.start===0)&&(s.stats.parsing.start=V),m&&(U||!z)&&(m.stats.parsing.start=V);var j=!(c&&((r=s.initSegment)===null||r===void 0?void 0:r.url)===((o=c.initSegment)===null||o===void 0?void 0:o.url)),Y=new k.TransmuxState(M,z,i,F,h,j);if(!z||M||j){C.logger.log("[transmuxer-interface, "+s.type+"]: Starting new transmux session for sn: "+n.sn+" p: "+n.part+" level: "+n.level+" id: "+n.id+`
        discontinuity: `+M+`
        trackSwitch: `+F+`
        contiguous: `+z+`
        accurateTimeOffset: `+i+`
        timeOffset: `+h+`
        initSegmentChange: `+j);var X=new k.TransmuxConfig(u,a,l,v,E);this.configureTransmuxer(X)}if(this.frag=s,this.part=m,e)e.postMessage({cmd:"demux",data:y,decryptdata:d,chunkMeta:n,state:Y},y instanceof ArrayBuffer?[y]:[]);else if(f){var Q=f.push(y,d,n,Y);(0,k.isPromise)(Q)?(f.async=!0,Q.then(function(te){t.handleTransmuxComplete(te)}).catch(function(te){t.transmuxerError(te,n,"transmuxer-interface push error")})):(f.async=!1,this.handleTransmuxComplete(Q))}},g.flush=function(y){var l=this;y.transmuxing.start=self.performance.now();var u=this.transmuxer,a=this.worker;if(a)a.postMessage({cmd:"flush",chunkMeta:y});else if(u){var s=u.flush(y),m=(0,k.isPromise)(s);m||u.async?((0,k.isPromise)(s)||(s=Promise.resolve(s)),s.then(function(v){l.handleFlushResult(v,y)}).catch(function(v){l.transmuxerError(v,y,"transmuxer-interface flush error")})):this.handleFlushResult(s,y)}},g.transmuxerError=function(y,l,u){!this.hls||this.hls.trigger(T.Events.ERROR,{type:B.ErrorTypes.MEDIA_ERROR,details:B.ErrorDetails.FRAG_PARSING_ERROR,chunkMeta:l,fatal:!1,error:y,err:y,reason:u})},g.handleFlushResult=function(y,l){var u=this;y.forEach(function(a){u.handleTransmuxComplete(a)}),this.onFlush(l)},g.onWorkerMessage=function(y){var l=y.data,u=this.hls;switch(l.event){case"init":{self.URL.revokeObjectURL(this.worker.objectURL);break}case"transmuxComplete":{this.handleTransmuxComplete(l.data);break}case"flush":{this.onFlush(l.data);break}case"workerLog":C.logger[l.data.logType]&&C.logger[l.data.logType](l.data.message);break;default:{l.data=l.data||{},l.data.frag=this.frag,l.data.id=this.id,u.trigger(l.event,l.data);break}}},g.configureTransmuxer=function(y){var l=this.worker,u=this.transmuxer;l?l.postMessage({cmd:"configure",config:y}):u&&u.configure(y)},g.handleTransmuxComplete=function(y){y.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(y)},S}()},"./src/demux/transmuxer-worker.ts":(W,O,p)=>{p.r(O),p.d(O,{default:()=>I});var P=p("./src/demux/transmuxer.ts"),T=p("./src/events.ts"),k=p("./src/utils/logger.ts"),C=p("./node_modules/eventemitter3/index.js"),B=p("./src/errors.ts");function I(g){var x=new C.EventEmitter,y=function(a,s){g.postMessage({event:a,data:s})};x.on(T.Events.FRAG_DECRYPTED,y),x.on(T.Events.ERROR,y);var l=function(){var a=function(v){var i=function(E){y("workerLog",{logType:v,message:E})};k.logger[v]=i};for(var s in k.logger)a(s)};g.addEventListener("message",function(u){var a=u.data;switch(a.cmd){case"init":{var s=JSON.parse(a.config);g.transmuxer=new P.default(x,a.typeSupported,s,a.vendor,a.id),(0,k.enableLogs)(s.debug,a.id),l(),y("init",null);break}case"configure":{g.transmuxer.configure(a.config);break}case"demux":{var m=g.transmuxer.push(a.data,a.decryptdata,a.chunkMeta,a.state);(0,P.isPromise)(m)?(g.transmuxer.async=!0,m.then(function(E){A(g,E)}).catch(function(E){y(T.Events.ERROR,{type:B.ErrorTypes.MEDIA_ERROR,details:B.ErrorDetails.FRAG_PARSING_ERROR,chunkMeta:a.chunkMeta,fatal:!1,error:E,err:E,reason:"transmuxer-worker push error"})})):(g.transmuxer.async=!1,A(g,m));break}case"flush":{var v=a.chunkMeta,i=g.transmuxer.flush(v),n=(0,P.isPromise)(i);n||g.transmuxer.async?((0,P.isPromise)(i)||(i=Promise.resolve(i)),i.then(function(E){_(g,E,v)}).catch(function(E){y(T.Events.ERROR,{type:B.ErrorTypes.MEDIA_ERROR,details:B.ErrorDetails.FRAG_PARSING_ERROR,chunkMeta:a.chunkMeta,fatal:!1,error:E,err:E,reason:"transmuxer-worker flush error"})})):_(g,i,v);break}}})}function A(g,x){if(S(x.remuxResult))return!1;var y=[],l=x.remuxResult,u=l.audio,a=l.video;return u&&b(y,u),a&&b(y,a),g.postMessage({event:"transmuxComplete",data:x},y),!0}function b(g,x){x.data1&&g.push(x.data1.buffer),x.data2&&g.push(x.data2.buffer)}function _(g,x,y){var l=x.reduce(function(u,a){return A(g,a)||u},!1);l||g.postMessage({event:"transmuxComplete",data:x[0]}),g.postMessage({event:"flush",data:y})}function S(g){return!g.audio&&!g.video&&!g.text&&!g.id3&&!g.initSegment}},"./src/demux/transmuxer.ts":(W,O,p)=>{p.r(O),p.d(O,{TransmuxConfig:()=>s,TransmuxState:()=>m,default:()=>y,isPromise:()=>a});var P=p("./src/events.ts"),T=p("./src/errors.ts"),k=p("./src/crypt/decrypter.ts"),C=p("./src/demux/aacdemuxer.ts"),B=p("./src/demux/mp4demuxer.ts"),I=p("./src/demux/tsdemuxer.ts"),A=p("./src/demux/mp3demuxer.ts"),b=p("./src/remux/mp4-remuxer.ts"),_=p("./src/remux/passthrough-remuxer.ts"),S=p("./src/utils/logger.ts"),g;try{g=self.performance.now.bind(self.performance)}catch{S.logger.debug("Unable to use Performance API on this environment"),g=self.Date.now}var x=[{demux:B.default,remux:_.default},{demux:I.default,remux:b.default},{demux:C.default,remux:b.default},{demux:A.default,remux:b.default}],y=function(){function v(n,E,r,o,t){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=n,this.typeSupported=E,this.config=r,this.vendor=o,this.id=t}var i=v.prototype;return i.configure=function(E){this.transmuxConfig=E,this.decrypter&&this.decrypter.reset()},i.push=function(E,r,o,t){var f=this,e=o.transmuxing;e.executeStart=g();var h=new Uint8Array(E),d=this.currentTransmuxState,c=this.transmuxConfig;t&&(this.currentTransmuxState=t);var M=t||d,F=M.contiguous,w=M.discontinuity,U=M.trackSwitch,N=M.accurateTimeOffset,z=M.timeOffset,V=M.initSegmentChange,j=c.audioCodec,Y=c.videoCodec,X=c.defaultInitPts,Q=c.duration,te=c.initSegmentData,$=l(h,r);if($&&$.method==="AES-128"){var ee=this.getDecrypter();if(ee.isSync()){var ne=ee.softwareDecrypt(h,$.key.buffer,$.iv.buffer),oe=o.part>-1;if(oe&&(ne=ee.flush()),!ne)return e.executeEnd=g(),u(o);h=new Uint8Array(ne)}else return this.decryptionPromise=ee.webCryptoDecrypt(h,$.key.buffer,$.iv.buffer).then(function(me){var pe=f.push(me,null,o);return f.decryptionPromise=null,pe}),this.decryptionPromise}var ae=this.needsProbing(w,U);ae&&this.configureTransmuxer(h),(w||U||V||ae)&&this.resetInitSegment(te,j,Y,Q,r),(w||V||ae)&&this.resetInitialTimestamp(X),F||this.resetContiguity();var ie=this.transmux(h,$,z,N,o),ce=this.currentTransmuxState;return ce.contiguous=!0,ce.discontinuity=!1,ce.trackSwitch=!1,e.executeEnd=g(),ie},i.flush=function(E){var r=this,o=E.transmuxing;o.executeStart=g();var t=this.decrypter,f=this.currentTransmuxState,e=this.decryptionPromise;if(e)return e.then(function(){return r.flush(E)});var h=[],d=f.timeOffset;if(t){var c=t.flush();c&&h.push(this.push(c,null,E))}var M=this.demuxer,F=this.remuxer;if(!M||!F)return this.observer.emit(P.Events.ERROR,P.Events.ERROR,{type:T.ErrorTypes.MEDIA_ERROR,details:T.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),o.executeEnd=g(),[u(E)];var w=M.flush(d);return a(w)?w.then(function(U){return r.flushRemux(h,U,E),h}):(this.flushRemux(h,w,E),h)},i.flushRemux=function(E,r,o){var t=r.audioTrack,f=r.videoTrack,e=r.id3Track,h=r.textTrack,d=this.currentTransmuxState,c=d.accurateTimeOffset,M=d.timeOffset;S.logger.log("[transmuxer.ts]: Flushed fragment "+o.sn+(o.part>-1?" p: "+o.part:"")+" of level "+o.level);var F=this.remuxer.remux(t,f,e,h,M,c,!0,this.id);E.push({remuxResult:F,chunkMeta:o}),o.transmuxing.executeEnd=g()},i.resetInitialTimestamp=function(E){var r=this.demuxer,o=this.remuxer;!r||!o||(r.resetTimeStamp(E),o.resetTimeStamp(E))},i.resetContiguity=function(){var E=this.demuxer,r=this.remuxer;!E||!r||(E.resetContiguity(),r.resetNextTimestamp())},i.resetInitSegment=function(E,r,o,t,f){var e=this.demuxer,h=this.remuxer;!e||!h||(e.resetInitSegment(E,r,o,t),h.resetInitSegment(E,r,o,f))},i.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},i.transmux=function(E,r,o,t,f){var e;return r&&r.method==="SAMPLE-AES"?e=this.transmuxSampleAes(E,r,o,t,f):e=this.transmuxUnencrypted(E,o,t,f),e},i.transmuxUnencrypted=function(E,r,o,t){var f=this.demuxer.demux(E,r,!1,!this.config.progressive),e=f.audioTrack,h=f.videoTrack,d=f.id3Track,c=f.textTrack,M=this.remuxer.remux(e,h,d,c,r,o,!1,this.id);return{remuxResult:M,chunkMeta:t}},i.transmuxSampleAes=function(E,r,o,t,f){var e=this;return this.demuxer.demuxSampleAes(E,r,o).then(function(h){var d=e.remuxer.remux(h.audioTrack,h.videoTrack,h.id3Track,h.textTrack,o,t,!1,e.id);return{remuxResult:d,chunkMeta:f}})},i.configureTransmuxer=function(E){for(var r=this.config,o=this.observer,t=this.typeSupported,f=this.vendor,e,h=0,d=x.length;h<d;h++)if(x[h].demux.probe(E)){e=x[h];break}e||(S.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),e={demux:B.default,remux:_.default});var c=this.demuxer,M=this.remuxer,F=e.remux,w=e.demux;(!M||!(M instanceof F))&&(this.remuxer=new F(o,r,t,f)),(!c||!(c instanceof w))&&(this.demuxer=new w(o,r,t),this.probe=w.probe)},i.needsProbing=function(E,r){return!this.demuxer||!this.remuxer||E||r},i.getDecrypter=function(){var E=this.decrypter;return E||(E=this.decrypter=new k.default(this.config)),E},v}();function l(v,i){var n=null;return v.byteLength>0&&i!=null&&i.key!=null&&i.iv!==null&&i.method!=null&&(n=i),n}var u=function(i){return{remuxResult:{},chunkMeta:i}};function a(v){return"then"in v&&v.then instanceof Function}var s=function(i,n,E,r,o){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=i,this.videoCodec=n,this.initSegmentData=E,this.duration=r,this.defaultInitPts=o},m=function(i,n,E,r,o,t){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=i,this.contiguous=n,this.accurateTimeOffset=E,this.trackSwitch=r,this.timeOffset=o,this.initSegmentChange=t}},"./src/demux/tsdemuxer.ts":(W,O,p)=>{p.r(O),p.d(O,{default:()=>v});var P=p("./src/demux/adts.ts"),T=p("./src/demux/mpegaudio.ts"),k=p("./src/demux/exp-golomb.ts"),C=p("./src/demux/sample-aes.ts"),B=p("./src/events.ts"),I=p("./src/utils/mp4-tools.ts"),A=p("./src/utils/logger.ts"),b=p("./src/errors.ts"),_=p("./src/types/demuxer.ts");function S(){return S=Object.assign?Object.assign.bind():function(i){for(var n=1;n<arguments.length;n++){var E=arguments[n];for(var r in E)Object.prototype.hasOwnProperty.call(E,r)&&(i[r]=E[r])}return i},S.apply(this,arguments)}var g=188,x=function(){function i(E,r,o){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=E,this.config=r,this.typeSupported=o}i.probe=function(r){var o=i.syncOffset(r);return o>0&&A.logger.warn("MPEG2-TS detected but first sync word found @ offset "+o),o!==-1},i.syncOffset=function(r){for(var o=Math.min(g*5,r.length-g)+1,t=0;t<o;){for(var f=!1,e=0;e<o&&r[e]===71;e+=g)if(!f&&l(r,e)===0&&(f=!0),f&&e+g>o)return t;t++}return-1},i.createTrack=function(r,o){return{container:r==="video"||r==="audio"?"video/mp2t":void 0,type:r,id:I.RemuxerTrackIdConfig[r],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:r==="audio"?o:void 0}};var n=i.prototype;return n.resetInitSegment=function(r,o,t,f){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=i.createTrack("video"),this._audioTrack=i.createTrack("audio",f),this._id3Track=i.createTrack("id3"),this._txtTrack=i.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=o,this.videoCodec=t,this._duration=f},n.resetTimeStamp=function(){},n.resetContiguity=function(){var r=this._audioTrack,o=this._avcTrack,t=this._id3Track;r&&(r.pesData=null),o&&(o.pesData=null),t&&(t.pesData=null),this.aacOverFlow=null,this.avcSample=null,this.remainderData=null},n.demux=function(r,o,t,f){t===void 0&&(t=!1),f===void 0&&(f=!1),t||(this.sampleAes=null);var e,h=this._avcTrack,d=this._audioTrack,c=this._id3Track,M=this._txtTrack,F=h.pid,w=h.pesData,U=d.pid,N=c.pid,z=d.pesData,V=c.pesData,j=null,Y=this.pmtParsed,X=this._pmtId,Q=r.length;if(this.remainderData&&(r=(0,I.appendUint8Array)(this.remainderData,r),Q=r.length,this.remainderData=null),Q<g&&!f)return this.remainderData=r,{audioTrack:d,videoTrack:h,id3Track:c,textTrack:M};var te=Math.max(0,i.syncOffset(r));Q-=(Q-te)%g,Q<r.byteLength&&!f&&(this.remainderData=new Uint8Array(r.buffer,Q,r.buffer.byteLength-Q));for(var $=0,ee=te;ee<Q;ee+=g)if(r[ee]===71){var ne=!!(r[ee+1]&64),oe=l(r,ee),ae=(r[ee+3]&48)>>4,ie=void 0;if(ae>1){if(ie=ee+5+r[ee+4],ie===ee+g)continue}else ie=ee+4;switch(oe){case F:ne&&(w&&(e=s(w))&&this.parseAVCPES(h,M,e,!1),w={data:[],size:0}),w&&(w.data.push(r.subarray(ie,ee+g)),w.size+=ee+g-ie);break;case U:if(ne){if(z&&(e=s(z)))switch(d.segmentCodec){case"aac":this.parseAACPES(d,e);break;case"mp3":this.parseMPEGPES(d,e);break}z={data:[],size:0}}z&&(z.data.push(r.subarray(ie,ee+g)),z.size+=ee+g-ie);break;case N:ne&&(V&&(e=s(V))&&this.parseID3PES(c,e),V={data:[],size:0}),V&&(V.data.push(r.subarray(ie,ee+g)),V.size+=ee+g-ie);break;case 0:ne&&(ie+=r[ie]+1),X=this._pmtId=u(r,ie);break;case X:{ne&&(ie+=r[ie]+1);var ce=a(r,ie,this.typeSupported,t);F=ce.avc,F>0&&(h.pid=F),U=ce.audio,U>0&&(d.pid=U,d.segmentCodec=ce.segmentCodec),N=ce.id3,N>0&&(c.pid=N),j!==null&&!Y&&(A.logger.log("unknown PID '"+j+"' in TS found"),j=null,ee=te-188),Y=this.pmtParsed=!0;break}case 17:case 8191:break;default:j=oe;break}}else $++;$>0&&this.observer.emit(B.Events.ERROR,B.Events.ERROR,{type:b.ErrorTypes.MEDIA_ERROR,details:b.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"Found "+$+" TS packet/s that do not start with 0x47"}),h.pesData=w,d.pesData=z,c.pesData=V;var me={audioTrack:d,videoTrack:h,id3Track:c,textTrack:M};return f&&this.extractRemainingSamples(me),me},n.flush=function(){var r=this.remainderData;this.remainderData=null;var o;return r?o=this.demux(r,-1,!1,!0):o={videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(o),this.sampleAes?this.decrypt(o,this.sampleAes):o},n.extractRemainingSamples=function(r){var o=r.audioTrack,t=r.videoTrack,f=r.id3Track,e=r.textTrack,h=t.pesData,d=o.pesData,c=f.pesData,M;if(h&&(M=s(h))?(this.parseAVCPES(t,e,M,!0),t.pesData=null):t.pesData=h,d&&(M=s(d))){switch(o.segmentCodec){case"aac":this.parseAACPES(o,M);break;case"mp3":this.parseMPEGPES(o,M);break}o.pesData=null}else d!=null&&d.size&&A.logger.log("last AAC PES packet truncated,might overlap between fragments"),o.pesData=d;c&&(M=s(c))?(this.parseID3PES(f,M),f.pesData=null):f.pesData=c},n.demuxSampleAes=function(r,o,t){var f=this.demux(r,t,!0,!this.config.progressive),e=this.sampleAes=new C.default(this.observer,this.config,o);return this.decrypt(f,e)},n.decrypt=function(r,o){return new Promise(function(t){var f=r.audioTrack,e=r.videoTrack;f.samples&&f.segmentCodec==="aac"?o.decryptAacSamples(f.samples,0,function(){e.samples?o.decryptAvcSamples(e.samples,0,0,function(){t(r)}):t(r)}):e.samples&&o.decryptAvcSamples(e.samples,0,0,function(){t(r)})})},n.destroy=function(){this._duration=0},n.parseAVCPES=function(r,o,t,f){var e=this,h=this.parseAVCNALu(r,t.data),d=this.avcSample,c,M=!1;t.data=null,d&&h.length&&!r.audFound&&(m(d,r),d=this.avcSample=y(!1,t.pts,t.dts,"")),h.forEach(function(F){switch(F.type){case 1:{c=!0,d||(d=e.avcSample=y(!0,t.pts,t.dts,"")),d.frame=!0;var w=F.data;if(M&&w.length>4){var U=new k.default(w).readSliceType();(U===2||U===4||U===7||U===9)&&(d.key=!0)}break}case 5:c=!0,d||(d=e.avcSample=y(!0,t.pts,t.dts,"")),d.key=!0,d.frame=!0;break;case 6:{c=!0,(0,I.parseSEIMessageFromNALu)(F.data,1,t.pts,o.samples);break}case 7:if(c=!0,M=!0,!r.sps){var N=new k.default(F.data),z=N.readSPS();r.width=z.width,r.height=z.height,r.pixelRatio=z.pixelRatio,r.sps=[F.data],r.duration=e._duration;for(var V=F.data.subarray(1,4),j="avc1.",Y=0;Y<3;Y++){var X=V[Y].toString(16);X.length<2&&(X="0"+X),j+=X}r.codec=j}break;case 8:c=!0,r.pps||(r.pps=[F.data]);break;case 9:c=!1,r.audFound=!0,d&&m(d,r),d=e.avcSample=y(!1,t.pts,t.dts,"");break;case 12:c=!0;break;default:c=!1,d&&(d.debug+="unknown NAL "+F.type+" ");break}if(d&&c){var Q=d.units;Q.push(F)}}),f&&d&&(m(d,r),this.avcSample=null)},n.getLastNalUnit=function(r){var o,t=this.avcSample,f;if((!t||t.units.length===0)&&(t=r[r.length-1]),(o=t)!==null&&o!==void 0&&o.units){var e=t.units;f=e[e.length-1]}return f},n.parseAVCNALu=function(r,o){var t=o.byteLength,f=r.naluState||0,e=f,h=[],d=0,c,M,F,w=-1,U=0;for(f===-1&&(w=0,U=o[0]&31,f=0,d=1);d<t;){if(c=o[d++],!f){f=c?0:1;continue}if(f===1){f=c?0:2;continue}if(!c)f=3;else if(c===1){if(w>=0){var N={data:o.subarray(w,d-f-1),type:U};h.push(N)}else{var z=this.getLastNalUnit(r.samples);if(z&&(e&&d<=4-e&&z.state&&(z.data=z.data.subarray(0,z.data.byteLength-e)),M=d-f-1,M>0)){var V=new Uint8Array(z.data.byteLength+M);V.set(z.data,0),V.set(o.subarray(0,M),z.data.byteLength),z.data=V,z.state=0}}d<t?(F=o[d]&31,w=d,U=F,f=0):f=-1}else f=0}if(w>=0&&f>=0){var j={data:o.subarray(w,t),type:U,state:f};h.push(j)}if(h.length===0){var Y=this.getLastNalUnit(r.samples);if(Y){var X=new Uint8Array(Y.data.byteLength+o.byteLength);X.set(Y.data,0),X.set(o,Y.data.byteLength),Y.data=X}}return r.naluState=f,h},n.parseAACPES=function(r,o){var t=0,f=this.aacOverFlow,e=o.data;if(f){this.aacOverFlow=null;var h=f.missing,d=f.sample.unit.byteLength;if(h===-1){var c=new Uint8Array(d+e.byteLength);c.set(f.sample.unit,0),c.set(e,d),e=c}else{var M=d-h;f.sample.unit.set(e.subarray(0,h),M),r.samples.push(f.sample),t=f.missing}}var F,w;for(F=t,w=e.length;F<w-1&&!P.isHeader(e,F);F++);if(F!==t){var U,N;if(F<w-1?(U="AAC PES did not start with ADTS header,offset:"+F,N=!1):(U="no ADTS header found in AAC PES",N=!0),A.logger.warn("parsing error:"+U),this.observer.emit(B.Events.ERROR,B.Events.ERROR,{type:b.ErrorTypes.MEDIA_ERROR,details:b.ErrorDetails.FRAG_PARSING_ERROR,fatal:N,reason:U}),N)return}P.initTrackConfig(r,this.observer,e,F,this.audioCodec);var z;if(o.pts!==void 0)z=o.pts;else if(f){var V=P.getFrameDuration(r.samplerate);z=f.sample.pts+V}else{A.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}for(var j=0,Y;F<w;)if(Y=P.appendFrame(r,e,F,z,j),F+=Y.length,Y.missing){this.aacOverFlow=Y;break}else for(j++;F<w-1&&!P.isHeader(e,F);F++);},n.parseMPEGPES=function(r,o){var t=o.data,f=t.length,e=0,h=0,d=o.pts;if(d===void 0){A.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;h<f;)if(T.isHeader(t,h)){var c=T.appendFrame(r,t,h,d,e);if(c)h+=c.length,e++;else break}else h++},n.parseID3PES=function(r,o){if(o.pts===void 0){A.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}var t=S({},o,{type:this._avcTrack?_.MetadataSchema.emsg:_.MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});r.samples.push(t)},i}();function y(i,n,E,r){return{key:i,frame:!1,pts:n,dts:E,units:[],debug:r,length:0}}function l(i,n){return((i[n+1]&31)<<8)+i[n+2]}function u(i,n){return(i[n+10]&31)<<8|i[n+11]}function a(i,n,E,r){var o={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},t=(i[n+1]&15)<<8|i[n+2],f=n+3+t-4,e=(i[n+10]&15)<<8|i[n+11];for(n+=12+e;n<f;){var h=l(i,n);switch(i[n]){case 207:if(!r){A.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:o.audio===-1&&(o.audio=h);break;case 21:o.id3===-1&&(o.id3=h);break;case 219:if(!r){A.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:o.avc===-1&&(o.avc=h);break;case 3:case 4:E.mpeg!==!0&&E.mp3!==!0?A.logger.log("MPEG audio found, not supported in this browser"):o.audio===-1&&(o.audio=h,o.segmentCodec="mp3");break;case 36:A.logger.warn("Unsupported HEVC stream type found");break}n+=((i[n+3]&15)<<8|i[n+4])+5}return o}function s(i){var n=0,E,r,o,t,f,e=i.data;if(!i||i.size===0)return null;for(;e[0].length<19&&e.length>1;){var h=new Uint8Array(e[0].length+e[1].length);h.set(e[0]),h.set(e[1],e[0].length),e[0]=h,e.splice(1,1)}E=e[0];var d=(E[0]<<16)+(E[1]<<8)+E[2];if(d===1){if(r=(E[4]<<8)+E[5],r&&r>i.size-6)return null;var c=E[7];c&192&&(t=(E[9]&14)*536870912+(E[10]&255)*4194304+(E[11]&254)*16384+(E[12]&255)*128+(E[13]&254)/2,c&64?(f=(E[14]&14)*536870912+(E[15]&255)*4194304+(E[16]&254)*16384+(E[17]&255)*128+(E[18]&254)/2,t-f>54e5&&(A.logger.warn(Math.round((t-f)/9e4)+"s delta between PTS and DTS, align them"),t=f)):f=t),o=E[8];var M=o+9;if(i.size<=M)return null;i.size-=M;for(var F=new Uint8Array(i.size),w=0,U=e.length;w<U;w++){E=e[w];var N=E.byteLength;if(M)if(M>N){M-=N;continue}else E=E.subarray(M),N-=M,M=0;F.set(E,n),n+=N}return r&&(r-=o+3),{data:F,pts:t,dts:f,len:r}}return null}function m(i,n){if(i.units.length&&i.frame){if(i.pts===void 0){var E=n.samples,r=E.length;if(r){var o=E[r-1];i.pts=o.pts,i.dts=o.dts}else{n.dropped++;return}}n.samples.push(i)}i.debug.length&&A.logger.log(i.pts+"/"+i.dts+":"+i.debug)}const v=x},"./src/demux/webworkify-webpack.js":(W,O,p)=>{p.r(O),p.d(O,{default:()=>g});var P=function(){var y=ENTRY_MODULE,l={},u=function s(m){var v=l[m];if(v!==void 0)return v.exports;var i=l[m]={exports:{}};return y[m].call(i.exports,i,i.exports,s),i.exports};u.m=y,function(){u.n=function(s){var m=s&&s.__esModule?function(){return s.default}:function(){return s};return u.d(m,{a:m}),m}}(),function(){u.d=function(s,m){for(var v in m)u.o(m,v)&&!u.o(s,v)&&Object.defineProperty(s,v,{enumerable:!0,get:m[v]})}}(),function(){u.o=function(s,m){return Object.prototype.hasOwnProperty.call(s,m)}}(),function(){u.r=function(s){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(s,"__esModule",{value:!0})}}();var a=u(ENTRY_MODULE);return a.default||a},T=P.toString().split("ENTRY_MODULE"),k="[\\.|\\-|\\+|\\w|/|@]+",C="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+k+").*?\\)";function B(x){return(x+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function I(x){return!isNaN(1*x)}function A(x,y,l){var u={};u[l]=[];var a=y.toString().replace(/^"[^"]+"/,"function"),s=a.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/)||a.match(/^\(\w+,\s*\w+,\s*(\w+)\)\s?\=\s?\>/);if(!s)return u;for(var m=s[1],v=new RegExp("(\\\\n|\\W)"+B(m)+C,"g"),i;i=v.exec(a);)i[3]!=="dll-reference"&&u[l].push(i[3]);for(v=new RegExp("\\("+B(m)+'\\("(dll-reference\\s('+k+'))"\\)\\)'+C,"g");i=v.exec(a);)x[i[2]]||(u[l].push(i[1]),x[i[2]]=p(i[1]).m),u[i[2]]=u[i[2]]||[],u[i[2]].push(i[4]);for(var n=Object.keys(u),E=0;E<n.length;E++)for(var r=0;r<u[n[E]].length;r++)I(u[n[E]][r])&&(u[n[E]][r]=1*u[n[E]][r]);return u}function b(x){var y=Object.keys(x);return y.reduce(function(l,u){return l||x[u].length>0},!1)}function _(x,y){for(var l={main:[y]},u={main:[]},a={main:{}};b(l);)for(var s=Object.keys(l),m=0;m<s.length;m++){var v=s[m],i=l[v],n=i.pop();if(a[v]=a[v]||{},!(a[v][n]||!x[v][n])){a[v][n]=!0,u[v]=u[v]||[],u[v].push(n);for(var E=A(x,x[v][n],v),r=Object.keys(E),o=0;o<r.length;o++)l[r[o]]=l[r[o]]||[],l[r[o]]=l[r[o]].concat(E[r[o]])}}return u}function S(x,y,l,u){var a=x[u].map(function(s){return'"'+s+'": '+y[u][s].toString().replace(/^"[^"]+"/,"function")}).join(",");return T[0]+"{"+a+"}"+T[1]+'"'+l+'"'+T[2]}function g(x,y){y=y||{};var l={main:p.m},u=y.all?{main:Object.keys(l.main)}:_(l,x),a="";Object.keys(u).filter(function(n){return n!=="main"}).forEach(function(n){for(var E=0;u[n][E];)E++;u[n].push(E),l[n][E]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",a=a+("var "+n+" = ("+S(u,l,E,modules)+`)();
`)}),a=a+("new (("+S(u,l,x,"main")+")())(self);");var s=new window.Blob([a],{type:"text/javascript"}),m=window.URL||window.webkitURL||window.mozURL||window.msURL,v=m.createObjectURL(s),i=new window.Worker(v);return i.objectURL=v,i}},"./src/errors.ts":(W,O,p)=>{p.r(O),p.d(O,{ErrorDetails:()=>T,ErrorTypes:()=>P});var P;(function(k){k.NETWORK_ERROR="networkError",k.MEDIA_ERROR="mediaError",k.KEY_SYSTEM_ERROR="keySystemError",k.MUX_ERROR="muxError",k.OTHER_ERROR="otherError"})(P||(P={}));var T;(function(k){k.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",k.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",k.KEY_SYSTEM_NO_SESSION="keySystemNoSession",k.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",k.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",k.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",k.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",k.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",k.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",k.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",k.MANIFEST_LOAD_ERROR="manifestLoadError",k.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",k.MANIFEST_PARSING_ERROR="manifestParsingError",k.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",k.LEVEL_EMPTY_ERROR="levelEmptyError",k.LEVEL_LOAD_ERROR="levelLoadError",k.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",k.LEVEL_SWITCH_ERROR="levelSwitchError",k.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",k.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",k.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",k.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",k.FRAG_LOAD_ERROR="fragLoadError",k.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",k.FRAG_DECRYPT_ERROR="fragDecryptError",k.FRAG_PARSING_ERROR="fragParsingError",k.REMUX_ALLOC_ERROR="remuxAllocError",k.KEY_LOAD_ERROR="keyLoadError",k.KEY_LOAD_TIMEOUT="keyLoadTimeOut",k.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",k.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",k.BUFFER_APPEND_ERROR="bufferAppendError",k.BUFFER_APPENDING_ERROR="bufferAppendingError",k.BUFFER_STALLED_ERROR="bufferStalledError",k.BUFFER_FULL_ERROR="bufferFullError",k.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",k.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",k.INTERNAL_EXCEPTION="internalException",k.INTERNAL_ABORTED="aborted",k.UNKNOWN="unknown"})(T||(T={}))},"./src/events.ts":(W,O,p)=>{p.r(O),p.d(O,{Events:()=>P});var P;(function(T){T.MEDIA_ATTACHING="hlsMediaAttaching",T.MEDIA_ATTACHED="hlsMediaAttached",T.MEDIA_DETACHING="hlsMediaDetaching",T.MEDIA_DETACHED="hlsMediaDetached",T.BUFFER_RESET="hlsBufferReset",T.BUFFER_CODECS="hlsBufferCodecs",T.BUFFER_CREATED="hlsBufferCreated",T.BUFFER_APPENDING="hlsBufferAppending",T.BUFFER_APPENDED="hlsBufferAppended",T.BUFFER_EOS="hlsBufferEos",T.BUFFER_FLUSHING="hlsBufferFlushing",T.BUFFER_FLUSHED="hlsBufferFlushed",T.MANIFEST_LOADING="hlsManifestLoading",T.MANIFEST_LOADED="hlsManifestLoaded",T.MANIFEST_PARSED="hlsManifestParsed",T.LEVEL_SWITCHING="hlsLevelSwitching",T.LEVEL_SWITCHED="hlsLevelSwitched",T.LEVEL_LOADING="hlsLevelLoading",T.LEVEL_LOADED="hlsLevelLoaded",T.LEVEL_UPDATED="hlsLevelUpdated",T.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",T.LEVELS_UPDATED="hlsLevelsUpdated",T.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",T.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",T.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",T.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",T.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",T.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",T.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",T.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",T.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",T.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",T.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",T.CUES_PARSED="hlsCuesParsed",T.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",T.INIT_PTS_FOUND="hlsInitPtsFound",T.FRAG_LOADING="hlsFragLoading",T.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",T.FRAG_LOADED="hlsFragLoaded",T.FRAG_DECRYPTED="hlsFragDecrypted",T.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",T.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",T.FRAG_PARSING_METADATA="hlsFragParsingMetadata",T.FRAG_PARSED="hlsFragParsed",T.FRAG_BUFFERED="hlsFragBuffered",T.FRAG_CHANGED="hlsFragChanged",T.FPS_DROP="hlsFpsDrop",T.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",T.ERROR="hlsError",T.DESTROYING="hlsDestroying",T.KEY_LOADING="hlsKeyLoading",T.KEY_LOADED="hlsKeyLoaded",T.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",T.BACK_BUFFER_REACHED="hlsBackBufferReached"})(P||(P={}))},"./src/hls.ts":(W,O,p)=>{p.r(O),p.d(O,{default:()=>i});var P=p("./node_modules/url-toolkit/src/url-toolkit.js"),T=p("./src/loader/playlist-loader.ts"),k=p("./src/controller/id3-track-controller.ts"),C=p("./src/controller/latency-controller.ts"),B=p("./src/controller/level-controller.ts"),I=p("./src/controller/fragment-tracker.ts"),A=p("./src/loader/key-loader.ts"),b=p("./src/controller/stream-controller.ts"),_=p("./src/is-supported.ts"),S=p("./src/utils/logger.ts"),g=p("./src/config.ts"),x=p("./node_modules/eventemitter3/index.js"),y=p("./src/events.ts"),l=p("./src/errors.ts"),u=p("./src/types/level.ts");function a(n,E){for(var r=0;r<E.length;r++){var o=E[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(n,m(o.key),o)}}function s(n,E,r){return E&&a(n.prototype,E),r&&a(n,r),Object.defineProperty(n,"prototype",{writable:!1}),n}function m(n){var E=v(n,"string");return typeof E=="symbol"?E:String(E)}function v(n,E){if(typeof n!="object"||n===null)return n;var r=n[Symbol.toPrimitive];if(r!==void 0){var o=r.call(n,E||"default");if(typeof o!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(E==="string"?String:Number)(n)}var i=function(){n.isSupported=function(){return(0,_.isSupported)()};function n(r){r===void 0&&(r={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new x.EventEmitter,this._autoLevelCapping=void 0,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var o=this.config=(0,g.mergeConfig)(n.DefaultConfig,r);this.userConfig=r,(0,S.enableLogs)(o.debug,"Hls instance"),this._autoLevelCapping=-1,o.progressive&&(0,g.enableStreamingMode)(o);var t=o.abrController,f=o.bufferController,e=o.capLevelController,h=o.fpsController,d=this.abrController=new t(this),c=this.bufferController=new f(this),M=this.capLevelController=new e(this),F=new h(this),w=new T.default(this),U=new k.default(this),N=this.levelController=new B.default(this),z=new I.FragmentTracker(this),V=new A.default(this.config),j=this.streamController=new b.default(this,z,V);M.setStreamController(j),F.setStreamController(j);var Y=[w,N,j];this.networkControllers=Y;var X=[d,c,M,F,U,z];this.audioTrackController=this.createController(o.audioTrackController,Y);var Q=o.audioStreamController;Q&&Y.push(new Q(this,z,V)),this.subtitleTrackController=this.createController(o.subtitleTrackController,Y);var te=o.subtitleStreamController;te&&Y.push(new te(this,z,V)),this.createController(o.timelineController,X),V.emeController=this.emeController=this.createController(o.emeController,X),this.cmcdController=this.createController(o.cmcdController,X),this.latencyController=this.createController(C.default,X),this.coreComponents=X}var E=n.prototype;return E.createController=function(o,t){if(o){var f=new o(this);return t&&t.push(f),f}return null},E.on=function(o,t,f){f===void 0&&(f=this),this._emitter.on(o,t,f)},E.once=function(o,t,f){f===void 0&&(f=this),this._emitter.once(o,t,f)},E.removeAllListeners=function(o){this._emitter.removeAllListeners(o)},E.off=function(o,t,f,e){f===void 0&&(f=this),this._emitter.off(o,t,f,e)},E.listeners=function(o){return this._emitter.listeners(o)},E.emit=function(o,t,f){return this._emitter.emit(o,t,f)},E.trigger=function(o,t){if(this.config.debug)return this.emit(o,o,t);try{return this.emit(o,o,t)}catch(f){S.logger.error("An internal error happened while handling event "+o+'. Error message: "'+f.message+'". Here is a stacktrace:',f),this.trigger(y.Events.ERROR,{type:l.ErrorTypes.OTHER_ERROR,details:l.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:o,error:f})}return!1},E.listenerCount=function(o){return this._emitter.listenerCount(o)},E.destroy=function(){S.logger.log("destroy"),this.trigger(y.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(o){return o.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(o){return o.destroy()}),this.coreComponents.length=0},E.attachMedia=function(o){S.logger.log("attachMedia"),this._media=o,this.trigger(y.Events.MEDIA_ATTACHING,{media:o})},E.detachMedia=function(){S.logger.log("detachMedia"),this.trigger(y.Events.MEDIA_DETACHING,void 0),this._media=null},E.loadSource=function(o){this.stopLoad();var t=this.media,f=this.url,e=this.url=P.buildAbsoluteURL(self.location.href,o,{alwaysNormalize:!0});S.logger.log("loadSource:"+e),t&&f&&f!==e&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(t)),this.trigger(y.Events.MANIFEST_LOADING,{url:o})},E.startLoad=function(o){o===void 0&&(o=-1),S.logger.log("startLoad("+o+")"),this.networkControllers.forEach(function(t){t.startLoad(o)})},E.stopLoad=function(){S.logger.log("stopLoad"),this.networkControllers.forEach(function(o){o.stopLoad()})},E.swapAudioCodec=function(){S.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},E.recoverMediaError=function(){S.logger.log("recoverMediaError");var o=this._media;this.detachMedia(),o&&this.attachMedia(o)},E.removeLevel=function(o,t){t===void 0&&(t=0),this.levelController.removeLevel(o,t)},s(n,[{key:"levels",get:function(){var o=this.levelController.levels;return o||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(o){S.logger.log("set currentLevel:"+o),this.loadLevel=o,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(o){S.logger.log("set nextLevel:"+o),this.levelController.manualLevel=o,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(o){S.logger.log("set loadLevel:"+o),this.levelController.manualLevel=o}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(o){this.levelController.nextLoadLevel=o}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(o){S.logger.log("set firstLevel:"+o),this.levelController.firstLevel=o}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(o){S.logger.log("set startLevel:"+o),o!==-1&&(o=Math.max(o,this.minAutoLevel)),this.levelController.startLevel=o}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(o){var t=!!o;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(o){this._autoLevelCapping!==o&&(S.logger.log("set autoLevelCapping:"+o),this._autoLevelCapping=o)}},{key:"bandwidthEstimate",get:function(){var o=this.abrController.bwEstimator;return o?o.getEstimate():NaN}},{key:"maxHdcpLevel",get:function(){return this._maxHdcpLevel},set:function(o){u.HdcpLevels.indexOf(o)>-1&&(this._maxHdcpLevel=o)}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var o=this.levels,t=this.config.minAutoBitrate;if(!o)return 0;for(var f=o.length,e=0;e<f;e++)if(o[e].maxBitrate>=t)return e;return 0}},{key:"maxAutoLevel",get:function(){var o=this.levels,t=this.autoLevelCapping,f=this.maxHdcpLevel,e;if(t===-1&&o&&o.length?e=o.length-1:e=t,f)for(var h=e;h--;){var d=o[h].attrs["HDCP-LEVEL"];if(d&&d<=f)return h}return e}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(o){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,o)}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"mainForwardBufferInfo",get:function(){return this.streamController.getMainFwdBufferInfo()}},{key:"audioTracks",get:function(){var o=this.audioTrackController;return o?o.audioTracks:[]}},{key:"audioTrack",get:function(){var o=this.audioTrackController;return o?o.audioTrack:-1},set:function(o){var t=this.audioTrackController;t&&(t.audioTrack=o)}},{key:"subtitleTracks",get:function(){var o=this.subtitleTrackController;return o?o.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var o=this.subtitleTrackController;return o?o.subtitleTrack:-1},set:function(o){var t=this.subtitleTrackController;t&&(t.subtitleTrack=o)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var o=this.subtitleTrackController;return o?o.subtitleDisplay:!1},set:function(o){var t=this.subtitleTrackController;t&&(t.subtitleDisplay=o)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(o){this.config.lowLatencyMode=o}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],[{key:"version",get:function(){return"1.3.3"}},{key:"Events",get:function(){return y.Events}},{key:"ErrorTypes",get:function(){return l.ErrorTypes}},{key:"ErrorDetails",get:function(){return l.ErrorDetails}},{key:"DefaultConfig",get:function(){return n.defaultConfig?n.defaultConfig:g.hlsDefaultConfig},set:function(o){n.defaultConfig=o}}]),n}();i.defaultConfig=void 0},"./src/is-supported.ts":(W,O,p)=>{p.r(O),p.d(O,{changeTypeSupported:()=>C,isSupported:()=>k});var P=p("./src/utils/mediasource-helper.ts");function T(){return self.SourceBuffer||self.WebKitSourceBuffer}function k(){var B=(0,P.getMediaSource)();if(!B)return!1;var I=T(),A=B&&typeof B.isTypeSupported=="function"&&B.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),b=!I||I.prototype&&typeof I.prototype.appendBuffer=="function"&&typeof I.prototype.remove=="function";return!!A&&!!b}function C(){var B,I=T();return typeof(I==null||(B=I.prototype)===null||B===void 0?void 0:B.changeType)=="function"}},"./src/loader/date-range.ts":(W,O,p)=>{p.r(O),p.d(O,{DateRange:()=>S,DateRangeAttribute:()=>_});var P=p("./src/polyfills/number.ts"),T=p("./src/utils/attr-list.ts"),k=p("./src/utils/logger.ts");function C(){return C=Object.assign?Object.assign.bind():function(g){for(var x=1;x<arguments.length;x++){var y=arguments[x];for(var l in y)Object.prototype.hasOwnProperty.call(y,l)&&(g[l]=y[l])}return g},C.apply(this,arguments)}function B(g,x){for(var y=0;y<x.length;y++){var l=x[y];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(g,A(l.key),l)}}function I(g,x,y){return x&&B(g.prototype,x),y&&B(g,y),Object.defineProperty(g,"prototype",{writable:!1}),g}function A(g){var x=b(g,"string");return typeof x=="symbol"?x:String(x)}function b(g,x){if(typeof g!="object"||g===null)return g;var y=g[Symbol.toPrimitive];if(y!==void 0){var l=y.call(g,x||"default");if(typeof l!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(x==="string"?String:Number)(g)}var _;(function(g){g.ID="ID",g.CLASS="CLASS",g.START_DATE="START-DATE",g.DURATION="DURATION",g.END_DATE="END-DATE",g.END_ON_NEXT="END-ON-NEXT",g.PLANNED_DURATION="PLANNED-DURATION",g.SCTE35_OUT="SCTE35-OUT",g.SCTE35_IN="SCTE35-IN"})(_||(_={}));var S=function(){function g(x,y){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,y){var l=y.attr;for(var u in l)if(Object.prototype.hasOwnProperty.call(x,u)&&x[u]!==l[u]){k.logger.warn('DATERANGE tag attribute: "'+u+'" does not match for tags with ID: "'+x.ID+'"'),this._badValueForSameId=u;break}x=C(new T.AttrList({}),l,x)}if(this.attr=x,this._startDate=new Date(x[_.START_DATE]),_.END_DATE in this.attr){var a=new Date(this.attr[_.END_DATE]);(0,P.isFiniteNumber)(a.getTime())&&(this._endDate=a)}}return I(g,[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){if(this._endDate)return this._endDate;var y=this.duration;return y!==null?new Date(this._startDate.getTime()+y*1e3):null}},{key:"duration",get:function(){if(_.DURATION in this.attr){var y=this.attr.decimalFloatingPoint(_.DURATION);if((0,P.isFiniteNumber)(y))return y}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return _.PLANNED_DURATION in this.attr?this.attr.decimalFloatingPoint(_.PLANNED_DURATION):null}},{key:"endOnNext",get:function(){return this.attr.bool(_.END_ON_NEXT)}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&(0,P.isFiniteNumber)(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}]),g}()},"./src/loader/fragment-loader.ts":(W,O,p)=>{p.r(O),p.d(O,{LoadError:()=>y,default:()=>g});var P=p("./src/polyfills/number.ts"),T=p("./src/errors.ts");function k(l,u){l.prototype=Object.create(u.prototype),l.prototype.constructor=l,b(l,u)}function C(l){var u=typeof Map=="function"?new Map:void 0;return C=function(s){if(s===null||!A(s))return s;if(typeof s!="function")throw new TypeError("Super expression must either be null or a function");if(typeof u<"u"){if(u.has(s))return u.get(s);u.set(s,m)}function m(){return B(s,arguments,_(this).constructor)}return m.prototype=Object.create(s.prototype,{constructor:{value:m,enumerable:!1,writable:!0,configurable:!0}}),b(m,s)},C(l)}function B(l,u,a){return I()?B=Reflect.construct.bind():B=function(m,v,i){var n=[null];n.push.apply(n,v);var E=Function.bind.apply(m,n),r=new E;return i&&b(r,i.prototype),r},B.apply(null,arguments)}function I(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function A(l){return Function.toString.call(l).indexOf("[native code]")!==-1}function b(l,u){return b=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,m){return s.__proto__=m,s},b(l,u)}function _(l){return _=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},_(l)}var S=Math.pow(2,17),g=function(){function l(a){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=a}var u=l.prototype;return u.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},u.abort=function(){this.loader&&this.loader.abort()},u.load=function(s,m){var v=this,i=s.url;if(!i)return Promise.reject(new y({type:T.ErrorTypes.NETWORK_ERROR,details:T.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:s,networkDetails:null},"Fragment does not have a "+(i?"part list":"url")));this.abort();var n=this.config,E=n.fLoader,r=n.loader;return new Promise(function(o,t){v.loader&&v.loader.destroy();var f=v.loader=s.loader=E?new E(n):new r(n),e=x(s),h={timeout:n.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:n.fragLoadingMaxRetryTimeout,highWaterMark:s.sn==="initSegment"?1/0:S};s.stats=f.stats,f.load(e,h,{onSuccess:function(c,M,F,w){v.resetLoader(s,f);var U=c.data;F.resetIV&&s.decryptdata&&(s.decryptdata.iv=new Uint8Array(U.slice(0,16)),U=U.slice(16)),o({frag:s,part:null,payload:U,networkDetails:w})},onError:function(c,M,F){v.resetLoader(s,f),t(new y({type:T.ErrorTypes.NETWORK_ERROR,details:T.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:s,response:c,networkDetails:F}))},onAbort:function(c,M,F){v.resetLoader(s,f),t(new y({type:T.ErrorTypes.NETWORK_ERROR,details:T.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:s,networkDetails:F}))},onTimeout:function(c,M,F){v.resetLoader(s,f),t(new y({type:T.ErrorTypes.NETWORK_ERROR,details:T.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:s,networkDetails:F}))},onProgress:function(c,M,F,w){m&&m({frag:s,part:null,payload:F,networkDetails:w})}})})},u.loadPart=function(s,m,v){var i=this;this.abort();var n=this.config,E=n.fLoader,r=n.loader;return new Promise(function(o,t){i.loader&&i.loader.destroy();var f=i.loader=s.loader=E?new E(n):new r(n),e=x(s,m),h={timeout:n.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:n.fragLoadingMaxRetryTimeout,highWaterMark:S};m.stats=f.stats,f.load(e,h,{onSuccess:function(c,M,F,w){i.resetLoader(s,f),i.updateStatsFromPart(s,m);var U={frag:s,part:m,payload:c.data,networkDetails:w};v(U),o(U)},onError:function(c,M,F){i.resetLoader(s,f),t(new y({type:T.ErrorTypes.NETWORK_ERROR,details:T.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:s,part:m,response:c,networkDetails:F}))},onAbort:function(c,M,F){s.stats.aborted=m.stats.aborted,i.resetLoader(s,f),t(new y({type:T.ErrorTypes.NETWORK_ERROR,details:T.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:s,part:m,networkDetails:F}))},onTimeout:function(c,M,F){i.resetLoader(s,f),t(new y({type:T.ErrorTypes.NETWORK_ERROR,details:T.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:s,part:m,networkDetails:F}))}})})},u.updateStatsFromPart=function(s,m){var v=s.stats,i=m.stats,n=i.total;if(v.loaded+=i.loaded,n){var E=Math.round(s.duration/m.duration),r=Math.min(Math.round(v.loaded/n),E),o=E-r,t=o*Math.round(v.loaded/r);v.total=v.loaded+t}else v.total=Math.max(v.loaded,v.total);var f=v.loading,e=i.loading;f.start?f.first+=e.first-e.start:(f.start=e.start,f.first=e.first),f.end=e.end},u.resetLoader=function(s,m){s.loader=null,this.loader===m&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),m.destroy()},l}();function x(l,u){u===void 0&&(u=null);var a=u||l,s={frag:l,part:u,responseType:"arraybuffer",url:a.url,headers:{},rangeStart:0,rangeEnd:0},m=a.byteRangeStartOffset,v=a.byteRangeEndOffset;if((0,P.isFiniteNumber)(m)&&(0,P.isFiniteNumber)(v)){var i,n=m,E=v;if(l.sn==="initSegment"&&((i=l.decryptdata)===null||i===void 0?void 0:i.method)==="AES-128"){var r=v-m;r%16&&(E=v+(16-r%16)),m!==0&&(s.resetIV=!0,n=m-16)}s.rangeStart=n,s.rangeEnd=E}return s}var y=function(l){k(u,l);function u(a){for(var s,m=arguments.length,v=new Array(m>1?m-1:0),i=1;i<m;i++)v[i-1]=arguments[i];return s=l.call.apply(l,[this].concat(v))||this,s.data=void 0,s.data=a,s}return u}(C(Error))},"./src/loader/fragment.ts":(W,O,p)=>{p.r(O),p.d(O,{BaseSegment:()=>g,ElementaryStreamTypes:()=>S,Fragment:()=>x,Part:()=>y});var P=p("./src/polyfills/number.ts"),T=p("./node_modules/url-toolkit/src/url-toolkit.js"),k=p("./src/loader/load-stats.ts");function C(l,u){l.prototype=Object.create(u.prototype),l.prototype.constructor=l,B(l,u)}function B(l,u){return B=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,m){return s.__proto__=m,s},B(l,u)}function I(l,u){for(var a=0;a<u.length;a++){var s=u[a];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(l,b(s.key),s)}}function A(l,u,a){return u&&I(l.prototype,u),a&&I(l,a),Object.defineProperty(l,"prototype",{writable:!1}),l}function b(l){var u=_(l,"string");return typeof u=="symbol"?u:String(u)}function _(l,u){if(typeof l!="object"||l===null)return l;var a=l[Symbol.toPrimitive];if(a!==void 0){var s=a.call(l,u||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(u==="string"?String:Number)(l)}var S;(function(l){l.AUDIO="audio",l.VIDEO="video",l.AUDIOVIDEO="audiovideo"})(S||(S={}));var g=function(){function l(a){var s;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=(s={},s[S.AUDIO]=null,s[S.VIDEO]=null,s[S.AUDIOVIDEO]=null,s),this.baseurl=a}var u=l.prototype;return u.setByteRange=function(s,m){var v=s.split("@",2),i=[];v.length===1?i[0]=m?m.byteRangeEndOffset:0:i[0]=parseInt(v[1]),i[1]=parseInt(v[0])+i[0],this._byteRange=i},A(l,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=(0,T.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(s){this._url=s}}]),l}(),x=function(l){C(u,l);function u(s,m){var v;return v=l.call(this,m)||this,v._decryptdata=null,v.rawProgramDateTime=null,v.programDateTime=null,v.tagList=[],v.duration=0,v.sn=0,v.levelkeys=void 0,v.type=void 0,v.loader=null,v.keyLoader=null,v.level=-1,v.cc=0,v.startPTS=void 0,v.endPTS=void 0,v.appendedPTS=void 0,v.startDTS=void 0,v.endDTS=void 0,v.start=0,v.deltaPTS=void 0,v.maxStartPTS=void 0,v.minEndPTS=void 0,v.stats=new k.LoadStats,v.urlId=0,v.data=void 0,v.bitrateTest=!1,v.title=null,v.initSegment=null,v.endList=void 0,v.type=s,v}var a=u.prototype;return a.setKeyFormat=function(m){if(this.levelkeys){var v=this.levelkeys[m];v&&!this._decryptdata&&(this._decryptdata=v.getDecryptData(this.sn))}},a.abortRequests=function(){var m,v;(m=this.loader)===null||m===void 0||m.abort(),(v=this.keyLoader)===null||v===void 0||v.abort()},a.setElementaryStreamInfo=function(m,v,i,n,E,r){r===void 0&&(r=!1);var o=this.elementaryStreams,t=o[m];if(!t){o[m]={startPTS:v,endPTS:i,startDTS:n,endDTS:E,partial:r};return}t.startPTS=Math.min(t.startPTS,v),t.endPTS=Math.max(t.endPTS,i),t.startDTS=Math.min(t.startDTS,n),t.endDTS=Math.max(t.endDTS,E)},a.clearElementaryStreamInfo=function(){var m=this.elementaryStreams;m[S.AUDIO]=null,m[S.VIDEO]=null,m[S.AUDIOVIDEO]=null},A(u,[{key:"decryptdata",get:function(){var m=this.levelkeys;if(!m&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){var v=this.levelkeys.identity;if(v)this._decryptdata=v.getDecryptData(this.sn);else{var i=Object.keys(this.levelkeys);if(i.length===1)return this._decryptdata=this.levelkeys[i[0]].getDecryptData(this.sn)}}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!(0,P.isFiniteNumber)(this.programDateTime))return null;var m=(0,P.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+m*1e3}},{key:"encrypted",get:function(){var m;if((m=this._decryptdata)!==null&&m!==void 0&&m.encrypted)return!0;if(this.levelkeys){var v=Object.keys(this.levelkeys),i=v.length;if(i>1||i===1&&this.levelkeys[v[0]].encrypted)return!0}return!1}}]),u}(g),y=function(l){C(u,l);function u(a,s,m,v,i){var n;n=l.call(this,m)||this,n.fragOffset=0,n.duration=0,n.gap=!1,n.independent=!1,n.relurl=void 0,n.fragment=void 0,n.index=void 0,n.stats=new k.LoadStats,n.duration=a.decimalFloatingPoint("DURATION"),n.gap=a.bool("GAP"),n.independent=a.bool("INDEPENDENT"),n.relurl=a.enumeratedString("URI"),n.fragment=s,n.index=v;var E=a.enumeratedString("BYTERANGE");return E&&n.setByteRange(E,i),i&&(n.fragOffset=i.fragOffset+i.duration),n}return A(u,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var s=this.elementaryStreams;return!!(s.audio||s.video||s.audiovideo)}}]),u}(g)},"./src/loader/key-loader.ts":(W,O,p)=>{p.r(O),p.d(O,{default:()=>k});var P=p("./src/errors.ts"),T=p("./src/loader/fragment-loader.ts"),k=function(){function C(I){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=I}var B=C.prototype;return B.abort=function(){for(var A in this.keyUriToKeyInfo){var b=this.keyUriToKeyInfo[A].loader;b&&b.abort()}},B.detach=function(){for(var A in this.keyUriToKeyInfo){var b=this.keyUriToKeyInfo[A];(b.mediaKeySessionContext||b.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[A]}},B.destroy=function(){this.detach();for(var A in this.keyUriToKeyInfo){var b=this.keyUriToKeyInfo[A].loader;b&&b.destroy()}this.keyUriToKeyInfo={}},B.createKeyLoadError=function(A,b,_,S){return b===void 0&&(b=P.ErrorDetails.KEY_LOAD_ERROR),new T.LoadError({type:P.ErrorTypes.NETWORK_ERROR,details:b,fatal:!1,frag:A,networkDetails:_})},B.loadClear=function(A,b){var _=this;if(this.emeController&&this.config.emeEnabled)for(var S=A.sn,g=A.cc,x=function(a){var s=b[a];if(g<=s.cc&&(S==="initSegment"||S<s.sn))return _.emeController.selectKeySystemFormat(s).then(function(m){s.setKeyFormat(m)}),"break"},y=0;y<b.length;y++){var l=x(y);if(l==="break")break}},B.load=function(A){var b=this;return!A.decryptdata&&A.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(A).then(function(_){return b.loadInternal(A,_)}):this.loadInternal(A)},B.loadInternal=function(A,b){var _,S;b&&A.setKeyFormat(b);var g=A.decryptdata;if(!g){var x=b?"Expected frag.decryptdata to be defined after setting format "+b:"Missing decryption data on fragment in onKeyLoading";return Promise.reject(this.createKeyLoadError(A,P.ErrorDetails.KEY_LOAD_ERROR,null,x))}var y=g.uri;if(!y)return Promise.reject(this.createKeyLoadError(A,P.ErrorDetails.KEY_LOAD_ERROR,null,'Invalid key URI: "'+y+'"'));var l=this.keyUriToKeyInfo[y];if((_=l)!==null&&_!==void 0&&_.decryptdata.key)return g.key=l.decryptdata.key,Promise.resolve({frag:A,keyInfo:l});if((S=l)!==null&&S!==void 0&&S.keyLoadPromise){var u;switch((u=l.mediaKeySessionContext)===null||u===void 0?void 0:u.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return l.keyLoadPromise}}switch(l=this.keyUriToKeyInfo[y]={decryptdata:g,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},g.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return g.keyFormat==="identity"?this.loadKeyHTTP(l,A):this.loadKeyEME(l,A);case"AES-128":return this.loadKeyHTTP(l,A);default:return Promise.reject(this.createKeyLoadError(A,P.ErrorDetails.KEY_LOAD_ERROR,null,'Key supplied with unsupported METHOD: "'+g.method+'"'))}},B.loadKeyEME=function(A,b){var _={frag:b,keyInfo:A};if(this.emeController&&this.config.emeEnabled){var S=this.emeController.loadKey(_);if(S)return(A.keyLoadPromise=S.then(function(g){return A.mediaKeySessionContext=g,_})).catch(function(g){throw A.keyLoadPromise=null,g})}return Promise.resolve(_)},B.loadKeyHTTP=function(A,b){var _=this,S=this.config,g=S.loader,x=new g(S);return b.keyLoader=A.loader=x,A.keyLoadPromise=new Promise(function(y,l){var u={keyInfo:A,frag:b,responseType:"arraybuffer",url:A.decryptdata.uri},a={timeout:S.fragLoadingTimeOut,maxRetry:0,retryDelay:S.fragLoadingRetryDelay,maxRetryDelay:S.fragLoadingMaxRetryTimeout,highWaterMark:0},s={onSuccess:function(v,i,n,E){var r=n.frag,o=n.keyInfo,t=n.url;if(!r.decryptdata||o!==_.keyUriToKeyInfo[t])return l(_.createKeyLoadError(r,P.ErrorDetails.KEY_LOAD_ERROR,E,"after key load, decryptdata unset or changed"));o.decryptdata.key=r.decryptdata.key=new Uint8Array(v.data),r.keyLoader=null,o.loader=null,y({frag:r,keyInfo:o})},onError:function(v,i,n){_.resetLoader(i),l(_.createKeyLoadError(b,P.ErrorDetails.KEY_LOAD_ERROR,n))},onTimeout:function(v,i,n){_.resetLoader(i),l(_.createKeyLoadError(b,P.ErrorDetails.KEY_LOAD_TIMEOUT,n))},onAbort:function(v,i,n){_.resetLoader(i),l(_.createKeyLoadError(b,P.ErrorDetails.INTERNAL_ABORTED,n))}};x.load(u,a,s)})},B.resetLoader=function(A){var b=A.frag,_=A.keyInfo,S=A.url,g=_.loader;b.keyLoader===g&&(b.keyLoader=null,_.loader=null),delete this.keyUriToKeyInfo[S],g&&g.destroy()},C}()},"./src/loader/level-details.ts":(W,O,p)=>{p.r(O),p.d(O,{LevelDetails:()=>A});var P=p("./src/polyfills/number.ts");function T(b,_){for(var S=0;S<_.length;S++){var g=_[S];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(b,C(g.key),g)}}function k(b,_,S){return _&&T(b.prototype,_),S&&T(b,S),Object.defineProperty(b,"prototype",{writable:!1}),b}function C(b){var _=B(b,"string");return typeof _=="symbol"?_:String(_)}function B(b,_){if(typeof b!="object"||b===null)return b;var S=b[Symbol.toPrimitive];if(S!==void 0){var g=S.call(b,_||"default");if(typeof g!="object")return g;throw new TypeError("@@toPrimitive must return a primitive value.")}return(_==="string"?String:Number)(b)}var I=10,A=function(){function b(S){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=S}var _=b.prototype;return _.reloaded=function(g){if(!g){this.advanced=!0,this.updated=!0;return}var x=this.lastPartSn-g.lastPartSn,y=this.lastPartIndex-g.lastPartIndex;this.updated=this.endSN!==g.endSN||!!y||!!x,this.advanced=this.endSN>g.endSN||x>0||x===0&&y>0,this.updated||this.advanced?this.misses=Math.floor(g.misses*.6):this.misses=g.misses+1,this.availabilityDelay=g.availabilityDelay},k(b,[{key:"hasProgramDateTime",get:function(){return this.fragments.length?(0,P.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime):!1}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||I}},{key:"drift",get:function(){var g=this.driftEndTime-this.driftStartTime;if(g>0){var x=this.driftEnd-this.driftStart;return x*1e3/g}return 1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var g;return(g=this.partList)!==null&&g!==void 0&&g.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var g;return(g=this.fragments)!==null&&g!==void 0&&g.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var g;return(g=this.partList)!==null&&g!==void 0&&g.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var g;return(g=this.partList)!==null&&g!==void 0&&g.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),b}()},"./src/loader/level-key.ts":(W,O,p)=>{p.r(O),p.d(O,{LevelKey:()=>A});var P=p("./src/utils/keysystem-util.ts"),T=p("./src/utils/mediakeys-helper.ts"),k=p("./src/utils/mp4-tools.ts"),C=p("./src/utils/logger.ts"),B=p("./src/utils/numeric-encoding-utils.ts"),I={},A=function(){_.clearKeyUriToKeyIdMap=function(){I={}};function _(g,x,y,l,u){l===void 0&&(l=[1]),u===void 0&&(u=null),this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=g,this.uri=x,this.keyFormat=y,this.keyFormatVersions=l,this.iv=u,this.encrypted=g?g!=="NONE":!1,this.isCommonEncryption=this.encrypted&&g!=="AES-128"}var S=_.prototype;return S.isSupported=function(){if(this.method){if(this.method==="AES-128"||this.method==="NONE")return!0;switch(this.keyFormat){case"identity":return this.method==="SAMPLE-AES";case T.KeySystemFormats.FAIRPLAY:case T.KeySystemFormats.WIDEVINE:case T.KeySystemFormats.PLAYREADY:case T.KeySystemFormats.CLEARKEY:return["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1},S.getDecryptData=function(x){if(!this.encrypted||!this.uri)return null;if(this.method==="AES-128"&&this.uri&&!this.iv){typeof x!="number"&&(this.method==="AES-128"&&!this.iv&&C.logger.warn('missing IV for initialization segment with method="'+this.method+'" - compliance issue'),x=0);var y=b(x),l=new _(this.method,this.uri,"identity",this.keyFormatVersions,y);return l}var u=(0,P.convertDataUriToArrayBytes)(this.uri);if(u)switch(this.keyFormat){case T.KeySystemFormats.WIDEVINE:this.pssh=u,u.length>=22&&(this.keyId=u.subarray(u.length-22,u.length-6));break;case T.KeySystemFormats.PLAYREADY:{var a=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=(0,k.mp4pssh)(a,null,u);var s=new Uint16Array(u.buffer,u.byteOffset,u.byteLength/2),m=String.fromCharCode.apply(null,Array.from(s)),v=m.substring(m.indexOf("<"),m.length),i=new DOMParser,n=i.parseFromString(v,"text/xml"),E=n.getElementsByTagName("KID")[0];if(E){var r=E.childNodes[0]?E.childNodes[0].nodeValue:E.getAttribute("VALUE");if(r){var o=(0,B.base64Decode)(r).subarray(0,16);(0,P.changeEndianness)(o),this.keyId=o}}break}default:{var t=u.subarray(0,16);if(t.length!==16){var f=new Uint8Array(16);f.set(t,16-t.length),t=f}this.keyId=t;break}}if(!this.keyId||this.keyId.byteLength!==16){var e=I[this.uri];if(!e){var h=Object.keys(I).length%Number.MAX_SAFE_INTEGER;e=new Uint8Array(16);var d=new DataView(e.buffer,12,4);d.setUint32(0,h),I[this.uri]=e}this.keyId=e}return this},_}();function b(_){for(var S=new Uint8Array(16),g=12;g<16;g++)S[g]=_>>8*(15-g)&255;return S}},"./src/loader/load-stats.ts":(W,O,p)=>{p.r(O),p.d(O,{LoadStats:()=>P});var P=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":(W,O,p)=>{p.r(O),p.d(O,{default:()=>u});var P=p("./src/polyfills/number.ts"),T=p("./node_modules/url-toolkit/src/url-toolkit.js"),k=p("./src/loader/date-range.ts"),C=p("./src/loader/fragment.ts"),B=p("./src/loader/level-details.ts"),I=p("./src/loader/level-key.ts"),A=p("./src/utils/attr-list.ts"),b=p("./src/utils/logger.ts"),_=p("./src/utils/codecs.ts");function S(){return S=Object.assign?Object.assign.bind():function(r){for(var o=1;o<arguments.length;o++){var t=arguments[o];for(var f in t)Object.prototype.hasOwnProperty.call(t,f)&&(r[f]=t[f])}return r},S.apply(this,arguments)}var g=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+|#EXT-X-SESSION-KEY:([^\n\r]*)[\r\n]+/g,x=/#EXT-X-MEDIA:(.*)/g,y=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),l=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),u=function(){function r(){}return r.findGroup=function(t,f){for(var e=0;e<t.length;e++){var h=t[e];if(h.id===f)return h}},r.convertAVC1ToAVCOTI=function(t){var f=t.split(".");if(f.length>2){var e=f.shift()+".";return e+=parseInt(f.shift()).toString(16),e+=("000"+parseInt(f.shift()).toString(16)).slice(-4),e}return t},r.resolve=function(t,f){return(0,T.buildAbsoluteURL)(f,t,{alwaysNormalize:!0})},r.parseMasterPlaylist=function(t,f){var e=[],h=[],d={},c=[],M=!1;g.lastIndex=0;for(var F;(F=g.exec(t))!=null;)if(F[1]){var w,U=new A.AttrList(F[1]),N={attrs:U,bitrate:U.decimalInteger("AVERAGE-BANDWIDTH")||U.decimalInteger("BANDWIDTH"),name:U.NAME,url:r.resolve(F[2],f)},z=U.decimalResolution("RESOLUTION");z&&(N.width=z.width,N.height=z.height),s((U.CODECS||"").split(/[ ,]+/).filter(function(Q){return Q}),N),N.videoCodec&&N.videoCodec.indexOf("avc1")!==-1&&(N.videoCodec=r.convertAVC1ToAVCOTI(N.videoCodec)),(w=N.unknownCodecs)!==null&&w!==void 0&&w.length||h.push(N),e.push(N)}else if(F[3]){var V=new A.AttrList(F[3]);V["DATA-ID"]&&(M=!0,d[V["DATA-ID"]]=V)}else if(F[4]){var j=F[4],Y=a(j,f);Y.encrypted&&Y.isSupported()?c.push(Y):b.logger.warn('[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "'+j+'"')}var X=h.length>0&&h.length<e.length;return{levels:X?h:e,sessionData:M?d:null,sessionKeys:c.length?c:null}},r.parseMasterPlaylistMedia=function(t,f,e,h){h===void 0&&(h=[]);var d,c=[],M=0;for(x.lastIndex=0;(d=x.exec(t))!==null;){var F=new A.AttrList(d[1]);if(F.TYPE===e){var w={attrs:F,bitrate:0,id:M++,groupId:F["GROUP-ID"],instreamId:F["INSTREAM-ID"],name:F.NAME||F.LANGUAGE||"",type:e,default:F.bool("DEFAULT"),autoselect:F.bool("AUTOSELECT"),forced:F.bool("FORCED"),lang:F.LANGUAGE,url:F.URI?r.resolve(F.URI,f):""};if(h.length){var U=r.findGroup(h,w.groupId)||h[0];m(w,U,"audioCodec"),m(w,U,"textCodec")}c.push(w)}}return c},r.parseLevelPlaylist=function(t,f,e,h,d){var c=new B.LevelDetails(f),M=c.fragments,F=null,w=0,U=0,N=0,z=0,V=null,j=new C.Fragment(h,f),Y,X,Q,te=-1,$=!1;for(y.lastIndex=0,c.m3u8=t;(Y=y.exec(t))!==null;){$&&($=!1,j=new C.Fragment(h,f),j.start=N,j.sn=w,j.cc=z,j.level=e,F&&(j.initSegment=F,j.rawProgramDateTime=F.rawProgramDateTime,F.rawProgramDateTime=null));var ee=Y[1];if(ee){j.duration=parseFloat(ee);var ne=(" "+Y[2]).slice(1);j.title=ne||null,j.tagList.push(ne?["INF",ee,ne]:["INF",ee])}else if(Y[3])(0,P.isFiniteNumber)(j.duration)&&(j.start=N,Q&&E(j,Q,c),j.sn=w,j.level=e,j.cc=z,j.urlId=d,M.push(j),j.relurl=(" "+Y[3]).slice(1),i(j,V),V=j,N+=j.duration,w++,U=0,$=!0);else if(Y[4]){var oe=(" "+Y[4]).slice(1);V?j.setByteRange(oe,V):j.setByteRange(oe)}else if(Y[5])j.rawProgramDateTime=(" "+Y[5]).slice(1),j.tagList.push(["PROGRAM-DATE-TIME",j.rawProgramDateTime]),te===-1&&(te=M.length);else{if(Y=Y[0].match(l),!Y){b.logger.warn("No matches on slow regex match for level playlist!");continue}for(X=1;X<Y.length&&!(typeof Y[X]<"u");X++);var ae=(" "+Y[X]).slice(1),ie=(" "+Y[X+1]).slice(1),ce=Y[X+2]?(" "+Y[X+2]).slice(1):"";switch(ae){case"PLAYLIST-TYPE":c.type=ie.toUpperCase();break;case"MEDIA-SEQUENCE":w=c.startSN=parseInt(ie);break;case"SKIP":{var me=new A.AttrList(ie),pe=me.decimalInteger("SKIPPED-SEGMENTS");if((0,P.isFiniteNumber)(pe)){c.skippedSegments=pe;for(var Ie=pe;Ie--;)M.unshift(null);w+=pe}var Ee=me.enumeratedString("RECENTLY-REMOVED-DATERANGES");Ee&&(c.recentlyRemovedDateranges=Ee.split("	"));break}case"TARGETDURATION":c.targetduration=parseFloat(ie);break;case"VERSION":c.version=parseInt(ie);break;case"EXTM3U":break;case"ENDLIST":c.live=!1;break;case"#":(ie||ce)&&j.tagList.push(ce?[ie,ce]:[ie]);break;case"DISCONTINUITY":z++,j.tagList.push(["DIS"]);break;case"GAP":j.tagList.push([ae]);break;case"BITRATE":j.tagList.push([ae,ie]);break;case"DATERANGE":{var Se=new A.AttrList(ie),Te=new k.DateRange(Se,c.dateRanges[Se.ID]);Te.isValid||c.skippedSegments?c.dateRanges[Te.id]=Te:b.logger.warn('Ignoring invalid DATERANGE tag: "'+ie+'"'),j.tagList.push(["EXT-X-DATERANGE",ie]);break}case"DISCONTINUITY-SEQUENCE":z=parseInt(ie);break;case"KEY":{var be=a(ie,f);if(be.isSupported()){if(be.method==="NONE"){Q=void 0;break}Q||(Q={}),Q[be.keyFormat]&&(Q=S({},Q)),Q[be.keyFormat]=be}else b.logger.warn('[Keys] Ignoring invalid EXT-X-KEY tag: "'+ie+'"');break}case"START":{var Ae=new A.AttrList(ie),Re=Ae.decimalFloatingPoint("TIME-OFFSET");(0,P.isFiniteNumber)(Re)&&(c.startTimeOffset=Re);break}case"MAP":{var Fe=new A.AttrList(ie);if(j.duration){var Ce=new C.Fragment(h,f);n(Ce,Fe,e,Q),F=Ce,j.initSegment=F,F.rawProgramDateTime&&!j.rawProgramDateTime&&(j.rawProgramDateTime=F.rawProgramDateTime)}else n(j,Fe,e,Q),F=j,$=!0;break}case"SERVER-CONTROL":{var Me=new A.AttrList(ie);c.canBlockReload=Me.bool("CAN-BLOCK-RELOAD"),c.canSkipUntil=Me.optionalFloat("CAN-SKIP-UNTIL",0),c.canSkipDateRanges=c.canSkipUntil>0&&Me.bool("CAN-SKIP-DATERANGES"),c.partHoldBack=Me.optionalFloat("PART-HOLD-BACK",0),c.holdBack=Me.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{var Ge=new A.AttrList(ie);c.partTarget=Ge.decimalFloatingPoint("PART-TARGET");break}case"PART":{var ye=c.partList;ye||(ye=c.partList=[]);var ot=U>0?ye[ye.length-1]:void 0,Xe=U++,He=new C.Part(new A.AttrList(ie),j,f,Xe,ot);ye.push(He),j.duration+=He.duration;break}case"PRELOAD-HINT":{var Ve=new A.AttrList(ie);c.preloadHint=Ve;break}case"RENDITION-REPORT":{var Ke=new A.AttrList(ie);c.renditionReports=c.renditionReports||[],c.renditionReports.push(Ke);break}default:b.logger.warn("line parsed but not handled: "+Y);break}}}V&&!V.relurl?(M.pop(),N-=V.duration,c.partList&&(c.fragmentHint=V)):c.partList&&(i(j,V),j.cc=z,c.fragmentHint=j,Q&&E(j,Q,c));var Be=M.length,je=M[0],qe=M[Be-1];if(N+=c.skippedSegments*c.targetduration,N>0&&Be&&qe){c.averagetargetduration=N/Be;var Oe=qe.sn;c.endSN=Oe!=="initSegment"?Oe:0,c.live||(qe.endList=!0),je&&(c.startCC=je.cc)}else c.endSN=0,c.startCC=0;return c.fragmentHint&&(N+=c.fragmentHint.duration),c.totalduration=N,c.endCC=z,te>0&&v(M,te),c},r}();function a(r,o){var t,f,e=new A.AttrList(r),h=(t=e.enumeratedString("METHOD"))!=null?t:"",d=e.URI,c=e.hexadecimalInteger("IV"),M=e.enumeratedString("KEYFORMATVERSIONS"),F=(f=e.enumeratedString("KEYFORMAT"))!=null?f:"identity";d&&e.IV&&!c&&b.logger.error("Invalid IV: "+e.IV);var w=d?u.resolve(d,o):"",U=(M||"1").split("/").map(Number).filter(Number.isFinite);return new I.LevelKey(h,w,F,U,c)}function s(r,o){["video","audio","text"].forEach(function(t){var f=r.filter(function(h){return(0,_.isCodecType)(h,t)});if(f.length){var e=f.filter(function(h){return h.lastIndexOf("avc1",0)===0||h.lastIndexOf("mp4a",0)===0});o[t+"Codec"]=e.length>0?e[0]:f[0],r=r.filter(function(h){return f.indexOf(h)===-1})}}),o.unknownCodecs=r}function m(r,o,t){var f=o[t];f&&(r[t]=f)}function v(r,o){for(var t=r[o],f=o;f--;){var e=r[f];if(!e)return;e.programDateTime=t.programDateTime-e.duration*1e3,t=e}}function i(r,o){r.rawProgramDateTime?r.programDateTime=Date.parse(r.rawProgramDateTime):o!=null&&o.programDateTime&&(r.programDateTime=o.endProgramDateTime),(0,P.isFiniteNumber)(r.programDateTime)||(r.programDateTime=null,r.rawProgramDateTime=null)}function n(r,o,t,f){r.relurl=o.URI,o.BYTERANGE&&r.setByteRange(o.BYTERANGE),r.level=t,r.sn="initSegment",f&&(r.levelkeys=f),r.initSegment=null}function E(r,o,t){r.levelkeys=o;var f=t.encryptedFragments;(!f.length||f[f.length-1].levelkeys!==o)&&Object.keys(o).some(function(e){return o[e].isCommonEncryption})&&f.push(r)}},"./src/loader/playlist-loader.ts":(W,O,p)=>{p.r(O),p.d(O,{default:()=>g});var P=p("./src/polyfills/number.ts"),T=p("./src/events.ts"),k=p("./src/errors.ts"),C=p("./src/utils/logger.ts"),B=p("./src/loader/m3u8-parser.ts"),I=p("./src/types/loader.ts"),A=p("./src/utils/attr-list.ts");function b(x){var y=x.type;switch(y){case I.PlaylistContextType.AUDIO_TRACK:return I.PlaylistLevelType.AUDIO;case I.PlaylistContextType.SUBTITLE_TRACK:return I.PlaylistLevelType.SUBTITLE;default:return I.PlaylistLevelType.MAIN}}function _(x,y){var l=x.url;return(l===void 0||l.indexOf("data:")===0)&&(l=y.url),l}var S=function(){function x(l){this.hls=void 0,this.loaders=Object.create(null),this.hls=l,this.registerListeners()}var y=x.prototype;return y.startLoad=function(u){},y.stopLoad=function(){this.destroyInternalLoaders()},y.registerListeners=function(){var u=this.hls;u.on(T.Events.MANIFEST_LOADING,this.onManifestLoading,this),u.on(T.Events.LEVEL_LOADING,this.onLevelLoading,this),u.on(T.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),u.on(T.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},y.unregisterListeners=function(){var u=this.hls;u.off(T.Events.MANIFEST_LOADING,this.onManifestLoading,this),u.off(T.Events.LEVEL_LOADING,this.onLevelLoading,this),u.off(T.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),u.off(T.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},y.createInternalLoader=function(u){var a=this.hls.config,s=a.pLoader,m=a.loader,v=s||m,i=new v(a);return u.loader=i,this.loaders[u.type]=i,i},y.getInternalLoader=function(u){return this.loaders[u.type]},y.resetInternalLoader=function(u){this.loaders[u]&&delete this.loaders[u]},y.destroyInternalLoaders=function(){for(var u in this.loaders){var a=this.loaders[u];a&&a.destroy(),this.resetInternalLoader(u)}},y.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},y.onManifestLoading=function(u,a){var s=a.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:I.PlaylistContextType.MANIFEST,url:s,deliveryDirectives:null})},y.onLevelLoading=function(u,a){var s=a.id,m=a.level,v=a.url,i=a.deliveryDirectives;this.load({id:s,groupId:null,level:m,responseType:"text",type:I.PlaylistContextType.LEVEL,url:v,deliveryDirectives:i})},y.onAudioTrackLoading=function(u,a){var s=a.id,m=a.groupId,v=a.url,i=a.deliveryDirectives;this.load({id:s,groupId:m,level:null,responseType:"text",type:I.PlaylistContextType.AUDIO_TRACK,url:v,deliveryDirectives:i})},y.onSubtitleTrackLoading=function(u,a){var s=a.id,m=a.groupId,v=a.url,i=a.deliveryDirectives;this.load({id:s,groupId:m,level:null,responseType:"text",type:I.PlaylistContextType.SUBTITLE_TRACK,url:v,deliveryDirectives:i})},y.load=function(u){var a,s=this.hls.config,m=this.getInternalLoader(u);if(m){var v=m.context;if(v&&v.url===u.url){C.logger.trace("[playlist-loader]: playlist request ongoing");return}C.logger.log("[playlist-loader]: aborting previous loader for type: "+u.type),m.abort()}var i,n,E,r;switch(u.type){case I.PlaylistContextType.MANIFEST:i=s.manifestLoadingMaxRetry,n=s.manifestLoadingTimeOut,E=s.manifestLoadingRetryDelay,r=s.manifestLoadingMaxRetryTimeout;break;case I.PlaylistContextType.LEVEL:case I.PlaylistContextType.AUDIO_TRACK:case I.PlaylistContextType.SUBTITLE_TRACK:i=0,n=s.levelLoadingTimeOut;break;default:i=s.levelLoadingMaxRetry,n=s.levelLoadingTimeOut,E=s.levelLoadingRetryDelay,r=s.levelLoadingMaxRetryTimeout;break}if(m=this.createInternalLoader(u),(a=u.deliveryDirectives)!==null&&a!==void 0&&a.part){var o;if(u.type===I.PlaylistContextType.LEVEL&&u.level!==null?o=this.hls.levels[u.level].details:u.type===I.PlaylistContextType.AUDIO_TRACK&&u.id!==null?o=this.hls.audioTracks[u.id].details:u.type===I.PlaylistContextType.SUBTITLE_TRACK&&u.id!==null&&(o=this.hls.subtitleTracks[u.id].details),o){var t=o.partTarget,f=o.targetduration;t&&f&&(n=Math.min(Math.max(t*3,f*.8)*1e3,n))}}var e={timeout:n,maxRetry:i,retryDelay:E,maxRetryDelay:r,highWaterMark:0},h={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};m.load(u,e,h)},y.loadsuccess=function(u,a,s,m){m===void 0&&(m=null),this.resetInternalLoader(s.type);var v=u.data;if(v.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(u,s,"no EXTM3U delimiter",m);return}a.parsing.start=performance.now(),v.indexOf("#EXTINF:")>0||v.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(u,a,s,m):this.handleMasterPlaylist(u,a,s,m)},y.loaderror=function(u,a,s){s===void 0&&(s=null),this.handleNetworkError(a,s,!1,u)},y.loadtimeout=function(u,a,s){s===void 0&&(s=null),this.handleNetworkError(a,s,!0)},y.handleMasterPlaylist=function(u,a,s,m){var v=this.hls,i=u.data,n=_(u,s),E=B.default.parseMasterPlaylist(i,n),r=E.levels,o=E.sessionData,t=E.sessionKeys;if(!r.length){this.handleManifestParsingError(u,s,"no level found in manifest",m);return}var f=r.map(function(F){return{id:F.attrs.AUDIO,audioCodec:F.audioCodec}}),e=r.map(function(F){return{id:F.attrs.SUBTITLES,textCodec:F.textCodec}}),h=B.default.parseMasterPlaylistMedia(i,n,"AUDIO",f),d=B.default.parseMasterPlaylistMedia(i,n,"SUBTITLES",e),c=B.default.parseMasterPlaylistMedia(i,n,"CLOSED-CAPTIONS");if(h.length){var M=h.some(function(F){return!F.url});!M&&r[0].audioCodec&&!r[0].attrs.AUDIO&&(C.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),h.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new A.AttrList({}),bitrate:0,url:""}))}v.trigger(T.Events.MANIFEST_LOADED,{levels:r,audioTracks:h,subtitles:d,captions:c,url:n,stats:a,networkDetails:m,sessionData:o,sessionKeys:t})},y.handleTrackOrLevelPlaylist=function(u,a,s,m){var v=this.hls,i=s.id,n=s.level,E=s.type,r=_(u,s),o=(0,P.isFiniteNumber)(i)?i:0,t=(0,P.isFiniteNumber)(n)?n:o,f=b(s),e=B.default.parseLevelPlaylist(u.data,r,t,f,o);if(!e.fragments.length){v.trigger(T.Events.ERROR,{type:k.ErrorTypes.NETWORK_ERROR,details:k.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:r,reason:"no fragments found in level",level:typeof s.level=="number"?s.level:void 0});return}if(E===I.PlaylistContextType.MANIFEST){var h={attrs:new A.AttrList({}),bitrate:0,details:e,name:"",url:r};v.trigger(T.Events.MANIFEST_LOADED,{levels:[h],audioTracks:[],url:r,stats:a,networkDetails:m,sessionData:null,sessionKeys:null})}a.parsing.end=performance.now(),s.levelDetails=e,this.handlePlaylistLoaded(u,a,s,m)},y.handleManifestParsingError=function(u,a,s,m){this.hls.trigger(T.Events.ERROR,{type:k.ErrorTypes.NETWORK_ERROR,details:k.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:a.type===I.PlaylistContextType.MANIFEST,url:u.url,reason:s,response:u,context:a,networkDetails:m})},y.handleNetworkError=function(u,a,s,m){s===void 0&&(s=!1),C.logger.warn("[playlist-loader]: A network "+(s?"timeout":"error")+" occurred while loading "+u.type+" level: "+u.level+" id: "+u.id+' group-id: "'+u.groupId+'"');var v=k.ErrorDetails.UNKNOWN,i=!1,n=this.getInternalLoader(u);switch(u.type){case I.PlaylistContextType.MANIFEST:v=s?k.ErrorDetails.MANIFEST_LOAD_TIMEOUT:k.ErrorDetails.MANIFEST_LOAD_ERROR,i=!0;break;case I.PlaylistContextType.LEVEL:v=s?k.ErrorDetails.LEVEL_LOAD_TIMEOUT:k.ErrorDetails.LEVEL_LOAD_ERROR,i=!1;break;case I.PlaylistContextType.AUDIO_TRACK:v=s?k.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:k.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,i=!1;break;case I.PlaylistContextType.SUBTITLE_TRACK:v=s?k.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:k.ErrorDetails.SUBTITLE_LOAD_ERROR,i=!1;break}n&&this.resetInternalLoader(u.type);var E={type:k.ErrorTypes.NETWORK_ERROR,details:v,fatal:i,url:u.url,loader:n,context:u,networkDetails:a};m&&(E.response=m),this.hls.trigger(T.Events.ERROR,E)},y.handlePlaylistLoaded=function(u,a,s,m){var v=s.type,i=s.level,n=s.id,E=s.groupId,r=s.loader,o=s.levelDetails,t=s.deliveryDirectives;if(!(o!=null&&o.targetduration)){this.handleManifestParsingError(u,s,"invalid target duration",m);return}if(!!r)switch(o.live&&(r.getCacheAge&&(o.ageHeader=r.getCacheAge()||0),(!r.getCacheAge||isNaN(o.ageHeader))&&(o.ageHeader=0)),v){case I.PlaylistContextType.MANIFEST:case I.PlaylistContextType.LEVEL:this.hls.trigger(T.Events.LEVEL_LOADED,{details:o,level:i||0,id:n||0,stats:a,networkDetails:m,deliveryDirectives:t});break;case I.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(T.Events.AUDIO_TRACK_LOADED,{details:o,id:n||0,groupId:E||"",stats:a,networkDetails:m,deliveryDirectives:t});break;case I.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(T.Events.SUBTITLE_TRACK_LOADED,{details:o,id:n||0,groupId:E||"",stats:a,networkDetails:m,deliveryDirectives:t});break}},x}();const g=S},"./src/polyfills/number.ts":(W,O,p)=>{p.r(O),p.d(O,{MAX_SAFE_INTEGER:()=>T,isFiniteNumber:()=>P});var P=Number.isFinite||function(k){return typeof k=="number"&&isFinite(k)},T=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":(W,O,p)=>{p.r(O),p.d(O,{default:()=>T});var P=function(){function k(){}return k.getSilentFrame=function(B,I){switch(B){case"mp4a.40.2":if(I===1)return new Uint8Array([0,200,0,128,35,128]);if(I===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(I===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(I===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(I===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(I===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(I===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(I===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(I===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}},k}();const T=P},"./src/remux/mp4-generator.ts":(W,O,p)=>{p.r(O),p.d(O,{default:()=>k});var P=Math.pow(2,32)-1,T=function(){function C(){}return C.init=function(){C.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var I;for(I in C.types)C.types.hasOwnProperty(I)&&(C.types[I]=[I.charCodeAt(0),I.charCodeAt(1),I.charCodeAt(2),I.charCodeAt(3)]);var A=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),b=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);C.HDLR_TYPES={video:A,audio:b};var _=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),S=new Uint8Array([0,0,0,0,0,0,0,0]);C.STTS=C.STSC=C.STCO=S,C.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),C.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),C.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),C.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var g=new Uint8Array([105,115,111,109]),x=new Uint8Array([97,118,99,49]),y=new Uint8Array([0,0,0,1]);C.FTYP=C.box(C.types.ftyp,g,y,g,x),C.DINF=C.box(C.types.dinf,C.box(C.types.dref,_))},C.box=function(I){for(var A=8,b=arguments.length,_=new Array(b>1?b-1:0),S=1;S<b;S++)_[S-1]=arguments[S];for(var g=_.length,x=g;g--;)A+=_[g].byteLength;var y=new Uint8Array(A);for(y[0]=A>>24&255,y[1]=A>>16&255,y[2]=A>>8&255,y[3]=A&255,y.set(I,4),g=0,A=8;g<x;g++)y.set(_[g],A),A+=_[g].byteLength;return y},C.hdlr=function(I){return C.box(C.types.hdlr,C.HDLR_TYPES[I])},C.mdat=function(I){return C.box(C.types.mdat,I)},C.mdhd=function(I,A){A*=I;var b=Math.floor(A/(P+1)),_=Math.floor(A%(P+1));return C.box(C.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,I>>24&255,I>>16&255,I>>8&255,I&255,b>>24,b>>16&255,b>>8&255,b&255,_>>24,_>>16&255,_>>8&255,_&255,85,196,0,0]))},C.mdia=function(I){return C.box(C.types.mdia,C.mdhd(I.timescale,I.duration),C.hdlr(I.type),C.minf(I))},C.mfhd=function(I){return C.box(C.types.mfhd,new Uint8Array([0,0,0,0,I>>24,I>>16&255,I>>8&255,I&255]))},C.minf=function(I){return I.type==="audio"?C.box(C.types.minf,C.box(C.types.smhd,C.SMHD),C.DINF,C.stbl(I)):C.box(C.types.minf,C.box(C.types.vmhd,C.VMHD),C.DINF,C.stbl(I))},C.moof=function(I,A,b){return C.box(C.types.moof,C.mfhd(I),C.traf(b,A))},C.moov=function(I){for(var A=I.length,b=[];A--;)b[A]=C.trak(I[A]);return C.box.apply(null,[C.types.moov,C.mvhd(I[0].timescale,I[0].duration)].concat(b).concat(C.mvex(I)))},C.mvex=function(I){for(var A=I.length,b=[];A--;)b[A]=C.trex(I[A]);return C.box.apply(null,[C.types.mvex].concat(b))},C.mvhd=function(I,A){A*=I;var b=Math.floor(A/(P+1)),_=Math.floor(A%(P+1)),S=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,I>>24&255,I>>16&255,I>>8&255,I&255,b>>24,b>>16&255,b>>8&255,b&255,_>>24,_>>16&255,_>>8&255,_&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return C.box(C.types.mvhd,S)},C.sdtp=function(I){var A=I.samples||[],b=new Uint8Array(4+A.length),_,S;for(_=0;_<A.length;_++)S=A[_].flags,b[_+4]=S.dependsOn<<4|S.isDependedOn<<2|S.hasRedundancy;return C.box(C.types.sdtp,b)},C.stbl=function(I){return C.box(C.types.stbl,C.stsd(I),C.box(C.types.stts,C.STTS),C.box(C.types.stsc,C.STSC),C.box(C.types.stsz,C.STSZ),C.box(C.types.stco,C.STCO))},C.avc1=function(I){var A=[],b=[],_,S,g;for(_=0;_<I.sps.length;_++)S=I.sps[_],g=S.byteLength,A.push(g>>>8&255),A.push(g&255),A=A.concat(Array.prototype.slice.call(S));for(_=0;_<I.pps.length;_++)S=I.pps[_],g=S.byteLength,b.push(g>>>8&255),b.push(g&255),b=b.concat(Array.prototype.slice.call(S));var x=C.box(C.types.avcC,new Uint8Array([1,A[3],A[4],A[5],255,224|I.sps.length].concat(A).concat([I.pps.length]).concat(b))),y=I.width,l=I.height,u=I.pixelRatio[0],a=I.pixelRatio[1];return C.box(C.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,y>>8&255,y&255,l>>8&255,l&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),x,C.box(C.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),C.box(C.types.pasp,new Uint8Array([u>>24,u>>16&255,u>>8&255,u&255,a>>24,a>>16&255,a>>8&255,a&255])))},C.esds=function(I){var A=I.config.length;return new Uint8Array([0,0,0,0,3,23+A,0,1,0,4,15+A,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([A]).concat(I.config).concat([6,1,2]))},C.mp4a=function(I){var A=I.samplerate;return C.box(C.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,I.channelCount,0,16,0,0,0,0,A>>8&255,A&255,0,0]),C.box(C.types.esds,C.esds(I)))},C.mp3=function(I){var A=I.samplerate;return C.box(C.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,I.channelCount,0,16,0,0,0,0,A>>8&255,A&255,0,0]))},C.stsd=function(I){return I.type==="audio"?I.segmentCodec==="mp3"&&I.codec==="mp3"?C.box(C.types.stsd,C.STSD,C.mp3(I)):C.box(C.types.stsd,C.STSD,C.mp4a(I)):C.box(C.types.stsd,C.STSD,C.avc1(I))},C.tkhd=function(I){var A=I.id,b=I.duration*I.timescale,_=I.width,S=I.height,g=Math.floor(b/(P+1)),x=Math.floor(b%(P+1));return C.box(C.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,A>>24&255,A>>16&255,A>>8&255,A&255,0,0,0,0,g>>24,g>>16&255,g>>8&255,g&255,x>>24,x>>16&255,x>>8&255,x&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,_>>8&255,_&255,0,0,S>>8&255,S&255,0,0]))},C.traf=function(I,A){var b=C.sdtp(I),_=I.id,S=Math.floor(A/(P+1)),g=Math.floor(A%(P+1));return C.box(C.types.traf,C.box(C.types.tfhd,new Uint8Array([0,0,0,0,_>>24,_>>16&255,_>>8&255,_&255])),C.box(C.types.tfdt,new Uint8Array([1,0,0,0,S>>24,S>>16&255,S>>8&255,S&255,g>>24,g>>16&255,g>>8&255,g&255])),C.trun(I,b.length+16+20+8+16+8+8),b)},C.trak=function(I){return I.duration=I.duration||4294967295,C.box(C.types.trak,C.tkhd(I),C.mdia(I))},C.trex=function(I){var A=I.id;return C.box(C.types.trex,new Uint8Array([0,0,0,0,A>>24,A>>16&255,A>>8&255,A&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},C.trun=function(I,A){var b=I.samples||[],_=b.length,S=12+16*_,g=new Uint8Array(S),x,y,l,u,a,s;for(A+=8+S,g.set([I.type==="video"?1:0,0,15,1,_>>>24&255,_>>>16&255,_>>>8&255,_&255,A>>>24&255,A>>>16&255,A>>>8&255,A&255],0),x=0;x<_;x++)y=b[x],l=y.duration,u=y.size,a=y.flags,s=y.cts,g.set([l>>>24&255,l>>>16&255,l>>>8&255,l&255,u>>>24&255,u>>>16&255,u>>>8&255,u&255,a.isLeading<<2|a.dependsOn,a.isDependedOn<<6|a.hasRedundancy<<4|a.paddingValue<<1|a.isNonSync,a.degradPrio&240<<8,a.degradPrio&15,s>>>24&255,s>>>16&255,s>>>8&255,s&255],12+16*x);return C.box(C.types.trun,g)},C.initSegment=function(I){C.types||C.init();var A=C.moov(I),b=new Uint8Array(C.FTYP.byteLength+A.byteLength);return b.set(C.FTYP),b.set(A,C.FTYP.byteLength),b},C}();T.types=void 0,T.HDLR_TYPES=void 0,T.STTS=void 0,T.STSC=void 0,T.STCO=void 0,T.STSZ=void 0,T.VMHD=void 0,T.SMHD=void 0,T.STSD=void 0,T.FTYP=void 0,T.DINF=void 0;const k=T},"./src/remux/mp4-remuxer.ts":(W,O,p)=>{p.r(O),p.d(O,{default:()=>u,flushTextTrackMetadataCueSamples:()=>m,flushTextTrackUserdataCueSamples:()=>v,normalizePts:()=>a});var P=p("./src/polyfills/number.ts"),T=p("./src/remux/aac-helper.ts"),k=p("./src/remux/mp4-generator.ts"),C=p("./src/events.ts"),B=p("./src/errors.ts"),I=p("./src/utils/logger.ts"),A=p("./src/types/loader.ts"),b=p("./src/utils/timescale-conversion.ts");function _(){return _=Object.assign?Object.assign.bind():function(E){for(var r=1;r<arguments.length;r++){var o=arguments[r];for(var t in o)Object.prototype.hasOwnProperty.call(o,t)&&(E[t]=o[t])}return E},_.apply(this,arguments)}var S=10*1e3,g=1024,x=1152,y=null,l=null,u=function(){function E(o,t,f,e){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=o,this.config=t,this.typeSupported=f,this.ISGenerated=!1,y===null){var h=navigator.userAgent||"",d=h.match(/Chrome\/(\d+)/i);y=d?parseInt(d[1]):0}if(l===null){var c=navigator.userAgent.match(/Safari\/(\d+)/i);l=c?parseInt(c[1]):0}}var r=E.prototype;return r.destroy=function(){},r.resetTimeStamp=function(t){I.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=t},r.resetNextTimestamp=function(){I.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},r.resetInitSegment=function(){I.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},r.getVideoStartPts=function(t){var f=!1,e=t.reduce(function(h,d){var c=d.pts-h;return c<-4294967296?(f=!0,a(h,d.pts)):c>0?h:d.pts},t[0].pts);return f&&I.logger.debug("PTS rollover detected"),e},r.remux=function(t,f,e,h,d,c,M,F){var w,U,N,z,V,j,Y=d,X=d,Q=t.pid>-1,te=f.pid>-1,$=f.samples.length,ee=t.samples.length>0,ne=M&&$>0||$>1,oe=(!Q||ee)&&(!te||ne)||this.ISGenerated||M;if(oe){this.ISGenerated||(N=this.generateIS(t,f,d));var ae=this.isVideoContiguous,ie=-1,ce;if(ne&&(ie=s(f.samples),!ae&&this.config.forceKeyFrameOnDiscontinuity))if(j=!0,ie>0){I.logger.warn("[mp4-remuxer]: Dropped "+ie+" out of "+$+" video samples due to a missing keyframe");var me=this.getVideoStartPts(f.samples);f.samples=f.samples.slice(ie),f.dropped+=ie,X+=(f.samples[0].pts-me)/f.inputTimeScale,ce=X}else ie===-1&&(I.logger.warn("[mp4-remuxer]: No keyframe found out of "+$+" video samples"),j=!1);if(this.ISGenerated){if(ee&&ne){var pe=this.getVideoStartPts(f.samples),Ie=a(t.samples[0].pts,pe)-pe,Ee=Ie/f.inputTimeScale;Y+=Math.max(0,Ee),X+=Math.max(0,-Ee)}if(ee){if(t.samplerate||(I.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),N=this.generateIS(t,f,d)),U=this.remuxAudio(t,Y,this.isAudioContiguous,c,te||ne||F===A.PlaylistLevelType.AUDIO?X:void 0),ne){var Se=U?U.endPTS-U.startPTS:0;f.inputTimeScale||(I.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),N=this.generateIS(t,f,d)),w=this.remuxVideo(f,X,ae,Se)}}else ne&&(w=this.remuxVideo(f,X,ae,0));w&&(w.firstKeyFrame=ie,w.independent=ie!==-1,w.firstKeyFramePTS=ce)}}return this.ISGenerated&&(e.samples.length&&(V=m(e,d,this._initPTS,this._initDTS)),h.samples.length&&(z=v(h,d,this._initPTS))),{audio:U,video:w,initSegment:N,independent:j,text:z,id3:V}},r.generateIS=function(t,f,e){var h=t.samples,d=f.samples,c=this.typeSupported,M={},F=!(0,P.isFiniteNumber)(this._initPTS),w="audio/mp4",U,N,z;if(F&&(U=N=1/0),t.config&&h.length){switch(t.timescale=t.samplerate,t.segmentCodec){case"mp3":c.mpeg?(w="audio/mpeg",t.codec=""):c.mp3&&(t.codec="mp3");break}M.audio={id:"audio",container:w,codec:t.codec,initSegment:t.segmentCodec==="mp3"&&c.mpeg?new Uint8Array(0):k.default.initSegment([t]),metadata:{channelCount:t.channelCount}},F&&(z=t.inputTimeScale,U=N=h[0].pts-Math.round(z*e))}if(f.sps&&f.pps&&d.length&&(f.timescale=f.inputTimeScale,M.video={id:"main",container:"video/mp4",codec:f.codec,initSegment:k.default.initSegment([f]),metadata:{width:f.width,height:f.height}},F)){z=f.inputTimeScale;var V=this.getVideoStartPts(d),j=Math.round(z*e);N=Math.min(N,a(d[0].dts,V)-j),U=Math.min(U,V-j)}if(Object.keys(M).length)return this.ISGenerated=!0,F&&(this._initPTS=U,this._initDTS=N),{tracks:M,initPTS:U,timescale:z}},r.remuxVideo=function(t,f,e,h){var d=t.inputTimeScale,c=t.samples,M=[],F=c.length,w=this._initPTS,U=this.nextAvcDts,N=8,z=this.videoSampleDuration,V,j,Y=Number.POSITIVE_INFINITY,X=Number.NEGATIVE_INFINITY,Q=!1;if(!e||U===null){var te=f*d,$=c[0].pts-a(c[0].dts,c[0].pts);U=te-$}for(var ee=0;ee<F;ee++){var ne=c[ee];ne.pts=a(ne.pts-w,U),ne.dts=a(ne.dts-w,U),ne.dts<c[ee>0?ee-1:ee].dts&&(Q=!0)}Q&&c.sort(function(Xt,ei){var Ln=Xt.dts-ei.dts,Pn=Xt.pts-ei.pts;return Ln||Pn}),V=c[0].dts,j=c[c.length-1].dts;var oe=j-V,ae=oe?Math.round(oe/(F-1)):z||t.inputTimeScale/30;if(e){var ie=V-U,ce=ie>ae,me=ie<-1;if((ce||me)&&(ce?I.logger.warn("AVC: "+(0,b.toMsFromMpegTsClock)(ie,!0)+" ms ("+ie+"dts) hole between fragments detected, filling it"):I.logger.warn("AVC: "+(0,b.toMsFromMpegTsClock)(-ie,!0)+" ms ("+ie+"dts) overlapping between fragments detected"),!me||U>c[0].pts)){V=U;var pe=c[0].pts-ie;c[0].dts=V,c[0].pts=pe,I.logger.log("Video: First PTS/DTS adjusted: "+(0,b.toMsFromMpegTsClock)(pe,!0)+"/"+(0,b.toMsFromMpegTsClock)(V,!0)+", delta: "+(0,b.toMsFromMpegTsClock)(ie,!0)+" ms")}}V=Math.max(0,V);for(var Ie=0,Ee=0,Se=0;Se<F;Se++){for(var Te=c[Se],be=Te.units,Ae=be.length,Re=0,Fe=0;Fe<Ae;Fe++)Re+=be[Fe].data.length;Ee+=Re,Ie+=Ae,Te.length=Re,Te.dts=Math.max(Te.dts,V),Y=Math.min(Te.pts,Y),X=Math.max(Te.pts,X)}j=c[F-1].dts;var Ce=Ee+4*Ie+8,Me;try{Me=new Uint8Array(Ce)}catch{this.observer.emit(C.Events.ERROR,C.Events.ERROR,{type:B.ErrorTypes.MUX_ERROR,details:B.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:Ce,reason:"fail allocating video mdat "+Ce});return}var Ge=new DataView(Me.buffer);Ge.setUint32(0,Ce),Me.set(k.default.types.mdat,4);for(var ye=!1,ot=Number.POSITIVE_INFINITY,Xe=Number.POSITIVE_INFINITY,He=Number.NEGATIVE_INFINITY,Ve=Number.NEGATIVE_INFINITY,Ke=0;Ke<F;Ke++){for(var Be=c[Ke],je=Be.units,qe=0,Oe=0,nt=je.length;Oe<nt;Oe++){var Qe=je[Oe],xt=Qe.data,ct=Qe.data.byteLength;Ge.setUint32(N,ct),N+=4,Me.set(xt,N),N+=ct,qe+=4+ct}var mt=void 0;if(Ke<F-1)z=c[Ke+1].dts-Be.dts,mt=c[Ke+1].pts-Be.pts;else{var Bt=this.config,St=Ke>0?Be.dts-c[Ke-1].dts:ae;if(mt=Ke>0?Be.pts-c[Ke-1].pts:ae,Bt.stretchShortVideoTrack&&this.nextAudioPts!==null){var Yt=Math.floor(Bt.maxBufferHole*d),J=(h?Y+h*d:this.nextAudioPts)-Be.pts;J>Yt?(z=J-St,z<0?z=St:ye=!0,I.logger.log("[mp4-remuxer]: It is approximately "+J/90+" ms to the next segment; using duration "+z/90+" ms for the last video frame.")):z=St}else z=St}var ge=Math.round(Be.pts-Be.dts);ot=Math.min(ot,z),He=Math.max(He,z),Xe=Math.min(Xe,mt),Ve=Math.max(Ve,mt),M.push(new i(Be.key,z,qe,ge))}if(M.length){if(y){if(y<70){var We=M[0].flags;We.dependsOn=2,We.isNonSync=0}}else if(l&&Ve-Xe<He-ot&&ae/He<.025&&M[0].cts===0){I.logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");for(var Ze=V,Ye=0,Jr=M.length;Ye<Jr;Ye++){var $r=Ze+M[Ye].duration,xn=Ze+M[Ye].cts;if(Ye<Jr-1){var Sn=$r+M[Ye+1].cts;M[Ye].duration=Sn-xn}else M[Ye].duration=Ye?M[Ye-1].duration:ae;M[Ye].cts=0,Ze=$r}}}console.assert(z!==null,"mp4SampleDuration must be computed"),z=ye||!z?ae:z,this.nextAvcDts=U=j+z,this.videoSampleDuration=z,this.isVideoContiguous=!0;var bn=k.default.moof(t.sequenceNumber++,V,_({},t,{samples:M})),An="video",Dn={data1:bn,data2:Me,startPTS:Y/d,endPTS:(X+z)/d,startDTS:V/d,endDTS:U/d,type:An,hasAudio:!1,hasVideo:!0,nb:M.length,dropped:t.dropped};return t.samples=[],t.dropped=0,console.assert(Me.length,"MDAT length must not be zero"),Dn},r.remuxAudio=function(t,f,e,h,d){var c=t.inputTimeScale,M=t.samplerate?t.samplerate:c,F=c/M,w=t.segmentCodec==="aac"?g:x,U=w*F,N=this._initPTS,z=t.segmentCodec==="mp3"&&this.typeSupported.mpeg,V=[],j=d!==void 0,Y=t.samples,X=z?0:8,Q=this.nextAudioPts||-1,te=f*c;if(this.isAudioContiguous=e=e||Y.length&&Q>0&&(h&&Math.abs(te-Q)<9e3||Math.abs(a(Y[0].pts-N,te)-Q)<20*U),Y.forEach(function(Qe){Qe.pts=a(Qe.pts-N,te)}),!e||Q<0){if(Y=Y.filter(function(Qe){return Qe.pts>=0}),!Y.length)return;d===0?Q=0:h&&!j?Q=Math.max(0,te):Q=Y[0].pts}if(t.segmentCodec==="aac")for(var $=this.config.maxAudioFramesDrift,ee=0,ne=Q;ee<Y.length;ee++){var oe=Y[ee],ae=oe.pts,ie=ae-ne,ce=Math.abs(1e3*ie/c);if(ie<=-$*U&&j)ee===0&&(I.logger.warn("Audio frame @ "+(ae/c).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*ie/c)+" ms."),this.nextAudioPts=Q=ne=ae);else if(ie>=$*U&&ce<S&&j){var me=Math.round(ie/U);ne=ae-me*U,ne<0&&(me--,ne+=U),ee===0&&(this.nextAudioPts=Q=ne),I.logger.warn("[mp4-remuxer]: Injecting "+me+" audio frame @ "+(ne/c).toFixed(3)+"s due to "+Math.round(1e3*ie/c)+" ms gap.");for(var pe=0;pe<me;pe++){var Ie=Math.max(ne,0),Ee=T.default.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);Ee||(I.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),Ee=oe.unit.subarray()),Y.splice(ee,0,{unit:Ee,pts:Ie}),ne+=U,ee++}}oe.pts=ne,ne+=U}for(var Se=null,Te=null,be,Ae=0,Re=Y.length;Re--;)Ae+=Y[Re].unit.byteLength;for(var Fe=0,Ce=Y.length;Fe<Ce;Fe++){var Me=Y[Fe],Ge=Me.unit,ye=Me.pts;if(Te!==null){var ot=V[Fe-1];ot.duration=Math.round((ye-Te)/F)}else if(e&&t.segmentCodec==="aac"&&(ye=Q),Se=ye,Ae>0){Ae+=X;try{be=new Uint8Array(Ae)}catch{this.observer.emit(C.Events.ERROR,C.Events.ERROR,{type:B.ErrorTypes.MUX_ERROR,details:B.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:Ae,reason:"fail allocating audio mdat "+Ae});return}if(!z){var Xe=new DataView(be.buffer);Xe.setUint32(0,Ae),be.set(k.default.types.mdat,4)}}else return;be.set(Ge,X);var He=Ge.byteLength;X+=He,V.push(new i(!0,w,He,0)),Te=ye}var Ve=V.length;if(!!Ve){var Ke=V[V.length-1];this.nextAudioPts=Q=Te+F*Ke.duration;var Be=z?new Uint8Array(0):k.default.moof(t.sequenceNumber++,Se/F,_({},t,{samples:V}));t.samples=[];var je=Se/c,qe=Q/c,Oe="audio",nt={data1:Be,data2:be,startPTS:je,endPTS:qe,startDTS:je,endDTS:qe,type:Oe,hasAudio:!0,hasVideo:!1,nb:Ve};return this.isAudioContiguous=!0,console.assert(be.length,"MDAT length must not be zero"),nt}},r.remuxEmptyAudio=function(t,f,e,h){var d=t.inputTimeScale,c=t.samplerate?t.samplerate:d,M=d/c,F=this.nextAudioPts,w=(F!==null?F:h.startDTS*d)+this._initDTS,U=h.endDTS*d+this._initDTS,N=M*g,z=Math.ceil((U-w)/N),V=T.default.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);if(I.logger.warn("[mp4-remuxer]: remux empty Audio"),!V){I.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}for(var j=[],Y=0;Y<z;Y++){var X=w+Y*N;j.push({unit:V,pts:X,dts:X})}return t.samples=j,this.remuxAudio(t,f,e,!1)},E}();function a(E,r){var o;if(r===null)return E;for(r<E?o=-8589934592:o=8589934592;Math.abs(E-r)>4294967296;)E+=o;return E}function s(E){for(var r=0;r<E.length;r++)if(E[r].key)return r;return-1}function m(E,r,o,t){var f=E.samples.length;if(!!f){for(var e=E.inputTimeScale,h=0;h<f;h++){var d=E.samples[h];d.pts=a(d.pts-o,r*e)/e,d.dts=a(d.dts-t,r*e)/e}var c=E.samples;return E.samples=[],{samples:c}}}function v(E,r,o){var t=E.samples.length;if(!!t){for(var f=E.inputTimeScale,e=0;e<t;e++){var h=E.samples[e];h.pts=a(h.pts-o,r*f)/f}E.samples.sort(function(c,M){return c.pts-M.pts});var d=E.samples;return E.samples=[],{samples:d}}}var i=function(r,o,t,f){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=o,this.size=t,this.cts=f,this.flags=new n(r)},n=function(r){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=r?2:1,this.isNonSync=r?0:1}},"./src/remux/passthrough-remuxer.ts":(W,O,p)=>{p.r(O),p.d(O,{default:()=>b});var P=p("./src/polyfills/number.ts"),T=p("./src/remux/mp4-remuxer.ts"),k=p("./src/utils/mp4-tools.ts"),C=p("./src/loader/fragment.ts"),B=p("./src/utils/logger.ts"),I=function(){function _(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndTime=null}var S=_.prototype;return S.destroy=function(){},S.resetTimeStamp=function(x){this.initPTS=x,this.lastEndTime=null},S.resetNextTimestamp=function(){this.lastEndTime=null},S.resetInitSegment=function(x,y,l,u){this.audioCodec=y,this.videoCodec=l,this.generateInitSegment((0,k.patchEncyptionData)(x,u)),this.emitInitSegment=!0},S.generateInitSegment=function(x){var y=this.audioCodec,l=this.videoCodec;if(!x||!x.byteLength){this.initTracks=void 0,this.initData=void 0;return}var u=this.initData=(0,k.parseInitSegment)(x);y||(y=A(u.audio,C.ElementaryStreamTypes.AUDIO)),l||(l=A(u.video,C.ElementaryStreamTypes.VIDEO));var a={};u.audio&&u.video?a.audiovideo={container:"video/mp4",codec:y+","+l,initSegment:x,id:"main"}:u.audio?a.audio={container:"audio/mp4",codec:y,initSegment:x,id:"audio"}:u.video?a.video={container:"video/mp4",codec:l,initSegment:x,id:"main"}:B.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=a},S.remux=function(x,y,l,u,a){var s,m=this.initPTS,v=this.lastEndTime,i={audio:void 0,video:void 0,text:u,id3:l,initSegment:void 0};(0,P.isFiniteNumber)(v)||(v=this.lastEndTime=a||0);var n=y.samples;if(!n||!n.length)return i;var E={initPTS:void 0,timescale:1},r=this.initData;if((!r||!r.length)&&(this.generateInitSegment(n),r=this.initData),!r||!r.length)return B.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),i;this.emitInitSegment&&(E.tracks=this.initTracks,this.emitInitSegment=!1);var o=(0,k.getStartDTS)(r,n);(0,P.isFiniteNumber)(m)||(this.initPTS=E.initPTS=m=o-a);var t=(0,k.getDuration)(n,r),f=x?o-m:v,e=f+t;(0,k.offsetStartDTS)(r,n,m),t>0?this.lastEndTime=e:(B.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var h=!!r.audio,d=!!r.video,c="";h&&(c+="audio"),d&&(c+="video");var M={data1:n,startPTS:f,startDTS:f,endPTS:e,endDTS:e,type:c,hasAudio:h,hasVideo:d,nb:1,dropped:0};i.audio=M.type==="audio"?M:void 0,i.video=M.type!=="audio"?M:void 0,i.initSegment=E;var F=(s=this.initPTS)!=null?s:0;return i.id3=(0,T.flushTextTrackMetadataCueSamples)(l,a,F,F),u.samples.length&&(i.text=(0,T.flushTextTrackUserdataCueSamples)(u,a,F)),i},_}();function A(_,S){var g=_==null?void 0:_.codec;return g&&g.length>4?g:g==="hvc1"||g==="hev1"?"hvc1.1.c.L120.90":g==="av01"?"av01.0.04M.08":g==="avc1"||S===C.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}const b=I},"./src/task-loop.ts":(W,O,p)=>{p.r(O),p.d(O,{default:()=>P});var P=function(){function T(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var k=T.prototype;return k.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},k.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},k.onHandlerDestroyed=function(){},k.hasInterval=function(){return!!this._tickInterval},k.hasNextTick=function(){return!!this._tickTimer},k.setInterval=function(B){return this._tickInterval?!1:(this._tickInterval=self.setInterval(this._boundTick,B),!0)},k.clearInterval=function(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1},k.clearNextTick=function(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1},k.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},k.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},k.doTick=function(){},T}()},"./src/types/cmcd.ts":(W,O,p)=>{p.r(O),p.d(O,{CMCDObjectType:()=>T,CMCDStreamType:()=>C,CMCDStreamingFormat:()=>k,CMCDVersion:()=>P});var P=1,T;(function(B){B.MANIFEST="m",B.AUDIO="a",B.VIDEO="v",B.MUXED="av",B.INIT="i",B.CAPTION="c",B.TIMED_TEXT="tt",B.KEY="k",B.OTHER="o"})(T||(T={}));var k;(function(B){B.DASH="d",B.HLS="h",B.SMOOTH="s",B.OTHER="o"})(k||(k={}));var C;(function(B){B.VOD="v",B.LIVE="l"})(C||(C={}))},"./src/types/demuxer.ts":(W,O,p)=>{p.r(O),p.d(O,{MetadataSchema:()=>P});var P;(function(T){T.audioId3="org.id3",T.dateRange="com.apple.quicktime.HLS",T.emsg="https://aomedia.org/emsg/ID3"})(P||(P={}))},"./src/types/level.ts":(W,O,p)=>{p.r(O),p.d(O,{HdcpLevels:()=>B,HlsSkip:()=>I,HlsUrlParameters:()=>b,Level:()=>_,getSkipValue:()=>A});function P(S,g){for(var x=0;x<g.length;x++){var y=g[x];y.enumerable=y.enumerable||!1,y.configurable=!0,"value"in y&&(y.writable=!0),Object.defineProperty(S,k(y.key),y)}}function T(S,g,x){return g&&P(S.prototype,g),x&&P(S,x),Object.defineProperty(S,"prototype",{writable:!1}),S}function k(S){var g=C(S,"string");return typeof g=="symbol"?g:String(g)}function C(S,g){if(typeof S!="object"||S===null)return S;var x=S[Symbol.toPrimitive];if(x!==void 0){var y=x.call(S,g||"default");if(typeof y!="object")return y;throw new TypeError("@@toPrimitive must return a primitive value.")}return(g==="string"?String:Number)(S)}var B=["NONE","TYPE-0","TYPE-1","TYPE-2",null],I;(function(S){S.No="",S.Yes="YES",S.v2="v2"})(I||(I={}));function A(S,g){var x=S.canSkipUntil,y=S.canSkipDateRanges,l=S.endSN,u=g!==void 0?g-l:0;return x&&u<x?y?I.v2:I.Yes:I.No}var b=function(){function S(x,y,l){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=x,this.part=y,this.skip=l}var g=S.prototype;return g.addDirectives=function(y){var l=new self.URL(y);return this.msn!==void 0&&l.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&l.searchParams.set("_HLS_part",this.part.toString()),this.skip&&l.searchParams.set("_HLS_skip",this.skip),l.href},S}(),_=function(){function S(g){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[g.url],this.attrs=g.attrs,this.bitrate=g.bitrate,g.details&&(this.details=g.details),this.id=g.id||0,this.name=g.name,this.width=g.width||0,this.height=g.height||0,this.audioCodec=g.audioCodec,this.videoCodec=g.videoCodec,this.unknownCodecs=g.unknownCodecs,this.codecSet=[g.videoCodec,g.audioCodec].filter(function(x){return x}).join(",").replace(/\.[^.,]+/g,"")}return T(S,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(x){var y=x%this.url.length;this._urlId!==y&&(this.details=void 0,this._urlId=y)}}]),S}()},"./src/types/loader.ts":(W,O,p)=>{p.r(O),p.d(O,{PlaylistContextType:()=>P,PlaylistLevelType:()=>T});var P;(function(k){k.MANIFEST="manifest",k.LEVEL="level",k.AUDIO_TRACK="audioTrack",k.SUBTITLE_TRACK="subtitleTrack"})(P||(P={}));var T;(function(k){k.MAIN="main",k.AUDIO="audio",k.SUBTITLE="subtitle"})(T||(T={}))},"./src/types/transmuxer.ts":(W,O,p)=>{p.r(O),p.d(O,{ChunkMetadata:()=>P});var P=function(C,B,I,A,b,_){A===void 0&&(A=0),b===void 0&&(b=-1),_===void 0&&(_=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=T(),this.buffering={audio:T(),video:T(),audiovideo:T()},this.level=C,this.sn=B,this.id=I,this.size=A,this.part=b,this.partial=_};function T(){return{start:0,executeStart:0,executeEnd:0,end:0}}},"./src/utils/attr-list.ts":(W,O,p)=>{p.r(O),p.d(O,{AttrList:()=>k});var P=/^(\d+)x(\d+)$/,T=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,k=function(){function C(I){typeof I=="string"&&(I=C.parseAttrList(I));for(var A in I)I.hasOwnProperty(A)&&(this[A]=I[A])}var B=C.prototype;return B.decimalInteger=function(A){var b=parseInt(this[A],10);return b>Number.MAX_SAFE_INTEGER?1/0:b},B.hexadecimalInteger=function(A){if(this[A]){var b=(this[A]||"0x").slice(2);b=(b.length&1?"0":"")+b;for(var _=new Uint8Array(b.length/2),S=0;S<b.length/2;S++)_[S]=parseInt(b.slice(S*2,S*2+2),16);return _}else return null},B.hexadecimalIntegerAsNumber=function(A){var b=parseInt(this[A],16);return b>Number.MAX_SAFE_INTEGER?1/0:b},B.decimalFloatingPoint=function(A){return parseFloat(this[A])},B.optionalFloat=function(A,b){var _=this[A];return _?parseFloat(_):b},B.enumeratedString=function(A){return this[A]},B.bool=function(A){return this[A]==="YES"},B.decimalResolution=function(A){var b=P.exec(this[A]);if(b!==null)return{width:parseInt(b[1],10),height:parseInt(b[2],10)}},C.parseAttrList=function(A){var b,_={},S='"';for(T.lastIndex=0;(b=T.exec(A))!==null;){var g=b[2];g.indexOf(S)===0&&g.lastIndexOf(S)===g.length-1&&(g=g.slice(1,-1)),_[b[1]]=g}return _},C}()},"./src/utils/binary-search.ts":(W,O,p)=>{p.r(O),p.d(O,{default:()=>T});var P={search:function(C,B){for(var I=0,A=C.length-1,b=null,_=null;I<=A;){b=(I+A)/2|0,_=C[b];var S=B(_);if(S>0)I=b+1;else if(S<0)A=b-1;else return _}return null}};const T=P},"./src/utils/buffer-helper.ts":(W,O,p)=>{p.r(O),p.d(O,{BufferHelper:()=>k});var P=p("./src/utils/logger.ts"),T={length:0,start:function(){return 0},end:function(){return 0}},k=function(){function C(){}return C.isBuffered=function(I,A){try{if(I){for(var b=C.getBuffered(I),_=0;_<b.length;_++)if(A>=b.start(_)&&A<=b.end(_))return!0}}catch{}return!1},C.bufferInfo=function(I,A,b){try{if(I){var _=C.getBuffered(I),S=[],g;for(g=0;g<_.length;g++)S.push({start:_.start(g),end:_.end(g)});return this.bufferedInfo(S,A,b)}}catch{}return{len:0,start:A,end:A,nextStart:void 0}},C.bufferedInfo=function(I,A,b){A=Math.max(0,A),I.sort(function(i,n){var E=i.start-n.start;return E||n.end-i.end});var _=[];if(b)for(var S=0;S<I.length;S++){var g=_.length;if(g){var x=_[g-1].end;I[S].start-x<b?I[S].end>x&&(_[g-1].end=I[S].end):_.push(I[S])}else _.push(I[S])}else _=I;for(var y=0,l,u=A,a=A,s=0;s<_.length;s++){var m=_[s].start,v=_[s].end;if(A+b>=m&&A<v)u=m,a=v,y=a-A;else if(A+b<m){l=m;break}}return{len:y,start:u||0,end:a||0,nextStart:l}},C.getBuffered=function(I){try{return I.buffered}catch(A){return P.logger.log("failed to get media.buffered",A),T}},C}()},"./src/utils/cea-608-parser.ts":(W,O,p)=>{p.r(O),p.d(O,{CaptionScreen:()=>s,Row:()=>a,default:()=>r});var P=p("./src/utils/logger.ts"),T={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},k=function(t){var f=t;return T.hasOwnProperty(t)&&(f=T[t]),String.fromCharCode(f)},C=15,B=100,I={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},A={17:2,18:4,21:6,22:8,23:10,19:13,20:15},b={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},_={25:2,26:4,29:6,30:8,31:10,27:13,28:15},S=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],g;(function(o){o[o.ERROR=0]="ERROR",o[o.TEXT=1]="TEXT",o[o.WARNING=2]="WARNING",o[o.INFO=2]="INFO",o[o.DEBUG=3]="DEBUG",o[o.DATA=3]="DATA"})(g||(g={}));var x=function(){function o(){this.time=null,this.verboseLevel=g.ERROR}var t=o.prototype;return t.log=function(e,h){if(this.verboseLevel>=e){var d=typeof h=="function"?h():h;P.logger.log(this.time+" ["+e+"] "+d)}},o}(),y=function(t){for(var f=[],e=0;e<t.length;e++)f.push(t[e].toString(16));return f},l=function(){function o(f,e,h,d,c){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=f||"white",this.underline=e||!1,this.italics=h||!1,this.background=d||"black",this.flash=c||!1}var t=o.prototype;return t.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},t.setStyles=function(e){for(var h=["foreground","underline","italics","background","flash"],d=0;d<h.length;d++){var c=h[d];e.hasOwnProperty(c)&&(this[c]=e[c])}},t.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},t.equals=function(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash},t.copy=function(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash},t.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},o}(),u=function(){function o(f,e,h,d,c,M){this.uchar=void 0,this.penState=void 0,this.uchar=f||" ",this.penState=new l(e,h,d,c,M)}var t=o.prototype;return t.reset=function(){this.uchar=" ",this.penState.reset()},t.setChar=function(e,h){this.uchar=e,this.penState.copy(h)},t.setPenState=function(e){this.penState.copy(e)},t.equals=function(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)},t.copy=function(e){this.uchar=e.uchar,this.penState.copy(e.penState)},t.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},o}(),a=function(){function o(f){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var e=0;e<B;e++)this.chars.push(new u);this.logger=f,this.pos=0,this.currPenState=new l}var t=o.prototype;return t.equals=function(e){for(var h=!0,d=0;d<B;d++)if(!this.chars[d].equals(e.chars[d])){h=!1;break}return h},t.copy=function(e){for(var h=0;h<B;h++)this.chars[h].copy(e.chars[h])},t.isEmpty=function(){for(var e=!0,h=0;h<B;h++)if(!this.chars[h].isEmpty()){e=!1;break}return e},t.setCursor=function(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(g.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>B&&(this.logger.log(g.DEBUG,"Too large cursor position "+this.pos),this.pos=B)},t.moveCursor=function(e){var h=this.pos+e;if(e>1)for(var d=this.pos+1;d<h+1;d++)this.chars[d].setPenState(this.currPenState);this.setCursor(h)},t.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},t.insertChar=function(e){var h=this;e>=144&&this.backSpace();var d=k(e);if(this.pos>=B){this.logger.log(g.ERROR,function(){return"Cannot insert "+e.toString(16)+" ("+d+") at position "+h.pos+". Skipping it!"});return}this.chars[this.pos].setChar(d,this.currPenState),this.moveCursor(1)},t.clearFromPos=function(e){var h;for(h=e;h<B;h++)this.chars[h].reset()},t.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},t.clearToEndOfRow=function(){this.clearFromPos(this.pos)},t.getTextString=function(){for(var e=[],h=!0,d=0;d<B;d++){var c=this.chars[d].uchar;c!==" "&&(h=!1),e.push(c)}return h?"":e.join("")},t.setPenStyles=function(e){this.currPenState.setStyles(e);var h=this.chars[this.pos];h.setPenState(this.currPenState)},o}(),s=function(){function o(f){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var e=0;e<C;e++)this.rows.push(new a(f));this.logger=f,this.currRow=C-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var t=o.prototype;return t.reset=function(){for(var e=0;e<C;e++)this.rows[e].clear();this.currRow=C-1},t.equals=function(e){for(var h=!0,d=0;d<C;d++)if(!this.rows[d].equals(e.rows[d])){h=!1;break}return h},t.copy=function(e){for(var h=0;h<C;h++)this.rows[h].copy(e.rows[h])},t.isEmpty=function(){for(var e=!0,h=0;h<C;h++)if(!this.rows[h].isEmpty()){e=!1;break}return e},t.backSpace=function(){var e=this.rows[this.currRow];e.backSpace()},t.clearToEndOfRow=function(){var e=this.rows[this.currRow];e.clearToEndOfRow()},t.insertChar=function(e){var h=this.rows[this.currRow];h.insertChar(e)},t.setPen=function(e){var h=this.rows[this.currRow];h.setPenStyles(e)},t.moveCursor=function(e){var h=this.rows[this.currRow];h.moveCursor(e)},t.setCursor=function(e){this.logger.log(g.INFO,"setCursor: "+e);var h=this.rows[this.currRow];h.setCursor(e)},t.setPAC=function(e){this.logger.log(g.INFO,function(){return"pacData = "+JSON.stringify(e)});var h=e.row-1;if(this.nrRollUpRows&&h<this.nrRollUpRows-1&&(h=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==h){for(var d=0;d<C;d++)this.rows[d].clear();var c=this.currRow+1-this.nrRollUpRows,M=this.lastOutputScreen;if(M){var F=M.rows[c].cueStartTime,w=this.logger.time;if(F&&w!==null&&F<w)for(var U=0;U<this.nrRollUpRows;U++)this.rows[h-this.nrRollUpRows+U+1].copy(M.rows[c+U])}}this.currRow=h;var N=this.rows[this.currRow];if(e.indent!==null){var z=e.indent,V=Math.max(z-1,0);N.setCursor(e.indent),e.color=N.chars[V].penState.foreground}var j={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(j)},t.setBkgData=function(e){this.logger.log(g.INFO,function(){return"bkgData = "+JSON.stringify(e)}),this.backSpace(),this.setPen(e),this.insertChar(32)},t.setRollUpRows=function(e){this.nrRollUpRows=e},t.rollUp=function(){var e=this;if(this.nrRollUpRows===null){this.logger.log(g.DEBUG,"roll_up but nrRollUpRows not set yet");return}this.logger.log(g.TEXT,function(){return e.getDisplayText()});var h=this.currRow+1-this.nrRollUpRows,d=this.rows.splice(h,1)[0];d.clear(),this.rows.splice(this.currRow,0,d),this.logger.log(g.INFO,"Rolling up")},t.getDisplayText=function(e){e=e||!1;for(var h=[],d="",c=-1,M=0;M<C;M++){var F=this.rows[M].getTextString();F&&(c=M+1,e?h.push("Row "+c+": '"+F+"'"):h.push(F.trim()))}return h.length>0&&(e?d="["+h.join(" | ")+"]":d=h.join(`
`)),d},t.getTextAndFormat=function(){return this.rows},o}(),m=function(){function o(f,e,h){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=f,this.outputFilter=e,this.mode=null,this.verbose=0,this.displayedMemory=new s(h),this.nonDisplayedMemory=new s(h),this.lastOutputScreen=new s(h),this.currRollUpRow=this.displayedMemory.rows[C-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=h}var t=o.prototype;return t.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[C-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},t.getHandler=function(){return this.outputFilter},t.setHandler=function(e){this.outputFilter=e},t.setPAC=function(e){this.writeScreen.setPAC(e)},t.setBkgData=function(e){this.writeScreen.setBkgData(e)},t.setMode=function(e){e!==this.mode&&(this.mode=e,this.logger.log(g.INFO,function(){return"MODE="+e}),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)},t.insertChars=function(e){for(var h=this,d=0;d<e.length;d++)this.writeScreen.insertChar(e[d]);var c=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(g.INFO,function(){return c+": "+h.writeScreen.getDisplayText(!0)}),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(g.TEXT,function(){return"DISPLAYED: "+h.displayedMemory.getDisplayText(!0)}),this.outputDataUpdate())},t.ccRCL=function(){this.logger.log(g.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},t.ccBS=function(){this.logger.log(g.INFO,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},t.ccAOF=function(){},t.ccAON=function(){},t.ccDER=function(){this.logger.log(g.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},t.ccRU=function(e){this.logger.log(g.INFO,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)},t.ccFON=function(){this.logger.log(g.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},t.ccRDC=function(){this.logger.log(g.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},t.ccTR=function(){this.logger.log(g.INFO,"TR"),this.setMode("MODE_TEXT")},t.ccRTD=function(){this.logger.log(g.INFO,"RTD"),this.setMode("MODE_TEXT")},t.ccEDM=function(){this.logger.log(g.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},t.ccCR=function(){this.logger.log(g.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},t.ccENM=function(){this.logger.log(g.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},t.ccEOC=function(){var e=this;if(this.logger.log(g.INFO,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var h=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=h,this.writeScreen=this.nonDisplayedMemory,this.logger.log(g.TEXT,function(){return"DISP: "+e.displayedMemory.getDisplayText()})}this.outputDataUpdate(!0)},t.ccTO=function(e){this.logger.log(g.INFO,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)},t.ccMIDROW=function(e){var h={flash:!1};if(h.underline=e%2===1,h.italics=e>=46,h.italics)h.foreground="white";else{var d=Math.floor(e/2)-16,c=["white","green","blue","cyan","red","yellow","magenta"];h.foreground=c[d]}this.logger.log(g.INFO,"MIDROW: "+JSON.stringify(h)),this.writeScreen.setPen(h)},t.outputDataUpdate=function(e){e===void 0&&(e=!1);var h=this.logger.time;h!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=h:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,h,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:h),this.lastOutputScreen.copy(this.displayedMemory))},t.cueSplitAtTime=function(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))},o}(),v=function(){function o(f,e,h){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var d=new x;this.channels=[null,new m(f,e,d),new m(f+1,h,d)],this.cmdHistory=E(),this.logger=d}var t=o.prototype;return t.getHandler=function(e){return this.channels[e].getHandler()},t.setHandler=function(e,h){this.channels[e].setHandler(h)},t.addData=function(e,h){var d,c,M,F=!1;this.logger.time=e;for(var w=0;w<h.length;w+=2)if(c=h[w]&127,M=h[w+1]&127,!(c===0&&M===0)){if(this.logger.log(g.DATA,"["+y([h[w],h[w+1]])+"] -> ("+y([c,M])+")"),d=this.parseCmd(c,M),d||(d=this.parseMidrow(c,M)),d||(d=this.parsePAC(c,M)),d||(d=this.parseBackgroundAttributes(c,M)),!d&&(F=this.parseChars(c,M),F)){var U=this.currentChannel;if(U&&U>0){var N=this.channels[U];N.insertChars(F)}else this.logger.log(g.WARNING,"No channel found yet. TEXT-MODE?")}!d&&!F&&this.logger.log(g.WARNING,"Couldn't parse cleaned data "+y([c,M])+" orig: "+y([h[w],h[w+1]]))}},t.parseCmd=function(e,h){var d=this.cmdHistory,c=(e===20||e===28||e===21||e===29)&&h>=32&&h<=47,M=(e===23||e===31)&&h>=33&&h<=35;if(!(c||M))return!1;if(n(e,h,d))return i(null,null,d),this.logger.log(g.DEBUG,"Repeated command ("+y([e,h])+") is dropped"),!0;var F=e===20||e===21||e===23?1:2,w=this.channels[F];return e===20||e===21||e===28||e===29?h===32?w.ccRCL():h===33?w.ccBS():h===34?w.ccAOF():h===35?w.ccAON():h===36?w.ccDER():h===37?w.ccRU(2):h===38?w.ccRU(3):h===39?w.ccRU(4):h===40?w.ccFON():h===41?w.ccRDC():h===42?w.ccTR():h===43?w.ccRTD():h===44?w.ccEDM():h===45?w.ccCR():h===46?w.ccENM():h===47&&w.ccEOC():w.ccTO(h-32),i(e,h,d),this.currentChannel=F,!0},t.parseMidrow=function(e,h){var d=0;if((e===17||e===25)&&h>=32&&h<=47){if(e===17?d=1:d=2,d!==this.currentChannel)return this.logger.log(g.ERROR,"Mismatch channel in midrow parsing"),!1;var c=this.channels[d];return c?(c.ccMIDROW(h),this.logger.log(g.DEBUG,"MIDROW ("+y([e,h])+")"),!0):!1}return!1},t.parsePAC=function(e,h){var d,c=this.cmdHistory,M=(e>=17&&e<=23||e>=25&&e<=31)&&h>=64&&h<=127,F=(e===16||e===24)&&h>=64&&h<=95;if(!(M||F))return!1;if(n(e,h,c))return i(null,null,c),!0;var w=e<=23?1:2;h>=64&&h<=95?d=w===1?I[e]:b[e]:d=w===1?A[e]:_[e];var U=this.channels[w];return U?(U.setPAC(this.interpretPAC(d,h)),i(e,h,c),this.currentChannel=w,!0):!1},t.interpretPAC=function(e,h){var d,c={color:null,italics:!1,indent:null,underline:!1,row:e};return h>95?d=h-96:d=h-64,c.underline=(d&1)===1,d<=13?c.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(d/2)]:d<=15?(c.italics=!0,c.color="white"):c.indent=Math.floor((d-16)/2)*4,c},t.parseChars=function(e,h){var d,c=null,M=null;if(e>=25?(d=2,M=e-8):(d=1,M=e),M>=17&&M<=19){var F;M===17?F=h+80:M===18?F=h+112:F=h+144,this.logger.log(g.INFO,"Special char '"+k(F)+"' in channel "+d),c=[F]}else e>=32&&e<=127&&(c=h===0?[e]:[e,h]);if(c){var w=y(c);this.logger.log(g.DEBUG,"Char codes =  "+w.join(",")),i(e,h,this.cmdHistory)}return c},t.parseBackgroundAttributes=function(e,h){var d=(e===16||e===24)&&h>=32&&h<=47,c=(e===23||e===31)&&h>=45&&h<=47;if(!(d||c))return!1;var M,F={};e===16||e===24?(M=Math.floor((h-32)/2),F.background=S[M],h%2===1&&(F.background=F.background+"_semi")):h===45?F.background="transparent":(F.foreground="black",h===47&&(F.underline=!0));var w=e<=23?1:2,U=this.channels[w];return U.setBkgData(F),i(e,h,this.cmdHistory),!0},t.reset=function(){for(var e=0;e<Object.keys(this.channels).length;e++){var h=this.channels[e];h&&h.reset()}this.cmdHistory=E()},t.cueSplitAtTime=function(e){for(var h=0;h<this.channels.length;h++){var d=this.channels[h];d&&d.cueSplitAtTime(e)}},o}();function i(o,t,f){f.a=o,f.b=t}function n(o,t,f){return f.a===o&&f.b===t}function E(){return{a:null,b:null}}const r=v},"./src/utils/codecs.ts":(W,O,p)=>{p.r(O),p.d(O,{isCodecSupportedInMp4:()=>k,isCodecType:()=>T});var P={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dva1:!0,dvav:!0,dvh1:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function T(C,B){var I=P[B];return!!I&&I[C.slice(0,4)]===!0}function k(C,B){return MediaSource.isTypeSupported((B||"video")+'/mp4;codecs="'+C+'"')}},"./src/utils/cues.ts":(W,O,p)=>{p.r(O),p.d(O,{default:()=>I});var P=p("./src/utils/vttparser.ts"),T=p("./src/utils/webvtt-parser.ts"),k=p("./src/utils/texttrack-utils.ts"),C=/\s/,B={newCue:function(b,_,S,g){for(var x=[],y,l,u,a,s,m=self.VTTCue||self.TextTrackCue,v=0;v<g.rows.length;v++)if(y=g.rows[v],u=!0,a=0,s="",!y.isEmpty()){for(var i=0;i<y.chars.length;i++)C.test(y.chars[i].uchar)&&u?a++:(s+=y.chars[i].uchar,u=!1);y.cueStartTime=_,_===S&&(S+=1e-4),a>=16?a--:a++;var n=(0,P.fixLineBreaks)(s.trim()),E=(0,T.generateCueId)(_,S,n);(!b||!b.cues||!b.cues.getCueById(E))&&(l=new m(_,S,n),l.id=E,l.line=v+1,l.align="left",l.position=10+Math.min(80,Math.floor(a*8/32)*10),x.push(l))}return b&&x.length&&(x.sort(function(r,o){return r.line==="auto"||o.line==="auto"?0:r.line>8&&o.line>8?o.line-r.line:r.line-o.line}),x.forEach(function(r){return(0,k.addCueToTrack)(b,r)})),x}};const I=B},"./src/utils/discontinuities.ts":(W,O,p)=>{p.r(O),p.d(O,{adjustSlidingStart:()=>b,alignMediaPlaylistByPDT:()=>x,alignPDT:()=>g,alignStream:()=>_,findDiscontinuousReferenceFrag:()=>I,findFirstFragWithCC:()=>C,shouldAlignOnDiscontinuities:()=>B});var P=p("./src/polyfills/number.ts"),T=p("./src/utils/logger.ts"),k=p("./src/controller/level-helper.ts");function C(y,l){for(var u=null,a=0,s=y.length;a<s;a++){var m=y[a];if(m&&m.cc===l){u=m;break}}return u}function B(y,l,u){return!!(l.details&&(u.endCC>u.startCC||y&&y.cc<u.startCC))}function I(y,l,u){var a=y.fragments,s=l.fragments;if(!s.length||!a.length){T.logger.log("No fragments to align");return}var m=C(a,s[0].cc);if(!m||m&&!m.startPTS){T.logger.log("No frag in previous level to align on");return}return m}function A(y,l){if(y){var u=y.start+l;y.start=y.startPTS=u,y.endPTS=u+y.duration}}function b(y,l){for(var u=l.fragments,a=0,s=u.length;a<s;a++)A(u[a],y);l.fragmentHint&&A(l.fragmentHint,y),l.alignedSliding=!0}function _(y,l,u){!l||(S(y,u,l),!u.alignedSliding&&l.details&&g(u,l.details),!u.alignedSliding&&l.details&&!u.skippedSegments&&(0,k.adjustSliding)(l.details,u))}function S(y,l,u){if(B(y,u,l)){var a=I(u.details,l);a&&(0,P.isFiniteNumber)(a.start)&&(T.logger.log("Adjusting PTS using last level due to CC increase within current level "+l.url),b(a.start,l))}}function g(y,l){if(!(!l.fragments.length||!y.hasProgramDateTime||!l.hasProgramDateTime)){var u=l.fragments[0].programDateTime,a=y.fragments[0].programDateTime,s=(a-u)/1e3+l.fragments[0].start;s&&(0,P.isFiniteNumber)(s)&&(T.logger.log("Adjusting PTS using programDateTime delta "+(a-u)+"ms, sliding:"+s.toFixed(3)+" "+y.url+" "),b(s,y))}}function x(y,l){if(!(!y.hasProgramDateTime||!l.hasProgramDateTime)){var u=y.fragments,a=l.fragments;if(!(!u.length||!a.length)){var s=Math.round(a.length/2)-1,m=a[s],v=C(u,m.cc)||u[Math.round(u.length/2)-1],i=m.programDateTime,n=v.programDateTime;if(!(i===null||n===null)){var E=(n-i)/1e3-(v.start-m.start);b(E,y)}}}}},"./src/utils/ewma-bandwidth-estimator.ts":(W,O,p)=>{p.r(O),p.d(O,{default:()=>k});var P=p("./src/utils/ewma.ts"),T=function(){function C(I,A,b){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=b,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new P.default(I),this.fast_=new P.default(A)}var B=C.prototype;return B.update=function(A,b){var _=this.slow_,S=this.fast_;this.slow_.halfLife!==A&&(this.slow_=new P.default(A,_.getEstimate(),_.getTotalWeight())),this.fast_.halfLife!==b&&(this.fast_=new P.default(b,S.getEstimate(),S.getTotalWeight()))},B.sample=function(A,b){A=Math.max(A,this.minDelayMs_);var _=8*b,S=A/1e3,g=_/S;this.fast_.sample(S,g),this.slow_.sample(S,g)},B.canEstimate=function(){var A=this.fast_;return A&&A.getTotalWeight()>=this.minWeight_},B.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},B.destroy=function(){},C}();const k=T},"./src/utils/ewma.ts":(W,O,p)=>{p.r(O),p.d(O,{default:()=>T});var P=function(){function k(B,I,A){I===void 0&&(I=0),A===void 0&&(A=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=B,this.alpha_=B?Math.exp(Math.log(.5)/B):0,this.estimate_=I,this.totalWeight_=A}var C=k.prototype;return C.sample=function(I,A){var b=Math.pow(this.alpha_,I);this.estimate_=A*(1-b)+b*this.estimate_,this.totalWeight_+=I},C.getTotalWeight=function(){return this.totalWeight_},C.getEstimate=function(){if(this.alpha_){var I=1-Math.pow(this.alpha_,this.totalWeight_);if(I)return this.estimate_/I}return this.estimate_},k}();const T=P},"./src/utils/fetch-loader.ts":(W,O,p)=>{p.r(O),p.d(O,{default:()=>s,fetchSupported:()=>x});var P=p("./src/polyfills/number.ts"),T=p("./src/loader/load-stats.ts"),k=p("./src/demux/chunk-cache.ts");function C(m,v){m.prototype=Object.create(v.prototype),m.prototype.constructor=m,_(m,v)}function B(m){var v=typeof Map=="function"?new Map:void 0;return B=function(n){if(n===null||!b(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof v<"u"){if(v.has(n))return v.get(n);v.set(n,E)}function E(){return I(n,arguments,S(this).constructor)}return E.prototype=Object.create(n.prototype,{constructor:{value:E,enumerable:!1,writable:!0,configurable:!0}}),_(E,n)},B(m)}function I(m,v,i){return A()?I=Reflect.construct.bind():I=function(E,r,o){var t=[null];t.push.apply(t,r);var f=Function.bind.apply(E,t),e=new f;return o&&_(e,o.prototype),e},I.apply(null,arguments)}function A(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function b(m){return Function.toString.call(m).indexOf("[native code]")!==-1}function _(m,v){return _=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,E){return n.__proto__=E,n},_(m,v)}function S(m){return S=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(i){return i.__proto__||Object.getPrototypeOf(i)},S(m)}function g(){return g=Object.assign?Object.assign.bind():function(m){for(var v=1;v<arguments.length;v++){var i=arguments[v];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(m[n]=i[n])}return m},g.apply(this,arguments)}function x(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}var y=function(){function m(i){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=i.fetchSetup||u,this.controller=new self.AbortController,this.stats=new T.LoadStats}var v=m.prototype;return v.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},v.abortInternal=function(){var n=this.response;(!n||!n.ok)&&(this.stats.aborted=!0,this.controller.abort())},v.abort=function(){var n;this.abortInternal(),(n=this.callbacks)!==null&&n!==void 0&&n.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},v.load=function(n,E,r){var o=this,t=this.stats;if(t.loading.start)throw new Error("Loader can only be used once.");t.loading.start=self.performance.now();var f=l(n,this.controller.signal),e=r.onProgress,h=n.responseType==="arraybuffer",d=h?"byteLength":"length";this.context=n,this.config=E,this.callbacks=r,this.request=this.fetchSetup(n,f),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){o.abortInternal(),r.onTimeout(t,n,o.response)},E.timeout),self.fetch(this.request).then(function(c){if(o.response=o.loader=c,!c.ok){var M=c.status,F=c.statusText;throw new a(F||"fetch, bad network response",M,c)}return t.loading.first=Math.max(self.performance.now(),t.loading.start),t.total=parseInt(c.headers.get("Content-Length")||"0"),e&&(0,P.isFiniteNumber)(E.highWaterMark)?o.loadProgressively(c,t,n,E.highWaterMark,e):h?c.arrayBuffer():c.text()}).then(function(c){var M=o.response;self.clearTimeout(o.requestTimeout),t.loading.end=Math.max(self.performance.now(),t.loading.first);var F=c[d];F&&(t.loaded=t.total=F);var w={url:M.url,data:c};e&&!(0,P.isFiniteNumber)(E.highWaterMark)&&e(t,n,c,M),r.onSuccess(w,t,n,M)}).catch(function(c){if(self.clearTimeout(o.requestTimeout),!t.aborted){var M=c&&c.code||0,F=c?c.message:null;r.onError({code:M,text:F},n,c?c.details:null)}})},v.getCacheAge=function(){var n=null;if(this.response){var E=this.response.headers.get("age");n=E?parseFloat(E):null}return n},v.loadProgressively=function(n,E,r,o,t){o===void 0&&(o=0);var f=new k.default,e=n.body.getReader(),h=function d(){return e.read().then(function(c){if(c.done)return f.dataLength&&t(E,r,f.flush(),n),Promise.resolve(new ArrayBuffer(0));var M=c.value,F=M.length;return E.loaded+=F,F<o||f.dataLength?(f.push(M),f.dataLength>=o&&t(E,r,f.flush(),n)):t(E,r,M,n),d()}).catch(function(){return Promise.reject()})};return h()},m}();function l(m,v){var i={method:"GET",mode:"cors",credentials:"same-origin",signal:v,headers:new self.Headers(g({},m.headers))};return m.rangeEnd&&i.headers.set("Range","bytes="+m.rangeStart+"-"+String(m.rangeEnd-1)),i}function u(m,v){return new self.Request(m.url,v)}var a=function(m){C(v,m);function v(i,n,E){var r;return r=m.call(this,i)||this,r.code=void 0,r.details=void 0,r.code=n,r.details=E,r}return v}(B(Error));const s=y},"./src/utils/hex.ts":(W,O,p)=>{p.r(O),p.d(O,{default:()=>T});var P={hexDump:function(C){for(var B="",I=0;I<C.length;I++){var A=C[I].toString(16);A.length<2&&(A="0"+A),B+=A}return B}};const T=P},"./src/utils/imsc1-ttml-parser.ts":(W,O,p)=>{p.r(O),p.d(O,{IMSC1_CODEC:()=>b,parseIMSC1:()=>x});var P=p("./src/utils/mp4-tools.ts"),T=p("./src/utils/vttparser.ts"),k=p("./src/utils/vttcue.ts"),C=p("./src/demux/id3.ts"),B=p("./src/utils/timescale-conversion.ts"),I=p("./src/utils/webvtt-parser.ts");function A(){return A=Object.assign?Object.assign.bind():function(r){for(var o=1;o<arguments.length;o++){var t=arguments[o];for(var f in t)Object.prototype.hasOwnProperty.call(t,f)&&(r[f]=t[f])}return r},A.apply(this,arguments)}var b="stpp.ttml.im1t",_=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,S=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,g={left:"start",center:"center",right:"end",start:"start",end:"end"};function x(r,o,t,f,e){var h=(0,P.findBox)(new Uint8Array(r),["mdat"]);if(h.length===0){e(new Error("Could not parse IMSC1 mdat"));return}var d=h.map(function(M){return(0,C.utf8ArrayToStr)(M)}),c=(0,B.toTimescaleFromScale)(o,1,t);try{d.forEach(function(M){return f(y(M,c))})}catch(M){e(M)}}function y(r,o){var t=new DOMParser,f=t.parseFromString(r,"text/xml"),e=f.getElementsByTagName("tt")[0];if(!e)throw new Error("Invalid ttml");var h={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},d=Object.keys(h).reduce(function(U,N){return U[N]=e.getAttribute("ttp:"+N)||h[N],U},{}),c=e.getAttribute("xml:space")!=="preserve",M=u(l(e,"styling","style")),F=u(l(e,"layout","region")),w=l(e,"body","[begin]");return[].map.call(w,function(U){var N=a(U,c);if(!N||!U.hasAttribute("begin"))return null;var z=i(U.getAttribute("begin"),d),V=i(U.getAttribute("dur"),d),j=i(U.getAttribute("end"),d);if(z===null)throw v(U);if(j===null){if(V===null)throw v(U);j=z+V}var Y=new k.default(z-o,j-o,N);Y.id=(0,I.generateCueId)(Y.startTime,Y.endTime,Y.text);var X=F[U.getAttribute("region")],Q=M[U.getAttribute("style")],te=s(X,Q,M),$=te.textAlign;if($){var ee=g[$];ee&&(Y.lineAlign=ee),Y.align=$}return A(Y,te),Y}).filter(function(U){return U!==null})}function l(r,o,t){var f=r.getElementsByTagName(o)[0];return f?[].slice.call(f.querySelectorAll(t)):[]}function u(r){return r.reduce(function(o,t){var f=t.getAttribute("xml:id");return f&&(o[f]=t),o},{})}function a(r,o){return[].slice.call(r.childNodes).reduce(function(t,f,e){var h;return f.nodeName==="br"&&e?t+`
`:(h=f.childNodes)!==null&&h!==void 0&&h.length?a(f,o):o?t+f.textContent.trim().replace(/\s+/g," "):t+f.textContent},"")}function s(r,o,t){var f="http://www.w3.org/ns/ttml#styling",e=null,h=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],d=r!=null&&r.hasAttribute("style")?r.getAttribute("style"):null;return d&&t.hasOwnProperty(d)&&(e=t[d]),h.reduce(function(c,M){var F=m(o,f,M)||m(r,f,M)||m(e,f,M);return F&&(c[M]=F),c},{})}function m(r,o,t){return r&&r.hasAttributeNS(o,t)?r.getAttributeNS(o,t):null}function v(r){return new Error("Could not parse ttml timestamp "+r)}function i(r,o){if(!r)return null;var t=(0,T.parseTimeStamp)(r);return t===null&&(_.test(r)?t=n(r,o):S.test(r)&&(t=E(r,o))),t}function n(r,o){var t=_.exec(r),f=(t[4]|0)+(t[5]|0)/o.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+f/o.frameRate}function E(r,o){var t=S.exec(r),f=Number(t[1]),e=t[2];switch(e){case"h":return f*3600;case"m":return f*60;case"ms":return f*1e3;case"f":return f/o.frameRate;case"t":return f/o.tickRate}return f}},"./src/utils/keysystem-util.ts":(W,O,p)=>{p.r(O),p.d(O,{changeEndianness:()=>k,convertDataUriToArrayBytes:()=>C,strToUtf8array:()=>B});var P=p("./src/utils/numeric-encoding-utils.ts");function T(I){var A=B(I).subarray(0,16),b=new Uint8Array(16);return b.set(A,16-A.length),b}function k(I){var A=function(_,S,g){var x=_[S];_[S]=_[g],_[g]=x};A(I,0,3),A(I,1,2),A(I,4,5),A(I,6,7)}function C(I){var A=I.split(":"),b=null;if(A[0]==="data"&&A.length===2){var _=A[1].split(";"),S=_[_.length-1].split(",");if(S.length===2){var g=S[0]==="base64",x=S[1];g?(_.splice(-1,1),b=(0,P.base64Decode)(x)):b=T(x)}}return b}function B(I){return Uint8Array.from(unescape(encodeURIComponent(I)),function(A){return A.charCodeAt(0)})}},"./src/utils/logger.ts":(W,O,p)=>{p.r(O),p.d(O,{enableLogs:()=>I,logger:()=>A});var P=function(){},T={trace:P,debug:P,log:P,warn:P,info:P,error:P},k=T;function C(b){var _=self.console[b];return _?_.bind(self.console,"["+b+"] >"):P}function B(b){for(var _=arguments.length,S=new Array(_>1?_-1:0),g=1;g<_;g++)S[g-1]=arguments[g];S.forEach(function(x){k[x]=b[x]?b[x].bind(b):C(x)})}function I(b,_){if(self.console&&b===!0||typeof b=="object"){B(b,"debug","log","info","warn","error");try{k.log('Debug logs enabled for "'+_+'"')}catch{k=T}}else k=T}var A=k},"./src/utils/mediakeys-helper.ts":(W,O,p)=>{p.r(O),p.d(O,{KeySystemFormats:()=>T,KeySystemIds:()=>C,KeySystems:()=>P,getKeySystemsForConfig:()=>A,getSupportedMediaKeySystemConfigurations:()=>_,keySystemDomainToKeySystemFormat:()=>I,keySystemFormatToKeySystemDomain:()=>k,keySystemIdToKeySystemDomain:()=>B,requestMediaKeySystemAccess:()=>b});var P;(function(g){g.CLEARKEY="org.w3.clearkey",g.FAIRPLAY="com.apple.fps",g.PLAYREADY="com.microsoft.playready",g.WIDEVINE="com.widevine.alpha"})(P||(P={}));var T;(function(g){g.CLEARKEY="org.w3.clearkey",g.FAIRPLAY="com.apple.streamingkeydelivery",g.PLAYREADY="com.microsoft.playready",g.WIDEVINE="urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"})(T||(T={}));function k(g){switch(g){case T.FAIRPLAY:return P.FAIRPLAY;case T.PLAYREADY:return P.PLAYREADY;case T.WIDEVINE:return P.WIDEVINE;case T.CLEARKEY:return P.CLEARKEY}}var C;(function(g){g.WIDEVINE="edef8ba979d64acea3c827dcd51d21ed"})(C||(C={}));function B(g){if(g===C.WIDEVINE)return P.WIDEVINE}function I(g){switch(g){case P.FAIRPLAY:return T.FAIRPLAY;case P.PLAYREADY:return T.PLAYREADY;case P.WIDEVINE:return T.WIDEVINE;case P.CLEARKEY:return T.CLEARKEY}}function A(g){var x=g.drmSystems,y=g.widevineLicenseUrl,l=x?[P.FAIRPLAY,P.WIDEVINE,P.PLAYREADY,P.CLEARKEY].filter(function(u){return!!x[u]}):[];return!l[P.WIDEVINE]&&y&&l.push(P.WIDEVINE),l}var b=function(){return typeof self<"u"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function _(g,x,y,l){var u;switch(g){case P.FAIRPLAY:u=["cenc","sinf"];break;case P.WIDEVINE:case P.PLAYREADY:u=["cenc"];break;case P.CLEARKEY:u=["cenc","keyids"];break;default:throw new Error("Unknown key-system: "+g)}return S(u,x,y,l)}function S(g,x,y,l){var u={initDataTypes:g,persistentState:l.persistentState||"not-allowed",distinctiveIdentifier:l.distinctiveIdentifier||"not-allowed",sessionTypes:l.sessionTypes||[l.sessionType||"temporary"],audioCapabilities:x.map(function(a){return{contentType:'audio/mp4; codecs="'+a+'"',robustness:l.audioRobustness||"",encryptionScheme:l.audioEncryptionScheme||null}}),videoCapabilities:y.map(function(a){return{contentType:'video/mp4; codecs="'+a+'"',robustness:l.videoRobustness||"",encryptionScheme:l.videoEncryptionScheme||null}})};return[u]}},"./src/utils/mediasource-helper.ts":(W,O,p)=>{p.r(O),p.d(O,{getMediaSource:()=>P});function P(){return self.MediaSource||self.WebKitMediaSource}},"./src/utils/mp4-tools.ts":(W,O,p)=>{p.r(O),p.d(O,{RemuxerTrackIdConfig:()=>b,appendUint8Array:()=>o,bin2str:()=>_,computeRawDurationFromSamples:()=>n,discardEPB:()=>d,findBox:()=>l,getDuration:()=>i,getStartDTS:()=>v,mp4Box:()=>M,mp4pssh:()=>F,offsetStartDTS:()=>E,parseEmsg:()=>c,parseInitSegment:()=>a,parsePssh:()=>w,parseSEIMessageFromNALu:()=>h,parseSamples:()=>t,parseSegmentIndex:()=>u,parseSinf:()=>m,patchEncyptionData:()=>s,readSint32:()=>x,readUint16:()=>S,readUint32:()=>g,segmentValidRange:()=>r,writeUint32:()=>y});var P=p("./src/loader/fragment.ts"),T=p("./src/utils/typed-array.ts"),k=p("./src/demux/id3.ts"),C=p("./src/utils/logger.ts"),B=p("./src/utils/hex.ts"),I=Math.pow(2,32)-1,A=[].push,b={video:1,audio:2,id3:3,text:4};function _(U){return String.fromCharCode.apply(null,U)}function S(U,N){var z=U[N]<<8|U[N+1];return z<0?65536+z:z}function g(U,N){var z=x(U,N);return z<0?4294967296+z:z}function x(U,N){return U[N]<<24|U[N+1]<<16|U[N+2]<<8|U[N+3]}function y(U,N,z){U[N]=z>>24,U[N+1]=z>>16&255,U[N+2]=z>>8&255,U[N+3]=z&255}function l(U,N){var z=[];if(!N.length)return z;for(var V=U.byteLength,j=0;j<V;){var Y=g(U,j),X=_(U.subarray(j+4,j+8)),Q=Y>1?j+Y:V;if(X===N[0])if(N.length===1)z.push(U.subarray(j+8,Q));else{var te=l(U.subarray(j+8,Q),N.slice(1));te.length&&A.apply(z,te)}j=Q}return z}function u(U){var N=[],z=U[0],V=8,j=g(U,V);V+=4;var Y=0,X=0;z===0?V+=8:V+=16,V+=2;var Q=U.length+X,te=S(U,V);V+=2;for(var $=0;$<te;$++){var ee=V,ne=g(U,ee);ee+=4;var oe=ne&2147483647,ae=(ne&2147483648)>>>31;if(ae===1)return console.warn("SIDX has hierarchical references (not supported)"),null;var ie=g(U,ee);ee+=4,N.push({referenceSize:oe,subsegmentDuration:ie,info:{duration:ie/j,start:Q,end:Q+oe-1}}),Q+=oe,ee+=4,V=ee}return{earliestPresentationTime:Y,timescale:j,version:z,referencesCount:te,references:N}}function a(U){for(var N=[],z=l(U,["moov","trak"]),V=0;V<z.length;V++){var j=z[V],Y=l(j,["tkhd"])[0];if(Y){var X=Y[0],Q=X===0?12:20,te=g(Y,Q),$=l(j,["mdia","mdhd"])[0];if($){X=$[0],Q=X===0?12:20;var ee=g($,Q),ne=l(j,["mdia","hdlr"])[0];if(ne){var oe=_(ne.subarray(8,12)),ae={soun:P.ElementaryStreamTypes.AUDIO,vide:P.ElementaryStreamTypes.VIDEO}[oe];if(ae){var ie=l(j,["mdia","minf","stbl","stsd"])[0],ce=void 0;ie&&(ce=_(ie.subarray(12,16))),N[te]={timescale:ee,type:ae},N[ae]={timescale:ee,id:te,codec:ce}}}}}}var me=l(U,["moov","mvex","trex"]);return me.forEach(function(pe){var Ie=g(pe,4),Ee=N[Ie];Ee&&(Ee.default={duration:g(pe,12),flags:g(pe,20)})}),N}function s(U,N){if(!U||!N)return U;var z=N.keyId;if(z&&N.isCommonEncryption){var V=l(U,["moov","trak"]);V.forEach(function(j){var Y=l(j,["mdia","minf","stbl","stsd"])[0],X=Y.subarray(8),Q=l(X,["enca"]),te=Q.length>0;te||(Q=l(X,["encv"])),Q.forEach(function($){var ee=te?$.subarray(28):$.subarray(78),ne=l(ee,["sinf"]);ne.forEach(function(oe){var ae=m(oe);if(ae){var ie=ae.subarray(8,24);ie.some(function(ce){return ce!==0})||(C.logger.log("[eme] Patching keyId in 'enc"+(te?"a":"v")+">sinf>>tenc' box: "+B.default.hexDump(ie)+" -> "+B.default.hexDump(z)),ae.set(z,8))}})})})}return U}function m(U){var N=l(U,["schm"])[0];if(N){var z=_(N.subarray(4,8));if(z==="cbcs"||z==="cenc")return l(U,["schi","tenc"])[0]}return C.logger.error("[eme] missing 'schm' box"),null}function v(U,N){return l(N,["moof","traf"]).reduce(function(z,V){var j=l(V,["tfdt"])[0],Y=j[0],X=l(V,["tfhd"]).reduce(function(Q,te){var $=g(te,4),ee=U[$];if(ee){var ne=g(j,4);Y===1&&(ne*=Math.pow(2,32),ne+=g(j,8));var oe=ee.timescale||9e4,ae=ne/oe;if(isFinite(ae)&&(Q===null||ae<Q))return ae}return Q},null);return X!==null&&isFinite(X)&&(z===null||X<z)?X:z},null)||0}function i(U,N){for(var z=0,V=0,j=0,Y=l(U,["moof","traf"]),X=0;X<Y.length;X++){var Q=Y[X],te=l(Q,["tfhd"])[0],$=g(te,4),ee=N[$];if(!!ee){var ne=ee.default,oe=g(te,0)|(ne==null?void 0:ne.flags),ae=ne==null?void 0:ne.duration;oe&8&&(oe&2?ae=g(te,12):ae=g(te,8));for(var ie=ee.timescale||9e4,ce=l(Q,["trun"]),me=0;me<ce.length;me++){if(z=n(ce[me]),!z&&ae){var pe=g(ce[me],4);z=ae*pe}ee.type===P.ElementaryStreamTypes.VIDEO?V+=z/ie:ee.type===P.ElementaryStreamTypes.AUDIO&&(j+=z/ie)}}}if(V===0&&j===0){for(var Ie=0,Ee=l(U,["sidx"]),Se=0;Se<Ee.length;Se++){var Te=u(Ee[Se]);Te!=null&&Te.references&&(Ie+=Te.references.reduce(function(be,Ae){return be+Ae.info.duration||0},0))}return Ie}return V||j}function n(U){var N=g(U,0),z=8;N&1&&(z+=4),N&4&&(z+=4);for(var V=0,j=g(U,4),Y=0;Y<j;Y++){if(N&256){var X=g(U,z);V+=X,z+=4}N&512&&(z+=4),N&1024&&(z+=4),N&2048&&(z+=4)}return V}function E(U,N,z){l(N,["moof","traf"]).forEach(function(V){l(V,["tfhd"]).forEach(function(j){var Y=g(j,4),X=U[Y];if(!!X){var Q=X.timescale||9e4;l(V,["tfdt"]).forEach(function(te){var $=te[0],ee=g(te,4);if($===0)ee-=z*Q,ee=Math.max(ee,0),y(te,4,ee);else{ee*=Math.pow(2,32),ee+=g(te,8),ee-=z*Q,ee=Math.max(ee,0);var ne=Math.floor(ee/(I+1)),oe=Math.floor(ee%(I+1));y(te,4,ne),y(te,8,oe)}})}})})}function r(U){var N={valid:null,remainder:null},z=l(U,["moof"]);if(z){if(z.length<2)return N.remainder=U,N}else return N;var V=z[z.length-1];return N.valid=(0,T.sliceUint8)(U,0,V.byteOffset-8),N.remainder=(0,T.sliceUint8)(U,V.byteOffset-8),N}function o(U,N){var z=new Uint8Array(U.length+N.length);return z.set(U),z.set(N,U.length),z}function t(U,N){var z=[],V=N.samples,j=N.timescale,Y=N.id,X=!1,Q=l(V,["moof"]);return Q.map(function(te){var $=te.byteOffset-8,ee=l(te,["traf"]);ee.map(function(ne){var oe=l(ne,["tfdt"]).map(function(ae){var ie=ae[0],ce=g(ae,4);return ie===1&&(ce*=Math.pow(2,32),ce+=g(ae,8)),ce/j})[0];return oe!==void 0&&(U=oe),l(ne,["tfhd"]).map(function(ae){var ie=g(ae,4),ce=g(ae,0)&16777215,me=(ce&1)!==0,pe=(ce&2)!==0,Ie=(ce&8)!==0,Ee=0,Se=(ce&16)!==0,Te=0,be=(ce&32)!==0,Ae=8;ie===Y&&(me&&(Ae+=8),pe&&(Ae+=4),Ie&&(Ee=g(ae,Ae),Ae+=4),Se&&(Te=g(ae,Ae),Ae+=4),be&&(Ae+=4),N.type==="video"&&(X=f(N.codec)),l(ne,["trun"]).map(function(Re){var Fe=Re[0],Ce=g(Re,0)&16777215,Me=(Ce&1)!==0,Ge=0,ye=(Ce&4)!==0,ot=(Ce&256)!==0,Xe=0,He=(Ce&512)!==0,Ve=0,Ke=(Ce&1024)!==0,Be=(Ce&2048)!==0,je=0,qe=g(Re,4),Oe=8;Me&&(Ge=g(Re,Oe),Oe+=4),ye&&(Oe+=4);for(var nt=Ge+$,Qe=0;Qe<qe;Qe++){if(ot?(Xe=g(Re,Oe),Oe+=4):Xe=Ee,He?(Ve=g(Re,Oe),Oe+=4):Ve=Te,Ke&&(Oe+=4),Be&&(Fe===0?je=g(Re,Oe):je=x(Re,Oe),Oe+=4),N.type===P.ElementaryStreamTypes.VIDEO)for(var xt=0;xt<Ve;){var ct=g(V,nt);if(nt+=4,e(X,V[nt])){var mt=V.subarray(nt,nt+ct);h(mt,X?2:1,U+je/j,z)}nt+=ct,xt+=ct+4}U+=Xe/j}}))})})}),z}function f(U){if(!U)return!1;var N=U.indexOf("."),z=N<0?U:U.substring(0,N);return z==="hvc1"||z==="hev1"||z==="dvh1"||z==="dvhe"}function e(U,N){if(U){var z=N>>1&63;return z===39||z===40}else{var V=N&31;return V===6}}function h(U,N,z,V){var j=d(U),Y=0;Y+=N;for(var X=0,Q=0,te=!1,$=0;Y<j.length;){X=0;do{if(Y>=j.length)break;$=j[Y++],X+=$}while($===255);Q=0;do{if(Y>=j.length)break;$=j[Y++],Q+=$}while($===255);var ee=j.length-Y;if(!te&&X===4&&Y<j.length){te=!0;var ne=j[Y++];if(ne===181){var oe=S(j,Y);if(Y+=2,oe===49){var ae=g(j,Y);if(Y+=4,ae===1195456820){var ie=j[Y++];if(ie===3){var ce=j[Y++],me=31&ce,pe=64&ce,Ie=pe?2+me*3:0,Ee=new Uint8Array(Ie);if(pe){Ee[0]=ce;for(var Se=1;Se<Ie;Se++)Ee[Se]=j[Y++]}V.push({type:ie,payloadType:X,pts:z,bytes:Ee})}}}}}else if(X===5&&Q<ee){if(te=!0,Q>16){for(var Te=[],be=0;be<16;be++){var Ae=j[Y++].toString(16);Te.push(Ae.length==1?"0"+Ae:Ae),(be===3||be===5||be===7||be===9)&&Te.push("-")}for(var Re=Q-16,Fe=new Uint8Array(Re),Ce=0;Ce<Re;Ce++)Fe[Ce]=j[Y++];V.push({payloadType:X,pts:z,uuid:Te.join(""),userData:(0,k.utf8ArrayToStr)(Fe),userDataBytes:Fe})}}else if(Q<ee)Y+=Q;else if(Q>ee)break}}function d(U){for(var N=U.byteLength,z=[],V=1;V<N-2;)U[V]===0&&U[V+1]===0&&U[V+2]===3?(z.push(V+2),V+=2):V++;if(z.length===0)return U;var j=N-z.length,Y=new Uint8Array(j),X=0;for(V=0;V<j;X++,V++)X===z[0]&&(X++,z.shift()),Y[V]=U[X];return Y}function c(U){var N=U[0],z="",V="",j=0,Y=0,X=0,Q=0,te=0,$=0;if(N===0){for(;_(U.subarray($,$+1))!=="\0";)z+=_(U.subarray($,$+1)),$+=1;for(z+=_(U.subarray($,$+1)),$+=1;_(U.subarray($,$+1))!=="\0";)V+=_(U.subarray($,$+1)),$+=1;V+=_(U.subarray($,$+1)),$+=1,j=g(U,12),Y=g(U,16),Q=g(U,20),te=g(U,24),$=28}else if(N===1){$+=4,j=g(U,$),$+=4;var ee=g(U,$);$+=4;var ne=g(U,$);for($+=4,X=Math.pow(2,32)*ee+ne,Number.isSafeInteger(X)||(X=Number.MAX_SAFE_INTEGER,console.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),Q=g(U,$),$+=4,te=g(U,$),$+=4;_(U.subarray($,$+1))!=="\0";)z+=_(U.subarray($,$+1)),$+=1;for(z+=_(U.subarray($,$+1)),$+=1;_(U.subarray($,$+1))!=="\0";)V+=_(U.subarray($,$+1)),$+=1;V+=_(U.subarray($,$+1)),$+=1}var oe=U.subarray($,U.byteLength);return{schemeIdUri:z,value:V,timeScale:j,presentationTime:X,presentationTimeDelta:Y,eventDuration:Q,id:te,payload:oe}}function M(U){for(var N=arguments.length,z=new Array(N>1?N-1:0),V=1;V<N;V++)z[V-1]=arguments[V];for(var j=z.length,Y=8,X=j;X--;)Y+=z[X].byteLength;var Q=new Uint8Array(Y);for(Q[0]=Y>>24&255,Q[1]=Y>>16&255,Q[2]=Y>>8&255,Q[3]=Y&255,Q.set(U,4),X=0,Y=8;X<j;X++)Q.set(z[X],Y),Y+=z[X].byteLength;return Q}function F(U,N,z){if(U.byteLength!==16)throw new RangeError("Invalid system id");var V,j;if(N){V=1,j=new Uint8Array(N.length*16);for(var Y=0;Y<N.length;Y++){var X=N[Y];if(X.byteLength!==16)throw new RangeError("Invalid key");j.set(X,Y*16)}}else V=0,j=new Uint8Array;var Q;V>0?(Q=new Uint8Array(4),N.length>0&&new DataView(Q.buffer).setUint32(0,N.length,!1)):Q=new Uint8Array;var te=new Uint8Array(4);return z&&z.byteLength>0&&new DataView(te.buffer).setUint32(0,z.byteLength,!1),M([112,115,115,104],new Uint8Array([V,0,0,0]),U,Q,j,te,z||new Uint8Array)}function w(U){if(!(U instanceof ArrayBuffer)||U.byteLength<32)return null;var N={version:0,systemId:"",kids:null,data:null},z=new DataView(U),V=z.getUint32(0);if(U.byteLength!==V&&V>44)return null;var j=z.getUint32(4);if(j!==1886614376||(N.version=z.getUint32(8)>>>24,N.version>1))return null;N.systemId=B.default.hexDump(new Uint8Array(U,12,16));var Y=z.getUint32(28);if(N.version===0){if(V-32<Y)return null;N.data=new Uint8Array(U,32,Y)}else if(N.version===1){N.kids=[];for(var X=0;X<Y;X++)N.kids.push(new Uint8Array(U,32+X*16,16))}return N}},"./src/utils/numeric-encoding-utils.ts":(W,O,p)=>{p.r(O),p.d(O,{base64Decode:()=>I,base64DecodeToStr:()=>k,base64Encode:()=>C,base64ToBase64Url:()=>P,base64UrlEncode:()=>B,strToBase64Encode:()=>T});function P(A){return A.replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}function T(A){return btoa(A)}function k(A){return atob(A)}function C(A){return btoa(String.fromCharCode.apply(String,A))}function B(A){return P(C(A))}function I(A){return Uint8Array.from(atob(A),function(b){return b.charCodeAt(0)})}},"./src/utils/output-filter.ts":(W,O,p)=>{p.r(O),p.d(O,{default:()=>P});var P=function(){function T(C,B){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=C,this.trackName=B}var k=T.prototype;return k.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},k.newCue=function(B,I,A){(this.startTime===null||this.startTime>B)&&(this.startTime=B),this.endTime=I,this.screen=A,this.timelineController.createCaptionsTrack(this.trackName)},k.reset=function(){this.cueRanges=[],this.startTime=null},T}()},"./src/utils/texttrack-utils.ts":(W,O,p)=>{p.r(O),p.d(O,{addCueToTrack:()=>k,clearCurrentCues:()=>C,getCuesInRange:()=>A,removeCuesInRange:()=>B,sendAddTrackEvent:()=>T});var P=p("./src/utils/logger.ts");function T(b,_){var S;try{S=new Event("addtrack")}catch{S=document.createEvent("Event"),S.initEvent("addtrack",!1,!1)}S.track=b,_.dispatchEvent(S)}function k(b,_){var S=b.mode;if(S==="disabled"&&(b.mode="hidden"),b.cues&&!b.cues.getCueById(_.id))try{if(b.addCue(_),!b.cues.getCueById(_.id))throw new Error("addCue is failed for: "+_)}catch(x){P.logger.debug("[texttrack-utils]: "+x);var g=new self.TextTrackCue(_.startTime,_.endTime,_.text);g.id=_.id,b.addCue(g)}S==="disabled"&&(b.mode=S)}function C(b){var _=b.mode;if(_==="disabled"&&(b.mode="hidden"),b.cues)for(var S=b.cues.length;S--;)b.removeCue(b.cues[S]);_==="disabled"&&(b.mode=_)}function B(b,_,S,g){var x=b.mode;if(x==="disabled"&&(b.mode="hidden"),b.cues&&b.cues.length>0)for(var y=A(b.cues,_,S),l=0;l<y.length;l++)(!g||g(y[l]))&&b.removeCue(y[l]);x==="disabled"&&(b.mode=x)}function I(b,_){if(_<b[0].startTime)return 0;var S=b.length-1;if(_>b[S].endTime)return-1;for(var g=0,x=S;g<=x;){var y=Math.floor((x+g)/2);if(_<b[y].startTime)x=y-1;else if(_>b[y].startTime&&g<S)g=y+1;else return y}return b[g].startTime-_<_-b[x].startTime?g:x}function A(b,_,S){var g=[],x=I(b,_);if(x>-1)for(var y=x,l=b.length;y<l;y++){var u=b[y];if(u.startTime>=_&&u.endTime<=S)g.push(u);else if(u.startTime>S)return g}return g}},"./src/utils/time-ranges.ts":(W,O,p)=>{p.r(O),p.d(O,{default:()=>T});var P={toString:function(C){for(var B="",I=C.length,A=0;A<I;A++)B+="["+C.start(A).toFixed(3)+"-"+C.end(A).toFixed(3)+"]";return B}};const T=P},"./src/utils/timescale-conversion.ts":(W,O,p)=>{p.r(O),p.d(O,{toMpegTsClockFromTimescale:()=>B,toMsFromMpegTsClock:()=>C,toTimescaleFromBase:()=>T,toTimescaleFromScale:()=>k});var P=9e4;function T(I,A,b,_){b===void 0&&(b=1),_===void 0&&(_=!1);var S=I*A*b;return _?Math.round(S):S}function k(I,A,b,_){return b===void 0&&(b=1),_===void 0&&(_=!1),T(I,A,1/b,_)}function C(I,A){return A===void 0&&(A=!1),T(I,1e3,1/P,A)}function B(I,A){return A===void 0&&(A=1),T(I,P,1/A)}},"./src/utils/typed-array.ts":(W,O,p)=>{p.r(O),p.d(O,{sliceUint8:()=>P});function P(T,k,C){return Uint8Array.prototype.slice?T.slice(k,C):new Uint8Array(Array.prototype.slice.call(T,k,C))}},"./src/utils/vttcue.ts":(W,O,p)=>{p.r(O),p.d(O,{default:()=>P});const P=function(){if(typeof self<"u"&&self.VTTCue)return self.VTTCue;var T=["","lr","rl"],k=["start","middle","end","left","right"];function C(_,S){if(typeof S!="string"||!Array.isArray(_))return!1;var g=S.toLowerCase();return~_.indexOf(g)?g:!1}function B(_){return C(T,_)}function I(_){return C(k,_)}function A(_){for(var S=arguments.length,g=new Array(S>1?S-1:0),x=1;x<S;x++)g[x-1]=arguments[x];for(var y=1;y<arguments.length;y++){var l=arguments[y];for(var u in l)_[u]=l[u]}return _}function b(_,S,g){var x=this,y={enumerable:!0};x.hasBeenReset=!1;var l="",u=!1,a=_,s=S,m=g,v=null,i="",n=!0,E="auto",r="start",o=50,t="middle",f=50,e="middle";Object.defineProperty(x,"id",A({},y,{get:function(){return l},set:function(d){l=""+d}})),Object.defineProperty(x,"pauseOnExit",A({},y,{get:function(){return u},set:function(d){u=!!d}})),Object.defineProperty(x,"startTime",A({},y,{get:function(){return a},set:function(d){if(typeof d!="number")throw new TypeError("Start time must be set to a number.");a=d,this.hasBeenReset=!0}})),Object.defineProperty(x,"endTime",A({},y,{get:function(){return s},set:function(d){if(typeof d!="number")throw new TypeError("End time must be set to a number.");s=d,this.hasBeenReset=!0}})),Object.defineProperty(x,"text",A({},y,{get:function(){return m},set:function(d){m=""+d,this.hasBeenReset=!0}})),Object.defineProperty(x,"region",A({},y,{get:function(){return v},set:function(d){v=d,this.hasBeenReset=!0}})),Object.defineProperty(x,"vertical",A({},y,{get:function(){return i},set:function(d){var c=B(d);if(c===!1)throw new SyntaxError("An invalid or illegal string was specified.");i=c,this.hasBeenReset=!0}})),Object.defineProperty(x,"snapToLines",A({},y,{get:function(){return n},set:function(d){n=!!d,this.hasBeenReset=!0}})),Object.defineProperty(x,"line",A({},y,{get:function(){return E},set:function(d){if(typeof d!="number"&&d!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");E=d,this.hasBeenReset=!0}})),Object.defineProperty(x,"lineAlign",A({},y,{get:function(){return r},set:function(d){var c=I(d);if(!c)throw new SyntaxError("An invalid or illegal string was specified.");r=c,this.hasBeenReset=!0}})),Object.defineProperty(x,"position",A({},y,{get:function(){return o},set:function(d){if(d<0||d>100)throw new Error("Position must be between 0 and 100.");o=d,this.hasBeenReset=!0}})),Object.defineProperty(x,"positionAlign",A({},y,{get:function(){return t},set:function(d){var c=I(d);if(!c)throw new SyntaxError("An invalid or illegal string was specified.");t=c,this.hasBeenReset=!0}})),Object.defineProperty(x,"size",A({},y,{get:function(){return f},set:function(d){if(d<0||d>100)throw new Error("Size must be between 0 and 100.");f=d,this.hasBeenReset=!0}})),Object.defineProperty(x,"align",A({},y,{get:function(){return e},set:function(d){var c=I(d);if(!c)throw new SyntaxError("An invalid or illegal string was specified.");e=c,this.hasBeenReset=!0}})),x.displayState=void 0}return b.prototype.getCueAsHTML=function(){var _=self.WebVTT;return _.convertCueToDOMTree(self,this.text)},b}()},"./src/utils/vttparser.ts":(W,O,p)=>{p.r(O),p.d(O,{VTTParser:()=>S,fixLineBreaks:()=>_,parseTimeStamp:()=>k});var P=p("./src/utils/vttcue.ts"),T=function(){function g(){}var x=g.prototype;return x.decode=function(l,u){if(!l)return"";if(typeof l!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(l))},g}();function k(g){function x(l,u,a,s){return(l|0)*3600+(u|0)*60+(a|0)+parseFloat(s||0)}var y=g.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return y?parseFloat(y[2])>59?x(y[2],y[3],0,y[4]):x(y[1],y[2],y[3],y[4]):null}var C=function(){function g(){this.values=Object.create(null)}var x=g.prototype;return x.set=function(l,u){!this.get(l)&&u!==""&&(this.values[l]=u)},x.get=function(l,u,a){return a?this.has(l)?this.values[l]:u[a]:this.has(l)?this.values[l]:u},x.has=function(l){return l in this.values},x.alt=function(l,u,a){for(var s=0;s<a.length;++s)if(u===a[s]){this.set(l,u);break}},x.integer=function(l,u){/^-?\d+$/.test(u)&&this.set(l,parseInt(u,10))},x.percent=function(l,u){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(u)){var a=parseFloat(u);if(a>=0&&a<=100)return this.set(l,a),!0}return!1},g}();function B(g,x,y,l){var u=l?g.split(l):[g];for(var a in u)if(typeof u[a]=="string"){var s=u[a].split(y);if(s.length===2){var m=s[0],v=s[1];x(m,v)}}}var I=new P.default(0,0,""),A=I.align==="middle"?"middle":"center";function b(g,x,y){var l=g;function u(){var m=k(g);if(m===null)throw new Error("Malformed timestamp: "+l);return g=g.replace(/^[^\sa-zA-Z-]+/,""),m}function a(m,v){var i=new C;B(m,function(r,o){var t;switch(r){case"region":for(var f=y.length-1;f>=0;f--)if(y[f].id===o){i.set(r,y[f].region);break}break;case"vertical":i.alt(r,o,["rl","lr"]);break;case"line":t=o.split(","),i.integer(r,t[0]),i.percent(r,t[0])&&i.set("snapToLines",!1),i.alt(r,t[0],["auto"]),t.length===2&&i.alt("lineAlign",t[1],["start",A,"end"]);break;case"position":t=o.split(","),i.percent(r,t[0]),t.length===2&&i.alt("positionAlign",t[1],["start",A,"end","line-left","line-right","auto"]);break;case"size":i.percent(r,o);break;case"align":i.alt(r,o,["start",A,"end","left","right"]);break}},/:/,/\s/),v.region=i.get("region",null),v.vertical=i.get("vertical","");var n=i.get("line","auto");n==="auto"&&I.line===-1&&(n=-1),v.line=n,v.lineAlign=i.get("lineAlign","start"),v.snapToLines=i.get("snapToLines",!0),v.size=i.get("size",100),v.align=i.get("align",A);var E=i.get("position","auto");E==="auto"&&I.position===50&&(E=v.align==="start"||v.align==="left"?0:v.align==="end"||v.align==="right"?100:50),v.position=E}function s(){g=g.replace(/^\s+/,"")}if(s(),x.startTime=u(),s(),g.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+l);g=g.slice(3),s(),x.endTime=u(),s(),a(g,x)}function _(g){return g.replace(/<br(?: \/)?>/gi,`
`)}var S=function(){function g(){this.state="INITIAL",this.buffer="",this.decoder=new T,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var x=g.prototype;return x.parse=function(l){var u=this;l&&(u.buffer+=u.decoder.decode(l,{stream:!0}));function a(){var E=u.buffer,r=0;for(E=_(E);r<E.length&&E[r]!=="\r"&&E[r]!==`
`;)++r;var o=E.slice(0,r);return E[r]==="\r"&&++r,E[r]===`
`&&++r,u.buffer=E.slice(r),o}function s(E){B(E,function(r,o){},/:/)}try{var m="";if(u.state==="INITIAL"){if(!/\r\n|\n/.test(u.buffer))return this;m=a();var v=m.match(/^()?WEBVTT([ \t].*)?$/);if(!v||!v[0])throw new Error("Malformed WebVTT signature.");u.state="HEADER"}for(var i=!1;u.buffer;){if(!/\r\n|\n/.test(u.buffer))return this;switch(i?i=!1:m=a(),u.state){case"HEADER":/:/.test(m)?s(m):m||(u.state="ID");continue;case"NOTE":m||(u.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(m)){u.state="NOTE";break}if(!m)continue;if(u.cue=new P.default(0,0,""),u.state="CUE",m.indexOf("-->")===-1){u.cue.id=m;continue}case"CUE":if(!u.cue){u.state="BADCUE";continue}try{b(m,u.cue,u.regionList)}catch{u.cue=null,u.state="BADCUE";continue}u.state="CUETEXT";continue;case"CUETEXT":{var n=m.indexOf("-->")!==-1;if(!m||n&&(i=!0)){u.oncue&&u.cue&&u.oncue(u.cue),u.cue=null,u.state="ID";continue}if(u.cue===null)continue;u.cue.text&&(u.cue.text+=`
`),u.cue.text+=m}continue;case"BADCUE":m||(u.state="ID")}}}catch{u.state==="CUETEXT"&&u.cue&&u.oncue&&u.oncue(u.cue),u.cue=null,u.state=u.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},x.flush=function(){var l=this;try{if((l.cue||l.state==="HEADER")&&(l.buffer+=`

`,l.parse()),l.state==="INITIAL"||l.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(u){l.onparsingerror&&l.onparsingerror(u)}return l.onflush&&l.onflush(),this},g}()},"./src/utils/webvtt-parser.ts":(W,O,p)=>{p.r(O),p.d(O,{generateCueId:()=>S,parseWebVTT:()=>x});var P=p("./src/polyfills/number.ts"),T=p("./src/utils/vttparser.ts"),k=p("./src/demux/id3.ts"),C=p("./src/utils/timescale-conversion.ts"),B=p("./src/remux/mp4-remuxer.ts"),I=/\r\n|\n\r|\n|\r/g,A=function(l,u,a){return a===void 0&&(a=0),l.slice(a,a+u.length)===u},b=function(l){var u=parseInt(l.slice(-3)),a=parseInt(l.slice(-6,-4)),s=parseInt(l.slice(-9,-7)),m=l.length>9?parseInt(l.substring(0,l.indexOf(":"))):0;if(!(0,P.isFiniteNumber)(u)||!(0,P.isFiniteNumber)(a)||!(0,P.isFiniteNumber)(s)||!(0,P.isFiniteNumber)(m))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+l);return u+=1e3*a,u+=60*1e3*s,u+=60*60*1e3*m,u},_=function(l){for(var u=5381,a=l.length;a;)u=u*33^l.charCodeAt(--a);return(u>>>0).toString()};function S(y,l,u){return _(y.toString())+_(l.toString())+_(u)}var g=function(l,u,a){var s=l[u],m=l[s.prevCC];if(!m||!m.new&&s.new){l.ccOffset=l.presentationOffset=s.start,s.new=!1;return}for(;(v=m)!==null&&v!==void 0&&v.new;){var v;l.ccOffset+=s.start-m.start,s.new=!1,s=m,m=l[s.prevCC]}l.presentationOffset=a};function x(y,l,u,a,s,m,v,i){var n=new T.VTTParser,E=(0,k.utf8ArrayToStr)(new Uint8Array(y)).trim().replace(I,`
`).split(`
`),r=[],o=(0,C.toMpegTsClockFromTimescale)(l,u),t="00:00.000",f=0,e=0,h,d=!0;n.oncue=function(c){var M=a[s],F=a.ccOffset,w=(f-o)/9e4;M!=null&&M.new&&(e!==void 0?F=a.ccOffset=M.start:g(a,s,w)),w&&(F=w-a.presentationOffset);var U=c.endTime-c.startTime,N=(0,B.normalizePts)((c.startTime+F-e)*9e4,m*9e4)/9e4;c.startTime=Math.max(N,0),c.endTime=Math.max(N+U,0);var z=c.text.trim();c.text=decodeURIComponent(encodeURIComponent(z)),c.id||(c.id=S(c.startTime,c.endTime,z)),c.endTime>0&&r.push(c)},n.onparsingerror=function(c){h=c},n.onflush=function(){if(h){i(h);return}v(r)},E.forEach(function(c){if(d)if(A(c,"X-TIMESTAMP-MAP=")){d=!1,c.slice(16).split(",").forEach(function(M){A(M,"LOCAL:")?t=M.slice(6):A(M,"MPEGTS:")&&(f=parseInt(M.slice(7)))});try{e=b(t)/1e3}catch(M){h=M}return}else c===""&&(d=!1);n.parse(c+`
`)}),n.flush()}},"./src/utils/xhr-loader.ts":(W,O,p)=>{p.r(O),p.d(O,{default:()=>B});var P=p("./src/utils/logger.ts"),T=p("./src/loader/load-stats.ts"),k=/^age:\s*[\d.]+\s*$/m,C=function(){function I(b){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=b?b.xhrSetup:null,this.stats=new T.LoadStats,this.retryDelay=0}var A=I.prototype;return A.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},A.abortInternal=function(){var _=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),_&&(_.onreadystatechange=null,_.onprogress=null,_.readyState!==4&&(this.stats.aborted=!0,_.abort()))},A.abort=function(){var _;this.abortInternal(),(_=this.callbacks)!==null&&_!==void 0&&_.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},A.load=function(_,S,g){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=_,this.config=S,this.callbacks=g,this.retryDelay=S.retryDelay,this.loadInternal()},A.loadInternal=function(){var _=this.config,S=this.context;if(!!_){var g=this.loader=new self.XMLHttpRequest,x=this.stats;x.loading.first=0,x.loaded=0;var y=this.xhrSetup;try{if(y)try{y(g,S.url)}catch{g.open("GET",S.url,!0),y(g,S.url)}g.readyState||g.open("GET",S.url,!0);var l=this.context.headers;if(l)for(var u in l)g.setRequestHeader(u,l[u])}catch(a){this.callbacks.onError({code:g.status,text:a.message},S,g);return}S.rangeEnd&&g.setRequestHeader("Range","bytes="+S.rangeStart+"-"+(S.rangeEnd-1)),g.onreadystatechange=this.readystatechange.bind(this),g.onprogress=this.loadprogress.bind(this),g.responseType=S.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),_.timeout),g.send()}},A.readystatechange=function(){var _=this.context,S=this.loader,g=this.stats;if(!(!_||!S)){var x=S.readyState,y=this.config;if(!g.aborted&&x>=2)if(self.clearTimeout(this.requestTimeout),g.loading.first===0&&(g.loading.first=Math.max(self.performance.now(),g.loading.start)),x===4){S.onreadystatechange=null,S.onprogress=null;var l=S.status,u=S.responseType==="arraybuffer";if(l>=200&&l<300&&(u&&S.response||S.responseText!==null)){g.loading.end=Math.max(self.performance.now(),g.loading.first);var a,s;if(u?(a=S.response,s=a.byteLength):(a=S.responseText,s=a.length),g.loaded=g.total=s,!this.callbacks)return;var m=this.callbacks.onProgress;if(m&&m(g,_,a,S),!this.callbacks)return;var v={url:S.responseURL,data:a};this.callbacks.onSuccess(v,g,_,S)}else g.retry>=y.maxRetry||l>=400&&l<499?(P.logger.error(l+" while loading "+_.url),this.callbacks.onError({code:l,text:S.statusText},_,S)):(P.logger.warn(l+" while loading "+_.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,y.maxRetryDelay),g.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),y.timeout)}},A.loadtimeout=function(){P.logger.warn("timeout while loading "+this.context.url);var _=this.callbacks;_&&(this.abortInternal(),_.onTimeout(this.stats,this.context,this.loader))},A.loadprogress=function(_){var S=this.stats;S.loaded=_.loaded,_.lengthComputable&&(S.total=_.total)},A.getCacheAge=function(){var _=null;if(this.loader&&k.test(this.loader.getAllResponseHeaders())){var S=this.loader.getResponseHeader("age");_=S?parseFloat(S):null}return _},I}();const B=C},"./node_modules/eventemitter3/index.js":W=>{var O=Object.prototype.hasOwnProperty,p="~";function P(){}Object.create&&(P.prototype=Object.create(null),new P().__proto__||(p=!1));function T(I,A,b){this.fn=I,this.context=A,this.once=b||!1}function k(I,A,b,_,S){if(typeof b!="function")throw new TypeError("The listener must be a function");var g=new T(b,_||I,S),x=p?p+A:A;return I._events[x]?I._events[x].fn?I._events[x]=[I._events[x],g]:I._events[x].push(g):(I._events[x]=g,I._eventsCount++),I}function C(I,A){--I._eventsCount===0?I._events=new P:delete I._events[A]}function B(){this._events=new P,this._eventsCount=0}B.prototype.eventNames=function(){var A=[],b,_;if(this._eventsCount===0)return A;for(_ in b=this._events)O.call(b,_)&&A.push(p?_.slice(1):_);return Object.getOwnPropertySymbols?A.concat(Object.getOwnPropertySymbols(b)):A},B.prototype.listeners=function(A){var b=p?p+A:A,_=this._events[b];if(!_)return[];if(_.fn)return[_.fn];for(var S=0,g=_.length,x=new Array(g);S<g;S++)x[S]=_[S].fn;return x},B.prototype.listenerCount=function(A){var b=p?p+A:A,_=this._events[b];return _?_.fn?1:_.length:0},B.prototype.emit=function(A,b,_,S,g,x){var y=p?p+A:A;if(!this._events[y])return!1;var l=this._events[y],u=arguments.length,a,s;if(l.fn){switch(l.once&&this.removeListener(A,l.fn,void 0,!0),u){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,b),!0;case 3:return l.fn.call(l.context,b,_),!0;case 4:return l.fn.call(l.context,b,_,S),!0;case 5:return l.fn.call(l.context,b,_,S,g),!0;case 6:return l.fn.call(l.context,b,_,S,g,x),!0}for(s=1,a=new Array(u-1);s<u;s++)a[s-1]=arguments[s];l.fn.apply(l.context,a)}else{var m=l.length,v;for(s=0;s<m;s++)switch(l[s].once&&this.removeListener(A,l[s].fn,void 0,!0),u){case 1:l[s].fn.call(l[s].context);break;case 2:l[s].fn.call(l[s].context,b);break;case 3:l[s].fn.call(l[s].context,b,_);break;case 4:l[s].fn.call(l[s].context,b,_,S);break;default:if(!a)for(v=1,a=new Array(u-1);v<u;v++)a[v-1]=arguments[v];l[s].fn.apply(l[s].context,a)}}return!0},B.prototype.on=function(A,b,_){return k(this,A,b,_,!1)},B.prototype.once=function(A,b,_){return k(this,A,b,_,!0)},B.prototype.removeListener=function(A,b,_,S){var g=p?p+A:A;if(!this._events[g])return this;if(!b)return C(this,g),this;var x=this._events[g];if(x.fn)x.fn===b&&(!S||x.once)&&(!_||x.context===_)&&C(this,g);else{for(var y=0,l=[],u=x.length;y<u;y++)(x[y].fn!==b||S&&!x[y].once||_&&x[y].context!==_)&&l.push(x[y]);l.length?this._events[g]=l.length===1?l[0]:l:C(this,g)}return this},B.prototype.removeAllListeners=function(A){var b;return A?(b=p?p+A:A,this._events[b]&&C(this,b)):(this._events=new P,this._eventsCount=0),this},B.prototype.off=B.prototype.removeListener,B.prototype.addListener=B.prototype.on,B.prefixed=p,B.EventEmitter=B,W.exports=B},"./node_modules/url-toolkit/src/url-toolkit.js":function(W){(function(O){var p=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,P=/^(?=([^\/?#]*))\1([^]*)$/,T=/(?:\/|^)\.(?=\/)/g,k=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,C={buildAbsoluteURL:function(B,I,A){if(A=A||{},B=B.trim(),I=I.trim(),!I){if(!A.alwaysNormalize)return B;var b=C.parseURL(B);if(!b)throw new Error("Error trying to parse base URL.");return b.path=C.normalizePath(b.path),C.buildURLFromParts(b)}var _=C.parseURL(I);if(!_)throw new Error("Error trying to parse relative URL.");if(_.scheme)return A.alwaysNormalize?(_.path=C.normalizePath(_.path),C.buildURLFromParts(_)):I;var S=C.parseURL(B);if(!S)throw new Error("Error trying to parse base URL.");if(!S.netLoc&&S.path&&S.path[0]!=="/"){var g=P.exec(S.path);S.netLoc=g[1],S.path=g[2]}S.netLoc&&!S.path&&(S.path="/");var x={scheme:S.scheme,netLoc:_.netLoc,path:null,params:_.params,query:_.query,fragment:_.fragment};if(!_.netLoc&&(x.netLoc=S.netLoc,_.path[0]!=="/"))if(!_.path)x.path=S.path,_.params||(x.params=S.params,_.query||(x.query=S.query));else{var y=S.path,l=y.substring(0,y.lastIndexOf("/")+1)+_.path;x.path=C.normalizePath(l)}return x.path===null&&(x.path=A.alwaysNormalize?C.normalizePath(_.path):_.path),C.buildURLFromParts(x)},parseURL:function(B){var I=p.exec(B);return I?{scheme:I[1]||"",netLoc:I[2]||"",path:I[3]||"",params:I[4]||"",query:I[5]||"",fragment:I[6]||""}:null},normalizePath:function(B){for(B=B.split("").reverse().join("").replace(T,"");B.length!==(B=B.replace(k,"")).length;);return B.split("").reverse().join("")},buildURLFromParts:function(B){return B.scheme+B.netLoc+B.path+B.params+B.query+B.fragment}};W.exports=C})()}},G={};function K(W){var O=G[W];if(O!==void 0)return O.exports;var p=G[W]={exports:{}};return R[W].call(p.exports,p,p.exports,K),p.exports}K.m=R,K.n=W=>{var O=W&&W.__esModule?()=>W.default:()=>W;return K.d(O,{a:O}),O},K.d=(W,O)=>{for(var p in O)K.o(O,p)&&!K.o(W,p)&&Object.defineProperty(W,p,{enumerable:!0,get:O[p]})},K.o=(W,O)=>Object.prototype.hasOwnProperty.call(W,O),K.r=W=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(W,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(W,"__esModule",{value:!0})};var H=K("./src/hls.ts");return H=H.default,H})())})(dr);const at=Ei(dr.exports);function fr(D,L,R,G){var K,H=!1,W=0;function O(){K&&clearTimeout(K)}function p(){O(),H=!0}typeof L!="boolean"&&(G=R,R=L,L=void 0);function P(){for(var T=arguments.length,k=new Array(T),C=0;C<T;C++)k[C]=arguments[C];var B=this,I=Date.now()-W;if(H)return;function A(){W=Date.now(),R.apply(B,k)}function b(){K=void 0}G&&!K&&A(),O(),G===void 0&&I>D?A():L!==!0&&(K=setTimeout(G?b:A,G===void 0?D-I:D))}return P.cancel=p,P}function cr(D,L,R){return R===void 0?fr(D,L,!1):fr(D,R,L!==!1)}const hr=D=>`${parseInt("0x"+D.slice(1,3))},${parseInt("0x"+D.slice(3,5))},${parseInt("0x"+D.slice(5,7))}`,Vt=D=>{let L=~~(D/3600),R=~~(D%3600/60),G=~~(D%60);return L=L<10?"0"+L:L,R=R<10?"0"+R:R,G=G<10?"0"+G:G,`${L}:${R}:${G}`},ft="ontouchstart"in window,Ti=D=>{let L=document,R=L.webkitIsFullScreen||L.fullscreen;return R?(document.exitFullscreen||L.webkitExitFullScreen).call(L):(D.requestFullscreen||(D==null?void 0:D.webkitRequestFullScreen)).call(D),!R},_i=()=>{Object.defineProperty(Event.prototype,"path",{get(){return this.composedPath()}})},vt=function(D,L,R,G=!1){D&&L&&R&&D.addEventListener(L,R,G)},ze=function(D,L,R,G=!1){D&&L&&R&&D.removeEventListener(L,R,G)},In="";function xi(D){$e(D,"svelte-qzeq9z",".d-slider.svelte-qzeq9z.svelte-qzeq9z{position:relative}.d-slider.svelte-qzeq9z .d-slider__runway.svelte-qzeq9z{width:100%;background-color:#333333;position:relative;cursor:pointer;vertical-align:middle}.d-slider.svelte-qzeq9z .d-slider__runway .d-slider__cursor.svelte-qzeq9z,.d-slider.svelte-qzeq9z .d-slider__runway .d-slider__preload.svelte-qzeq9z,.d-slider.svelte-qzeq9z .d-slider__runway .d-slider__bar.svelte-qzeq9z{position:absolute;top:0;left:0;height:100%}.d-slider.svelte-qzeq9z .d-slider__runway .d-slider__cursor.svelte-qzeq9z{display:none;z-index:1;width:1px;background:#fff;pointer-events:none}.d-slider.svelte-qzeq9z .d-slider__runway .d-slider__cursor .d-slider__tips.svelte-qzeq9z{pointer-events:none;color:#fff;position:absolute;white-space:nowrap;z-index:2;bottom:14px;left:50%;padding:4px;box-sizing:border-box;display:block;font-size:12px;background:rgba(0, 0, 0, 0.6);border-radius:3px;transform:translateX(-50%)}.d-slider.svelte-qzeq9z .d-slider__runway:hover .d-slider__cursor.svelte-qzeq9z{display:block}.d-slider.svelte-qzeq9z .d-slider__runway .d-slider__preload.svelte-qzeq9z{background-color:#717171}.d-slider.svelte-qzeq9z .d-slider__runway .d-slider__bar.svelte-qzeq9z{background:linear-gradient(to right, var(--primary-color) 0%, var(--primary-color-end) 80%, var(--primary-color-end) 100%)}.d-slider.svelte-qzeq9z .d-slider__runway .d-slider__bar.svelte-qzeq9z::before{display:block;content:'';position:absolute;right:-6px;top:50%;width:5px;height:5px;transition:0.2s;transform:translateY(-50%) scale(1, 1);border-radius:50%;background:#fff;border:5px solid var(--primary-color)}.d-slider.is-vertical.svelte-qzeq9z.svelte-qzeq9z{height:100px;display:inline-block}.d-slider.is-vertical.svelte-qzeq9z .d-slider__runway.svelte-qzeq9z{position:relative;height:100%;margin:0 6px}.d-slider.is-vertical.svelte-qzeq9z .d-slider__runway .d-slider__preload.svelte-qzeq9z,.d-slider.is-vertical.svelte-qzeq9z .d-slider__runway .d-slider__bar.svelte-qzeq9z,.d-slider.is-vertical.svelte-qzeq9z .d-slider__runway .d-slider__cursor.svelte-qzeq9z{bottom:0;top:auto;width:100%}.d-slider.is-vertical.svelte-qzeq9z .d-slider__runway .d-slider__cursor.svelte-qzeq9z{height:1px}.d-slider.is-vertical.svelte-qzeq9z .d-slider__runway .d-slider__bar.svelte-qzeq9z::before{top:-6px;left:50%;width:5px;height:5px;transform:translateX(-50%) scale(1, 1)}.d-progress-bar.svelte-qzeq9z.svelte-qzeq9z{position:absolute;left:0;right:0;bottom:0;width:100%;transition:height 0.1s;height:3px;z-index:1}.d-progress-bar.svelte-qzeq9z .d-slider__runway.svelte-qzeq9z{transition:height 0.1s;height:100% !important}.d-progress-bar.svelte-qzeq9z .d-slider__runway .d-slider__bar.svelte-qzeq9z::before{transform:translateY(-50%) scale(0, 0)}.d-progress-bar.svelte-qzeq9z.svelte-qzeq9z:hover{height:100%}.d-progress-bar.svelte-qzeq9z:hover .d-slider__bar.svelte-qzeq9z::before{transform:translateY(-50%) scale(1, 1) !important}.d-player-filter-panel-item.svelte-qzeq9z .d-slider__runway.svelte-qzeq9z{background-color:#999}.d-player-filter-panel-item.svelte-qzeq9z .d-slider__runway .d-slider__bar.svelte-qzeq9z:before{width:5px;height:5px}.filter-panel-slider.svelte-qzeq9z.svelte-qzeq9z{width:100%}")}function Si(D){let L,R,G,K,H,W,O,p,P,T,k,C,B,I,A;return{c(){L=re("div"),R=re("div"),G=re("div"),K=re("div"),H=ve(D[2]),p=le(),P=re("div"),T=le(),k=re("div"),q(K,"class","d-slider__tips svelte-qzeq9z"),q(K,"style",W=`left:${D[5].hoverTipsLeft};display:${D[2]?"block":"none"}`),q(G,"class","d-slider__cursor svelte-qzeq9z"),q(G,"style",O=`${D[8]}; display:${D[0]?"block":"none"}`),q(P,"class","d-slider__preload svelte-qzeq9z"),q(P,"style",D[9]),q(k,"class","d-slider__bar svelte-qzeq9z"),q(k,"style",D[10]),q(R,"class","d-slider__runway svelte-qzeq9z"),q(R,"style",C=D[1]?"width:"+D[3]:"height:"+D[3]),q(L,"class",B=we(`d-slider ${D[1]?"is-vertical":""} ${D[4]}`)+" svelte-qzeq9z")},m(b,_){fe(b,L,_),Z(L,R),Z(R,G),Z(G,K),Z(K,H),D[19](K),Z(R,p),Z(R,P),Z(R,T),Z(R,k),D[20](L),I||(A=[he(R,"mousemove",D[15]),he(R,"mouseleave",D[14]),he(R,"mouseenter",D[13]),he(L,"mousedown",Ct(D[12])),he(L,"contextmenu",D[11])],I=!0)},p(b,[_]){_&4&&xe(H,b[2]),_&36&&W!==(W=`left:${b[5].hoverTipsLeft};display:${b[2]?"block":"none"}`)&&q(K,"style",W),_&257&&O!==(O=`${b[8]}; display:${b[0]?"block":"none"}`)&&q(G,"style",O),_&512&&q(P,"style",b[9]),_&1024&&q(k,"style",b[10]),_&10&&C!==(C=b[1]?"width:"+b[3]:"height:"+b[3])&&q(R,"style",C),_&18&&B!==(B=we(`d-slider ${b[1]?"is-vertical":""} ${b[4]}`)+" svelte-qzeq9z")&&q(L,"class",B)},i:_e,o:_e,d(b){b&&de(L),D[19](null),D[20](null),I=!1,st(A)}}}function bi(D,L,R){let G,K,H;const W=ht();let{modelValue:O=0}=L,{disabled:p=!1}=L,{vertical:P=!1}=L,{hover:T=!1}=L,{hoverText:k=""}=L,{preload:C=0}=L,{size:B="10px"}=L,{className:I=""}=L;const A={dragging:!1,hoverPosition:0,hoverTipsLeft:"50%"};let b,_;const S=n=>{n.preventDefault()},g=n=>{if(p){const E=a(n);W("speedDisabled",E);return}n.preventDefault(),R(5,A.dragging=!0,A),u(n),vt(window,"mousemove",s),vt(window,"touchmove",s),vt(window,"mouseup",m),vt(window,"touchend",m)},x=()=>{R(0,T=!0)},y=()=>{R(0,T=!1)},l=n=>{if(!T)return;let E=a(n);if(W("onMousemove",{ev:n,val:E}),R(5,A.hoverPosition=E,A),P)return;let r=b,o=_.clientWidth/2,t=n.clientX-r.getBoundingClientRect().left;t<o?R(5,A.hoverTipsLeft=o-t+"px",A):r.clientWidth-t<o?R(5,A.hoverTipsLeft=r.clientWidth-t-o+"px",A):R(5,A.hoverTipsLeft="50%",A)},u=n=>{let E=a(n);W("update",E),W("change",{ev:n,value:E})},a=n=>{let E=b,r=0;if(P){let o=E.clientHeight;r=(E.getBoundingClientRect().bottom-n.clientY)/o}else r=(n.clientX-E.getBoundingClientRect().left)/E.clientWidth;return r<0?0:r>1?1:r},s=n=>{u(n)},m=n=>{A.dragging&&(ze(window,"mousemove",s),ze(window,"touchmove",s),ze(window,"mouseup",m),ze(window,"touchend",m),ze(window,"contextmenu",m),setTimeout(()=>{R(5,A.dragging=!1,A)},0))};function v(n){ut[n?"unshift":"push"](()=>{_=n,R(7,_)})}function i(n){ut[n?"unshift":"push"](()=>{b=n,R(6,b)})}return D.$$set=n=>{"modelValue"in n&&R(16,O=n.modelValue),"disabled"in n&&R(17,p=n.disabled),"vertical"in n&&R(1,P=n.vertical),"hover"in n&&R(0,T=n.hover),"hoverText"in n&&R(2,k=n.hoverText),"preload"in n&&R(18,C=n.preload),"size"in n&&R(3,B=n.size),"className"in n&&R(4,I=n.className)},D.$$.update=()=>{D.$$.dirty&65538&&R(10,G=(()=>{let n=O<0?0:O>1?1:O;return P?`height:${n*100}%`:`width:${n*100}%`})()),D.$$.dirty&262146&&R(9,K=(()=>{let n=C<0?0:C>1?1:C;return P?`height:${n*100}%`:`width:${n*100}%`})()),D.$$.dirty&34&&R(8,H=(()=>{let n=A.hoverPosition<0?0:A.hoverPosition>1?1:A.hoverPosition;return P?`bottom:${n*100}%`:`left:${n*100}%`})())},[T,P,k,B,I,A,b,_,H,K,G,S,g,x,y,l,O,p,C,v,i]}class Pt extends rt{constructor(L){super(),tt(this,L,bi,Si,Je,{modelValue:16,disabled:17,vertical:1,hover:0,hoverText:2,preload:18,size:3,className:4},xi)}}const Rn="";function Ai(D){$e(D,"svelte-31e6zs",".d-switch.svelte-31e6zs.svelte-31e6zs{position:relative;height:18px;transition:background 0.2s;background:#757575;border-radius:10px;display:inline-flex;align-items:center;vertical-align:middle}.d-switch.svelte-31e6zs .d-switch__input.svelte-31e6zs{position:relative;z-index:1;margin:0;width:100%;height:100%;opacity:0}.d-switch.svelte-31e6zs .d-switch_action.svelte-31e6zs{position:absolute;transition:0.2s;left:2px;top:2px;z-index:0;height:5px;width:5px;background:#fff;border-radius:50%}.d-switch.is-checked.svelte-31e6zs.svelte-31e6zs{background-color:var(--primary-color)}.d-switch.is-checked.svelte-31e6zs .d-switch_action.svelte-31e6zs{left:100%;background:#fff;margin-left:-18px}")}function Di(D){let L,R,G,K,H,W,O,p;return{c(){L=re("div"),R=re("input"),G=le(),K=re("span"),q(R,"class","d-switch__input svelte-31e6zs"),q(R,"type","checkbox"),R.checked=D[4],q(R,"true-value",D[1]),q(R,"false-value",D[2]),q(K,"class","d-switch_action svelte-31e6zs"),q(L,"class",H=we(D[4]?"is-checked d-switch":"d-switch")+" svelte-31e6zs"),q(L,"style",W=`width:${D[0]}`)},m(P,T){fe(P,L,T),Z(L,R),D[8](R),Z(L,G),Z(L,K),O||(p=he(R,"change",D[5]),O=!0)},p(P,[T]){T&16&&(R.checked=P[4]),T&2&&q(R,"true-value",P[1]),T&4&&q(R,"false-value",P[2]),T&16&&H!==(H=we(P[4]?"is-checked d-switch":"d-switch")+" svelte-31e6zs")&&q(L,"class",H),T&1&&W!==(W=`width:${P[0]}`)&&q(L,"style",W)},i:_e,o:_e,d(P){P&&de(L),D[8](null),O=!1,p()}}}function Li(D,L,R){let G;const K=ht();let{modelValue:H}=L,{width:W="40px"}=L,{trueValue:O=!0}=L,{falseValue:p=!0}=L,{activeColor:P="#409EFF"}=L,T;const k=async()=>{await Gt();const B=T.checked;K("update",B),K("change",B)};function C(B){ut[B?"unshift":"push"](()=>{T=B,R(3,T)})}return D.$$set=B=>{"modelValue"in B&&R(6,H=B.modelValue),"width"in B&&R(0,W=B.width),"trueValue"in B&&R(1,O=B.trueValue),"falseValue"in B&&R(2,p=B.falseValue),"activeColor"in B&&R(7,P=B.activeColor)},D.$$.update=()=>{D.$$.dirty&66&&R(4,G=(()=>H===O)())},[W,O,p,T,G,k,H,P,C]}class jt extends rt{constructor(L){super(),tt(this,L,Li,Di,Je,{modelValue:6,width:0,trueValue:1,falseValue:2,activeColor:7},Ai)}}const Cn="";function Pi(D){$e(D,"svelte-6alrox","@import '../asset/style/iconfont.css';.d-icon.svelte-6alrox{display:inline-block;cursor:pointer;overflow:hidden}.icon-play.svelte-6alrox{margin-left:5px}")}function Ii(D){let L,R;return{c(){L=re("i"),q(L,"class",R=we(`${D[0]} d-icon iconfont ${D[1]}`)+" svelte-6alrox"),q(L,"style",D[2])},m(G,K){fe(G,L,K)},p(G,[K]){K&3&&R!==(R=we(`${G[0]} d-icon iconfont ${G[1]}`)+" svelte-6alrox")&&q(L,"class",R),K&4&&q(L,"style",G[2])},i:_e,o:_e,d(G){G&&de(L)}}}function Ri(D,L,R){let G,{icon:K}=L,{size:H}=L,{className:W=""}=L;return D.$$set=O=>{"icon"in O&&R(0,K=O.icon),"size"in O&&R(3,H=O.size),"className"in O&&R(1,W=O.className)},D.$$.update=()=>{D.$$.dirty&8&&R(2,G=(()=>`font-size:${/^\d+$/.test(H+"")?H+"px":H}`)())},[K,W,G,H]}class gt extends rt{constructor(L){super(),tt(this,L,Ri,Ii,Je,{icon:0,size:3,className:1},Pi)}}const vr={en:{speed:"speed",mirror:"mirror",loop:"loop",lightOff:"light off",pictureInPicture:"picture in picture",webFullScreen:"web fullscreen",exitWebFullScreen:"exit web fullscreen",fullScreen:"fullscreen(f)",exitFullScreen:"exit fullscreen(f)",colorAdjustment:"Color adjustment",saturability:"saturability",brightness:"brightness",contrast:"contrast",reset:"reset",shortcutKeyInstructions:"Shortcut key instructions",copyVideoUrl:"Copy the url address",version:"Version",loading:"loading",replay:"replay",playError:"play error",playStuck:"play stuck",progressError:"The progress bar cannot be dragged",videoBlack:"The video is black but there is sound",soundPictueAsync:"Sound and picture are out of sync",feedbackTips:"Feedback success!",playerFeedBack:"Player problem feedback",other:"other",feedbackPlaceHolder:"Description of the problem in 100 words or less",confirm:"confirm"},"zh-cn":{speed:"\u500D\u901F",mirror:"\u955C\u50CF\u753B\u9762",loop:"\u5FAA\u73AF\u64AD\u653E",lightOff:"\u5173\u706F\u6A21\u5F0F",pictureInPicture:"\u753B\u4E2D\u753B",webFullScreen:"\u7F51\u9875\u5168\u5C4F",exitWebFullScreen:"\u9000\u51FA\u7F51\u9875\u5168\u5C4F",fullScreen:"\u5168\u5C4F(f)",exitFullScreen:"\u9000\u51FA\u5168\u5C4F(f)",colorAdjustment:"\u89C6\u9891\u8272\u5F69\u8C03\u6574",saturability:"\u9971\u548C\u5EA6",brightness:"\u4EAE\u5EA6",contrast:"\u5BF9\u6BD4\u5EA6",reset:"\u91CD\u7F6E",shortcutKeyInstructions:"\u5FEB\u6377\u952E\u8BF4\u660E",copyVideoUrl:"\u590D\u5236\u7F51\u5740\u89C6\u9891",version:"\u7248\u672C",loading:"\u6B63\u5728\u7F13\u51B2...",replay:"\u91CD\u65B0\u64AD\u653E",playError:"\u8BF7\u6C42\u9519\u8BEF",playStuck:"\u64AD\u653E\u5361\u987F",progressError:"\u8FDB\u5EA6\u6761\u65E0\u6CD5\u62D6\u52A8",videoBlack:"\u89C6\u9891\u9ED1\u5C4F\u4F46\u6709\u58F0\u97F3",soundPictueAsync:"\u97F3\u753B\u4E0D\u540C\u6B65",feedbackTips:"\u53CD\u9988\u6210\u529F\uFF01",playerFeedBack:"\u64AD\u653E\u5668\u95EE\u9898\u53CD\u9988",other:"\u5176\u4ED6",feedbackPlaceHolder:"\u95EE\u9898\u63CF\u8FF0\uFF0C\u9650100\u5B57\u5185",confirm:"\u786E\u8BA4"},"zh-tw":{speed:"\u500D\u901F",mirror:"\u93E1\u50CF\u756B\u9762",loop:"\u8FF4\u5708\u64AD\u653E",lightOff:"\u95DC\u71C8\u6A21\u5F0F",pictureInPicture:"\u756B\u4E2D\u756B",webFullScreen:"\u7DB2\u9801\u5168\u5C4F",exitWebFullScreen:"\u9000\u51FA\u7DB2\u9801\u5168\u5C4F",fullScreen:"\u5168\u5C4F(f)",exitFullScreen:"\u9000\u51FA\u5168\u5C4F(f)",colorAdjustment:"\u8996\u983B\u8272\u5F69\u8ABF\u6574",saturability:"\u98FD\u548C\u5EA6",brightness:"\u4EAE\u5EA6",contrast:"\u5C0D\u6BD4\u5EA6",reset:"\u91CD\u7F6E",shortcutKeyInstructions:"\u5FEB\u6377\u9375\u8AAA\u660E",copyVideoUrl:"\u8907\u88FD\u7DB2\u5740\u8996\u983B",version:"\u7248\u672C",loading:"\u6B63\u5728\u7DE9\u885D...",replay:"\u91CD\u65B0\u64AD\u653E",playError:"\u8ACB\u6C42\u932F\u8AA4",playStuck:"\u64AD\u653E\u5361\u9813",progressError:"\u9032\u5EA6\u689D\u7121\u6CD5\u62D6\u52D5",videoBlack:"\u8996\u983B\u9ED1\u5C4F\u4F46\u6709\u8072\u97F3",soundPictueAsync:"\u97F3\u756B\u4E0D\u540C\u6B65",feedbackTips:"\u56DE\u994B\u6210\u529F\uFF01",playerFeedBack:"\u64AD\u653E\u5668\u554F\u984C\u56DE\u994B",other:"\u5176\u4ED6",feedbackPlaceHolder:"\u554F\u984C\u63CF\u8FF0\uFF0C\u9650100\u5B57\u5167",confirm:"\u78BA\u8A8D"}},On="";function Ci(D){$e(D,"svelte-1sesy3u","div.svelte-1sesy3u.svelte-1sesy3u,span.svelte-1sesy3u.svelte-1sesy3u,h5.svelte-1sesy3u.svelte-1sesy3u,i.svelte-1sesy3u.svelte-1sesy3u,ul.svelte-1sesy3u.svelte-1sesy3u,li.svelte-1sesy3u.svelte-1sesy3u{margin:0;padding:0;border:0;font-size:100%;font:inherit;vertical-align:baseline}ul.svelte-1sesy3u.svelte-1sesy3u{list-style:none}@keyframes svelte-1sesy3u-rotating{100%{-webkit-transform:rotate(360deg)}}.d-player-contextmenu.svelte-1sesy3u.svelte-1sesy3u,.d-player-dialog.svelte-1sesy3u.svelte-1sesy3u{position:absolute;left:0;top:0;bottom:50px;width:100%;z-index:5}.d-player-contextmenu.svelte-1sesy3u .d-player-copyText.svelte-1sesy3u{opacity:0}.d-player-contextmenu.svelte-1sesy3u .d-player-contextmenu-body.svelte-1sesy3u{position:absolute;border-radius:5px;font-size:12px;background:rgba(0, 0, 0, 0.8);color:#efefef;padding:0;text-align:left;min-width:130px;box-sizing:border-box;padding:5px 0}.d-player-contextmenu.svelte-1sesy3u .d-player-contextmenu-body li.svelte-1sesy3u{padding:8px 20px;margin:0;cursor:pointer;transition:0.2s}.d-player-contextmenu.svelte-1sesy3u .d-player-contextmenu-body li.svelte-1sesy3u:hover{background-color:rgba(255, 255, 255, 0.1)}.d-player-dialog.svelte-1sesy3u.svelte-1sesy3u{display:flex;justify-content:center;align-items:center}.d-player-dialog.svelte-1sesy3u .d-player-dialog-body.svelte-1sesy3u{background-color:rgba(33, 33, 33, 0.9);border-radius:5px;color:#fff;min-width:200px;padding:0 0 10px}.d-player-dialog.svelte-1sesy3u .d-player-dialog-body .d-player-dialog-title.svelte-1sesy3u{text-align:center;position:relative;font-size:14px;font-weight:normal;margin:0;padding:12px 0px;border-bottom:1px solid rgba(255, 255, 255, 0.15);margin-bottom:10px}.d-player-dialog.svelte-1sesy3u .d-player-dialog-body .d-player-dialog-title .icon-close.svelte-1sesy3u{position:absolute;right:0px;top:0px;width:40px;height:40px;line-height:40px;text-align:center;cursor:pointer}.d-player-dialog.svelte-1sesy3u .d-player-dialog-body .d-player-hotkey-panel.svelte-1sesy3u{font-size:12px;color:#eee;padding-right:40px}.d-player-dialog.svelte-1sesy3u .d-player-dialog-body .d-player-hotkey-panel .d-player-hotkey-panel-item.svelte-1sesy3u{line-height:26px}.d-player-dialog.svelte-1sesy3u .d-player-dialog-body .d-player-hotkey-panel .d-player-hotkey-panel-item span.svelte-1sesy3u{text-align:center;display:inline-block;width:120px}.d-player-dialog.svelte-1sesy3u .d-player-dialog-body .d-player-hotkey-panel .d-player-hotkey-panel-item span.svelte-1sesy3u:nth-child(2){color:#999;width:160px}.d-player-dialog.svelte-1sesy3u .d-player-dialog-body .d-player-filter-panel.svelte-1sesy3u{width:320px;padding:0 20px;text-align:center}.d-player-dialog.svelte-1sesy3u .d-player-dialog-body .d-player-filter-panel .d-player-filter-reset.svelte-1sesy3u{text-align:center;cursor:pointer;margin-top:10px;padding:3px 20px;display:inline-block;border-radius:2px;font-size:12px;background:rgba(133, 133, 133, 0.5)}.d-player-dialog.svelte-1sesy3u .d-player-dialog-body .d-player-filter-panel .d-player-filter-reset.svelte-1sesy3u:hover{background:rgba(255, 255, 255, 0.3)}.d-player-dialog.svelte-1sesy3u .d-player-dialog-body .d-player-filter-panel .d-player-filter-panel-item.svelte-1sesy3u{height:32px;display:flex;align-items:center}.d-player-dialog.svelte-1sesy3u .d-player-dialog-body .d-player-filter-panel .d-player-filter-panel-item span.svelte-1sesy3u{font-size:12px;display:block;width:80px;text-align:center}")}function gr(D,L,R){const G=D.slice();return G[17]=L[R],G}function mr(D,L,R){const G=D.slice();return G[17]=L[R],G}function pr(D){let L,R,G,K=D[1].dialogTitle+"",H,W,O,p,P,T,k,C,B,I=D[1].dialogType=="hotkey"&&yr(D),A=D[1].dialogType=="filter"&&Tr(D);return{c(){L=re("div"),R=re("div"),G=re("h5"),H=ve(K),W=le(),O=re("i"),O.textContent="X",p=le(),I&&I.c(),P=le(),A&&A.c(),q(O,"class","icon icon-close svelte-1sesy3u"),q(G,"class","d-player-dialog-title svelte-1sesy3u"),q(R,"class","d-player-dialog-body svelte-1sesy3u"),q(L,"class","d-player-dialog svelte-1sesy3u")},m(b,_){fe(b,L,_),Z(L,R),Z(R,G),Z(G,H),Z(G,W),Z(G,O),Z(R,p),I&&I.m(R,null),Z(R,P),A&&A.m(R,null),k=!0,C||(B=he(O,"click",D[9]),C=!0)},p(b,_){(!k||_&2)&&K!==(K=b[1].dialogTitle+"")&&xe(H,K),b[1].dialogType=="hotkey"?I?I.p(b,_):(I=yr(b),I.c(),I.m(R,P)):I&&(I.d(1),I=null),b[1].dialogType=="filter"?A?(A.p(b,_),_&2&&se(A,1)):(A=Tr(b),A.c(),se(A,1),A.m(R,null)):A&&(Ue(),ue(A,1,1,()=>{A=null}),Ne())},i(b){k||(se(A),lt(()=>{T||(T=et(L,it,{},!0)),T.run(1)}),k=!0)},o(b){ue(A),T||(T=et(L,it,{},!1)),T.run(0),k=!1},d(b){b&&de(L),I&&I.d(),A&&A.d(),b&&T&&T.end(),C=!1,B()}}}function yr(D){let L,R=D[5],G=[];for(let K=0;K<R.length;K+=1)G[K]=Er(mr(D,R,K));return{c(){L=re("ul");for(let K=0;K<G.length;K+=1)G[K].c();q(L,"class","d-player-hotkey-panel svelte-1sesy3u")},m(K,H){fe(K,L,H);for(let W=0;W<G.length;W+=1)G[W].m(L,null)},p(K,H){if(H&32){R=K[5];let W;for(W=0;W<R.length;W+=1){const O=mr(K,R,W);G[W]?G[W].p(O,H):(G[W]=Er(O),G[W].c(),G[W].m(L,null))}for(;W<G.length;W+=1)G[W].d(1);G.length=R.length}},d(K){K&&de(L),bt(G,K)}}}function Er(D){let L,R,G=D[17].key+"",K,H,W,O=D[17].label+"",p,P;return{c(){L=re("li"),R=re("span"),K=ve(G),H=le(),W=re("span"),p=ve(O),P=le(),q(R,"class","svelte-1sesy3u"),q(W,"class","svelte-1sesy3u"),q(L,"class","d-player-hotkey-panel-item svelte-1sesy3u")},m(T,k){fe(T,L,k),Z(L,R),Z(R,K),Z(L,H),Z(L,W),Z(W,p),Z(L,P)},p:_e,d(T){T&&de(L)}}}function Tr(D){let L,R,G,K=D[0].saturability+"",H,W,O,p,P,T=Math.round(D[2].saturate*255)+"",k,C,B,I,A=D[0].brightness+"",b,_,S,g,x,y=Math.round(D[2].brightness*255)+"",l,u,a,s,m=D[0].contrast+"",v,i,n,E,r,o=Math.round(D[2].contrast*255)+"",t,f,e,h=D[0].reset+"",d,c,M,F;return O=new Pt({props:{className:"d-player-filter-panel-item filter-panel-slider",size:"5px",modelValue:D[2].saturate}}),O.$on("update",D[10]),S=new Pt({props:{className:"d-player-filter-panel-item filter-panel-slider",size:"5px",modelValue:D[2].brightness}}),S.$on("update",D[11]),n=new Pt({props:{className:"d-player-filter-panel-item filter-panel-slider",size:"5px",modelValue:D[2].contrast}}),n.$on("update",D[12]),{c(){L=re("ul"),R=re("li"),G=re("span"),H=ve(K),W=le(),Pe(O.$$.fragment),p=le(),P=re("span"),k=ve(T),C=le(),B=re("li"),I=re("span"),b=ve(A),_=le(),Pe(S.$$.fragment),g=le(),x=re("span"),l=ve(y),u=le(),a=re("li"),s=re("span"),v=ve(m),i=le(),Pe(n.$$.fragment),E=le(),r=re("span"),t=ve(o),f=le(),e=re("span"),d=ve(h),q(G,"class","svelte-1sesy3u"),q(P,"class","svelte-1sesy3u"),q(R,"class","d-player-filter-panel-item svelte-1sesy3u"),q(I,"class","svelte-1sesy3u"),q(x,"class","svelte-1sesy3u"),q(B,"class","d-player-filter-panel-item svelte-1sesy3u"),q(s,"class","svelte-1sesy3u"),q(r,"class","svelte-1sesy3u"),q(a,"class","d-player-filter-panel-item svelte-1sesy3u"),q(e,"title","\u91CD\u7F6E"),q(e,"aria-label","\u91CD\u7F6E"),q(e,"class","d-player-filter-reset svelte-1sesy3u"),q(L,"class","d-player-filter-panel svelte-1sesy3u")},m(w,U){fe(w,L,U),Z(L,R),Z(R,G),Z(G,H),Z(R,W),De(O,R,null),Z(R,p),Z(R,P),Z(P,k),Z(L,C),Z(L,B),Z(B,I),Z(I,b),Z(B,_),De(S,B,null),Z(B,g),Z(B,x),Z(x,l),Z(L,u),Z(L,a),Z(a,s),Z(s,v),Z(a,i),De(n,a,null),Z(a,E),Z(a,r),Z(r,t),Z(L,f),Z(L,e),Z(e,d),c=!0,M||(F=he(e,"click",D[6]),M=!0)},p(w,U){(!c||U&1)&&K!==(K=w[0].saturability+"")&&xe(H,K);const N={};U&4&&(N.modelValue=w[2].saturate),O.$set(N),(!c||U&4)&&T!==(T=Math.round(w[2].saturate*255)+"")&&xe(k,T),(!c||U&1)&&A!==(A=w[0].brightness+"")&&xe(b,A);const z={};U&4&&(z.modelValue=w[2].brightness),S.$set(z),(!c||U&4)&&y!==(y=Math.round(w[2].brightness*255)+"")&&xe(l,y),(!c||U&1)&&m!==(m=w[0].contrast+"")&&xe(v,m);const V={};U&4&&(V.modelValue=w[2].contrast),n.$set(V),(!c||U&4)&&o!==(o=Math.round(w[2].contrast*255)+"")&&xe(t,o),(!c||U&1)&&h!==(h=w[0].reset+"")&&xe(d,h)},i(w){c||(se(O.$$.fragment,w),se(S.$$.fragment,w),se(n.$$.fragment,w),c=!0)},o(w){ue(O.$$.fragment,w),ue(S.$$.fragment,w),ue(n.$$.fragment,w),c=!1},d(w){w&&de(L),Le(O),Le(S),Le(n),M=!1,F()}}}function _r(D){let L,R,G,K,H=D[4],W=[];for(let O=0;O<H.length;O+=1)W[O]=xr(gr(D,H,O));return{c(){L=re("div"),R=re("ul");for(let O=0;O<W.length;O+=1)W[O].c();G=le(),K=re("input"),q(R,"class","d-player-contextmenu-body svelte-1sesy3u"),q(R,"style",D[3]),q(K,"class","d-player-copyText svelte-1sesy3u"),q(L,"class","d-player-contextmenu svelte-1sesy3u")},m(O,p){fe(O,L,p),Z(L,R);for(let P=0;P<W.length;P+=1)W[P].m(R,null);Z(L,G),Z(L,K)},p(O,p){if(p&16){H=O[4];let P;for(P=0;P<H.length;P+=1){const T=gr(O,H,P);W[P]?W[P].p(T,p):(W[P]=xr(T),W[P].c(),W[P].m(R,null))}for(;P<W.length;P+=1)W[P].d(1);W.length=H.length}p&8&&q(R,"style",O[3])},d(O){O&&de(L),bt(W,O)}}}function xr(D){let L,R=D[17].label+"",G,K;return{c(){L=re("li"),G=ve(R),q(L,"dplayerkeycode",K=D[17].key),q(L,"class","svelte-1sesy3u")},m(H,W){fe(H,L,W),Z(L,G)},p(H,W){W&16&&R!==(R=H[17].label+"")&&xe(G,R),W&16&&K!==(K=H[17].key)&&q(L,"dplayerkeycode",K)},d(H){H&&de(L)}}}function Oi(D){let L,R,G,K=D[1].dialogType&&pr(D),H=D[1].show&&_r(D);return{c(){L=re("div"),K&&K.c(),R=le(),H&&H.c(),q(L,"class","svelte-1sesy3u")},m(W,O){fe(W,L,O),K&&K.m(L,null),Z(L,R),H&&H.m(L,null),G=!0},p(W,[O]){W[1].dialogType?K?(K.p(W,O),O&2&&se(K,1)):(K=pr(W),K.c(),se(K,1),K.m(L,R)):K&&(Ue(),ue(K,1,1,()=>{K=null}),Ne()),W[1].show?H?H.p(W,O):(H=_r(W),H.c(),H.m(L,null)):H&&(H.d(1),H=null)},i(W){G||(se(K),G=!0)},o(W){ue(K),G=!1},d(W){W&&de(L),K&&K.d(),H&&H.d()}}}function Mi(D,L,R){let G,{version:K="1.0.0"}=L,{nowLanguage:H}=L,{contextMenu:W=["filter","hotkey","copy","version"]}=L;const O={version:K,show:!1,dialogType:"",dialogTitle:"",mouseX:0,mouseY:0},p=[{label:H.colorAdjustment,key:"filter"},{label:H.shortcutKeyInstructions,key:"hotkey"},{label:H.copyVideoUrl,key:"copy"},{label:`${H.version}\uFF1A`+K,key:"version"}],P=[{key:"Space",label:"\u64AD\u653E/\u6682\u505C"},{key:"\u2192",label:"\u5355\u6B21\u5FEB\u8FDB10s\uFF0C\u957F\u63095\u500D\u901F\u64AD\u653E"},{key:"\u2190",label:"\u5FEB\u900010s"},{key:"\u2191",label:"\u97F3\u91CF\u589E\u52A010%"},{key:"\u2193",label:"\u97F3\u91CF\u589E\u52A0\u964D\u4F4E10%"}],T={saturate:.392,brightness:.392,contrast:.392};let k;const C=()=>{R(2,T.saturate=.392,T),R(2,T.brightness=.392,T),R(2,T.contrast=.392,T)},B=x=>{x.key=="Escape"&&A(0)},I=x=>{x.preventDefault(),vt(window,"keydown",B),vt(window,"click",A);const y=document.querySelector("#refPlayerWrap");vt(y,"click",A);let l=y.clientWidth;y.clientHeight,R(1,O.mouseX=x.clientX-y.getBoundingClientRect().left,O),l-O.mouseX<130&&R(1,O.mouseX=O.mouseX+(l-O.mouseX-130),O),R(1,O.mouseY=x.clientY-y.getBoundingClientRect().top,O),R(1,O.show=!0,O)},A=x=>{let y=x.path[0].tagName=="LI",l=x.path[0].attributes.dplayerKeyCode&&x.path[0].attributes.dplayerKeyCode.value,u=G.map(s=>s.key);if(y&&u.includes(l))if(R(1,O.dialogTitle=x.path[0].innerText,O),R(1,O.dialogType=l,O),l=="copy"){let s=document.querySelector(".d-player-copyText");s.value=window.location.href,s.select(),document.execCommand("copy"),R(1,O.dialogType="",O)}else l=="version"&&R(1,O.dialogType="",O);R(1,O.show=!1,O),ze(window,"keydown",B),ze(window,"click",A);const a=document.querySelector("#refPlayerWrap");ze(a,"click",A)};sr(()=>{const x=document.querySelector("#refPlayerWrap");ze(window,"keydown",B),ze(window,"click",A),ze(x,"contextmenu",I),vt(x,"contextmenu",I)}),ci(()=>{const x=document.querySelector("#refPlayerWrap");ze(window,"keydown",B),ze(window,"click",A),ze(x,"contextmenu",I)});const b=()=>{R(1,O.dialogType=!1,O)},_=x=>{R(2,T.saturate=x.detail,T)},S=x=>{R(2,T.brightness=x.detail,T)},g=x=>{R(2,T.contrast=x.detail,T)};return D.$$set=x=>{"version"in x&&R(7,K=x.version),"nowLanguage"in x&&R(0,H=x.nowLanguage),"contextMenu"in x&&R(8,W=x.contextMenu)},D.$$.update=()=>{if(D.$$.dirty&256&&R(4,G=p.filter(x=>W.includes(x.key))),D.$$.dirty&2&&R(3,k=`left: ${O.mouseX}px;top:${O.mouseY}px`),D.$$.dirty&4){const x=document.querySelector("#dPlayerVideo");if(x){const y=(T.saturate*2.55).toFixed(2),l=(T.brightness*2.55).toFixed(2),u=(T.contrast*2.55).toFixed(2);x.style.filter=`saturate(${y}) brightness(${l}) contrast(${u})`,x.style["-webkit-filter"]=`saturate(${y}) brightness(${l}) contrast(${u})`}}},[H,O,T,k,G,P,C,K,W,b,_,S,g]}class ki extends rt{constructor(L){super(),tt(this,L,Mi,Oi,Je,{version:7,nowLanguage:0,contextMenu:8},Ci)}}const Mn="";function wi(D){$e(D,"svelte-1dcs6nc","@import '../asset/style/iconfont.css';div.svelte-1dcs6nc.svelte-1dcs6nc,span.svelte-1dcs6nc.svelte-1dcs6nc,p.svelte-1dcs6nc.svelte-1dcs6nc,img.svelte-1dcs6nc.svelte-1dcs6nc,i.svelte-1dcs6nc.svelte-1dcs6nc{margin:0;padding:0;border:0;font-size:100%;font:inherit;vertical-align:baseline}.iconfont.svelte-1dcs6nc.svelte-1dcs6nc{display:inline-block}.d-flex-x.svelte-1dcs6nc.svelte-1dcs6nc{display:flex}.d-flex-x.svelte-1dcs6nc.svelte-1dcs6nc{align-items:center}.mr5.svelte-1dcs6nc.svelte-1dcs6nc{margin-right:5px}.d-pointer.svelte-1dcs6nc.svelte-1dcs6nc{cursor:pointer}.rotating.svelte-1dcs6nc.svelte-1dcs6nc{animation:svelte-1dcs6nc-rotating 2s linear infinite}@keyframes svelte-1dcs6nc-rotating{100%{-webkit-transform:rotate(360deg)}}.f50.svelte-1dcs6nc.svelte-1dcs6nc{font-size:50px}.f24.svelte-1dcs6nc.svelte-1dcs6nc{font-size:24px}.d-loading.svelte-1dcs6nc.svelte-1dcs6nc{position:absolute;left:0;right:0;bottom:0px;top:0;display:flex;align-items:center;justify-content:center;background:rgba(0, 0, 0, 0.3);z-index:2;color:#efefef;text-align:center;font-size:13px}.loading-img.svelte-1dcs6nc.svelte-1dcs6nc{width:50px}.d-logo-loading.svelte-1dcs6nc.svelte-1dcs6nc{position:relative;width:100px;height:23px;overflow:hidden}.d-logo-loading.svelte-1dcs6nc .d-logo.svelte-1dcs6nc{width:100%;height:100%;background:url(https://s.thsi.cn/cd/ths-frontend-hxmui-container/front/thsc-hxmui/1.11.0/img/logo_light.ed78645a.png) 50%;background-size:cover}.d-logo-loading.svelte-1dcs6nc .d-light.svelte-1dcs6nc{position:absolute;left:0;top:50%;-webkit-transform:translateY(-50%);transform:translateY(-50%);width:32px;height:23px;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGIAAABaCAMAAAB0UnP8AAAAhFBMVEUAAAD///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////8g2+bRAAAALHRSTlMABAgVDx4uDCU9ODMZKUJcRiFWYGZKt06ojpeJUq95bmqzo6CTfYRydaybgZ4JNUQAAAd9SURBVGjejNWNVtpAEIbhpoECGii/ojUCapEU7v/++s27ux23kMTxHH/O0Tx+Mzubb7eqsPquGo0Gg0FZllVVDYeLxVg1/VT6cbEYqqqqVOl3RyP7M/7+W2sV9gEhYARQBoDH/6Du9aFCWaBgOIFRtBqhsgwhAcD9p0KxaG4I8RhFWwqAIglEIAGPv7OaUPomMo440dUrD5FlCAHS4x2JxiIRg55peApCIDAGixD+/dlsNg+l76QIoV0YnqNzGP+HUJdcANiEckRBPIcTrRk8RIlABrVICXj8drutrfTVFBAZlqOqaFXPNAoqaxMZSABQ10vKEKLIULOmjDyLgdA3CQQyAITn/0wVFBnkwPBWdaZwgjZNp2QgQgBWoWQsZcQctMqJzhTXIciw2ZBgtVqnQhGiZmVGd6e8TwhVGISOknUpAgfVfr/XZynB2MzsXEEEA6JNcMJPUxBqBHv8iTJFSWQwDyc6O5UJEC5oCAL2+6bZhWqaE0hmiKi8U719KodD3RsQZFCTlEDC0UqIjJTDY1R9nYLwYVsIFw4C9PzLh9XlIqY5HQ6r1XL5L8aCgXenyE+sEZOJ2uSCgGdKyG5nORRju82JQSuRnyefRBIUQc9/okCOyag3ED/GGaFqSeFEnARtsgwXhN8qIWbYPAKh3fgKgaAaiAiT+EGIIGjOHwC/rEx5/mAca02DTokYc0+1EoUTPuxAqE3M4RkhGiJsHGEadAqi6iAYRTbs+3vbiZoQEizDr/P5XXU+C7EYx2a/XkMw70RgdBJcTyEEx8lCkAHhDYQcl6M6BTHvJ/Ijm/oUFpsQCAZQGEyDTtXajK+myM4Tk6gV4tQcLwgCHqlgcKhaCGbRsRUKARGHbSGeIBAwiGHE/hCISR9RXB9ZNrteatiEiMIfymKETt0g2ra7yAhWmxBGxEm8v5vw8vIiQsZtovxEFD2rzXlKfUohBFB/6FRG3OUperdiHIma8xT7pDbp6a+vbUR/CifoE0e2ZilsJ1KIVxXEW06k7ZbQmyKN4u4uHVkR9EmTQPgyUXRsBcRkPqdPzc6GbSEQMGzeELvG7loukOymbdmKIp+2H9mPZ44TxMPDA0RIYXuhC6SFKNoWr6riVtCndTxPCoGQEWy3EZzZzhTFrT5N0pG92LDfIAQ4wXaf1hAcqKsUvRfUtpN4zwh/d0v4SgqOrIg4iicRCBlh1yDvC3uxQkiAuH3PBiEjwpGFYBSEyImLESsRs0SUbYSfJ67ZeEHVSxHqk4hzIijbC12DTyJO/4g0CvrU/a5gt7nI2QobBXvnBKvH/cEbScRcxNVVfkO42gpu2RNbEUI48fjItEXYbjPtSAw8RRcxdYLFy0cBwShE7J0YQ9y+PopEIFTxDoxb0VyPgmmfbdp+fYjovz4gfPEi8bdSc1ttI4qh6ENbqKF1ZojBLZi0BOqG/P8HRmeNthVFntFknvy2kHS2rn5xVRghhcLTB/0HiCq8akUtRw/DT0u0UyhCeGpxXNs/QKyrAgRlG4Sr4kmhwAi+LDxrNxFeowoQqYMSwnIgofh1H/FfCIWi1TZ+CuE9UrYpeIQiCPZkibYhHqQKQ3wp0S5WpGgbwsu21QoQJRSoAoTq9tdAtKoAQQcVwst++q2i6pl8BoHwunIEgop3qgjlwFcQRPt8PoJoy1F0Bo4YqjiRAzMiiqoq3nlvUc0j3lEItF0QWXgHot1akUc89csgqHiOiFpBmj0tCYpod+UoI0LbSh9C0EPRlUt4F6miIgKwibgGgk9PlhYKxDRt+4kvDxZeLFRUQZAFIUh3JCg9WRC5M8hJcC8CgiPGuJob5rmqolphBCGOCcGLUk9Op8kkuWQPjcNpT7S2NFCGKog6WPCeeLKlHLVWZATiRnrPMR4xgXlN9VZToaBW7LPi8BFxG/I0R0YHJVUI0VhREai7TqqWn/BTWn7UJ9vHgsp9pYsS4zmM4MkK0aoCwj3E1taALFtG+p0IdEGO0trAGPYNAARN9IZQM5ubNCAN4gjCMoibwX7FCeYmjNC4rVqxJbwci5i48dRTXUMZwYxQsMNP9clWRF5+0B683FumuRF6T/2TLT2zth+YoZUgO8FYCa5tHbsdc906stgcDG02sYHFZvipZo/yZcSsnaCWpxYOg/BdiYMIUrZ6j2pFfVKB4NlaNB7/Eo5/BrHPAEG4xEIQRKiiWc++WwFr28+mXKtyA9gAGQQlj1RTy5eWgqGMSbvywYiF/x9swE0RCSHWrcjb+M9eLZoVM58QBEOeujHGWWE5vQDABOvPRlcgTRREdwab/W5xmMRIJyQDXC523Smnl3hPzd0Chm5503TmDhZnMAOYk4aXILCTCMKaKgridqY66JoXxzy/5mFDNaKzQoxv9qi4GMKoN8kBwAapLkSxaYWkERF3OwYkDqs6esoG3EQxam7Q9QLtJ+7V8/BigySRZLfjtCoGh3og+cgdhJlA7D9yw8BVYpizgORbvf4P8B0vJSPaU312lYXcPhgBsR9O4M8TEp1iLSvaRwUDyDyv/m8i2RCxLoCqjRwPvKW/f+j7KYAIDeIN31OsfyvZzREAAAAASUVORK5CYII=) 50%;background-size:cover;opacity:0.6;-webkit-animation:svelte-1dcs6nc-move 0.8s ease-in-out infinite;animation:svelte-1dcs6nc-move 0.8s ease-in-out infinite}@keyframes svelte-1dcs6nc-move{from{left:0}to{left:100%}}")}function Sr(D){let L,R,G=["loadstart","waiting"].includes(D[1]),K,H,W=G&&br(D),O=D[1]=="ended"&&Ar(D),p=(D[1]=="error"||D[1]=="stalled")&&Dr(D);return{c(){L=re("div"),R=re("div"),W&&W.c(),K=le(),O&&O.c(),H=le(),p&&p.c(),q(R,"class","svelte-1dcs6nc"),q(L,"class","d-loading svelte-1dcs6nc"),q(L,"style",D[6])},m(P,T){fe(P,L,T),Z(L,R),W&&W.m(R,null),Z(R,K),O&&O.m(R,null),Z(R,H),p&&p.m(R,null)},p(P,T){T&2&&(G=["loadstart","waiting"].includes(P[1])),G?W?W.p(P,T):(W=br(P),W.c(),W.m(R,K)):W&&(W.d(1),W=null),P[1]=="ended"?O?O.p(P,T):(O=Ar(P),O.c(),O.m(R,H)):O&&(O.d(1),O=null),P[1]=="error"||P[1]=="stalled"?p?p.p(P,T):(p=Dr(P),p.c(),p.m(R,null)):p&&(p.d(1),p=null),T&64&&q(L,"style",P[6])},d(P){P&&de(L),W&&W.d(),O&&O.d(),p&&p.d()}}}function br(D){let L,R,G,K;function H(p,P){return p[3]?Ni:p[4]?Ui:p[5]==="ths"?Bi:Fi}let W=H(D),O=W(D);return{c(){L=re("span"),O.c(),R=le(),G=re("p"),K=ve(D[2]),q(G,"class","svelte-1dcs6nc"),q(L,"class","svelte-1dcs6nc")},m(p,P){fe(p,L,P),O.m(L,null),Z(L,R),Z(L,G),Z(G,K)},p(p,P){W===(W=H(p))&&O?O.p(p,P):(O.d(1),O=W(p),O&&(O.c(),O.m(L,R))),P&4&&xe(K,p[2])},d(p){p&&de(L),O.d()}}}function Fi(D){let L;return{c(){L=re("i"),q(L,"class","rotating iconfont icon-loading f50 svelte-1dcs6nc")},m(R,G){fe(R,L,G)},p:_e,d(R){R&&de(L)}}}function Bi(D){let L;return{c(){L=re("div"),L.innerHTML=`<div class="d-logo svelte-1dcs6nc"></div> 
              <div class="d-light svelte-1dcs6nc"></div>`,q(L,"class","d-logo-loading svelte-1dcs6nc")},m(R,G){fe(R,L,G)},p:_e,d(R){R&&de(L)}}}function Ui(D){let L,R;return{c(){L=re("img"),Rt(L.src,R=D[4])||q(L,"src",R),q(L,"alt",""),q(L,"class","rotating f50 loading-img svelte-1dcs6nc")},m(G,K){fe(G,L,K)},p(G,K){K&16&&!Rt(L.src,R=G[4])&&q(L,"src",R)},d(G){G&&de(L)}}}function Ni(D){let L,R;return{c(){L=new oi(!1),R=Et(),L.a=R},m(G,K){L.m(D[3],G,K),fe(G,R,K)},p(G,K){K&8&&L.p(G[3])},d(G){G&&de(R),G&&L.d()}}}function Ar(D){let L,R,G,K=D[0].replay+"",H,W,O;return{c(){L=re("span"),R=re("p"),G=re("i"),H=ve(K),q(G,"class","iconfont icon-replay f24 mr5 svelte-1dcs6nc"),q(R,"class","d-flex-x d-pointer svelte-1dcs6nc"),q(L,"class","svelte-1dcs6nc")},m(p,P){fe(p,L,P),Z(L,R),Z(R,G),Z(R,H),W||(O=he(R,"click",D[8]),W=!0)},p(p,P){P&1&&K!==(K=p[0].replay+"")&&xe(H,K)},d(p){p&&de(L),W=!1,O()}}}function Dr(D){let L,R,G,K=D[0].playError+"",H,W,O;return{c(){L=re("span"),R=re("p"),G=re("i"),H=ve(K),q(G,"class","iconfont icon-replay f24 mr5 svelte-1dcs6nc"),q(R,"class","d-flex-x d-pointer svelte-1dcs6nc"),q(L,"class","svelte-1dcs6nc")},m(p,P){fe(p,L,P),Z(L,R),Z(R,G),Z(R,H),W||(O=he(R,"click",D[8]),W=!0)},p(p,P){P&1&&K!==(K=p[0].playError+"")&&xe(H,K)},d(p){p&&de(L),W=!1,O()}}}function Ki(D){let L=D[7].includes(D[1]),R,G=L&&Sr(D);return{c(){G&&G.c(),R=Et()},m(K,H){G&&G.m(K,H),fe(K,R,H)},p(K,[H]){H&2&&(L=K[7].includes(K[1])),L?G?G.p(K,H):(G=Sr(K),G.c(),G.m(R.parentNode,R)):G&&(G.d(1),G=null)},i:_e,o:_e,d(K){G&&G.d(K),K&&de(R)}}}function Wi(D,L,R){const G=ht(),K=["loadstart","loadStateType","waiting","ended","error","stalled"];let{nowLanguage:H}=L,{loadType:W=H.loading}=L,{loadingText:O=""}=L,{loadingDom:p=""}=L,{loadingImg:P=""}=L,{loadingType:T=""}=L,k="";const C=()=>{G("playHandle")};return D.$$set=B=>{"nowLanguage"in B&&R(0,H=B.nowLanguage),"loadType"in B&&R(1,W=B.loadType),"loadingText"in B&&R(2,O=B.loadingText),"loadingDom"in B&&R(3,p=B.loadingDom),"loadingImg"in B&&R(4,P=B.loadingImg),"loadingType"in B&&R(5,T=B.loadingType)},D.$$.update=()=>{if(D.$$.dirty&2){let B="background: rgba(0, 0, 0, .1);z-index:1";W==="loadstart"&&(B="background: rgba(0, 0, 0, 1);;z-index:3"),R(6,k=B)}},[H,W,O,p,P,T,k,K,C]}class Gi extends rt{constructor(L){super(),tt(this,L,Wi,Ki,Je,{nowLanguage:0,loadType:1,loadingText:2,loadingDom:3,loadingImg:4,loadingType:5},wi)}}const kn="";function zi(D){$e(D,"svelte-q8odyd",".d-player-top.svelte-q8odyd{position:absolute;font-size:16px;left:0px;top:0;right:0px;color:#fff;display:flex;padding:0 20px;height:60px;background-image:linear-gradient(rgba(0, 0, 0, 0.6), transparent);justify-content:space-between;z-index:1}")}function Hi(D){let L,R,G=(D[0]||"")+"",K;return{c(){L=re("div"),R=re("p"),K=ve(G),q(R,"class","top-title"),q(L,"class","d-player-top svelte-q8odyd")},m(H,W){fe(H,L,W),Z(L,R),Z(R,K)},p(H,[W]){W&1&&G!==(G=(H[0]||"")+"")&&xe(K,G)},i:_e,o:_e,d(H){H&&de(L)}}}function Vi(D,L,R){let{title:G=""}=L;return D.$$set=K=>{"title"in K&&R(0,G=K.title)},[G]}class ji extends rt{constructor(L){super(),tt(this,L,Vi,Hi,Je,{title:0},zi)}}const wn="";function Yi(D){$e(D,"svelte-o0d56g",".d-flex-center.svelte-o0d56g{display:flex}.d-flex-center.svelte-o0d56g{justify-content:center;align-items:center}.d-status.svelte-o0d56g{text-align:center;font-size:14px;vertical-align:middle;background:rgba(0, 0, 0, 0.8);padding:0 8px;height:30px;border-radius:5px;display:flex;align-items:center;color:rgba(255, 255, 255, 0.95)}")}function Lr(D){let L,R,G,K=D[0].handleType=="volume"&&Pr(D),H=(D[0].handleType==="playbackRate"||D[0].isMultiplesPlay)&&Ir();return{c(){L=re("div"),K&&K.c(),R=le(),H&&H.c(),q(L,"class","d-status svelte-o0d56g")},m(W,O){fe(W,L,O),K&&K.m(L,null),Z(L,R),H&&H.m(L,null),G=!0},p(W,O){W[0].handleType=="volume"?K?(K.p(W,O),O&1&&se(K,1)):(K=Pr(W),K.c(),se(K,1),K.m(L,R)):K&&(Ue(),ue(K,1,1,()=>{K=null}),Ne()),W[0].handleType==="playbackRate"||W[0].isMultiplesPlay?H||(H=Ir(),H.c(),H.m(L,null)):H&&(H.d(1),H=null)},i(W){G||(se(K),G=!0)},o(W){ue(K),G=!1},d(W){W&&de(L),K&&K.d(),H&&H.d()}}}function Pr(D){let L,R,G,K=~~(D[0].volume*100)+"",H,W,O;return R=new gt({props:{size:"18",className:"d-status-icon",icon:`icon-volume-${D[0].volume==0?"mute":D[0].volume>.5?"up":"down"}`}}),{c(){L=re("li"),Pe(R.$$.fragment),G=le(),H=ve(K),W=ve("%"),q(L,"class","d-flex-center svelte-o0d56g")},m(p,P){fe(p,L,P),De(R,L,null),Z(L,G),Z(L,H),Z(L,W),O=!0},p(p,P){const T={};P&1&&(T.icon=`icon-volume-${p[0].volume==0?"mute":p[0].volume>.5?"up":"down"}`),R.$set(T),(!O||P&1)&&K!==(K=~~(p[0].volume*100)+"")&&xe(H,K)},i(p){O||(se(R.$$.fragment,p),O=!0)},o(p){ue(R.$$.fragment,p),O=!1},d(p){p&&de(L),Le(R)}}}function Ir(D){let L;return{c(){L=re("li"),L.innerHTML=`<d-icon size="12" icon="icon-play"></d-icon> 
        <d-icon size="12" icon="icon-play" style="margin-right:5px"></d-icon>5X\u901F\u64AD\u653E\u4E2D`,q(L,"class","d-flex-center svelte-o0d56g")},m(R,G){fe(R,L,G)},d(R){R&&de(L)}}}function Xi(D){let L,R,G=(D[0].handleType||D[0].isMultiplesPlay)&&Lr(D);return{c(){G&&G.c(),L=Et()},m(K,H){G&&G.m(K,H),fe(K,L,H),R=!0},p(K,[H]){K[0].handleType||K[0].isMultiplesPlay?G?(G.p(K,H),H&1&&se(G,1)):(G=Lr(K),G.c(),se(G,1),G.m(L.parentNode,L)):G&&(Ue(),ue(G,1,1,()=>{G=null}),Ne())},i(K){R||(se(G),R=!0)},o(K){ue(G),R=!1},d(K){G&&G.d(K),K&&de(L)}}}function qi(D,L,R){let{state:G}=L;return D.$$set=K=>{"state"in K&&R(0,G=K.state)},[G]}class Qi extends rt{constructor(L){super(),tt(this,L,qi,Xi,Je,{state:0},Yi)}}const Fn="";function Zi(D){$e(D,"svelte-9brao2",".d-radio.svelte-9brao2{position:relative;display:inline-block;padding-left:20px;box-sizing:border-box;height:18px;line-height:18px;font-size:14px;margin-left:12px;margin-top:10px;cursor:pointer;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.d-radio.svelte-9brao2::before{content:'';position:absolute;display:inline-block;top:2px;left:0;width:5px;height:5px;border:1px solid #ccc;border-radius:50%}.d-radio.d-radio-checked.svelte-9brao2::before{content:'';border-color:#409eff;position:absolute;display:inline-block;top:2px;left:0;width:5px;height:5px;border:1px solid #409eff;border-radius:50%}.d-radio.d-radio-checked.svelte-9brao2::after{content:'';position:absolute;top:5px;left:3px;display:inline-block;width:8px;height:8px;background-color:#00a1d6;border-radius:50%}")}function Ji(D){let L,R,G,K,H;return{c(){L=re("div"),R=ve(D[0]),q(L,"title",D[0]),q(L,"class","d-radio svelte-9brao2"),q(L,"style",G=`width:${D[1]}`),rr(L,"d-radio-checked",D[2])},m(W,O){fe(W,L,O),Z(L,R),K||(H=he(L,"click",Ct(D[3])),K=!0)},p(W,[O]){O&1&&xe(R,W[0]),O&1&&q(L,"title",W[0]),O&2&&G!==(G=`width:${W[1]}`)&&q(L,"style",G),O&4&&rr(L,"d-radio-checked",W[2])},i:_e,o:_e,d(W){W&&de(L),K=!1,H()}}}function $i(D,L,R){const G=ht();let{radioText:K=""}=L,{width:H="100%"}=L,W=!1;const O=()=>{R(2,W=!W),G("checkRadio",{radioText:K,isChecked:W})};return D.$$set=p=>{"radioText"in p&&R(0,K=p.radioText),"width"in p&&R(1,H=p.width)},[K,H,W,O]}class en extends rt{constructor(L){super(),tt(this,L,$i,Ji,Je,{radioText:0,width:1},Zi)}}const Bn="";function tn(D){$e(D,"svelte-bbg92z",".d-toast.svelte-bbg92z{position:fixed;top:50%;left:50%;transform:translate(-50%, -50%);background-color:rgba(40, 40, 40, 0.96);padding:0 18px;border-radius:10px}.d-toast-content.svelte-bbg92z{font-size:16px;line-height:1;word-break:break-all;color:#fefefe}")}function Rr(D){let L,R,G,K,H;return{c(){L=re("div"),R=re("p"),q(R,"class","d-toast-content svelte-bbg92z"),q(L,"class","d-toast svelte-bbg92z"),q(L,"style",G=`z-index: ${D[1]}`)},m(W,O){fe(W,L,O),Z(L,R),R.innerHTML=D[0],H=!0},p(W,O){(!H||O&1)&&(R.innerHTML=W[0]),(!H||O&2&&G!==(G=`z-index: ${W[1]}`))&&q(L,"style",G)},i(W){H||(lt(()=>{K||(K=et(L,it,{},!0)),K.run(1)}),H=!0)},o(W){K||(K=et(L,it,{},!1)),K.run(0),H=!1},d(W){W&&de(L),W&&K&&K.end()}}}function rn(D){let L,R,G=D[2]&&Rr(D);return{c(){G&&G.c(),L=Et()},m(K,H){G&&G.m(K,H),fe(K,L,H),R=!0},p(K,[H]){K[2]?G?(G.p(K,H),H&4&&se(G,1)):(G=Rr(K),G.c(),se(G,1),G.m(L.parentNode,L)):G&&(Ue(),ue(G,1,1,()=>{G=null}),Ne())},i(K){R||(se(G),R=!0)},o(K){ue(G),R=!1},d(K){G&&G.d(K),K&&de(L)}}}function nn(D,L,R){const G=ht();let{content:K=""}=L,{zIndex:H=9999}=L,{duration:W=2e3}=L,{isShow:O=!1}=L;return D.$$set=p=>{"content"in p&&R(0,K=p.content),"zIndex"in p&&R(1,H=p.zIndex),"duration"in p&&R(3,W=p.duration),"isShow"in p&&R(2,O=p.isShow)},D.$$.update=()=>{D.$$.dirty&12&&O&&setTimeout(()=>{G("closeIsShow")},W)},[K,H,O,W]}class sn extends rt{constructor(L){super(),tt(this,L,nn,rn,Je,{content:0,zIndex:1,duration:3,isShow:2},tn)}}const Un="";function an(D){$e(D,"svelte-bjqzkb",".d-feedback-container.svelte-bjqzkb.svelte-bjqzkb{position:absolute;left:0;top:0;right:0;bottom:0;display:flex;justify-content:center;align-items:center;z-index:3}.d-feedback-container.svelte-bjqzkb .dialog.svelte-bjqzkb{width:400px;height:240px;background-color:rgba(33, 33, 33, 0.9);color:#ffffff}.d-feedback-container.svelte-bjqzkb .dialog .header.svelte-bjqzkb{width:100%;height:40px;display:flex;justify-content:center;align-items:center;font-size:16px;position:relative}.d-feedback-container.svelte-bjqzkb .dialog .header.svelte-bjqzkb::after{content:' ';position:absolute;width:100%;height:1px;bottom:0;left:0;background-color:hsla(0, 0%, 100%, 0.4)}.d-feedback-container.svelte-bjqzkb .dialog .header .icon-close.svelte-bjqzkb{position:absolute;right:0px;top:8px;width:40px;height:40px;line-height:40px;text-align:center;cursor:pointer;font:inherit}.d-feedback-container.svelte-bjqzkb .dialog .content.svelte-bjqzkb{position:relative;text-align:left}.d-feedback-container.svelte-bjqzkb .dialog .other.svelte-bjqzkb{font-size:14px;margin-left:12px}.d-feedback-container.svelte-bjqzkb .dialog #otherContent.svelte-bjqzkb{background-color:#191919;border:1px solid hsla(0, 0%, 100%, 0.4);resize:none;color:#ccc;margin-top:10px}.d-feedback-container.svelte-bjqzkb .dialog #otherContent.svelte-bjqzkb::-webkit-scrollbar{width:5px;background-color:rgba(255, 255, 255, 0.5)}.d-feedback-container.svelte-bjqzkb .dialog #otherContent.svelte-bjqzkb::-webkit-scrollbar-thumb{width:5px;height:5px;background-color:rgba(0, 0, 0, 0.5);border-radius:10px}.d-feedback-container.svelte-bjqzkb .dialog .footer.svelte-bjqzkb{text-align:center}.d-feedback-container.svelte-bjqzkb .dialog .footer .d-player-filter-reset.svelte-bjqzkb{cursor:pointer;margin-top:10px;padding:3px 20px;display:inline-block;border-radius:2px;font-size:12px;background:rgba(133, 133, 133, 0.5)}.d-feedback-container.svelte-bjqzkb .dialog .footer .d-player-filter-reset.svelte-bjqzkb:hover{background:rgba(255, 255, 255, 0.3)}")}function Cr(D,L,R){const G=D.slice();return G[13]=L[R],G}function Or(D){let L,R,G,K,H=D[1].playerFeedBack+"",W,O,p,P,T,k,C,B=D[1].other+"",I,A,b,_,S,g,x,y,l=D[1].confirm+"",u,a,s,m,v,i,n,E=D[8],r=[];for(let t=0;t<E.length;t+=1)r[t]=Mr(Cr(D,E,t));const o=t=>ue(r[t],1,1,()=>{r[t]=null});return{c(){L=re("div"),R=re("div"),G=re("div"),K=re("span"),W=ve(H),O=le(),p=re("i"),p.textContent="X",P=le(),T=re("div");for(let t=0;t<r.length;t+=1)r[t].c();k=le(),C=re("span"),I=ve(B),A=ve("\uFF1A"),b=le(),_=re("textarea"),g=le(),x=re("div"),y=re("span"),u=ve(l),q(p,"class","icon-close svelte-bjqzkb"),q(G,"class","header svelte-bjqzkb"),q(C,"class","other svelte-bjqzkb"),q(_,"name","otherContent"),q(_,"id","otherContent"),q(_,"cols","36"),q(_,"rows","3"),q(_,"placeholder",S=D[1].feedbackPlaceHolder),q(_,"class","svelte-bjqzkb"),q(T,"class","content svelte-bjqzkb"),q(y,"title",a=D[1].confirm),q(y,"aria-label",s=D[1].confirm),q(y,"class","d-player-filter-reset svelte-bjqzkb"),q(x,"class","footer svelte-bjqzkb"),q(R,"class","dialog svelte-bjqzkb"),q(L,"class","d-feedback-container svelte-bjqzkb")},m(t,f){fe(t,L,f),Z(L,R),Z(R,G),Z(G,K),Z(K,W),Z(G,O),Z(G,p),Z(R,P),Z(R,T);for(let e=0;e<r.length;e+=1)r[e].m(T,null);Z(T,k),Z(T,C),Z(C,I),Z(C,A),Z(T,b),Z(T,_),tr(_,D[2]),Z(R,g),Z(R,x),Z(x,y),Z(y,u),v=!0,i||(n=[he(p,"click",D[5]),he(_,"input",D[10]),he(y,"click",D[6]),he(R,"click",Ct(D[9]))],i=!0)},p(t,f){if((!v||f&2)&&H!==(H=t[1].playerFeedBack+"")&&xe(W,H),f&384){E=t[8];let e;for(e=0;e<E.length;e+=1){const h=Cr(t,E,e);r[e]?(r[e].p(h,f),se(r[e],1)):(r[e]=Mr(h),r[e].c(),se(r[e],1),r[e].m(T,k))}for(Ue(),e=E.length;e<r.length;e+=1)o(e);Ne()}(!v||f&2)&&B!==(B=t[1].other+"")&&xe(I,B),(!v||f&2&&S!==(S=t[1].feedbackPlaceHolder))&&q(_,"placeholder",S),f&4&&tr(_,t[2]),(!v||f&2)&&l!==(l=t[1].confirm+"")&&xe(u,l),(!v||f&2&&a!==(a=t[1].confirm))&&q(y,"title",a),(!v||f&2&&s!==(s=t[1].confirm))&&q(y,"aria-label",s)},i(t){if(!v){for(let f=0;f<E.length;f+=1)se(r[f]);lt(()=>{m||(m=et(L,it,{},!0)),m.run(1)}),v=!0}},o(t){r=r.filter(Boolean);for(let f=0;f<r.length;f+=1)ue(r[f]);m||(m=et(L,it,{},!1)),m.run(0),v=!1},d(t){t&&de(L),bt(r,t),t&&m&&m.end(),i=!1,st(n)}}}function Mr(D){let L,R;return L=new en({props:{radioText:D[13],width:"45%"}}),L.$on("checkRadio",D[7]),{c(){Pe(L.$$.fragment)},m(G,K){De(L,G,K),R=!0},p:_e,i(G){R||(se(L.$$.fragment,G),R=!0)},o(G){ue(L.$$.fragment,G),R=!1},d(G){Le(L,G)}}}function on(D){let L,R,G,K;L=new sn({props:{isShow:D[3],content:D[1].feedbackTips}}),L.$on("closeIsShow",D[4]);let H=D[0]&&Or(D);return{c(){Pe(L.$$.fragment),R=le(),H&&H.c(),G=Et()},m(W,O){De(L,W,O),fe(W,R,O),H&&H.m(W,O),fe(W,G,O),K=!0},p(W,[O]){const p={};O&8&&(p.isShow=W[3]),O&2&&(p.content=W[1].feedbackTips),L.$set(p),W[0]?H?(H.p(W,O),O&1&&se(H,1)):(H=Or(W),H.c(),se(H,1),H.m(G.parentNode,G)):H&&(Ue(),ue(H,1,1,()=>{H=null}),Ne())},i(W){K||(se(L.$$.fragment,W),se(H),K=!0)},o(W){ue(L.$$.fragment,W),ue(H),K=!1},d(W){Le(L,W),W&&de(R),H&&H.d(W),W&&de(G)}}}function ln(D,L,R){const G=ht();let{isShow:K=!1}=L,{nowLanguage:H}=L;const W=new Set([]);let O="",p=!1;const P=()=>{R(3,p=!1)},T=()=>{G("closeFeedBack")},k=()=>{R(3,p=!0),T(),G("feedbackConfirm",{feedbackOptions:[...W],feedbackValue:O})},C=({detail:{isChecked:b,radioText:_}})=>{b?W.add(_):W.delete(_)},B=[H.playStuck,H.progressError,H.videoBlack,H.soundPictueAsync];function I(b){hi.call(this,D,b)}function A(){O=this.value,R(2,O)}return D.$$set=b=>{"isShow"in b&&R(0,K=b.isShow),"nowLanguage"in b&&R(1,H=b.nowLanguage)},[K,H,O,p,P,T,k,C,B,I,A]}class un extends rt{constructor(L){super(),tt(this,L,ln,on,Je,{isShow:0,nowLanguage:1},an)}}const Nn="";function dn(D){$e(D,"svelte-v622af",".d-icon-feedback.svelte-v622af{position:absolute;width:15px;height:15px;top:20px;right:35px;z-index:2;cursor:pointer}")}function fn(D){let L,R,G,K,H,W,O;return K=new un({props:{nowLanguage:D[0],isShow:D[1]}}),K.$on("closeFeedBack",D[3]),K.$on("feedbackConfirm",D[4]),{c(){L=re("div"),L.innerHTML='<svg t="1669096469269" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5486" width="25" height="25"><path d="M514.048 54.272q95.232 0 178.688 36.352t145.92 98.304 98.304 145.408 35.84 178.688-35.84 178.176-98.304 145.408-145.92 98.304-178.688 35.84-178.176-35.84-145.408-98.304-98.304-145.408-35.84-178.176 35.84-178.688 98.304-145.408 145.408-98.304 178.176-36.352zM515.072 826.368q26.624 0 44.544-17.92t17.92-43.52q0-26.624-17.92-44.544t-44.544-17.92-44.544 17.92-17.92 44.544q0 25.6 17.92 43.52t44.544 17.92zM567.296 574.464q-1.024-16.384 20.48-34.816t48.128-40.96 49.152-50.688 24.576-65.024q2.048-39.936-8.192-74.752t-33.792-59.904-60.928-39.936-87.552-14.848q-62.464 0-103.936 22.016t-67.072 53.248-35.84 64.512-9.216 55.808q1.024 26.624 16.896 38.912t34.304 12.8 33.792-10.24 15.36-31.232q0-12.288 7.68-30.208t20.992-34.304 32.256-27.648 42.496-11.264q46.08 0 73.728 23.04t25.6 57.856q0 17.408-10.24 32.256t-26.112 28.672-33.792 27.648-33.792 28.672-26.624 32.256-11.776 37.888l1.024 38.912q0 15.36 14.336 29.184t37.888 14.848q23.552-1.024 37.376-15.36t12.8-32.768l0-24.576z" p-id="5487" fill="rgba(255,255,255,0.5)"></path></svg>',G=le(),Pe(K.$$.fragment),q(L,"class","d-icon-feedback svelte-v622af")},m(p,P){fe(p,L,P),fe(p,G,P),De(K,p,P),H=!0,W||(O=he(L,"click",Ct(D[2])),W=!0)},p(p,[P]){const T={};P&1&&(T.nowLanguage=p[0]),P&2&&(T.isShow=p[1]),K.$set(T)},i(p){H||(lt(()=>{R||(R=et(L,it,{},!0)),R.run(1)}),se(K.$$.fragment,p),H=!0)},o(p){R||(R=et(L,it,{},!1)),R.run(0),ue(K.$$.fragment,p),H=!1},d(p){p&&de(L),p&&R&&R.end(),p&&de(G),Le(K,p),W=!1,O()}}}function cn(D,L,R){const G=ht();let{nowLanguage:K}=L,H=!1;const W=()=>{R(1,H=!0)},O=()=>{R(1,H=!1)},p=({detail:P})=>{G("feedbackConfirm",P)};return D.$$set=P=>{"nowLanguage"in P&&R(0,K=P.nowLanguage)},[K,H,W,O,p]}class hn extends rt{constructor(L){super(),tt(this,L,cn,fn,Je,{nowLanguage:0},dn)}}const vn=["loadstart","durationchange","loadedmetadata","loadeddata","progress","canplay","canplaythrough","play","pause","playing","seeking","seeked","waiting","timeupdate","ended","error","stalled"],Kn="";function gn(D){$e(D,"svelte-uvv227","div.svelte-uvv227.svelte-uvv227,span.svelte-uvv227.svelte-uvv227,ul.svelte-uvv227.svelte-uvv227,li.svelte-uvv227.svelte-uvv227,video.svelte-uvv227.svelte-uvv227{margin:0;padding:0;border:0;font-size:100%;font:inherit;vertical-align:baseline}ul.svelte-uvv227.svelte-uvv227{list-style:none}.d-fade-in-enter-active.svelte-uvv227.svelte-uvv227,.d-fade-in-leave-active.svelte-uvv227.svelte-uvv227{transition:0.5s}.d-fade-in-enter-from.svelte-uvv227.svelte-uvv227,.d-fade-in-leave-to.svelte-uvv227.svelte-uvv227{opacity:0}.d-scale-out-enter-active.svelte-uvv227.svelte-uvv227,.d-scale-out-leave-active.svelte-uvv227.svelte-uvv227{transition:0.3s}.d-scale-out-leave-to.svelte-uvv227.svelte-uvv227{transform:scale(1.3);opacity:0}.rotateHover.svelte-uvv227.svelte-uvv227{transition:0.2s}.rotateHover.svelte-uvv227.svelte-uvv227:hover{transform:rotate(90deg)}.rotating.svelte-uvv227.svelte-uvv227{animation:svelte-uvv227-rotating 2s linear infinite}@keyframes svelte-uvv227-rotating{100%{-webkit-transform:rotate(360deg)}}.iconfont.svelte-uvv227.svelte-uvv227{display:inline-block}.d-flex-x.svelte-uvv227.svelte-uvv227,.d-flex-y.svelte-uvv227.svelte-uvv227,.d-flex-center.svelte-uvv227.svelte-uvv227{display:flex}.d-flex-x.svelte-uvv227.svelte-uvv227{align-items:center}.d-flex-y.svelte-uvv227.svelte-uvv227{justify-content:center}.d-flex-center.svelte-uvv227.svelte-uvv227{justify-content:center;align-items:center}.mr5.svelte-uvv227.svelte-uvv227{margin-right:5px}.mr10.svelte-uvv227.svelte-uvv227{margin-right:10px}.ml5.svelte-uvv227.svelte-uvv227{margin-left:5px}.ml10.svelte-uvv227.svelte-uvv227{margin-left:10px}.d-pointer.svelte-uvv227.svelte-uvv227{cursor:pointer}.d-player-wrap.svelte-uvv227.svelte-uvv227{position:relative;overflow:hidden;background-color:#000}.d-player-wrap.web-full-screen.svelte-uvv227.svelte-uvv227{z-index:9999999;position:fixed;left:0;top:0;width:100vw !important;height:100vh !important}.d-player-wrap.svelte-uvv227 .d-player-video.svelte-uvv227{position:relative;z-index:1;width:100%;height:100%}.d-player-wrap.svelte-uvv227 .d-player-video .d-player-video-poster.svelte-uvv227{position:absolute;height:100%;width:100%;top:0;left:0}.d-player-wrap.svelte-uvv227 .d-player-video .d-player-video-main.svelte-uvv227{width:100%;height:100%;transition:0.2s}.d-player-wrap.svelte-uvv227 .d-player-video .d-player-video-main.video-mirror.svelte-uvv227{transform:rotateY(180deg)}.d-player-wrap.svelte-uvv227 .d-player-control.svelte-uvv227{transition:0.1s;transform:translateY(45px);position:absolute;z-index:2;left:0;bottom:0;height:50px;width:100%;color:#fff}.d-player-wrap.svelte-uvv227 .d-player-control .d-control-progress.svelte-uvv227{width:100%;margin:0 auto;position:relative;height:5px;cursor:pointer}.d-player-wrap.svelte-uvv227 .d-player-control .d-control-progress .d-progress-bar.svelte-uvv227{position:absolute;left:0;right:0;bottom:0;width:100%;transition:height 0.1s;height:3px;z-index:1}.d-player-wrap.svelte-uvv227 .d-player-control .d-control-progress .d-progress-bar .d-slider__runway.svelte-uvv227{transition:height 0.1s;height:100%}.d-player-wrap.svelte-uvv227 .d-player-control .d-control-progress .d-progress-bar .d-slider__runway .d-slider__bar.svelte-uvv227::before{transform:translateY(-50%) scale(0, 0)}.d-player-wrap.svelte-uvv227 .d-player-control .d-control-progress:hover .d-progress-bar.svelte-uvv227{height:100%}.d-player-wrap.svelte-uvv227 .d-player-control .d-control-progress:hover .d-progress-bar .d-slider__bar.svelte-uvv227::before{transform:translateY(-50%) scale(1, 1) !important}.d-player-wrap.svelte-uvv227 .d-player-control .d-control-tool.svelte-uvv227{position:absolute;padding:0 10px;background-image:linear-gradient(180deg, transparent, rgba(0, 0, 0, 0.37), rgba(0, 0, 0, 0.75), rgba(0, 0, 0, 0.75));display:flex;justify-content:space-between;align-items:center;top:10px;left:0;bottom:0;width:100%;box-sizing:border-box}.d-player-wrap.svelte-uvv227 .d-player-control .d-control-tool .d-tool-bar.svelte-uvv227{display:flex;height:100%}.d-player-wrap.svelte-uvv227 .d-player-control .d-control-tool .d-tool-bar .d-tool-item.svelte-uvv227{position:relative;height:100%;cursor:pointer;text-align:center;padding:0 8px;display:flex;align-items:center;font-size:13px}.d-player-wrap.svelte-uvv227 .d-player-control .d-control-tool .d-tool-bar .d-tool-item .d-tool-item-main.svelte-uvv227{position:absolute;white-space:nowrap;z-index:2;bottom:98%;left:50%;padding:6px 16px;box-sizing:border-box;display:none;background:rgba(0, 0, 0, 0.95);border-radius:5px;transform:translateX(-50%)}.d-player-wrap.svelte-uvv227 .d-player-control .d-control-tool .d-tool-bar .d-tool-item:hover .d-tool-item-main.svelte-uvv227{display:flex}.d-player-wrap.svelte-uvv227 .d-player-control .d-control-tool .d-tool-time.svelte-uvv227{font-size:12px;color:#fff;font-weight:300}.d-player-wrap.svelte-uvv227 .d-player-control .d-control-tool .d-tool-time .total-time.svelte-uvv227{color:rgba(255, 255, 255, 0.8)}.d-player-wrap.svelte-uvv227 .d-player-control .d-control-tool .volume-box.svelte-uvv227{height:160px;width:50px;display:flex;align-items:center;justify-content:center}.d-player-wrap.svelte-uvv227 .d-player-control .d-control-tool .volume-box .volume-main.svelte-uvv227{height:90%;display:flex;width:60px;flex-direction:column;align-items:center}.d-player-wrap.svelte-uvv227 .d-player-control .d-control-tool .volume-box .volume-main .volume-text-size.svelte-uvv227{margin-bottom:10px;font-size:12px;font-weight:400}.d-player-wrap.svelte-uvv227 .d-player-control .d-control-tool .volume-box .volume-main.is-muted .d-slider__bar.svelte-uvv227{height:0 !important}.d-player-wrap.svelte-uvv227 .d-player-control .d-control-tool .speed-main.svelte-uvv227{padding:0 10px}.d-player-wrap.svelte-uvv227 .d-player-control .d-control-tool .speed-main li.svelte-uvv227{cursor:pointer;line-height:34px;font-size:12px;color:#fff}.d-player-wrap.svelte-uvv227 .d-player-control .d-control-tool .speed-main li.svelte-uvv227:hover{opacity:0.8}.d-player-wrap.svelte-uvv227 .d-player-control .d-control-tool .speed-main li.speed-active.svelte-uvv227{color:var(--primary-color);font-weight:bold}.d-player-wrap.d-player-wrap-hover.svelte-uvv227 .d-player-control.svelte-uvv227{transform:translateY(0px)}.d-player-wrap.d-player-wrap-hover.svelte-uvv227 .d-control-progress.svelte-uvv227{width:96%}.d-player-state.svelte-uvv227.svelte-uvv227,.d-player-input.svelte-uvv227.svelte-uvv227{position:absolute;left:0;top:0;right:0;bottom:40px;display:flex;justify-content:center;align-items:center;overflow:hidden;z-index:1}.d-player-input.svelte-uvv227.svelte-uvv227{width:100%;border:none;opacity:0;cursor:default}.d-play-btn.svelte-uvv227.svelte-uvv227{width:90px;height:90px;color:#fff;display:flex;align-items:center;justify-content:center;background-color:rgba(0, 0, 0, 0.7);border-radius:50%}.d-player-lightoff.svelte-uvv227.svelte-uvv227{position:fixed;left:0;top:0;width:100vw;height:100vh;background-color:rgba(0, 0, 0, 0.9)}.is-lightoff.svelte-uvv227.svelte-uvv227{z-index:999998}.d-left-0.svelte-uvv227.svelte-uvv227{left:0 !important}.d-player-state-top.svelte-uvv227.svelte-uvv227{position:absolute;left:0;top:0;right:0;bottom:40px px;display:flex;justify-content:center;align-items:flex-start;padding-top:5%;overflow:hidden;z-index:1}")}function kr(D,L,R){const G=D.slice();return G[86]=L[R],G}function wr(D,L,R){const G=D.slice();return G[86]=L[R],G[90]=R,G}function Fr(D){let L,R,G;return{c(){L=re("div"),q(L,"class","d-player-lightoff svelte-uvv227")},m(K,H){fe(K,L,H),G=!0},i(K){G||(lt(()=>{R||(R=et(L,it,{},!0)),R.run(1)}),G=!0)},o(K){R||(R=et(L,it,{},!1)),R.run(0),G=!1},d(K){K&&de(L),K&&R&&R.end()}}}function Br(D){let L,R;return L=new ji({props:{title:D[4]}}),{c(){Pe(L.$$.fragment)},m(G,K){De(L,G,K),R=!0},p(G,K){const H={};K[0]&16&&(H.title=G[4]),L.$set(H)},i(G){R||(se(L.$$.fragment,G),R=!0)},o(G){ue(L.$$.fragment,G),R=!1},d(G){Le(L,G)}}}function mn(D){let L,R,G,K,H,W,O,p=D[15].playBtnState==="play"&&Ur();K=new Qi({props:{state:D[15]}});let P=D[15].hasFeedBack&&(D[15].playBtnState==="play"||D[15].isVideoHovering)&&Nr(D);return{c(){L=re("div"),p&&p.c(),R=le(),G=re("div"),Pe(K.$$.fragment),H=le(),P&&P.c(),W=Et(),q(L,"class","d-player-state svelte-uvv227"),q(G,"class","d-player-state-top svelte-uvv227")},m(T,k){fe(T,L,k),p&&p.m(L,null),fe(T,R,k),fe(T,G,k),De(K,G,null),fe(T,H,k),P&&P.m(T,k),fe(T,W,k),O=!0},p(T,k){T[15].playBtnState==="play"?p?k[0]&32768&&se(p,1):(p=Ur(),p.c(),se(p,1),p.m(L,null)):p&&(Ue(),ue(p,1,1,()=>{p=null}),Ne());const C={};k[0]&32768&&(C.state=T[15]),K.$set(C),T[15].hasFeedBack&&(T[15].playBtnState==="play"||T[15].isVideoHovering)?P?(P.p(T,k),k[0]&32768&&se(P,1)):(P=Nr(T),P.c(),se(P,1),P.m(W.parentNode,W)):P&&(Ue(),ue(P,1,1,()=>{P=null}),Ne())},i(T){O||(se(p),se(K.$$.fragment,T),se(P),O=!0)},o(T){ue(p),ue(K.$$.fragment,T),ue(P),O=!1},d(T){T&&de(L),p&&p.d(),T&&de(R),T&&de(G),Le(K),T&&de(H),P&&P.d(T),T&&de(W)}}}function Ur(D){let L,R,G,K;return R=new gt({props:{icon:"icon-play",size:"30"}}),{c(){L=re("div"),Pe(R.$$.fragment),q(L,"class","d-play-btn svelte-uvv227")},m(H,W){fe(H,L,W),De(R,L,null),K=!0},i(H){K||(se(R.$$.fragment,H),lt(()=>{G||(G=et(L,it,{},!0)),G.run(1)}),K=!0)},o(H){ue(R.$$.fragment,H),G||(G=et(L,it,{},!1)),G.run(0),K=!1},d(H){H&&de(L),Le(R),H&&G&&G.end()}}}function Nr(D){let L,R;return L=new hn({props:{nowLanguage:D[23]}}),L.$on("feedbackConfirm",D[26]),{c(){Pe(L.$$.fragment)},m(G,K){De(L,G,K),R=!0},p:_e,i(G){R||(se(L.$$.fragment,G),R=!0)},o(G){ue(L.$$.fragment,G),R=!1},d(G){Le(L,G)}}}function pn(D){let L,R,G;return{c(){L=re("input"),q(L,"type","input"),L.readOnly=!0,q(L,"class","d-player-input svelte-uvv227"),q(L,"maxlength","0")},m(K,H){fe(K,L,H),D[60](L),R||(G=[he(L,"dblclick",D[61]),he(L,"click",D[31]),he(L,"keyup",D[28]),he(L,"keydown",D[62])],R=!0)},p:_e,d(K){K&&de(L),D[60](null),R=!1,st(G)}}}function Kr(D){let L,R=D[8].includes("progress"),G,K,H,W,O,p,P=D[8].includes("progressTime"),T,k,C=D[15].qualityLevels.length&&D[8].includes("quality"),B,I=D[8].includes("speedRate"),A,b=D[8].includes("volume"),_,S=D[8].includes("setting"),g,x=D[8].includes("pip")&&document.pictureInPictureEnabled,y,l=D[8].includes("pageFullScreen"),u,a=D[8].includes("fullScreen"),s,m,v,i=R&&Wr(D);O=new gt({props:{size:"24",icon:`icon-${D[15].playBtnState}`}});let n=P&&Gr(D),E=C&&zr(D),r=I&&Vr(D),o=b&&Yr(D),t=S&&Xr(D),f=x&&qr(D),e=l&&Qr(D),h=a&&Zr(D);return{c(){L=re("div"),i&&i.c(),G=le(),K=re("div"),H=re("div"),W=re("div"),Pe(O.$$.fragment),p=le(),n&&n.c(),T=le(),k=re("div"),E&&E.c(),B=le(),r&&r.c(),A=le(),o&&o.c(),_=le(),t&&t.c(),g=le(),f&&f.c(),y=le(),e&&e.c(),u=le(),h&&h.c(),q(W,"class","d-tool-item svelte-uvv227"),q(H,"class","d-tool-bar svelte-uvv227"),q(k,"class","d-tool-bar svelte-uvv227"),q(K,"class","d-control-tool svelte-uvv227"),q(L,"class","d-player-control svelte-uvv227")},m(d,c){fe(d,L,c),i&&i.m(L,null),Z(L,G),Z(L,K),Z(K,H),Z(H,W),De(O,W,null),Z(H,p),n&&n.m(H,null),Z(K,T),Z(K,k),E&&E.m(k,null),Z(k,B),r&&r.m(k,null),Z(k,A),o&&o.m(k,null),Z(k,_),t&&t.m(k,null),Z(k,g),f&&f.m(k,null),Z(k,y),e&&e.m(k,null),Z(k,u),h&&h.m(k,null),D[72](L),s=!0,m||(v=[he(W,"click",D[31]),he(K,"click",D[29])],m=!0)},p(d,c){c[0]&256&&(R=d[8].includes("progress")),R?i?(i.p(d,c),c[0]&256&&se(i,1)):(i=Wr(d),i.c(),se(i,1),i.m(L,G)):i&&(Ue(),ue(i,1,1,()=>{i=null}),Ne());const M={};c[0]&32768&&(M.icon=`icon-${d[15].playBtnState}`),O.$set(M),c[0]&256&&(P=d[8].includes("progressTime")),P?n?n.p(d,c):(n=Gr(d),n.c(),n.m(H,null)):n&&(n.d(1),n=null),c[0]&33024&&(C=d[15].qualityLevels.length&&d[8].includes("quality")),C?E?E.p(d,c):(E=zr(d),E.c(),E.m(k,B)):E&&(E.d(1),E=null),c[0]&256&&(I=d[8].includes("speedRate")),I?r?r.p(d,c):(r=Vr(d),r.c(),r.m(k,A)):r&&(r.d(1),r=null),c[0]&256&&(b=d[8].includes("volume")),b?o?(o.p(d,c),c[0]&256&&se(o,1)):(o=Yr(d),o.c(),se(o,1),o.m(k,_)):o&&(Ue(),ue(o,1,1,()=>{o=null}),Ne()),c[0]&256&&(S=d[8].includes("setting")),S?t?(t.p(d,c),c[0]&256&&se(t,1)):(t=Xr(d),t.c(),se(t,1),t.m(k,g)):t&&(Ue(),ue(t,1,1,()=>{t=null}),Ne()),c[0]&256&&(x=d[8].includes("pip")&&document.pictureInPictureEnabled),x?f?(f.p(d,c),c[0]&256&&se(f,1)):(f=qr(d),f.c(),se(f,1),f.m(k,y)):f&&(Ue(),ue(f,1,1,()=>{f=null}),Ne()),c[0]&256&&(l=d[8].includes("pageFullScreen")),l?e?(e.p(d,c),c[0]&256&&se(e,1)):(e=Qr(d),e.c(),se(e,1),e.m(k,u)):e&&(Ue(),ue(e,1,1,()=>{e=null}),Ne()),c[0]&256&&(a=d[8].includes("fullScreen")),a?h?(h.p(d,c),c[0]&256&&se(h,1)):(h=Zr(d),h.c(),se(h,1),h.m(k,null)):h&&(Ue(),ue(h,1,1,()=>{h=null}),Ne())},i(d){s||(se(i),se(O.$$.fragment,d),se(o),se(t),se(f),se(e),se(h),s=!0)},o(d){ue(i),ue(O.$$.fragment,d),ue(o),ue(t),ue(f),ue(e),ue(h),s=!1},d(d){d&&de(L),i&&i.d(),Le(O),n&&n.d(),E&&E.d(),r&&r.d(),o&&o.d(),t&&t.d(),f&&f.d(),e&&e.d(),h&&h.d(),D[72](null),m=!1,st(v)}}}function Wr(D){let L,R,G;return R=new Pt({props:{className:"d-progress-bar",disabled:!D[15].canSpeed,hoverText:D[15].progressCursorTime,modelValue:D[15].playProgress,preload:D[15].preloadBar}}),R.$on("onMousemove",D[34]),R.$on("change",D[33]),R.$on("update",D[63]),R.$on("speedDisabled",D[27]),{c(){L=re("div"),Pe(R.$$.fragment),q(L,"class","d-control-progress svelte-uvv227")},m(K,H){fe(K,L,H),De(R,L,null),G=!0},p(K,H){const W={};H[0]&32768&&(W.disabled=!K[15].canSpeed),H[0]&32768&&(W.hoverText=K[15].progressCursorTime),H[0]&32768&&(W.modelValue=K[15].playProgress),H[0]&32768&&(W.preload=K[15].preloadBar),R.$set(W)},i(K){G||(se(R.$$.fragment,K),G=!0)},o(K){ue(R.$$.fragment,K),G=!1},d(K){K&&de(L),Le(R)}}}function Gr(D){let L,R,G=D[15].currentTime+"",K,H,W,O,p,P=D[15].totalTime+"",T;return{c(){L=re("div"),R=re("span"),K=ve(G),H=le(),W=re("span"),W.textContent="/",O=le(),p=re("span"),T=ve(P),q(R,"class","svelte-uvv227"),Ot(W,"margin","0 3px"),q(W,"class","svelte-uvv227"),q(p,"class","total-time svelte-uvv227"),q(L,"class","d-tool-item d-tool-time audioTrack-btn svelte-uvv227")},m(k,C){fe(k,L,C),Z(L,R),Z(R,K),Z(L,H),Z(L,W),Z(L,O),Z(L,p),Z(p,T)},p(k,C){C[0]&32768&&G!==(G=k[15].currentTime+"")&&xe(K,G),C[0]&32768&&P!==(P=k[15].totalTime+"")&&xe(T,P)},d(k){k&&de(L)}}}function zr(D){let L,R=(D[15].qualityLevels.length&&(D[15].qualityLevels[D[15].currentLevel]||{}).height)+"",G,K,H,W,O=D[15].qualityLevels,p=[];for(let P=0;P<O.length;P+=1)p[P]=Hr(wr(D,O,P));return{c(){L=re("div"),G=ve(R),K=ve(`P
              `),H=re("div"),W=re("ul");for(let P=0;P<p.length;P+=1)p[P].c();q(W,"class","speed-main svelte-uvv227"),Ot(W,"text-align","center"),q(H,"class","d-tool-item-main svelte-uvv227"),q(L,"class","d-tool-item quality-btn svelte-uvv227")},m(P,T){fe(P,L,T),Z(L,G),Z(L,K),Z(L,H),Z(H,W);for(let k=0;k<p.length;k+=1)p[k].m(W,null)},p(P,T){if(T[0]&32768&&R!==(R=(P[15].qualityLevels.length&&(P[15].qualityLevels[P[15].currentLevel]||{}).height)+"")&&xe(G,R),T[0]&32768|T[1]&32){O=P[15].qualityLevels;let k;for(k=0;k<O.length;k+=1){const C=wr(P,O,k);p[k]?p[k].p(C,T):(p[k]=Hr(C),p[k].c(),p[k].m(W,null))}for(;k<p.length;k+=1)p[k].d(1);p.length=O.length}},d(P){P&&de(L),bt(p,P)}}}function Hr(D){let L,R=D[86].height+"",G,K,H,W,O;function p(){return D[64](D[86],D[90])}return{c(){L=re("li"),G=ve(R),K=ve(`P
                    `),q(L,"class",H=we(D[15].currentLevel==D[90]?"speed-active":"")+" svelte-uvv227")},m(P,T){fe(P,L,T),Z(L,G),Z(L,K),W||(O=he(L,"click",p),W=!0)},p(P,T){D=P,T[0]&32768&&R!==(R=D[86].height+"")&&xe(G,R),T[0]&32768&&H!==(H=we(D[15].currentLevel==D[90]?"speed-active":"")+" svelte-uvv227")&&q(L,"class",H)},d(P){P&&de(L),W=!1,O()}}}function Vr(D){let L,R=(D[15].speedActive=="1.0"?D[23].speed:D[15].speedActive+"x")+"",G,K,H,W,O=D[15].speedRate,p=[];for(let P=0;P<O.length;P+=1)p[P]=jr(kr(D,O,P));return{c(){L=re("div"),G=ve(R),K=le(),H=re("div"),W=re("ul");for(let P=0;P<p.length;P+=1)p[P].c();q(W,"class","speed-main svelte-uvv227"),q(H,"class","d-tool-item-main svelte-uvv227"),q(L,"class","d-tool-item speedRate-btn svelte-uvv227")},m(P,T){fe(P,L,T),Z(L,G),Z(L,K),Z(L,H),Z(H,W);for(let k=0;k<p.length;k+=1)p[k].m(W,null)},p(P,T){if(T[0]&32768&&R!==(R=(P[15].speedActive=="1.0"?P[23].speed:P[15].speedActive+"x")+"")&&xe(G,R),T[0]&32768|T[1]&64){O=P[15].speedRate;let k;for(k=0;k<O.length;k+=1){const C=kr(P,O,k);p[k]?p[k].p(C,T):(p[k]=jr(C),p[k].c(),p[k].m(W,null))}for(;k<p.length;k+=1)p[k].d(1);p.length=O.length}},d(P){P&&de(L),bt(p,P)}}}function jr(D){let L,R=D[86]+"",G,K,H,W,O;function p(){return D[65](D[86])}return{c(){L=re("li"),G=ve(R),K=ve(`x
                    `),q(L,"class",H=we(D[15].speedActive==D[86]?"speed-active":"")+" svelte-uvv227")},m(P,T){fe(P,L,T),Z(L,G),Z(L,K),W||(O=he(L,"click",p),W=!0)},p(P,T){D=P,T[0]&32768&&R!==(R=D[86]+"")&&xe(G,R),T[0]&32768&&H!==(H=we(D[15].speedActive==D[86]?"speed-active":"")+" svelte-uvv227")&&q(L,"class",H)},d(P){P&&de(L),W=!1,O()}}}function Yr(D){let L,R,G,K,H=(D[15].muted?0:~~(D[15].volume*100))+"",W,O,p,P,T,k,C,B,I,A,b;return P=new Pt({props:{hover:!1,size:"5px",vertical:!0,modelValue:D[15].volume}}),P.$on("change",D[66]),P.$on("update",D[67]),B=new gt({props:{size:"20",icon:`icon-volume-${D[15].volume==0||D[15].muted?"mute":D[15].volume>.5?"up":"down"}`}}),{c(){L=re("div"),R=re("div"),G=re("div"),K=re("span"),W=ve(H),O=ve("%"),p=le(),Pe(P.$$.fragment),k=le(),C=re("span"),Pe(B.$$.fragment),q(K,"class","volume-text-size svelte-uvv227"),q(G,"class",T=we(`${D[15].muted?"is-muted":""} volume-main`)+" svelte-uvv227"),q(R,"class","d-tool-item-main volume-box svelte-uvv227"),Ot(R,"width","52px"),Ot(C,"display","flex"),q(C,"class","svelte-uvv227"),q(L,"class","d-tool-item volume-btn svelte-uvv227")},m(_,S){fe(_,L,S),Z(L,R),Z(R,G),Z(G,K),Z(K,W),Z(K,O),Z(G,p),De(P,G,null),Z(L,k),Z(L,C),De(B,C,null),I=!0,A||(b=he(C,"click",D[32]),A=!0)},p(_,S){(!I||S[0]&32768)&&H!==(H=(_[15].muted?0:~~(_[15].volume*100))+"")&&xe(W,H);const g={};S[0]&32768&&(g.modelValue=_[15].volume),P.$set(g),(!I||S[0]&32768&&T!==(T=we(`${_[15].muted?"is-muted":""} volume-main`)+" svelte-uvv227"))&&q(G,"class",T);const x={};S[0]&32768&&(x.icon=`icon-volume-${_[15].volume==0||_[15].muted?"mute":_[15].volume>.5?"up":"down"}`),B.$set(x)},i(_){I||(se(P.$$.fragment,_),se(B.$$.fragment,_),I=!0)},o(_){ue(P.$$.fragment,_),ue(B.$$.fragment,_),I=!1},d(_){_&&de(L),Le(P),Le(B),A=!1,b()}}}function Xr(D){let L,R,G,K,H,W,O=D[23].mirror+"",p,P,T,k,C,B=D[23].loop+"",I,A,b,_,S,g=D[23].lightOff+"",x,y,l,u;return R=new gt({props:{size:"20",className:"rotateHover",icon:"icon-settings"}}),T=new jt({props:{modelValue:D[15].mirror}}),T.$on("change",D[38]),T.$on("update",D[68]),b=new jt({props:{modelValue:D[15].loop}}),b.$on("change",D[39]),b.$on("update",D[69]),l=new jt({props:{modelValue:D[15].lightOff}}),l.$on("change",D[40]),l.$on("update",D[70]),{c(){L=re("div"),Pe(R.$$.fragment),G=le(),K=re("div"),H=re("ul"),W=re("li"),p=ve(O),P=le(),Pe(T.$$.fragment),k=le(),C=re("li"),I=ve(B),A=le(),Pe(b.$$.fragment),_=le(),S=re("li"),x=ve(g),y=le(),Pe(l.$$.fragment),q(W,"class","svelte-uvv227"),q(C,"class","svelte-uvv227"),q(S,"class","svelte-uvv227"),q(H,"class","speed-main svelte-uvv227"),q(K,"class","d-tool-item-main svelte-uvv227"),q(L,"class","d-tool-item setting-btn svelte-uvv227")},m(a,s){fe(a,L,s),De(R,L,null),Z(L,G),Z(L,K),Z(K,H),Z(H,W),Z(W,p),Z(W,P),De(T,W,null),Z(H,k),Z(H,C),Z(C,I),Z(C,A),De(b,C,null),Z(H,_),Z(H,S),Z(S,x),Z(S,y),De(l,S,null),u=!0},p(a,s){const m={};s[0]&32768&&(m.modelValue=a[15].mirror),T.$set(m);const v={};s[0]&32768&&(v.modelValue=a[15].loop),b.$set(v);const i={};s[0]&32768&&(i.modelValue=a[15].lightOff),l.$set(i)},i(a){u||(se(R.$$.fragment,a),se(T.$$.fragment,a),se(b.$$.fragment,a),se(l.$$.fragment,a),u=!0)},o(a){ue(R.$$.fragment,a),ue(T.$$.fragment,a),ue(b.$$.fragment,a),ue(l.$$.fragment,a),u=!1},d(a){a&&de(L),Le(R),Le(T),Le(b),Le(l)}}}function qr(D){let L,R,G,K,H,W,O;return R=new gt({props:{size:"20",icon:"icon-pip"}}),{c(){L=re("div"),Pe(R.$$.fragment),G=le(),K=re("div"),K.textContent=`${D[23].pictureInPicture}`,q(K,"class","d-tool-item-main svelte-uvv227"),q(L,"class","d-tool-item pip-btn svelte-uvv227")},m(p,P){fe(p,L,P),De(R,L,null),Z(L,G),Z(L,K),H=!0,W||(O=he(L,"click",D[41]),W=!0)},p:_e,i(p){H||(se(R.$$.fragment,p),H=!0)},o(p){ue(R.$$.fragment,p),H=!1},d(p){p&&de(L),Le(R),W=!1,O()}}}function Qr(D){let L,R,G,K,H,W,O,p,P;return R=new gt({props:{size:"20",icon:"icon-web-screen"}}),{c(){L=re("div"),Pe(R.$$.fragment),G=le(),K=re("div"),H=ve(D[22]),q(K,"class",W=we(`d-tool-item-main  ${D[8].includes("fullScreen")?"":"d-left-0"}`)+" svelte-uvv227"),q(L,"class","d-tool-item pip-btn svelte-uvv227")},m(T,k){fe(T,L,k),De(R,L,null),Z(L,G),Z(L,K),Z(K,H),O=!0,p||(P=he(L,"click",D[71]),p=!0)},p(T,k){(!O||k[0]&4194304)&&xe(H,T[22]),(!O||k[0]&256&&W!==(W=we(`d-tool-item-main  ${T[8].includes("fullScreen")?"":"d-left-0"}`)+" svelte-uvv227"))&&q(K,"class",W)},i(T){O||(se(R.$$.fragment,T),O=!0)},o(T){ue(R.$$.fragment,T),O=!1},d(T){T&&de(L),Le(R),p=!1,P()}}}function Zr(D){let L,R,G,K,H,W,O,p,P;return W=new gt({props:{size:"20",icon:"icon-screen"}}),{c(){L=re("div"),R=re("div"),G=ve(D[21]),H=le(),Pe(W.$$.fragment),q(R,"class",K=we(`d-tool-item-main ${D[15].fullScreen||D[0]==="en"?"d-left-0":""}`)+" svelte-uvv227"),q(L,"class","d-tool-item fullScreen-btn svelte-uvv227")},m(T,k){fe(T,L,k),Z(L,R),Z(R,G),Z(L,H),De(W,L,null),O=!0,p||(P=he(L,"click",D[42]),p=!0)},p(T,k){(!O||k[0]&2097152)&&xe(G,T[21]),(!O||k[0]&32769&&K!==(K=we(`d-tool-item-main ${T[15].fullScreen||T[0]==="en"?"d-left-0":""}`)+" svelte-uvv227"))&&q(R,"class",K)},i(T){O||(se(W.$$.fragment,T),O=!0)},o(T){ue(W.$$.fragment,T),O=!1},d(T){T&&de(L),Le(W),p=!1,P()}}}function yn(D){let L,R,G,K,H,W,O,p,P,T,k,C,B,I,A,b,_,S,g,x,y,l,u,a=D[15].lightOff&&Fr(),s=D[15].fullScreen&&D[4]&&Br(D),m=!ft&&mn(D),v=!ft&&pn(D);A=new Gi({props:{nowLanguage:D[23],loadingText:D[14],loadType:D[15].loadStateType,loadingDom:D[12],loadingImg:D[11],loadingType:D[13]}}),A.$on("playHandle",D[30]),_=new ki({props:{contextMenu:D[10],nowLanguage:D[23],version:En}});let i=!ft&&D[7]&&Kr(D);return{c(){a&&a.c(),L=le(),R=re("div"),G=re("div"),K=re("video"),H=ve("\u60A8\u7684\u6D4F\u89C8\u5668\u4E0D\u652F\u6301Video\u6807\u7B7E\u3002"),k=le(),s&&s.c(),C=le(),m&&m.c(),B=le(),v&&v.c(),I=le(),Pe(A.$$.fragment),b=le(),Pe(_.$$.fragment),S=le(),i&&i.c(),q(K,"class",W=we(`${D[15].mirror?"video-mirror":""} d-player-video-main`)+" svelte-uvv227"),q(K,"id","dPlayerVideoMain"),K.controls=O=ft&&D[15].canSpeed,K.muted=p=D[15].muted,K.loop=P=D[15].loop,K.playsInline=D[6],Rt(K.src,T=D[3])||q(K,"src",T),q(K,"poster",D[5]),q(K,"preload",D[9]),q(K,"webkit-playsinline",D[6]),q(K,"width","100%"),q(K,"height","100%"),q(G,"id","dPlayerVideo"),q(G,"class","d-player-video svelte-uvv227"),q(R,"id","refPlayerWrap"),q(R,"style",g=`width:${D[1]};height:${D[2]};--primary-color:rgb(${D[24]});--primary-color-end:rgb(${D[25]})`),q(R,"class",x=we(`d-player-wrap ${D[15].webFullScreen?"web-full-screen":""} ${D[15].lightOff?"is-lightoff":""} ${D[15].playBtnState==="play"||D[15].isVideoHovering?"d-player-wrap-hover":""}`)+" svelte-uvv227")},m(n,E){a&&a.m(n,E),fe(n,L,E),fe(n,R,E),Z(R,G),Z(G,K),Z(K,H),D[58](K),isNaN(D[15].volume)||(K.volume=D[15].volume),Z(R,k),s&&s.m(R,null),Z(R,C),m&&m.m(R,null),Z(R,B),v&&v.m(R,null),Z(R,I),De(A,R,null),Z(R,b),De(_,R,null),Z(R,S),i&&i.m(R,null),D[73](R),y=!0,l||(u=[he(K,"volumechange",D[59]),he(K,"loadstart",function(){ke(D[20].loadstart)&&D[20].loadstart.apply(this,arguments)}),he(K,"durationchange",function(){ke(D[20].durationchange)&&D[20].durationchange.apply(this,arguments)}),he(K,"loadedmetadata",function(){ke(D[20].loadedmetadata)&&D[20].loadedmetadata.apply(this,arguments)}),he(K,"loadeddata",function(){ke(D[20].loadeddata)&&D[20].loadeddata.apply(this,arguments)}),he(K,"progress",function(){ke(D[20].progress)&&D[20].progress.apply(this,arguments)}),he(K,"canplay",function(){ke(D[20].canplay)&&D[20].canplay.apply(this,arguments)}),he(K,"canplaythrough",function(){ke(D[20].canplaythrough)&&D[20].canplaythrough.apply(this,arguments)}),he(K,"ended",function(){ke(D[20].ended)&&D[20].ended.apply(this,arguments)}),he(K,"error",function(){ke(D[20].error)&&D[20].error.apply(this,arguments)}),he(K,"pause",function(){ke(D[20].pause)&&D[20].pause.apply(this,arguments)}),he(K,"play",function(){ke(D[20].play)&&D[20].play.apply(this,arguments)}),he(K,"playing",function(){ke(D[20].playing)&&D[20].playing.apply(this,arguments)}),he(K,"seeked",function(){ke(D[20].seeked)&&D[20].seeked.apply(this,arguments)}),he(K,"seeking",function(){ke(D[20].seeking)&&D[20].seeking.apply(this,arguments)}),he(K,"stalled",function(){ke(D[20].stalled)&&D[20].stalled.apply(this,arguments)}),he(K,"timeupdate",function(){ke(D[20].timeupdate)&&D[20].timeupdate.apply(this,arguments)}),he(K,"waiting",function(){ke(D[20].waiting)&&D[20].waiting.apply(this,arguments)}),he(R,"mousemove",D[35])],l=!0)},p(n,E){D=n,D[15].lightOff?a?E[0]&32768&&se(a,1):(a=Fr(),a.c(),se(a,1),a.m(L.parentNode,L)):a&&(Ue(),ue(a,1,1,()=>{a=null}),Ne()),(!y||E[0]&32768&&W!==(W=we(`${D[15].mirror?"video-mirror":""} d-player-video-main`)+" svelte-uvv227"))&&q(K,"class",W),(!y||E[0]&32768&&O!==(O=ft&&D[15].canSpeed))&&(K.controls=O),(!y||E[0]&32768&&p!==(p=D[15].muted))&&(K.muted=p),(!y||E[0]&32768&&P!==(P=D[15].loop))&&(K.loop=P),(!y||E[0]&64)&&(K.playsInline=D[6]),(!y||E[0]&8&&!Rt(K.src,T=D[3]))&&q(K,"src",T),(!y||E[0]&32)&&q(K,"poster",D[5]),(!y||E[0]&512)&&q(K,"preload",D[9]),(!y||E[0]&64)&&q(K,"webkit-playsinline",D[6]),E[0]&32768&&!isNaN(D[15].volume)&&(K.volume=D[15].volume),D[15].fullScreen&&D[4]?s?(s.p(D,E),E[0]&32784&&se(s,1)):(s=Br(D),s.c(),se(s,1),s.m(R,C)):s&&(Ue(),ue(s,1,1,()=>{s=null}),Ne()),ft||m.p(D,E),ft||v.p(D,E);const r={};E[0]&16384&&(r.loadingText=D[14]),E[0]&32768&&(r.loadType=D[15].loadStateType),E[0]&4096&&(r.loadingDom=D[12]),E[0]&2048&&(r.loadingImg=D[11]),E[0]&8192&&(r.loadingType=D[13]),A.$set(r);const o={};E[0]&1024&&(o.contextMenu=D[10]),_.$set(o),!ft&&D[7]?i?(i.p(D,E),E[0]&128&&se(i,1)):(i=Kr(D),i.c(),se(i,1),i.m(R,null)):i&&(Ue(),ue(i,1,1,()=>{i=null}),Ne()),(!y||E[0]&6&&g!==(g=`width:${D[1]};height:${D[2]};--primary-color:rgb(${D[24]});--primary-color-end:rgb(${D[25]})`))&&q(R,"style",g),(!y||E[0]&32768&&x!==(x=we(`d-player-wrap ${D[15].webFullScreen?"web-full-screen":""} ${D[15].lightOff?"is-lightoff":""} ${D[15].playBtnState==="play"||D[15].isVideoHovering?"d-player-wrap-hover":""}`)+" svelte-uvv227"))&&q(R,"class",x)},i(n){y||(se(a),se(s),se(m),se(A.$$.fragment,n),se(_.$$.fragment,n),se(i),y=!0)},o(n){ue(a),ue(s),ue(m),ue(A.$$.fragment,n),ue(_.$$.fragment,n),ue(i),y=!1},d(n){a&&a.d(n),n&&de(L),n&&de(R),D[58](null),s&&s.d(),m&&m.d(),v&&v.d(),Le(A),Le(_),i&&i.d(),D[73](null),l=!1,st(u)}}}const En="1.0.0";function Tn(D,L,R){let G,K;_i();const H=ht();let{languageType:W="zh-cn"}=L;const O=vr[W]||vr["zh-cn"];let{width:p="800px"}=L,{height:P="450px"}=L,{color:T="#E93030"}=L,{colorEnd:k="#F06F6F"}=L,{src:C=""}=L,{title:B=""}=L,{type:I="video/mp4"}=L,{poster:A=""}=L,{webFullScreen:b=!1}=L,{canSpeed:_=!0}=L,{currentTime:S=0}=L,{playsinline:g=!1}=L,{muted:x=!1}=L,{speedRate:y=["2.0","1.5","1.25","1.0","0.75","0.5"]}=L,{autoPlay:l=!1}=L,{loop:u=!1}=L,{mirror:a=!1}=L,{lightOff:s=!1}=L,{volume:m=1}=L,{control:v=!0}=L,{controlBtns:i=["progress","progressTime","quality","speedRate","volume","setting","pip","pageFullScreen","fullScreen"]}=L,{preload:n="auto"}=L,{qualityLevels:E=[]}=L,{contextMenu:r=["filter","hotkey","copy","version"]}=L,{loadingImg:o=""}=L,{loadingDom:t=""}=L,{loadingType:f=""}=L,{loadingText:e=O.loading}=L,{hasFeedBack:h=!1}=L;const d={width:p,height:P,color:T,colorEnd:k,src:C,title:B,type:I,poster:A,webFullScreen:b,canSpeed:_,playsinline:g,muted:x,speedRate:y,autoPlay:l,loop:u,mirror:a,lightOff:s,volume:m,control:v,controlBtns:i,preload:n,qualityLevels:E,hasFeedBack:h,isShowFeedBack:!1,currentTime:"",dVideo:null,playBtnState:l?"pause":"play",loadStateType:"loadstart",fullScreen:!1,handleType:"",preloadBar:0,totalTime:"00:00:00",isVideoHovering:!0,speedActive:"1.0",playProgress:0,isMultiplesPlay:!1,longPressTimeout:null,progressCursorTime:"00:00:00",currentLevel:0};let c,M,F,w,U;const N=hr(d.color),z=hr(d.colorEnd),V=({detail:J})=>{H("feedbackConfirm",J)},j=({detail:J})=>{H("speedDisabled",J)},Y=cr(500,()=>{R(15,d.handleType="",d)}),X=J=>{J.preventDefault(),J.code=="ArrowUp"?R(15,d.volume=d.volume+.1>1?1:d.volume+.1,d):R(15,d.volume=d.volume-.1<0?0:d.volume-.1,d),R(15,d.muted=!1,d),R(15,d.handleType="volume",d),Y()},Q=J=>{!_||(R(15,d.dVideo.currentTime=d.dVideo.currentTime<10?.1:d.dVideo.currentTime-10,d),ye.timeupdate(d.dVideo),ne())},te=(J,ge)=>{J.preventDefault();const We=J.type;if(J.keyCode===39){if(ne(),We==="keyup"){if(clearTimeout(d.longPressTimeout),!_&&!d.longPressTimeout)return;d.isMultiplesPlay?(R(15,d.dVideo.playbackRate=+d.speedActive,d),R(15,d.isMultiplesPlay=!1,d)):(R(15,d.dVideo.currentTime=d.dVideo.currentTime+10,d),ye.timeupdate(d.dVideo))}else if(We==="keydown"){if(!_)return;d.isMultiplesPlay&&clearTimeout(d.longPressTimeout),R(15,d.longPressTimeout=window.setTimeout(()=>{R(15,d.isMultiplesPlay=!0,d),R(15,d.dVideo.playbackRate=5,d),R(15,d.handleType="playbackRate",d),Y()},500),d)}}if(ge==="keydown"){switch(J.keyCode){case 32:ae(J);break;case 70:i.includes("fullScreen")&&Me();break;case 37:Q();break;case 38:X(J);break;case 40:X(J);break}Y()}},$=()=>{ft||U.focus()},ee=J=>{const{code:ge,message:We,name:Ze}=J;We.includes("play() failed because the user didn't interact with the document first")&&ge===0&&Ze==="NotAllowedError"?(R(15,d.muted=!0,d),Gt().then(()=>{ne()})):setTimeout(()=>{R(15,d.playBtnState="replay",d),R(15,d.loadStateType="error",d)},500)},ne=()=>{R(15,d.loadStateType="play",d);const J=d.dVideo.play();J&&J.catch(ge=>{ee(ge)}),R(15,d.playBtnState="pause",d)},oe=()=>{R(15,d.loadStateType="pause",d),d.dVideo.pause(),R(15,d.playBtnState="play",d)},ae=J=>{J&&J.preventDefault(),d.playBtnState=="play"||d.playBtnState=="replay"?ne():d.playBtnState=="pause"&&oe()},ie=()=>{R(15,d.muted=!d.muted,d),d.volume===0&&R(15,d.volume=.05,d)},ce=({detail:{ev:J,value:ge}})=>{var Ze,Ye;const We=d.dVideo.duration||((Ye=(Ze=d==null?void 0:d.dVideo)==null?void 0:Ze.target)==null?void 0:Ye.duration);R(15,d.dVideo.currentTime=We*ge,d),d.playBtnState==="play"&&ne()},me=({detail:{ev:J,val:ge}})=>{R(15,d.progressCursorTime=Vt(d.dVideo.duration*ge),d)},pe=cr(2500,()=>{R(15,d.isVideoHovering=!1,d)}),Ie=J=>{R(15,d.isVideoHovering=!0,d),pe()},Ee=(J,ge)=>{c&&(c.currentLevel=ge),R(15,d.currentLevel=ge,d)},Se=J=>{R(15,d.speedActive=J,d),R(15,d.dVideo.playbackRate=+J,d)},Te=J=>{H("mirrorChange",{mirrorStatus:J.detail,videoDom:d.dVideo})},be=J=>{H("loopChange",{loopStatus:J.detail,videoDom:d.dVideo})},Ae=J=>{H("lightOffChange",{lightOffStatus:J.detail,videoDom:d.dVideo})},Re=()=>{document.exitPictureInPicture()},Fe=()=>{d.dVideo.requestPictureInPicture()},Ce=()=>{document.pictureInPictureElement?Re():Fe()},Me=()=>{R(15,d.fullScreen=Ti(M),d)},Ge=(...J)=>ge=>J.reverse().reduce((We,Ze)=>{if(Ze)return Ze(We)},ge),ye=vn.reduce((J,ge)=>(J[ge]=We=>{["stalled","error"].includes(ge)&&R(15,d.playBtnState="replay",d),R(15,d.loadStateType=ge,d),["canplay","durationchange","progress","timeupdate"].includes(ge)||H(ge,{currentTime:d.dVideo.currentTime,duration:d.dVideo.duration})},J),{});ye.canplay=Ge(ye.canplay,J=>{(d.playBtnState!=="play"||d.autoPlay)&&ne(),H("canplay",{videoDom:d.dVideo,duration:d.dVideo.duration})}),ye.ended=Ge(ye.ended,J=>{R(15,d.playBtnState="replay",d)}),ye.durationchange=J=>{H("durationchange",{duration:d.dVideo.duration}),S!==0&&R(15,d.dVideo.currentTime=S,d),ye.timeupdate(J)},ye.progress=J=>{const ge=J.target.duration;H("progress",{duration:ge,currentTime:d.dVideo.currentTime});const We=J.target.buffered,Ze=J.target.buffered.length&&J.target.buffered.end(We-1);R(15,d.preloadBar=Ze/ge,d)},ye.timeupdate=J=>{const ge=J.duration||J.target.duration||0,We=J.currentTime||J.target.currentTime;H("timeupdate",{currentTime:We,duration:ge}),R(15,d.playProgress=We/ge,d),R(15,d.currentTime=Vt(We),d),R(15,d.totalTime=Vt(ge),d)},ye.playing=Ge(ye.playing,()=>{R(15,d.playBtnState="pause",d)}),ye.pause=Ge(ye.pause,()=>{R(15,d.playBtnState="play",d)}),ye.error=Ge(ye.error,J=>{R(15,d.loadStateType="error",d),R(15,d.playBtnState="replay",d)});const ot=()=>{if(d.dVideo.canPlayType(I)||d.dVideo.canPlayType("application/vnd.apple.mpegurl")){c&&(c.detachMedia(),R(15,d.qualityLevels=[],d)),Se(d.speedActive||"1.0");return}at.isSupported()&&(c=new at({fragLoadingTimeOut:2e3}),c.detachMedia(),c.attachMedia(d.dVideo),c.on(at.Events.MEDIA_ATTACHED,()=>{c.loadSource(C),c.on(at.Events.MANIFEST_PARSED,(J,ge)=>{R(15,d.qualityLevels=ge.levels||[],d)})}),c.on(at.Events.ERROR,(J,ge)=>{if(ge.fatal)switch(ge.type){case at.ErrorTypes.NETWORK_ERROR:c.startLoad();break;case at.ErrorTypes.MEDIA_ERROR:c.recoverMediaError();break;default:c.destroy();break}}),c.on(at.Events.LEVEL_SWITCHING,(J,ge)=>{H(at.Events.LEVEL_SWITCHING,ge.level)}),c.on(at.Events.LEVEL_SWITCHED,(J,ge)=>{R(15,d.currentLevel=ge.level,d),H(at.Events.LEVEL_SWITCHED,d.currentLevel)}))};sr(()=>{R(15,d.dVideo=F,d),$()});function Xe(J){ut[J?"unshift":"push"](()=>{F=J,R(17,F)})}function He(){d.volume=this.volume,R(15,d)}function Ve(J){ut[J?"unshift":"push"](()=>{U=J,R(19,U)})}const Ke=()=>{i.includes("fullScreen")&&Me()},Be=J=>{te(J,"keydown")},je=J=>{R(15,d.playProgress=J.detail,d)},qe=(J,ge)=>{Ee(J,ge)},Oe=J=>{Se(J)},nt=()=>{R(15,d.muted=!1,d)},Qe=J=>{R(15,d.volume=J.detail,d)},xt=J=>{R(15,d.mirror=J.detail,d)},ct=J=>{R(15,d.loop=J.detail,d)},mt=J=>{R(15,d.lightOff=J.detail,d)},Bt=()=>{R(15,d.webFullScreen=!d.webFullScreen,d)};function St(J){ut[J?"unshift":"push"](()=>{w=J,R(18,w)})}function Yt(J){ut[J?"unshift":"push"](()=>{M=J,R(16,M)})}return D.$$set=J=>{"languageType"in J&&R(0,W=J.languageType),"width"in J&&R(1,p=J.width),"height"in J&&R(2,P=J.height),"color"in J&&R(43,T=J.color),"colorEnd"in J&&R(44,k=J.colorEnd),"src"in J&&R(3,C=J.src),"title"in J&&R(4,B=J.title),"type"in J&&R(45,I=J.type),"poster"in J&&R(5,A=J.poster),"webFullScreen"in J&&R(46,b=J.webFullScreen),"canSpeed"in J&&R(47,_=J.canSpeed),"currentTime"in J&&R(48,S=J.currentTime),"playsinline"in J&&R(6,g=J.playsinline),"muted"in J&&R(49,x=J.muted),"speedRate"in J&&R(50,y=J.speedRate),"autoPlay"in J&&R(51,l=J.autoPlay),"loop"in J&&R(52,u=J.loop),"mirror"in J&&R(53,a=J.mirror),"lightOff"in J&&R(54,s=J.lightOff),"volume"in J&&R(55,m=J.volume),"control"in J&&R(7,v=J.control),"controlBtns"in J&&R(8,i=J.controlBtns),"preload"in J&&R(9,n=J.preload),"qualityLevels"in J&&R(56,E=J.qualityLevels),"contextMenu"in J&&R(10,r=J.contextMenu),"loadingImg"in J&&R(11,o=J.loadingImg),"loadingDom"in J&&R(12,t=J.loadingDom),"loadingType"in J&&R(13,f=J.loadingType),"loadingText"in J&&R(14,e=J.loadingText),"hasFeedBack"in J&&R(57,h=J.hasFeedBack)},D.$$.update=()=>{D.$$.dirty[0]&32768&&R(22,G=d.webFullScreen?O.exitWebFullScreen:O.webFullScreen),D.$$.dirty[0]&32768&&R(21,K=d.fullScreen?O.exitFullScreen:O.fullScreen),D.$$.dirty[0]&8&&C&&Gt().then(()=>{ot()})},[W,p,P,C,B,A,g,v,i,n,r,o,t,f,e,d,M,F,w,U,ye,K,G,O,N,z,V,j,te,$,ne,ae,ie,ce,me,Ie,Ee,Se,Te,be,Ae,Ce,Me,T,k,I,b,_,S,x,y,l,u,a,s,m,E,h,Xe,He,Ve,Ke,Be,je,qe,Oe,nt,Qe,xt,ct,mt,Bt,St,Yt]}class _n extends rt{constructor(L){super(),tt(this,L,Tn,yn,Je,{languageType:0,width:1,height:2,color:43,colorEnd:44,src:3,title:4,type:45,poster:5,webFullScreen:46,canSpeed:47,currentTime:48,playsinline:6,muted:49,speedRate:50,autoPlay:51,loop:52,mirror:53,lightOff:54,volume:55,control:7,controlBtns:8,preload:9,qualityLevels:56,contextMenu:10,loadingImg:11,loadingDom:12,loadingType:13,loadingText:14,hasFeedBack:57},gn,[-1,-1,-1])}}return _n});
